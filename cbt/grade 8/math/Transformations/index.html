<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 8 Math - Transformations | Ideolix Learning Hub</title>
    <style>
        /* CSS Variables for Transformations Theme */
        :root {
            --primary-blue: #2196F3;
            --primary-green: #4CAF50;
            --primary-orange: #FF9800;
            --primary-purple: #9C27B0;
            --accent-red: #F44336;
            --accent-teal: #009688;
            --accent-yellow: #FFC107;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --original-glow: 0 0 20px rgba(33, 150, 243, 0.4);
            --transformed-glow: 0 0 20px rgba(76, 175, 80, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(33, 150, 243, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 152, 0, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(156, 39, 176, 0.05) 0%, transparent 70%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(10px);
        }

        .logo {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            border-radius: 10px;
            overflow: hidden;
            background-color: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info h1 {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }

        /* Card Styles */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(5px);
        }

        /* Welcome Page */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 30px 20px;
        }

        .welcome-title {
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 25px;
            max-width: 800px;
            line-height: 1.6;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(33, 150, 243, 0.15);
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 20px;
            border: 2px solid var(--primary-blue);
        }

        .topic-icon {
            font-size: 1.5rem;
        }

        .topic-name {
            font-weight: 600;
            color: var(--primary-blue);
        }

        .input-group {
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--dark-border);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .btn-primary:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(33, 150, 243, 0.4);
        }

        .btn-secondary {
            background: var(--primary-green);
            color: white;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-secondary:hover {
            background: #3d8b40;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-blue);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Topics Grid */
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        @media (max-width: 992px) {
            .topics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .topics-grid {
                grid-template-columns: 1fr;
            }
        }

        .topic-card {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .topic-card.translation {
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), transparent);
        }

        .topic-card.reflection {
            border-color: var(--primary-green);
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), transparent);
        }

        .topic-card.rotation {
            border-color: var(--primary-orange);
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), transparent);
        }

        .topic-card.enlargement {
            border-color: var(--primary-purple);
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), transparent);
        }

        .topic-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .topic-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .topic-card.translation .topic-title {
            color: var(--primary-blue);
        }

        .topic-card.reflection .topic-title {
            color: var(--primary-green);
        }

        .topic-card.rotation .topic-title {
            color: var(--primary-orange);
        }

        .topic-card.enlargement .topic-title {
            color: var(--primary-purple);
        }

        .topic-features {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--dark-border);
        }

        .topic-features h4 {
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .feature-list {
            list-style-type: none;
        }

        .feature-list li {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 4px;
            padding-left: 15px;
            position: relative;
        }

        .feature-list li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: var(--accent-teal);
        }

        /* Practice Page */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 20px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-bar {
            height: 8px;
            background: var(--dark-surface);
            border-radius: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-blue), var(--primary-green), var(--primary-orange), var(--primary-purple));
            border-radius: 8px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
        }

        .question-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .math-tip {
            background: rgba(255, 152, 0, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--accent-yellow);
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Options */
        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .option {
            padding: 15px;
            background: var(--dark-card);
            border: 2px solid var(--dark-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: rgba(33, 150, 243, 0.05);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--primary-green);
            color: var(--primary-green);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 25px;
            height: 25px;
            background: var(--primary-blue);
            border-radius: 50%;
            margin-right: 12px;
            font-weight: bold;
            color: white;
        }

        .option.correct .option-letter {
            background: var(--primary-green);
        }

        .option.incorrect .option-letter {
            background: var(--accent-red);
        }

        /* Feedback */
        .feedback-container {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .feedback-correct {
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid var(--primary-green);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid var(--accent-red);
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--primary-green);
        }

        .feedback-incorrect .feedback-icon {
            background: var(--accent-red);
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .feedback-correct .feedback-title {
            color: var(--primary-green);
        }

        .feedback-incorrect .feedback-title {
            color: var(--accent-red);
        }

        .feedback-explanation {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Navigation */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* Visualization Area */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 20px 0;
        }

        @media (max-width: 992px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .visualization-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--dark-border);
            overflow: auto;
        }

        /* Coordinate Plane */
        .coordinate-plane-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--primary-blue);
        }

        .visualizer-title {
            color: var(--primary-blue);
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .coordinate-plane {
            width: 100%;
            height: 300px;
            position: relative;
            background: var(--dark-surface);
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid var(--dark-border);
        }

        .grid-canvas {
            width: 100%;
            height: 100%;
        }

        .shape-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .shape-controls {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .shape-btn {
            padding: 8px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .shape-btn:hover {
            background: rgba(33, 150, 243, 0.1);
            border-color: var(--primary-blue);
        }

        .shape-btn.active {
            background: var(--primary-blue);
            color: white;
        }

        /* Transformation Controls */
        .transformation-controls {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--primary-green);
        }

        .transformation-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .transformation-tab {
            padding: 8px 15px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .transformation-tab.active {
            background: var(--primary-green);
            color: white;
        }

        .transformation-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }

        .transform-input {
            padding: 8px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.9rem;
            text-align: center;
        }

        .transform-slider {
            width: 100%;
            margin: 10px 0;
        }

        .transform-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 10px 0;
        }

        .transform-btn {
            padding: 8px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .transform-btn:hover {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--primary-green);
        }

        /* Reflection Simulator */
        .reflection-simulator {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--primary-green);
        }

        .mirror-line {
            position: absolute;
            background: rgba(76, 175, 80, 0.5);
            z-index: 1;
        }

        .mirror-line.horizontal {
            width: 100%;
            height: 2px;
            left: 0;
        }

        .mirror-line.vertical {
            width: 2px;
            height: 100%;
            top: 0;
        }

        .mirror-line.diagonal {
            width: 2px;
            height: 141%; /* sqrt(2)*100% for 45¬∞ diagonal */
            transform: rotate(45deg);
            transform-origin: top left;
        }

        /* Rotation Simulator */
        .rotation-simulator {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--primary-orange);
        }

        .center-point {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--accent-red);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
            box-shadow: 0 0 5px var(--accent-red);
        }

        .rotation-handle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--primary-orange);
            border-radius: 50%;
            cursor: grab;
            transform: translate(-50%, -50%);
            z-index: 4;
            box-shadow: 0 0 5px var(--primary-orange);
        }

        /* Enlargement Simulator */
        .enlargement-simulator {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--primary-purple);
        }

        .scale-factor-display {
            margin-top: 10px;
            padding: 8px;
            background: var(--dark-surface);
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            color: var(--primary-purple);
        }

        /* Transformation Rules */
        .transformation-rules {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--accent-teal);
        }

        .rules-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .rules-grid {
                grid-template-columns: 1fr;
            }
        }

        .rule-card {
            background: var(--dark-surface);
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .rule-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .rule-title {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--accent-teal);
            margin-bottom: 5px;
        }

        .rule-formula {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        /* Transformation Types */
        .transformation-types {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--accent-yellow);
        }

        .types-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        .type-card {
            background: var(--dark-surface);
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .type-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .type-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .type-name {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--accent-yellow);
        }

        /* Combined Transformations */
        .combined-transformations {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--accent-red);
        }

        .sequence-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .sequence-btn {
            padding: 6px 12px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 4px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sequence-btn.active {
            background: var(--accent-red);
            color: white;
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 30px 20px;
        }

        .results-title {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            margin: 0 auto 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .score-percentage {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 0.5s ease;
        }

        @keyframes transformAnimation {
            0% { opacity: 0.5; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .transform-animate {
            animation: transformAnimation 0.5s ease forwards;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 1.8rem;
            }
            
            .topics-grid {
                grid-template-columns: 1fr;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons .btn {
                width: 100%;
            }
            
            .transform-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .transformation-inputs {
                grid-template-columns: 1fr;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .types-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card fade-in" id="welcomePage">
            <h1 class="welcome-title">Grade 8 Math: Transformations</h1>
            <p class="welcome-subtitle">Explore the magical world of geometric transformations! Learn how shapes can slide, flip, turn, and grow while preserving their essential properties. Master reflection, rotation, translation, and enlargement through interactive visualization.</p>
            
            <div class="topic-badge">
                <span class="topic-icon">üîÑ‚ú®</span>
                <span class="topic-name">Geometric Transformations & Symmetry</span>
            </div>
            
            <div class="topics-grid">
                <div class="topic-card translation" onclick="showTopicInfo('translation')">
                    <div class="topic-icon">‚Üí</div>
                    <h3 class="topic-title">Translation</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 15px;">Sliding a shape without rotating or flipping it</p>
                    <div class="topic-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Same shape and size</li>
                            <li>Same orientation</li>
                            <li>Described by vector</li>
                            <li>Preserves all properties</li>
                        </ul>
                    </div>
                </div>
                
                <div class="topic-card reflection" onclick="showTopicInfo('reflection')">
                    <div class="topic-icon">‚ÜîÔ∏è</div>
                    <h3 class="topic-title">Reflection</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 15px;">Flipping a shape over a mirror line</p>
                    <div class="topic-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Mirror image</li>
                            <li>Same shape and size</li>
                            <li>Opposite orientation</li>
                            <li>Creates symmetry</li>
                        </ul>
                    </div>
                </div>
                
                <div class="topic-card rotation" onclick="showTopicInfo('rotation')">
                    <div class="topic-icon">‚Üª</div>
                    <h3 class="topic-title">Rotation</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 15px;">Turning a shape around a fixed point</p>
                    <div class="topic-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Same shape and size</li>
                            <li>Turns around center</li>
                            <li>Angle of rotation</li>
                            <li>Clockwise/anticlockwise</li>
                        </ul>
                    </div>
                </div>
                
                <div class="topic-card enlargement" onclick="showTopicInfo('enlargement')">
                    <div class="topic-icon">‚¨ÜÔ∏è</div>
                    <h3 class="topic-title">Enlargement</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 15px;">Changing size of a shape from a center point</p>
                    <div class="topic-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Same shape</li>
                            <li>Different size</li>
                            <li>Scale factor</li>
                            <li>Center of enlargement</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your name:</label>
                <input type="text" id="studentName" placeholder="Your name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">
                    <span>üéØ Begin Transformations Study</span>
                </button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 25</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 4%"></div>
                </div>
            </div>

            <div class="question-container">
                <div id="mathTip"></div>
                
                <h2 class="question-text" id="questionText"></h2>
                
                <div class="options-container" id="optionsContainer"></div>
                
                <div class="feedback-container" id="feedbackContainer">
                    <div class="feedback-header">
                        <div class="feedback-icon"></div>
                        <div class="feedback-title"></div>
                    </div>
                    <div class="feedback-explanation" id="feedbackExplanation"></div>
                </div>
            </div>
            
            <!-- Visualization Area -->
            <div class="content-wrapper">
                <div class="visualization-container">
                    <div class="coordinate-plane-container">
                        <div class="visualizer-title">Transformations Playground</div>
                        <div class="coordinate-plane" id="coordinatePlane">
                            <canvas class="grid-canvas" id="gridCanvas"></canvas>
                            <!-- Shapes and transformations will be drawn here -->
                        </div>
                        <div class="shape-controls">
                            <div class="shape-btn active" onclick="selectShape('triangle')">Triangle</div>
                            <div class="shape-btn" onclick="selectShape('square')">Square</div>
                            <div class="shape-btn" onclick="selectShape('rectangle')">Rectangle</div>
                            <div class="shape-btn" onclick="selectShape('polygon')">Polygon</div>
                            <div class="shape-btn" onclick="selectShape('house')">House</div>
                            <div class="shape-btn" onclick="selectShape('star')">Star</div>
                            <div class="shape-btn" onclick="clearShapes()">Clear</div>
                            <div class="shape-btn" onclick="resetTransformations()">Reset</div>
                        </div>
                    </div>
                    
                    <div class="transformation-controls">
                        <div class="visualizer-title">Transformation Controls</div>
                        <div class="transformation-tabs">
                            <div class="transformation-tab active" onclick="selectTransformation('translation')">Translation</div>
                            <div class="transformation-tab" onclick="selectTransformation('reflection')">Reflection</div>
                            <div class="transformation-tab" onclick="selectTransformation('rotation')">Rotation</div>
                            <div class="transformation-tab" onclick="selectTransformation('enlargement')">Enlargement</div>
                        </div>
                        
                        <!-- Translation Controls -->
                        <div id="translationControls" class="transformation-controls-content">
                            <div class="transformation-inputs">
                                <input type="number" id="translateX" class="transform-input" placeholder="X movement" value="3">
                                <input type="number" id="translateY" class="transform-input" placeholder="Y movement" value="2">
                            </div>
                            <div class="transform-buttons">
                                <button class="transform-btn" onclick="applyTranslation()">Apply Translation</button>
                                <button class="transform-btn" onclick="showTranslationExample()">Example</button>
                                <button class="transform-btn" onclick="reverseTranslation()">Reverse</button>
                            </div>
                        </div>
                        
                        <!-- Reflection Controls -->
                        <div id="reflectionControls" class="transformation-controls-content" style="display: none;">
                            <div style="text-align: center; margin: 10px 0;">
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Select mirror line:</p>
                            </div>
                            <div class="transform-buttons">
                                <button class="transform-btn" onclick="setReflectionLine('x-axis')">X-axis (y=0)</button>
                                <button class="transform-btn" onclick="setReflectionLine('y-axis')">Y-axis (x=0)</button>
                                <button class="transform-btn" onclick="setReflectionLine('y=x')">Line y=x</button>
                            </div>
                            <div class="transform-buttons">
                                <button class="transform-btn" onclick="applyReflection()">Apply Reflection</button>
                                <button class="transform-btn" onclick="showReflectionExample()">Example</button>
                                <button class="transform-btn" onclick="toggleMirrorLine()">Show/Hide Line</button>
                            </div>
                        </div>
                        
                        <!-- Rotation Controls -->
                        <div id="rotationControls" class="transformation-controls-content" style="display: none;">
                            <div class="transformation-inputs">
                                <input type="number" id="rotationAngle" class="transform-input" placeholder="Angle (degrees)" value="90">
                                <input type="text" id="rotationCenter" class="transform-input" placeholder="Center (0,0)" value="0,0" readonly>
                            </div>
                            <div style="text-align: center; margin: 10px 0;">
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Direction:</p>
                            </div>
                            <div class="transform-buttons">
                                <button class="transform-btn" onclick="setRotationDirection('clockwise')">Clockwise</button>
                                <button class="transform-btn" onclick="setRotationDirection('anticlockwise')">Anticlockwise</button>
                                <button class="transform-btn" onclick="applyRotation()">Apply Rotation</button>
                            </div>
                            <div class="transform-buttons">
                                <button class="transform-btn" onclick="showRotationExample()">Example</button>
                                <button class="transform-btn" onclick="changeRotationCenter()">Change Center</button>
                            </div>
                        </div>
                        
                        <!-- Enlargement Controls -->
                        <div id="enlargementControls" class="transformation-controls-content" style="display: none;">
                            <div class="transformation-inputs">
                                <input type="number" id="scaleFactor" class="transform-input" placeholder="Scale factor" value="2" step="0.5">
                                <input type="text" id="enlargementCenter" class="transform-input" placeholder="Center (0,0)" value="0,0" readonly>
                            </div>
                            <input type="range" min="0.5" max="3" step="0.1" value="2" class="transform-slider" id="scaleSlider" oninput="updateScaleFactor()">
                            <div class="scale-factor-display" id="scaleDisplay">Scale Factor: 2</div>
                            <div class="transform-buttons">
                                <button class="transform-btn" onclick="applyEnlargement()">Apply Enlargement</button>
                                <button class="transform-btn" onclick="showEnlargementExample()">Example</button>
                                <button class="transform-btn" onclick="changeEnlargementCenter()">Change Center</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="transformation-rules">
                        <div class="visualizer-title">Transformation Rules</div>
                        <div class="rules-grid">
                            <div class="rule-card" onclick="showRule('translation-rule')">
                                <div class="rule-title">Translation</div>
                                <div class="rule-formula">(x, y) ‚Üí (x+a, y+b)</div>
                            </div>
                            <div class="rule-card" onclick="showRule('reflection-x-axis')">
                                <div class="rule-title">Reflection in x-axis</div>
                                <div class="rule-formula">(x, y) ‚Üí (x, -y)</div>
                            </div>
                            <div class="rule-card" onclick="showRule('reflection-y-axis')">
                                <div class="rule-title">Reflection in y-axis</div>
                                <div class="rule-formula">(x, y) ‚Üí (-x, y)</div>
                            </div>
                            <div class="rule-card" onclick="showRule('rotation-90')">
                                <div class="rule-title">Rotation 90¬∞ about origin</div>
                                <div class="rule-formula">(x, y) ‚Üí (-y, x)</div>
                            </div>
                            <div class="rule-card" onclick="showRule('rotation-180')">
                                <div class="rule-title">Rotation 180¬∞ about origin</div>
                                <div class="rule-formula">(x, y) ‚Üí (-x, -y)</div>
                            </div>
                            <div class="rule-card" onclick="showRule('enlargement-rule')">
                                <div class="rule-title">Enlargement from origin</div>
                                <div class="rule-formula">(x, y) ‚Üí (kx, ky)</div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <button class="btn btn-small btn-secondary" onclick="showAllRules()">View All Rules</button>
                        </div>
                    </div>
                    
                    <div class="transformation-types">
                        <div class="visualizer-title">Properties Preserved</div>
                        <div class="types-grid">
                            <div class="type-card" onclick="showProperty('congruent')">
                                <div class="type-icon">‚â°</div>
                                <div class="type-name">Congruent</div>
                            </div>
                            <div class="type-card" onclick="showProperty('similar')">
                                <div class="type-icon">‚àº</div>
                                <div class="type-name">Similar</div>
                            </div>
                            <div class="type-card" onclick="showProperty('invariant')">
                                <div class="type-icon">‚óã</div>
                                <div class="type-name">Invariant Points</div>
                            </div>
                            <div class="type-card" onclick="showProperty('orientation')">
                                <div class="type-icon">‚Ü∑</div>
                                <div class="type-name">Orientation</div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <button class="btn btn-small btn-secondary" onclick="explainProperties()">Learn Properties</button>
                        </div>
                    </div>
                    
                    <div class="combined-transformations">
                        <div class="visualizer-title">Combined Transformations</div>
                        <div style="text-align: center; margin: 10px 0;">
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Apply multiple transformations in sequence:</p>
                        </div>
                        <div class="sequence-controls">
                            <div class="sequence-btn active" onclick="setSequence('translate_then_rotate')">Translate then Rotate</div>
                            <div class="sequence-btn" onclick="setSequence('rotate_then_reflect')">Rotate then Reflect</div>
                            <div class="sequence-btn" onclick="setSequence('enlarge_then_translate')">Enlarge then Translate</div>
                        </div>
                        <div class="transform-buttons">
                            <button class="transform-btn" onclick="applySequence()">Apply Sequence</button>
                            <button class="transform-btn" onclick="showCombinationExample()">Example</button>
                            <button class="transform-btn" onclick="clearSequence()">Clear Sequence</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="btn btn-secondary" id="skipQuestion">Skip Question</button>
                <button class="btn btn-primary" id="nextQuestion" disabled>Next Question</button>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Transformations Study Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                <div class="score-message" id="scoreMessage"></div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="timeSpent">0min</div>
                        <div class="stat-label">Time Spent</div>
                    </div>
                </div>
                
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-primary" id="retryTopic">Try Again</button>
                    <button class="btn btn-secondary" id="viewTopics">Other Topics</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Questions array - 25 focused questions on Transformations
        const questions = [
            {
                question: "What transformation moves a shape without rotating or flipping it?",
                options: ["Translation", "Reflection", "Rotation", "Enlargement"],
                answer: "A",
                explanation: "Translation slides a shape from one position to another without changing its orientation or size."
            },
            {
                question: "Which transformation creates a mirror image of a shape?",
                options: ["Reflection", "Translation", "Rotation", "Enlargement"],
                answer: "A",
                explanation: "Reflection flips a shape over a line (mirror line) to create its mirror image."
            },
            {
                question: "What is the result of rotating a shape 180¬∞ about the origin?",
                options: ["(x, y) becomes (-x, -y)", "(x, y) becomes (-y, x)", "(x, y) becomes (y, -x)", "(x, y) stays the same"],
                answer: "A",
                explanation: "A 180¬∞ rotation about the origin changes (x, y) to (-x, -y)."
            },
            {
                question: "If a shape is enlarged by scale factor 3, what happens to its area?",
                options: ["Area becomes 9 times larger", "Area becomes 3 times larger", "Area stays the same", "Area becomes 6 times larger"],
                answer: "A",
                explanation: "Area scales by the square of the scale factor. Scale factor 3 ‚Üí area factor 3¬≤ = 9."
            },
            {
                question: "Which transformation preserves orientation?",
                options: ["Translation", "Reflection", "All transformations", "No transformations"],
                answer: "A",
                explanation: "Translation preserves orientation (the shape faces the same direction). Reflection reverses orientation."
            },
            {
                question: "What transformation rule represents reflection in the y-axis?",
                options: ["(x, y) ‚Üí (-x, y)", "(x, y) ‚Üí (x, -y)", "(x, y) ‚Üí (-x, -y)", "(x, y) ‚Üí (y, x)"],
                answer: "A",
                explanation: "Reflection in the y-axis changes the x-coordinate sign: (x, y) becomes (-x, y)."
            },
            {
                question: "A shape is translated by vector (3, -2). What happens to point (1, 4)?",
                options: ["Becomes (4, 2)", "Becomes (-2, 2)", "Becomes (1, 2)", "Becomes (4, 6)"],
                answer: "A",
                explanation: "Add vector components: (1+3, 4+(-2)) = (4, 2)."
            },
            {
                question: "Which points remain unchanged during reflection in the x-axis?",
                options: ["Points on the x-axis", "Points on the y-axis", "All points", "No points"],
                answer: "A",
                explanation: "Points on the x-axis (where y=0) stay in the same position when reflected in the x-axis."
            },
            {
                question: "What is the center of rotation?",
                options: ["The fixed point around which rotation occurs", "The middle of the shape", "The origin (0,0)", "The point that moves the most"],
                answer: "A",
                explanation: "The center of rotation is the fixed point that everything rotates around."
            },
            {
                question: "If a shape is similar after a transformation, what is preserved?",
                options: ["Shape but not necessarily size", "Size but not shape", "Both shape and size", "Neither shape nor size"],
                answer: "A",
                explanation: "Similar shapes have the same shape but can be different sizes. Enlargement produces similar shapes."
            },
            {
                question: "What transformation is described by (x, y) ‚Üí (x+2, y-3)?",
                options: ["Translation by vector (2, -3)", "Reflection in y=x", "Rotation 90¬∞ clockwise", "Enlargement scale factor 2"],
                answer: "A",
                explanation: "Adding to x and y coordinates indicates a translation."
            },
            {
                question: "How many lines of symmetry does a square have?",
                options: ["4", "2", "1", "8"],
                answer: "A",
                explanation: "A square has 4 lines of symmetry: vertical, horizontal, and two diagonals."
            },
            {
                question: "What is the result of rotating point (2, 3) 90¬∞ clockwise about the origin?",
                options: ["(3, -2)", "(-3, 2)", "(-2, -3)", "(2, -3)"],
                answer: "A",
                explanation: "90¬∞ clockwise rotation: (x, y) becomes (y, -x). So (2, 3) becomes (3, -2)."
            },
            {
                question: "Which transformation changes the size of a shape?",
                options: ["Enlargement", "Translation", "Reflection", "Rotation"],
                answer: "A",
                explanation: "Enlargement (with scale factor not equal to 1) changes the size of a shape."
            },
            {
                question: "If a shape has rotational symmetry of order 4, what does this mean?",
                options: ["It looks the same 4 times in a full turn", "It has 4 sides", "It can be rotated 4 different ways", "It has 4 lines of symmetry"],
                answer: "A",
                explanation: "Rotational symmetry of order n means the shape looks the same n times during a 360¬∞ rotation."
            },
            {
                question: "What is the image of point (1, 2) after reflection in the line y = x?",
                options: ["(2, 1)", "(1, -2)", "(-1, 2)", "(-2, -1)"],
                answer: "A",
                explanation: "Reflection in y = x swaps x and y coordinates: (x, y) becomes (y, x)."
            },
            {
                question: "A triangle is enlarged by scale factor 0.5. What happens?",
                options: ["It gets smaller", "It gets larger", "It stays the same size", "It disappears"],
                answer: "A",
                explanation: "Scale factor between 0 and 1 reduces the size of the shape."
            },
            {
                question: "Which transformation always produces congruent shapes?",
                options: ["Translation, reflection, rotation", "Only enlargement", "Only translation", "All transformations"],
                answer: "A",
                explanation: "Translation, reflection, and rotation preserve size and shape (congruent). Enlargement changes size."
            },
            {
                question: "What is the vector that translates (3, 1) to (5, 4)?",
                options: ["(2, 3)", "(8, 5)", "(-2, -3)", "(3, 2)"],
                answer: "A",
                explanation: "Subtract original from image: (5-3, 4-1) = (2, 3)."
            },
            {
                question: "How many degrees in a full rotation?",
                options: ["360¬∞", "180¬∞", "90¬∞", "270¬∞"],
                answer: "A",
                explanation: "A full rotation is 360¬∞."
            },
            {
                question: "What is an invariant point?",
                options: ["A point that doesn't move during transformation", "The center of rotation", "Any point on a shape", "The point that moves the most"],
                answer: "A",
                explanation: "An invariant point stays in the same position under a transformation."
            },
            {
                question: "Which describes a glide reflection?",
                options: ["Translation followed by reflection", "Two reflections", "Rotation and translation", "Enlargement and reflection"],
                answer: "A",
                explanation: "A glide reflection combines a translation and a reflection in a line parallel to the translation direction."
            },
            {
                question: "What is the order of rotational symmetry for a regular hexagon?",
                options: ["6", "3", "4", "12"],
                answer: "A",
                explanation: "A regular hexagon has rotational symmetry of order 6 (60¬∞, 120¬∞, 180¬∞, 240¬∞, 300¬∞, 360¬∞)."
            },
            {
                question: "Point (-3, 4) is reflected in the x-axis. What is its image?",
                options: ["(-3, -4)", "(3, 4)", "(3, -4)", "(-3, 4)"],
                answer: "A",
                explanation: "Reflection in x-axis: (x, y) becomes (x, -y). So (-3, 4) becomes (-3, -4)."
            },
            {
                question: "What is the scale factor if a shape doubles in size?",
                options: ["2", "0.5", "1", "4"],
                answer: "A",
                explanation: "Doubling size means scale factor 2."
            }
        ];

        // Math tips and facts
        const mathTips = [
            "Translation slides, reflection flips, rotation turns, and enlargement grows or shrinks!",
            "Congruent shapes are identical in size and shape. Similar shapes have same shape but can be different sizes.",
            "Lines of symmetry are like fold lines - if you fold along them, both halves match perfectly.",
            "The order of rotational symmetry is how many times a shape looks the same during a full 360¬∞ turn.",
            "Scale factor > 1 enlarges, 0 < scale factor < 1 reduces, and negative scale factor also reflects!",
            "Invariant points don't move during a transformation. On reflection lines, all points are invariant.",
            "A glide reflection is like a footprint - you slide then flip!",
            "Combined transformations: order matters! Translate then rotate is different from rotate then translate."
        ];

        // Transformation rules
        const transformationRules = {
            'translation-rule': {
                name: "Translation Rule",
                description: "Add the translation vector to each point",
                formula: "(x, y) ‚Üí (x + a, y + b) where (a, b) is the translation vector",
                example: "Vector (3, -2): (1, 4) ‚Üí (4, 2)"
            },
            'reflection-x-axis': {
                name: "Reflection in x-axis",
                description: "Mirror over the horizontal axis (y=0)",
                formula: "(x, y) ‚Üí (x, -y)",
                example: "(2, 3) ‚Üí (2, -3)"
            },
            'reflection-y-axis': {
                name: "Reflection in y-axis",
                description: "Mirror over the vertical axis (x=0)",
                formula: "(x, y) ‚Üí (-x, y)",
                example: "(2, 3) ‚Üí (-2, 3)"
            },
            'reflection-y=x': {
                name: "Reflection in y = x",
                description: "Mirror over the diagonal line where x = y",
                formula: "(x, y) ‚Üí (y, x)",
                example: "(2, 3) ‚Üí (3, 2)"
            },
            'rotation-90': {
                name: "Rotation 90¬∞ clockwise about origin",
                description: "Quarter turn clockwise around (0, 0)",
                formula: "(x, y) ‚Üí (y, -x)",
                example: "(2, 3) ‚Üí (3, -2)"
            },
            'rotation-180': {
                name: "Rotation 180¬∞ about origin",
                description: "Half turn around (0, 0)",
                formula: "(x, y) ‚Üí (-x, -y)",
                example: "(2, 3) ‚Üí (-2, -3)"
            },
            'rotation-270': {
                name: "Rotation 270¬∞ clockwise (or 90¬∞ anticlockwise)",
                description: "Three-quarter turn clockwise around (0, 0)",
                formula: "(x, y) ‚Üí (-y, x)",
                example: "(2, 3) ‚Üí (-3, 2)"
            },
            'enlargement-rule': {
                name: "Enlargement from origin",
                description: "Scale from the origin (0, 0)",
                formula: "(x, y) ‚Üí (kx, ky) where k is scale factor",
                example: "k = 2: (2, 3) ‚Üí (4, 6)"
            }
        };

        // Properties information
        const properties = {
            'congruent': {
                name: "Congruent Shapes",
                description: "Same shape and size",
                transformations: "Translation, reflection, rotation",
                example: "All rigid transformations produce congruent shapes"
            },
            'similar': {
                name: "Similar Shapes",
                description: "Same shape but can be different sizes",
                transformations: "Enlargement (and combinations with rigid transformations)",
                example: "Enlargement produces similar shapes"
            },
            'invariant': {
                name: "Invariant Points",
                description: "Points that don't move under transformation",
                examples: [
                    "Reflection: points on mirror line",
                    "Rotation: center point",
                    "Enlargement: center of enlargement"
                ]
            },
            'orientation': {
                name: "Orientation",
                description: "Whether shape is facing same direction",
                preserve: "Translation and rotation preserve orientation",
                reverse: "Reflection reverses orientation (mirror image)"
            }
        };

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            studentName: "",
            startTime: null,
            currentShape: 'triangle',
            currentTransformation: 'translation',
            currentColor: '#2196F3',
            transformedColor: '#4CAF50',
            shapes: [],
            transformedShapes: [],
            canvas: null,
            ctx: null,
            gridSize: 20,
            showGrid: true,
            showAxes: true,
            showMirrorLine: false,
            mirrorLineType: 'x-axis',
            rotationCenter: {x: 0, y: 0},
            enlargementCenter: {x: 0, y: 0},
            rotationDirection: 'clockwise',
            sequenceType: 'translate_then_rotate'
        };

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const backToHomeBtn = document.getElementById('backToHome');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const mathTip = document.getElementById('mathTip');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const feedbackExplanation = document.getElementById('feedbackExplanation');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const scoreMessage = document.getElementById('scoreMessage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const timeSpent = document.getElementById('timeSpent');

        // Initialize
        function initApp() {
            setupEventListeners();
            showWelcomePage();
            initializeCanvas();
            setupShapeControls();
            setupTransformationTabs();
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', showWelcomePage);
            viewTopicsBtn.addEventListener('click', () => alert("Other math topics would be available here."));
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') startPractice();
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            appState.startTime = new Date();
            loadQuestion();
            drawScene();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const percentage = Math.round((appState.score / questions.length) * 100);
            const timeDiff = new Date() - appState.startTime;
            const minutes = Math.floor(timeDiff / 60000);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            timeSpent.textContent = `${minutes}min`;
            
            if (percentage >= 90) {
                scoreMessage.textContent = "Outstanding! You're a transformations expert!";
            } else if (percentage >= 75) {
                scoreMessage.textContent = "Excellent! You understand geometric transformations well!";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "Good job! You're getting the hang of transformations!";
            } else {
                scoreMessage.textContent = "Keep practicing! Transformations become intuitive with practice - try again!";
            }
        }

        // Create math tip display
        function createMathTip() {
            const tipDiv = document.createElement('div');
            tipDiv.className = 'math-tip';
            tipDiv.innerHTML = `<strong>Geometry Tip:</strong> ${mathTips[Math.floor(Math.random() * mathTips.length)]}`;
            return tipDiv;
        }

        // Load question
        function loadQuestion() {
            const question = questions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${questions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / questions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            mathTip.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            mathTip.appendChild(createMathTip());
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = questions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                optionElement.classList.add('pulse');
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation);
            }
            
            nextQuestionBtn.disabled = false;
        }

        // Show feedback
        function showFeedback(isCorrect, explanation) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '‚úì';
                feedbackTitle.textContent = 'Correct!';
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '‚úó';
                feedbackTitle.textContent = 'Incorrect';
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
            feedbackContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
        }

        // Skip question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
        }

        // Retry topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            showPracticePage();
        }

        // Start practice
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name to begin studying transformations!");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            showPracticePage();
        }

        // Initialize canvas
        function initializeCanvas() {
            const canvas = document.getElementById('gridCanvas');
            const container = document.getElementById('coordinatePlane');
            
            // Set canvas dimensions to match container
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            appState.canvas = canvas;
            appState.ctx = canvas.getContext('2d');
            
            // Create default shape
            createShape('triangle');
            
            // Draw initial scene
            drawScene();
        }

        // Setup shape controls
        function setupShapeControls() {
            const shapeBtns = document.querySelectorAll('.shape-btn');
            shapeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all
                    shapeBtns.forEach(b => b.classList.remove('active'));
                    // Add active class to clicked
                    this.classList.add('active');
                    
                    const shapeType = this.getAttribute('onclick').match(/'([^']+)'/)[1];
                    if (shapeType !== 'clear' && shapeType !== 'reset') {
                        selectShape(shapeType);
                    }
                });
            });
        }

        // Setup transformation tabs
        function setupTransformationTabs() {
            const tabs = document.querySelectorAll('.transformation-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all
                    tabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked
                    this.classList.add('active');
                    
                    const transformation = this.getAttribute('onclick').match(/'([^']+)'/)[1];
                    selectTransformation(transformation);
                });
            });
        }

        // Select shape
        window.selectShape = function(shapeType) {
            appState.currentShape = shapeType;
            appState.shapes = [];
            appState.transformedShapes = [];
            createShape(shapeType);
            drawScene();
        };

        // Create a shape
        function createShape(type) {
            const centerX = appState.canvas.width / 2;
            const centerY = appState.canvas.height / 2;
            const grid = appState.gridSize;
            
            let points = [];
            
            switch(type) {
                case 'triangle':
                    points = [
                        {x: centerX, y: centerY - 2*grid},
                        {x: centerX - 2*grid, y: centerY + 2*grid},
                        {x: centerX + 2*grid, y: centerY + 2*grid}
                    ];
                    break;
                case 'square':
                    points = [
                        {x: centerX - 2*grid, y: centerY - 2*grid},
                        {x: centerX + 2*grid, y: centerY - 2*grid},
                        {x: centerX + 2*grid, y: centerY + 2*grid},
                        {x: centerX - 2*grid, y: centerY + 2*grid}
                    ];
                    break;
                case 'rectangle':
                    points = [
                        {x: centerX - 3*grid, y: centerY - 2*grid},
                        {x: centerX + 3*grid, y: centerY - 2*grid},
                        {x: centerX + 3*grid, y: centerY + 2*grid},
                        {x: centerX - 3*grid, y: centerY + 2*grid}
                    ];
                    break;
                case 'polygon':
                    // Hexagon
                    for (let i = 0; i < 6; i++) {
                        const angle = i * Math.PI / 3;
                        points.push({
                            x: centerX + 3*grid * Math.cos(angle),
                            y: centerY + 3*grid * Math.sin(angle)
                        });
                    }
                    break;
                case 'house':
                    points = [
                        {x: centerX, y: centerY - 3*grid}, // Roof top
                        {x: centerX - 3*grid, y: centerY - grid}, // Roof left
                        {x: centerX - 3*grid, y: centerY + 2*grid}, // House left bottom
                        {x: centerX + 3*grid, y: centerY + 2*grid}, // House right bottom
                        {x: centerX + 3*grid, y: centerY - grid}, // Roof right
                        {x: centerX, y: centerY - 3*grid} // Back to top
                    ];
                    break;
                case 'star':
                    // 5-pointed star
                    for (let i = 0; i < 10; i++) {
                        const angle = i * Math.PI / 5;
                        const radius = i % 2 === 0 ? 3*grid : 1.5*grid;
                        points.push({
                            x: centerX + radius * Math.cos(angle - Math.PI/2),
                            y: centerY + radius * Math.sin(angle - Math.PI/2)
                        });
                    }
                    break;
            }
            
            appState.shapes.push({
                type: type,
                points: points,
                color: appState.currentColor,
                fill: true
            });
        }

        // Clear shapes
        window.clearShapes = function() {
            appState.shapes = [];
            appState.transformedShapes = [];
            drawScene();
        };

        // Reset transformations
        window.resetTransformations = function() {
            appState.transformedShapes = [];
            drawScene();
        };

        // Select transformation
        window.selectTransformation = function(transformation) {
            appState.currentTransformation = transformation;
            
            // Hide all control panels
            document.getElementById('translationControls').style.display = 'none';
            document.getElementById('reflectionControls').style.display = 'none';
            document.getElementById('rotationControls').style.display = 'none';
            document.getElementById('enlargementControls').style.display = 'none';
            
            // Show selected control panel
            document.getElementById(transformation + 'Controls').style.display = 'block';
        };

        // Draw the scene
        function drawScene() {
            const ctx = appState.ctx;
            const canvas = appState.canvas;
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Draw grid if enabled
            if (appState.showGrid) {
                drawGrid();
            }
            
            // Draw axes if enabled
            if (appState.showAxes) {
                drawAxes();
            }
            
            // Draw mirror line if enabled
            if (appState.showMirrorLine) {
                drawMirrorLine();
            }
            
            // Draw rotation center
            drawRotationCenter();
            
            // Draw original shapes
            appState.shapes.forEach(shape => {
                drawShape(shape, false);
            });
            
            // Draw transformed shapes
            appState.transformedShapes.forEach(shape => {
                drawShape(shape, true);
            });
        }

        // Draw grid
        function drawGrid() {
            const ctx = appState.ctx;
            const width = appState.canvas.width;
            const height = appState.canvas.height;
            const gridSize = appState.gridSize;
            const centerX = width / 2;
            const centerY = height / 2;
            
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 0.5;
            
            // Vertical lines
            for (let x = centerX % gridSize; x < width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            
            // Horizontal lines
            for (let y = centerY % gridSize; y < height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
        }

        // Draw axes
        function drawAxes() {
            const ctx = appState.ctx;
            const width = appState.canvas.width;
            const height = appState.canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // X-axis
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            // Y-axis
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            // Axis labels
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            
            // X-axis labels
            for (let i = -5; i <= 5; i++) {
                if (i === 0) continue;
                const x = centerX + i * appState.gridSize;
                ctx.fillText(i.toString(), x, centerY + 5);
            }
            
            // Y-axis labels
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            for (let i = -5; i <= 5; i++) {
                if (i === 0) continue;
                const y = centerY - i * appState.gridSize;
                ctx.fillText(i.toString(), centerX - 5, y);
            }
            
            // Origin label
            ctx.textAlign = 'right';
            ctx.textBaseline = 'top';
            ctx.fillText('0', centerX - 5, centerY + 5);
        }

        // Draw mirror line
        function drawMirrorLine() {
            const ctx = appState.ctx;
            const width = appState.canvas.width;
            const height = appState.canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            
            ctx.strokeStyle = 'rgba(76, 175, 80, 0.7)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            
            switch(appState.mirrorLineType) {
                case 'x-axis':
                    ctx.beginPath();
                    ctx.moveTo(0, centerY);
                    ctx.lineTo(width, centerY);
                    break;
                case 'y-axis':
                    ctx.beginPath();
                    ctx.moveTo(centerX, 0);
                    ctx.lineTo(centerX, height);
                    break;
                case 'y=x':
                    ctx.beginPath();
                    ctx.moveTo(0, height);
                    ctx.lineTo(width, 0);
                    break;
            }
            
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // Draw rotation center
        function drawRotationCenter() {
            const ctx = appState.ctx;
            const centerX = appState.canvas.width / 2;
            const centerY = appState.canvas.height / 2;
            
            // Convert mathematical coordinates to canvas coordinates
            const x = centerX + appState.rotationCenter.x * appState.gridSize;
            const y = centerY - appState.rotationCenter.y * appState.gridSize;
            
            ctx.fillStyle = '#F44336';
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw crosshairs for better visibility
            ctx.strokeStyle = '#F44336';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x - 8, y);
            ctx.lineTo(x + 8, y);
            ctx.moveTo(x, y - 8);
            ctx.lineTo(x, y + 8);
            ctx.stroke();
        }

        // Draw a shape
        function drawShape(shape, isTransformed) {
            const ctx = appState.ctx;
            const centerX = appState.canvas.width / 2;
            const centerY = appState.canvas.height / 2;
            
            if (!shape.points || shape.points.length === 0) return;
            
            // Convert mathematical coordinates to canvas coordinates
            const canvasPoints = shape.points.map(point => ({
                x: centerX + point.x * appState.gridSize,
                y: centerY - point.y * appState.gridSize
            }));
            
            // Draw shape outline
            ctx.strokeStyle = isTransformed ? appState.transformedColor : shape.color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(canvasPoints[0].x, canvasPoints[0].y);
            
            for (let i = 1; i < canvasPoints.length; i++) {
                ctx.lineTo(canvasPoints[i].x, canvasPoints[i].y);
            }
            
            if (shape.fill) {
                ctx.closePath();
            }
            
            ctx.stroke();
            
            // Fill shape if specified
            if (shape.fill) {
                ctx.fillStyle = isTransformed ? 
                    hexToRgba(appState.transformedColor, 0.3) : 
                    hexToRgba(shape.color, 0.3);
                ctx.fill();
            }
            
            // Draw vertices
            canvasPoints.forEach(point => {
                ctx.fillStyle = isTransformed ? appState.transformedColor : shape.color;
                ctx.beginPath();
                ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Helper function to convert hex to rgba
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // Apply translation
        window.applyTranslation = function() {
            const dx = parseFloat(document.getElementById('translateX').value) || 0;
            const dy = parseFloat(document.getElementById('translateY').value) || 0;
            
            if (appState.shapes.length === 0) {
                alert("Please create a shape first!");
                return;
            }
            
            // Create transformed shape by translating each point
            appState.shapes.forEach(originalShape => {
                const transformedPoints = originalShape.points.map(point => ({
                    x: point.x + dx * appState.gridSize / 10,
                    y: point.y + dy * appState.gridSize / 10
                }));
                
                appState.transformedShapes.push({
                    type: originalShape.type + '_translated',
                    points: transformedPoints,
                    color: appState.transformedColor,
                    fill: true,
                    description: `Translated by (${dx}, ${dy})`
                });
            });
            
            drawScene();
            
            // Show transformation rule
            showTransformationResult(`Translation applied: (x, y) ‚Üí (x + ${dx}, y + ${dy})`);
        };

        window.showTranslationExample = function() {
            alert("Translation Example:\n\nMoving a shape without rotating or flipping it.\n\nExample: Translate triangle by vector (3, 2)\n\nRule: (x, y) ‚Üí (x+3, y+2)\n\nPoint (1, 4) becomes (4, 6)");
            
            // Set example values
            document.getElementById('translateX').value = 3;
            document.getElementById('translateY').value = 2;
        };

        window.reverseTranslation = function() {
            const dx = parseFloat(document.getElementById('translateX').value) || 0;
            const dy = parseFloat(document.getElementById('translateY').value) || 0;
            
            // Apply translation in opposite direction
            document.getElementById('translateX').value = -dx;
            document.getElementById('translateY').value = -dy;
            applyTranslation();
        };

        // Set reflection line
        window.setReflectionLine = function(lineType) {
            appState.mirrorLineType = lineType;
            appState.showMirrorLine = true;
            drawScene();
        };

        window.applyReflection = function() {
            if (appState.shapes.length === 0) {
                alert("Please create a shape first!");
                return;
            }
            
            appState.shapes.forEach(originalShape => {
                const transformedPoints = originalShape.points.map(point => {
                    let newX = point.x;
                    let newY = point.y;
                    
                    // Apply reflection based on mirror line type
                    switch(appState.mirrorLineType) {
                        case 'x-axis':
                            // Reflect in x-axis: (x, y) ‚Üí (x, -y)
                            newY = -point.y;
                            break;
                        case 'y-axis':
                            // Reflect in y-axis: (x, y) ‚Üí (-x, y)
                            newX = -point.x;
                            break;
                        case 'y=x':
                            // Reflect in y = x: (x, y) ‚Üí (y, x)
                            newX = point.y;
                            newY = point.x;
                            break;
                    }
                    
                    return {x: newX, y: newY};
                });
                
                appState.transformedShapes.push({
                    type: originalShape.type + '_reflected',
                    points: transformedPoints,
                    color: appState.transformedColor,
                    fill: true,
                    description: `Reflected in ${appState.mirrorLineType}`
                });
            });
            
            drawScene();
            
            // Show transformation rule
            let rule = '';
            switch(appState.mirrorLineType) {
                case 'x-axis': rule = '(x, y) ‚Üí (x, -y)'; break;
                case 'y-axis': rule = '(x, y) ‚Üí (-x, y)'; break;
                case 'y=x': rule = '(x, y) ‚Üí (y, x)'; break;
            }
            showTransformationResult(`Reflection applied in ${appState.mirrorLineType}: ${rule}`);
        };

        window.showReflectionExample = function() {
            alert("Reflection Example:\n\nCreating a mirror image of a shape.\n\nExample: Reflect triangle in y-axis\n\nRule: (x, y) ‚Üí (-x, y)\n\nPoint (2, 3) becomes (-2, 3)\n\nOrientation is reversed (mirror image).");
            
            // Set example reflection line
            setReflectionLine('y-axis');
        };

        window.toggleMirrorLine = function() {
            appState.showMirrorLine = !appState.showMirrorLine;
            drawScene();
        };

        // Set rotation direction
        window.setRotationDirection = function(direction) {
            appState.rotationDirection = direction;
        };

        window.applyRotation = function() {
            const angleInput = parseFloat(document.getElementById('rotationAngle').value) || 90;
            let angle = angleInput;
            
            // Convert to radians and adjust for direction
            if (appState.rotationDirection === 'clockwise') {
                angle = -angle * Math.PI / 180;
            } else {
                angle = angle * Math.PI / 180;
            }
            
            if (appState.shapes.length === 0) {
                alert("Please create a shape first!");
                return;
            }
            
            const centerX = appState.rotationCenter.x;
            const centerY = appState.rotationCenter.y;
            
            appState.shapes.forEach(originalShape => {
                const transformedPoints = originalShape.points.map(point => {
                    // Translate to origin, rotate, then translate back
                    const translatedX = point.x - centerX * appState.gridSize;
                    const translatedY = point.y - centerY * appState.gridSize;
                    
                    // Rotate
                    const rotatedX = translatedX * Math.cos(angle) - translatedY * Math.sin(angle);
                    const rotatedY = translatedX * Math.sin(angle) + translatedY * Math.cos(angle);
                    
                    // Translate back
                    return {
                        x: rotatedX + centerX * appState.gridSize,
                        y: rotatedY + centerY * appState.gridSize
                    };
                });
                
                appState.transformedShapes.push({
                    type: originalShape.type + '_rotated',
                    points: transformedPoints,
                    color: appState.transformedColor,
                    fill: true,
                    description: `Rotated ${angleInput}¬∞ ${appState.rotationDirection} about (${centerX}, ${centerY})`
                });
            });
            
            drawScene();
            
            // Show transformation rule
            const directionText = appState.rotationDirection === 'clockwise' ? 'clockwise' : 'anticlockwise';
            showTransformationResult(`Rotation applied: ${angleInput}¬∞ ${directionText} about (${centerX}, ${centerY})`);
        };

        window.showRotationExample = function() {
            alert("Rotation Example:\n\nTurning a shape around a fixed point.\n\nExample: Rotate triangle 90¬∞ clockwise about origin\n\nRule: (x, y) ‚Üí (y, -x)\n\nPoint (2, 3) becomes (3, -2)\n\nOrientation is preserved (not reversed).");
            
            // Set example values
            document.getElementById('rotationAngle').value = 90;
            setRotationDirection('clockwise');
        };

        window.changeRotationCenter = function() {
            const input = prompt("Enter new rotation center as (x, y):", "0,0");
            if (input) {
                const parts = input.split(',').map(num => parseFloat(num.trim()));
                if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
                    appState.rotationCenter = {x: parts[0], y: parts[1]};
                    document.getElementById('rotationCenter').value = `${parts[0]},${parts[1]}`;
                    drawScene();
                } else {
                    alert("Please enter coordinates in format: x,y");
                }
            }
        };

        // Update scale factor from slider
        window.updateScaleFactor = function() {
            const slider = document.getElementById('scaleSlider');
            const display = document.getElementById('scaleDisplay');
            const factor = parseFloat(slider.value);
            
            document.getElementById('scaleFactor').value = factor;
            display.textContent = `Scale Factor: ${factor}`;
            
            if (factor < 1) {
                display.style.color = '#FF9800'; // Orange for reduction
            } else if (factor > 1) {
                display.style.color = '#9C27B0'; // Purple for enlargement
            } else {
                display.style.color = '#FFFFFF'; // White for no change
            }
        };

        window.applyEnlargement = function() {
            const scaleFactor = parseFloat(document.getElementById('scaleFactor').value) || 2;
            
            if (appState.shapes.length === 0) {
                alert("Please create a shape first!");
                return;
            }
            
            const centerX = appState.enlargementCenter.x;
            const centerY = appState.enlargementCenter.y;
            
            appState.shapes.forEach(originalShape => {
                const transformedPoints = originalShape.points.map(point => {
                    // Translate to origin, scale, then translate back
                    const translatedX = point.x - centerX * appState.gridSize;
                    const translatedY = point.y - centerY * appState.gridSize;
                    
                    // Scale
                    const scaledX = translatedX * scaleFactor;
                    const scaledY = translatedY * scaleFactor;
                    
                    // Translate back
                    return {
                        x: scaledX + centerX * appState.gridSize,
                        y: scaledY + centerY * appState.gridSize
                    };
                });
                
                appState.transformedShapes.push({
                    type: originalShape.type + '_enlarged',
                    points: transformedPoints,
                    color: appState.transformedColor,
                    fill: true,
                    description: `Enlarged by scale factor ${scaleFactor} from (${centerX}, ${centerY})`
                });
            });
            
            drawScene();
            
            // Show transformation rule
            let sizeChange = '';
            if (scaleFactor > 1) {
                sizeChange = `Shape is ${scaleFactor} times larger`;
            } else if (scaleFactor < 1 && scaleFactor > 0) {
                sizeChange = `Shape is ${scaleFactor} times smaller`;
            } else if (scaleFactor < 0) {
                sizeChange = `Shape is enlarged and reflected`;
            }
            
            showTransformationResult(`Enlargement applied: Scale factor ${scaleFactor} from center (${centerX}, ${centerY})\n${sizeChange}`);
        };

        window.showEnlargementExample = function() {
            alert("Enlargement Example:\n\nChanging the size of a shape from a center point.\n\nExample: Enlarge triangle by scale factor 2 from origin\n\nRule: (x, y) ‚Üí (2x, 2y)\n\nPoint (2, 3) becomes (4, 6)\n\nArea becomes 4 times larger (scale factor squared).");
            
            // Set example values
            document.getElementById('scaleFactor').value = 2;
            updateScaleFactor();
        };

        window.changeEnlargementCenter = function() {
            const input = prompt("Enter new enlargement center as (x, y):", "0,0");
            if (input) {
                const parts = input.split(',').map(num => parseFloat(num.trim()));
                if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
                    appState.enlargementCenter = {x: parts[0], y: parts[1]};
                    document.getElementById('enlargementCenter').value = `${parts[0]},${parts[1]}`;
                    drawScene();
                } else {
                    alert("Please enter coordinates in format: x,y");
                }
            }
        };

        // Show transformation result
        function showTransformationResult(message) {
            // Create or update result display
            let resultDiv = document.getElementById('transformResult');
            if (!resultDiv) {
                resultDiv = document.createElement('div');
                resultDiv.id = 'transformResult';
                resultDiv.style.marginTop = '10px';
                resultDiv.style.padding = '10px';
                resultDiv.style.background = 'var(--dark-surface)';
                resultDiv.style.borderRadius = '6px';
                resultDiv.style.textAlign = 'center';
                document.querySelector('.coordinate-plane-container').appendChild(resultDiv);
            }
            
            resultDiv.textContent = message;
            resultDiv.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }

        // Show transformation rule
        window.showRule = function(ruleId) {
            const rule = transformationRules[ruleId];
            if (!rule) return;
            
            let info = `${rule.name}\n\n`;
            info += `${rule.description}\n\n`;
            info += `Rule: ${rule.formula}\n`;
            info += `Example: ${rule.example}`;
            
            alert(info);
        };

        window.showAllRules = function() {
            let info = "Transformation Rules\n\n";
            
            for (const [key, rule] of Object.entries(transformationRules)) {
                info += `${rule.name}:\n`;
                info += `  ${rule.formula}\n`;
                info += `  Example: ${rule.example}\n\n`;
            }
            
            info += "Key Points:\n";
            info += "‚Ä¢ Translation: Add vector to coordinates\n";
            info += "‚Ä¢ Reflection: Change sign of coordinate perpendicular to mirror line\n";
            info += "‚Ä¢ Rotation: Use trigonometry or special rules for 90¬∞, 180¬∞, 270¬∞\n";
            info += "‚Ä¢ Enlargement: Multiply coordinates by scale factor";
            
            alert(info);
        };

        // Show property
        window.showProperty = function(propertyId) {
            const property = properties[propertyId];
            if (!property) return;
            
            let info = `${property.name}\n\n`;
            info += `${property.description}\n\n`;
            
            if (property.transformations) {
                info += `Transformations that preserve this: ${property.transformations}\n`;
            }
            if (property.example) {
                info += `Example: ${property.example}\n`;
            }
            if (property.preserve) {
                info += `Preserved by: ${property.preserve}\n`;
            }
            if (property.reverse) {
                info += `Reversed by: ${property.reverse}\n`;
            }
            if (property.examples) {
                info += `Examples:\n`;
                property.examples.forEach(ex => {
                    info += `‚Ä¢ ${ex}\n`;
                });
            }
            
            alert(info);
        };

        window.explainProperties = function() {
            let info = "Properties of Transformations\n\n";
            
            info += "CONGRUENT (‚âÖ):\n";
            info += "‚Ä¢ Same shape and size\n";
            info += "‚Ä¢ Produced by: Translation, Reflection, Rotation\n\n";
            
            info += "SIMILAR (‚àº):\n";
            info += "‚Ä¢ Same shape, can be different size\n";
            info += "‚Ä¢ Produced by: Enlargement\n\n";
            
            info += "ORIENTATION:\n";
            info += "‚Ä¢ Preserved by: Translation, Rotation\n";
            info += "‚Ä¢ Reversed by: Reflection (creates mirror image)\n\n";
            
            info += "INVARIANT POINTS:\n";
            info += "‚Ä¢ Points that don't move\n";
            info += "‚Ä¢ Reflection: Points on mirror line\n";
            info += "‚Ä¢ Rotation: Center point\n";
            info += "‚Ä¢ Enlargement: Center point (if scale factor ‚â† 0)\n";
            
            alert(info);
        };

        // Set transformation sequence
        window.setSequence = function(sequenceType) {
            appState.sequenceType = sequenceType;
            
            // Update active button
            const sequenceBtns = document.querySelectorAll('.sequence-btn');
            sequenceBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        };

        window.applySequence = function() {
            if (appState.shapes.length === 0) {
                alert("Please create a shape first!");
                return;
            }
            
            // Clear previous transformed shapes
            appState.transformedShapes = [];
            
            // Apply sequence based on type
            switch(appState.sequenceType) {
                case 'translate_then_rotate':
                    // First apply translation
                    const dx = 3, dy = 2;
                    let translatedPoints = appState.shapes[0].points.map(point => ({
                        x: point.x + dx * appState.gridSize / 10,
                        y: point.y + dy * appState.gridSize / 10
                    }));
                    
                    // Then apply rotation
                    const angle = -90 * Math.PI / 180; // 90¬∞ clockwise
                    const rotatedPoints = translatedPoints.map(point => {
                        const rotatedX = point.x * Math.cos(angle) - point.y * Math.sin(angle);
                        const rotatedY = point.x * Math.sin(angle) + point.y * Math.cos(angle);
                        return {x: rotatedX, y: rotatedY};
                    });
                    
                    appState.transformedShapes.push({
                        type: appState.shapes[0].type + '_sequence',
                        points: rotatedPoints,
                        color: appState.transformedColor,
                        fill: true,
                        description: 'Translated then Rotated'
                    });
                    break;
                    
                case 'rotate_then_reflect':
                    // Similar logic for other sequences
                    break;
                    
                case 'enlarge_then_translate':
                    // Similar logic for other sequences
                    break;
            }
            
            drawScene();
            showTransformationResult(`Applied sequence: ${appState.sequenceType.replace(/_/g, ' ')}`);
        };

        window.showCombinationExample = function() {
            alert("Combined Transformations Example:\n\nTransformations can be combined in sequence.\n\nIMPORTANT: Order matters!\n\nExample 1: Translate then Rotate\n  ‚Ä¢ Slide shape, then turn it\n\nExample 2: Rotate then Translate\n  ‚Ä¢ Turn shape, then slide it\n\nThese give different final positions!");
        };

        window.clearSequence = function() {
            appState.transformedShapes = [];
            drawScene();
        };

        // Topic information display
        window.showTopicInfo = function(topic) {
            let info = '';
            if (topic === 'translation') {
                info = "‚Üí Translation ‚Üí\n\n";
                info += "Sliding a shape without rotating or flipping.\n\n";
                info += "Key Features:\n";
                info += "‚Ä¢ Preserves size, shape, and orientation\n";
                info += "‚Ä¢ Described by a vector (x movement, y movement)\n";
                info += "‚Ä¢ All points move the same distance and direction\n\n";
                info += "Rule: (x, y) ‚Üí (x + a, y + b)\n";
                info += "Where (a, b) is the translation vector";
            } else if (topic === 'reflection') {
                info = "‚ÜîÔ∏è Reflection ‚ÜîÔ∏è\n\n";
                info += "Flipping a shape over a mirror line.\n\n";
                info += "Key Features:\n";
                info += "‚Ä¢ Creates a mirror image\n";
                info += "‚Ä¢ Preserves size and shape\n";
                info += "‚Ä¢ Reverses orientation\n";
                info += "‚Ä¢ Points on mirror line stay in place\n\n";
                info += "Common Reflections:\n";
                info += "‚Ä¢ x-axis: (x, y) ‚Üí (x, -y)\n";
                info += "‚Ä¢ y-axis: (x, y) ‚Üí (-x, y)\n";
                info += "‚Ä¢ y = x: (x, y) ‚Üí (y, x)";
            } else if (topic === 'rotation') {
                info = "‚Üª Rotation ‚Üª\n\n";
                info += "Turning a shape around a fixed point.\n\n";
                info += "Key Features:\n";
                info += "‚Ä¢ Preserves size, shape, and orientation\n";
                info += "‚Ä¢ Turns around a center point\n";
                info += "‚Ä¢ Angle can be clockwise or anticlockwise\n";
                info += "‚Ä¢ Center point stays in place\n\n";
                info += "Common Rotations about origin:\n";
                info += "‚Ä¢ 90¬∞ clockwise: (x, y) ‚Üí (y, -x)\n";
                info += "‚Ä¢ 180¬∞: (x, y) ‚Üí (-x, -y)\n";
                info += "‚Ä¢ 270¬∞ clockwise: (x, y) ‚Üí (-y, x)";
            } else {
                info = "‚¨ÜÔ∏è Enlargement ‚¨ÜÔ∏è\n\n";
                info += "Changing size of a shape from a center point.\n\n";
                info += "Key Features:\n";
                info += "‚Ä¢ Preserves shape but changes size\n";
                info += "‚Ä¢ Scale factor determines size change\n";
                info += "‚Ä¢ Center of enlargement stays in place\n";
                info += "‚Ä¢ All distances from center multiply by scale factor\n\n";
                info += "Scale Factor:\n";
                info += "‚Ä¢ k > 1: Enlargement (bigger)\n";
                info += "‚Ä¢ 0 < k < 1: Reduction (smaller)\n";
                info += "‚Ä¢ k < 0: Enlargement and reflection\n\n";
                info += "Rule from origin: (x, y) ‚Üí (kx, ky)";
            }
            alert(info);
        };

        // Initialize app
        window.addEventListener('DOMContentLoaded', initApp);
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (appState.canvas) {
                const container = document.getElementById('coordinatePlane');
                appState.canvas.width = container.clientWidth;
                appState.canvas.height = container.clientHeight;
                drawScene();
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 5 Math - Variables | Ideolix Learning Hub</title>
    <style>
        /* CSS Variables for Algebra Theme */
        :root {
            --primary-indigo: #3F51B5;
            --secondary-pink: #E91E63;
            --accent-amber: #FFC107;
            --accent-teal: #009688;
            --accent-green: #4CAF50;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --text-muted: #888;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --glow: 0 0 20px rgba(63, 81, 181, 0.3);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Background Slideshow */
        .slideshow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .slide.active {
            opacity: 1;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            position: sticky;
            top: 20px;
            z-index: 100;
            border: 1px solid var(--dark-border);
        }

        .logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info {
            flex: 1;
        }

        .brand-info h1 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        /* Card Styles */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--dark-border);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow), var(--glow);
        }

        /* Welcome Page */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-logo {
            width: 140px;
            height: 140px;
            margin-bottom: 25px;
            border-radius: 20px;
            overflow: hidden;
            background-color: var(--dark-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .welcome-logo img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .welcome-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-indigo), var(--secondary-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 700px;
            line-height: 1.6;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(63, 81, 181, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 25px;
            border: 1px solid var(--primary-indigo);
        }

        .topic-icon {
            font-size: 1.5rem;
        }

        .topic-name {
            font-weight: 600;
            color: var(--primary-indigo);
        }

        .input-group {
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 1.1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-indigo);
            box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-indigo);
            color: white;
            box-shadow: 0 4px 15px rgba(63, 81, 181, 0.4);
        }

        .btn-primary:hover {
            background: #303F9F;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(63, 81, 181, 0.5);
        }

        .btn-secondary {
            background: var(--secondary-pink);
            color: white;
            box-shadow: 0 4px 15px rgba(233, 30, 99, 0.4);
        }

        .btn-secondary:hover {
            background: #C2185B;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(233, 30, 99, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-indigo);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Practice Page */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-bar {
            height: 12px;
            background: var(--dark-surface);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-indigo), var(--secondary-pink));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(63, 81, 181, 0.5);
        }

        /* Question Content Layout */
        .question-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
            min-height: 400px;
        }

        @media (max-width: 768px) {
            .question-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .question-section {
            background: var(--dark-surface);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid var(--dark-border);
        }

        .example-section {
            background: var(--dark-surface);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid var(--dark-border);
        }

        .question-text {
            font-size: 1.6rem;
            margin-bottom: 20px;
            line-height: 1.5;
            color: var(--text-primary);
            min-height: 80px;
        }

        /* Expression Display */
        .expression-display {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-amber);
        }

        .variable {
            color: var(--accent-teal);
            font-style: italic;
            padding: 0 5px;
            background: rgba(0, 150, 136, 0.1);
            border-radius: 5px;
            margin: 0 3px;
        }

        .operator {
            color: var(--primary-indigo);
            margin: 0 10px;
            font-weight: bold;
        }

        .number {
            color: var(--accent-green);
            padding: 0 5px;
        }

        .equals {
            color: var(--secondary-pink);
            margin: 0 15px;
            font-size: 2.5rem;
        }

        /* Input Box for Variables */
        .variable-input {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .input-box {
            background: var(--dark-bg);
            border: 2px solid var(--primary-indigo);
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 1.5rem;
            text-align: center;
            color: var(--text-primary);
            width: 120px;
            transition: all 0.3s ease;
        }

        .input-box:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.2);
            transform: scale(1.05);
        }

        /* Expression Builder */
        .expression-builder {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .expression-piece {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .expression-piece:hover {
            background: rgba(63, 81, 181, 0.2);
            transform: translateY(-2px);
        }

        /* Options Container */
        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .option {
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--dark-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-indigo);
            background: rgba(63, 81, 181, 0.05);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(63, 81, 181, 0.1);
            border-color: var(--primary-indigo);
            color: var(--primary-indigo);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: #F44336;
            color: #F44336;
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--primary-indigo);
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
            color: white;
        }

        .option.correct .option-letter {
            background: var(--primary-indigo);
            color: white;
        }

        .option.incorrect .option-letter {
            background: #F44336;
            color: white;
        }

        /* Example Section */
        .example-title {
            font-size: 1.3rem;
            color: var(--primary-indigo);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .math-fact {
            background: rgba(255, 193, 7, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-amber);
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .example-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .process-display {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .process-step {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 3px solid var(--accent-green);
        }

        .step-icon {
            font-size: 1.5rem;
            color: var(--accent-green);
        }

        .step-content h4 {
            color: var(--accent-green);
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .step-content p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Variable Table */
        .variable-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .variable-table th {
            background: var(--primary-indigo);
            color: white;
            padding: 10px;
            text-align: left;
        }

        .variable-table td {
            padding: 10px;
            border-bottom: 1px solid var(--dark-border);
        }

        .variable-table tr:last-child td {
            border-bottom: none;
        }

        /* Feedback Container */
        .feedback-container {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: none;
            grid-column: 1 / -1;
        }

        .feedback-correct {
            background: rgba(63, 81, 181, 0.1);
            border-left: 5px solid var(--primary-indigo);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 5px solid #F44336;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--primary-indigo);
        }

        .feedback-incorrect .feedback-icon {
            background: #F44336;
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .feedback-correct .feedback-title {
            color: var(--primary-indigo);
        }

        .feedback-incorrect .feedback-title {
            color: #F44336;
        }

        .feedback-message {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            grid-column: 1 / -1;
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .results-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-indigo), var(--secondary-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-indigo), var(--secondary-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .score-percentage {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--dark-border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-indigo);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease;
        }
        
        @keyframes variableGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(0, 150, 136, 0.3); }
            50% { box-shadow: 0 0 15px rgba(0, 150, 136, 0.6); }
        }
        
        .variable-glow {
            animation: variableGlow 1s ease-in-out;
        }
        
        @keyframes expressionSlide {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .expression-slide {
            animation: expressionSlide 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Background Slideshow -->
    <div class="slideshow" id="slideshow">
        <div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1589256469067-ea99122bbdc4?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
    </div>
    <div class="overlay"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToTopics">Other Topics</button>
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card fade-in" id="welcomePage">
            <div class="welcome-logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <h1 class="welcome-title">Grade 5 Mathematics</h1>
            <p class="welcome-subtitle">Discover the world of variables! Learn to use letters to represent unknown numbers, write simple expressions, evaluate expressions by substituting values, and understand basic algebraic concepts. Build the foundation for all future algebra!</p>
            
            <div class="topic-badge">
                <span class="topic-icon">๐ฅ๐ฆ</span>
                <span class="topic-name">Variables in Simple Expressions</span>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your full name:</label>
                <input type="text" id="studentName" placeholder="Your full name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">
                    <span>Start Algebra Adventure</span>
                </button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 80</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 1%"></div>
                </div>
            </div>

            <div class="question-content">
                <!-- Left Column: Question and Options -->
                <div class="question-section">
                    <h2 class="question-text" id="questionText"></h2>
                    <div id="expressionDisplay"></div>
                    <div id="variableInput"></div>
                    <div class="options-container" id="optionsContainer"></div>
                </div>
                
                <!-- Right Column: Examples and Process -->
                <div class="example-section">
                    <h3 class="example-title">Examples & Process</h3>
                    <div id="mathFact" class="math-fact"></div>
                    <div id="visualDisplay" class="example-display"></div>
                    <div id="processDisplay" class="process-display"></div>
                </div>
                
                <!-- Feedback spans both columns -->
                <div class="feedback-container" id="feedbackContainer">
                    <div class="feedback-header">
                        <div class="feedback-icon"></div>
                        <div class="feedback-title"></div>
                    </div>
                    <div class="feedback-message"></div>
                    <div class="feedback-explanation"></div>
                </div>
                
                <!-- Navigation spans both columns -->
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip Question</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next Question</button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Algebra Basics Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                <div class="score-message" id="scoreMessage"></div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="highestScore">0</div>
                        <div class="stat-label">Highest Score</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Try Again</button>
                <button class="btn btn-secondary" id="viewTopics">Explore Other Topics</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize slideshow
        function initSlideshow() {
            let currentSlide = 0;
            const slides = document.querySelectorAll('.slide');
            
            setInterval(() => {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }, 5000);
        }

        // 80+ Questions on Variables and Simple Expressions
        const questions = [
            // Understanding Variables Basics (1-15)
            {
                type: "variable_basics",
                question: "What is a variable in mathematics?",
                options: ["A letter that represents an unknown number", "A number that never changes", "A mathematical operation", "The answer to a problem"],
                answer: "A",
                explanation: "A variable is a symbol (usually a letter like x, y, or n) that represents an unknown number or a quantity that can change."
            },
            {
                type: "variable_basics",
                question: "Which letter is commonly used as a variable?",
                options: ["x", "5", "+", "="],
                answer: "A",
                explanation: "The letter x is most commonly used as a variable in mathematics, though any letter can be used (y, n, a, b, etc.)."
            },
            {
                type: "variable_basics",
                question: "In the expression 3 + n, what does n represent?",
                options: ["An unknown number", "The number 3", "The plus sign", "The answer"],
                answer: "A",
                explanation: "n is a variable that represents an unknown number in the expression 3 + n."
            },
            {
                type: "variable_basics",
                question: "What does the expression 'y - 5' mean?",
                options: ["Some number y minus 5", "5 minus y", "y equals 5", "y divided by 5"],
                answer: "A",
                explanation: "The expression y - 5 means an unknown number y minus 5."
            },
            {
                type: "variable_basics",
                question: "Which of these contains a variable?",
                options: ["x + 7", "5 + 3", "12 รท 4", "8 ร 2"],
                answer: "A",
                explanation: "x + 7 contains the variable x. The others are numerical expressions without variables."
            },
            // Writing Expressions (16-30)
            {
                type: "writing_expressions",
                question: "Write an expression for 'a number increased by 8'.",
                options: ["n + 8", "8 - n", "n ร 8", "8 รท n"],
                answer: "A",
                explanation: "'Increased by' means addition. If n represents the number, then n + 8."
            },
            {
                type: "writing_expressions",
                question: "How would you write '5 less than a number'?",
                options: ["x - 5", "5 - x", "x + 5", "5 ร x"],
                answer: "A",
                explanation: "'5 less than a number' means subtract 5 from the number. If x is the number, then x - 5."
            },
            {
                type: "writing_expressions",
                question: "Write an expression for 'twice a number'.",
                options: ["2n", "n + 2", "n รท 2", "n - 2"],
                answer: "A",
                explanation: "'Twice' means two times. If n is the number, then 2 ร n or simply 2n."
            },
            {
                type: "writing_expressions",
                question: "Express 'a number divided by 3'.",
                options: ["n รท 3", "3 รท n", "n ร 3", "n + 3"],
                answer: "A",
                explanation: "'Divided by' means division. If n is the number, then n รท 3."
            },
            {
                type: "writing_expressions",
                question: "Write 'the sum of a number and 12'.",
                options: ["x + 12", "x - 12", "12 - x", "x ร 12"],
                answer: "A",
                explanation: "'Sum' means addition. If x is the number, then x + 12."
            },
            {
                type: "writing_expressions",
                question: "Express '7 more than a number'.",
                options: ["y + 7", "y - 7", "7 - y", "7 ร y"],
                answer: "A",
                explanation: "'More than' means addition. If y is the number, then y + 7."
            },
            {
                type: "writing_expressions",
                question: "Write 'the product of 6 and a number'.",
                options: ["6n", "n + 6", "n รท 6", "6 - n"],
                answer: "A",
                explanation: "'Product' means multiplication. If n is the number, then 6 ร n or 6n."
            },
            {
                type: "writing_expressions",
                question: "Express 'a number decreased by 9'.",
                options: ["x - 9", "9 - x", "x + 9", "x รท 9"],
                answer: "A",
                explanation: "'Decreased by' means subtraction. If x is the number, then x - 9."
            },
            // Substitution Basics (31-50)
            {
                type: "substitution",
                question: "If x = 5, what is x + 3?",
                options: ["8", "2", "15", "5"],
                answer: "A",
                explanation: "Substitute x with 5: 5 + 3 = 8."
            },
            {
                type: "substitution",
                question: "If y = 7, what is y - 4?",
                options: ["3", "11", "28", "74"],
                answer: "A",
                explanation: "Substitute y with 7: 7 - 4 = 3."
            },
            {
                type: "substitution",
                question: "If n = 6, what is 2n?",
                options: ["12", "8", "4", "62"],
                answer: "A",
                explanation: "2n means 2 ร n. Substitute n with 6: 2 ร 6 = 12."
            },
            {
                type: "substitution",
                question: "If a = 9, what is a + 5?",
                options: ["14", "4", "45", "95"],
                answer: "A",
                explanation: "Substitute a with 9: 9 + 5 = 14."
            },
            {
                type: "substitution",
                question: "If b = 10, what is b รท 2?",
                options: ["5", "8", "12", "20"],
                answer: "A",
                explanation: "Substitute b with 10: 10 รท 2 = 5."
            },
            {
                type: "substitution",
                question: "If x = 3, what is 4x?",
                options: ["12", "7", "1", "34"],
                answer: "A",
                explanation: "4x means 4 ร x. Substitute x with 3: 4 ร 3 = 12."
            },
            {
                type: "substitution",
                question: "If y = 8, what is y - 6?",
                options: ["2", "14", "48", "86"],
                answer: "A",
                explanation: "Substitute y with 8: 8 - 6 = 2."
            },
            {
                type: "substitution",
                question: "If n = 12, what is n รท 3?",
                options: ["4", "9", "15", "36"],
                answer: "A",
                explanation: "Substitute n with 12: 12 รท 3 = 4."
            },
            // Expressions with Multiple Operations (51-65)
            {
                type: "multi_operation",
                question: "If x = 4, what is 2x + 3?",
                options: ["11", "14", "5", "10"],
                answer: "A",
                explanation: "2x means 2 ร x = 2 ร 4 = 8, then + 3 = 11."
            },
            {
                type: "multi_operation",
                question: "If y = 5, what is 3y - 2?",
                options: ["13", "7", "15", "17"],
                answer: "A",
                explanation: "3y means 3 ร y = 3 ร 5 = 15, then - 2 = 13."
            },
            {
                type: "multi_operation",
                question: "If n = 6, what is n + 2 ร 3? (Remember order of operations: multiplication before addition)",
                options: ["12", "24", "8", "20"],
                answer: "A",
                explanation: "First do multiplication: 2 ร 3 = 6, then add n (6): 6 + 6 = 12."
            },
            {
                type: "multi_operation",
                question: "If a = 7, what is 5 + a ร 2?",
                options: ["19", "24", "14", "49"],
                answer: "A",
                explanation: "First do multiplication: a ร 2 = 7 ร 2 = 14, then add 5: 5 + 14 = 19."
            },
            {
                type: "multi_operation",
                question: "If b = 9, what is (b + 3) รท 3?",
                options: ["4", "3", "6", "12"],
                answer: "A",
                explanation: "First do parentheses: b + 3 = 9 + 3 = 12, then divide by 3: 12 รท 3 = 4."
            },
            {
                type: "multi_operation",
                question: "If x = 8, what is 2 ร (x - 3)?",
                options: ["10", "13", "16", "22"],
                answer: "A",
                explanation: "First do parentheses: x - 3 = 8 - 3 = 5, then multiply by 2: 2 ร 5 = 10."
            },
            // Writing Equations (66-75)
            {
                type: "writing_equations",
                question: "Write an equation for 'a number plus 4 equals 9'.",
                options: ["n + 4 = 9", "n - 4 = 9", "4n = 9", "n รท 4 = 9"],
                answer: "A",
                explanation: "'A number plus 4 equals 9' means n + 4 = 9."
            },
            {
                type: "writing_equations",
                question: "Write 'twice a number is 14' as an equation.",
                options: ["2n = 14", "n + 2 = 14", "n รท 2 = 14", "n - 2 = 14"],
                answer: "A",
                explanation: "'Twice a number' means 2 ร n, 'is' means equals, so 2n = 14."
            },
            {
                type: "writing_equations",
                question: "Express '5 less than a number is 7' as an equation.",
                options: ["n - 5 = 7", "5 - n = 7", "n + 5 = 7", "5n = 7"],
                answer: "A",
                explanation: "'5 less than a number' means n - 5, 'is' means equals, so n - 5 = 7."
            },
            {
                type: "writing_equations",
                question: "Write 'a number divided by 3 equals 4'.",
                options: ["n รท 3 = 4", "3 รท n = 4", "n ร 3 = 4", "n + 3 = 4"],
                answer: "A",
                explanation: "'A number divided by 3' means n รท 3, 'equals' means =, so n รท 3 = 4."
            },
            {
                type: "writing_equations",
                question: "Express 'the sum of a number and 6 is 15'.",
                options: ["n + 6 = 15", "n - 6 = 15", "6n = 15", "n รท 6 = 15"],
                answer: "A",
                explanation: "'Sum' means addition, 'is' means equals, so n + 6 = 15."
            },
            // Real-World Problems (76-85)
            {
                type: "real_world",
                question: "John has some marbles. He gets 5 more. Now he has 12 marbles. Which equation shows this?",
                options: ["m + 5 = 12", "m - 5 = 12", "5m = 12", "m รท 5 = 12"],
                answer: "A",
                explanation: "Let m = original marbles. m + 5 = 12."
            },
            {
                type: "real_world",
                question: "A pencil costs 3 times as much as an eraser. If the pencil costs 75 cents, which equation finds the eraser cost?",
                options: ["3e = 75", "e + 3 = 75", "e รท 3 = 75", "e - 3 = 75"],
                answer: "A",
                explanation: "Let e = eraser cost. Pencil is 3 times eraser: 3e = 75."
            },
            {
                type: "real_world",
                question: "Sara is 4 years older than Tom. If Sara is 12, which equation finds Tom's age?",
                options: ["t + 4 = 12", "t - 4 = 12", "4t = 12", "t รท 4 = 12"],
                answer: "A",
                explanation: "Let t = Tom's age. Sara is t + 4 = 12."
            },
            {
                type: "real_world",
                question: "A book has 250 pages. You've read p pages and have 125 left. Which equation is correct?",
                options: ["p + 125 = 250", "p - 125 = 250", "125p = 250", "p รท 125 = 250"],
                answer: "A",
                explanation: "Pages read + pages left = total pages: p + 125 = 250."
            },
            {
                type: "real_world",
                question: "You save $5 each week. After w weeks, you have $45. Which equation shows this?",
                options: ["5w = 45", "w + 5 = 45", "w รท 5 = 45", "5 รท w = 45"],
                answer: "A",
                explanation: "$5 per week ร w weeks = total saved: 5w = 45."
            },
            // Pattern Recognition (86-95)
            {
                type: "patterns",
                question: "In the pattern 3, 6, 9, 12..., each number is 3 more than the previous. If n represents position (1st, 2nd, 3rd...), which expression gives the number?",
                options: ["3n", "n + 3", "3 + n", "n รท 3"],
                answer: "A",
                explanation: "Position 1: 3ร1=3, Position 2: 3ร2=6, Position 3: 3ร3=9. So 3n."
            },
            {
                type: "patterns",
                question: "Pattern: 5, 10, 15, 20... If n is position number, which expression?",
                options: ["5n", "n + 5", "5 + n", "n รท 5"],
                answer: "A",
                explanation: "Position 1: 5ร1=5, Position 2: 5ร2=10. So 5n."
            },
            {
                type: "patterns",
                question: "Pattern: 2, 4, 6, 8... If n is position, which expression?",
                options: ["2n", "n + 2", "2 + n", "n รท 2"],
                answer: "A",
                explanation: "Position 1: 2ร1=2, Position 2: 2ร2=4. So 2n."
            },
            // Mixed Review (96-105)
            {
                type: "mixed_review",
                question: "If a = 2 and b = 3, what is a + b?",
                options: ["5", "6", "1", "23"],
                answer: "A",
                explanation: "Substitute: 2 + 3 = 5."
            },
            {
                type: "mixed_review",
                question: "If x = 4, what is 3x + 1?",
                options: ["13", "7", "12", "5"],
                answer: "A",
                explanation: "3x = 3ร4=12, +1=13."
            },
            {
                type: "mixed_review",
                question: "Express '7 times a number'.",
                options: ["7n", "n + 7", "n รท 7", "n - 7"],
                answer: "A",
                explanation: "'Times' means multiplication: 7 ร n or 7n."
            },
            {
                type: "mixed_review",
                question: "If y = 9, what is y รท 3 + 2?",
                options: ["5", "8", "11", "7"],
                answer: "A",
                explanation: "y รท 3 = 9 รท 3 = 3, +2 = 5."
            },
            {
                type: "mixed_review",
                question: "Write 'a number decreased by 8 is 15'.",
                options: ["n - 8 = 15", "8 - n = 15", "n + 8 = 15", "8n = 15"],
                answer: "A",
                explanation: "'Decreased by' means subtract: n - 8 = 15."
            }
        ];

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // Positive feedback messages
        const positiveMessages = [
            "Excellent variable skills!",
            "Fantastic understanding of algebraic expressions!",
            "Great work! You're an algebra expert in the making!",
            "Amazing! Your substitution skills are impressive!",
            "Well done! Perfect expression evaluation!",
            "You're a variables champion!",
            "Perfect! You understand how variables work!",
            "Outstanding mathematical reasoning with expressions!",
            "Brilliant! You handle algebraic expressions like a pro!",
            "You're on fire! Great attention to substitution rules!"
        ];

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const expressionDisplay = document.getElementById('expressionDisplay');
        const variableInput = document.getElementById('variableInput');
        const mathFact = document.getElementById('mathFact');
        const visualDisplay = document.getElementById('visualDisplay');
        const processDisplay = document.getElementById('processDisplay');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const backToTopicsBtn = document.getElementById('backToTopics');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const scoreMessage = document.getElementById('scoreMessage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const highestScore = document.getElementById('highestScore');

        // Helper function to create expression display
        function createExpressionDisplay() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            let displayHTML = '';
            
            if (question.type.includes("substitution") || question.type.includes("multi_operation")) {
                // Extract expression from question
                const text = question.question;
                const expressions = text.match(/what is (.*)\?/i);
                
                if (expressions && expressions[1]) {
                    const expression = expressions[1].replace(/x|y|n|a|b/g, match => 
                        `<span class="variable variable-glow">${match}</span>`
                    );
                    
                    displayHTML = `
                        <div class="expression-display expression-slide">
                            <span>Expression:</span>
                            <div class="expression">${expression}</div>
                        </div>
                    `;
                }
            } else if (question.type.includes("writing")) {
                displayHTML = `
                    <div class="expression-display expression-slide">
                        <div style="color: var(--accent-teal);">Your task: Write the correct expression or equation</div>
                    </div>
                `;
            }
            
            return displayHTML;
        }

        // Helper function to create variable input if needed
        function createVariableInput() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            let inputHTML = '';
            
            if (question.type.includes("substitution") || question.type.includes("multi_operation")) {
                // Extract variable value from question
                const text = question.question;
                const varMatch = text.match(/If (\w) = (\d+)/i);
                
                if (varMatch) {
                    const variable = varMatch[1];
                    const value = varMatch[2];
                    
                    inputHTML = `
                        <div class="variable-input">
                            <div style="color: var(--text-secondary);">Given:</div>
                            <div style="color: var(--accent-teal); font-weight: bold; font-size: 1.5rem;">
                                ${variable} = ${value}
                            </div>
                        </div>
                    `;
                }
            }
            
            return inputHTML;
        }

        // Initialize the app
        function initApp() {
            initSlideshow();
            loadStateFromStorage();
            setupEventListeners();
            
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Load state from localStorage
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixGrade5MathVariables');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // Save state to localStorage
        function saveStateToStorage() {
            localStorage.setItem('ideolixGrade5MathVariables', JSON.stringify(appState));
        }

        // Initialize and shuffle questions
        function initializeQuestions() {
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', backToHome);
            backToTopicsBtn.addEventListener('click', backToTopics);
            viewTopicsBtn.addEventListener('click', backToTopics);
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startPractice();
                }
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            
            const highest = localStorage.getItem('ideolixGrade5MathVariables_highestScore') || 0;
            highestScore.textContent = Math.max(highest, appState.score);
            
            if (appState.score > highest) {
                localStorage.setItem('ideolixGrade5MathVariables_highestScore', appState.score);
            }
            
            if (percentage >= 90) {
                scoreMessage.textContent = "Outstanding! You're an algebra expert!";
            } else if (percentage >= 80) {
                scoreMessage.textContent = "Great job! You have excellent variable skills!";
            } else if (percentage >= 70) {
                scoreMessage.textContent = "Good work! Keep practicing with variables!";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "Not bad! Review how to use variables in expressions!";
            } else {
                scoreMessage.textContent = "Keep learning! Variables get easier with practice!";
            }
        }

        // Create math fact display
        function createMathFact() {
            const facts = [
                "The word 'algebra' comes from Arabic 'al-jabr' meaning 'reunion of broken parts'!",
                "The ancient Babylonians were solving algebraic equations over 4,000 years ago!",
                "The letter 'x' became popular for variables because it was easy to typeset in early printing presses!",
                "Renรฉ Descartes introduced using letters from the end of the alphabet (x, y, z) for unknowns!",
                "Variables allow us to solve problems without knowing the exact numbers first!",
                "The equals sign '=' was invented in 1557 by Welsh mathematician Robert Recorde!",
                "Algebra is sometimes called 'generalized arithmetic' because it works with all numbers!",
                "The use of variables is what makes computers possible - they store values in variables!"
            ];
            
            return `<strong>Math Fact:</strong> ${facts[Math.floor(Math.random() * facts.length)]}`;
        }

        // Create visual display
        function createVisualDisplay() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            let visualHTML = '';
            
            if (question.type.includes("substitution")) {
                visualHTML = `
                    <div style="margin-bottom: 10px; color: var(--accent-amber); font-weight: bold;">Substitution Example:</div>
                    <div style="background: rgba(63, 81, 181, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <div style="color: var(--text-secondary); margin-bottom: 8px;">If x = 4, find x + 3:</div>
                        <div style="font-size: 1.2rem;">
                            x + 3 = <span style="color: var(--accent-teal);">4</span> + 3 = <span style="color: var(--accent-green);">7</span>
                        </div>
                    </div>
                    <div style="margin-top: 10px; color: var(--text-secondary); font-size: 0.9rem;">
                        Replace the variable with its given value, then calculate!
                    </div>
                `;
            } else if (question.type.includes("writing")) {
                visualHTML = `
                    <div style="margin-bottom: 10px; color: var(--accent-teal); font-weight: bold;">Expression Builder:</div>
                    <div style="background: rgba(0, 150, 136, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <table class="variable-table">
                            <tr>
                                <th>Word Phrase</th>
                                <th>Operation</th>
                                <th>Expression</th>
                            </tr>
                            <tr>
                                <td>sum, plus, more than</td>
                                <td>Addition</td>
                                <td>n + 5</td>
                            </tr>
                            <tr>
                                <td>difference, minus, less than</td>
                                <td>Subtraction</td>
                                <td>n - 3</td>
                            </tr>
                            <tr>
                                <td>product, times, multiplied by</td>
                                <td>Multiplication</td>
                                <td>4n or 4 ร n</td>
                            </tr>
                            <tr>
                                <td>quotient, divided by</td>
                                <td>Division</td>
                                <td>n รท 2</td>
                            </tr>
                        </table>
                    </div>
                `;
            } else if (question.type.includes("patterns")) {
                visualHTML = `
                    <div style="margin-bottom: 10px; color: var(--accent-green); font-weight: bold;">Pattern Recognition:</div>
                    <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <div style="color: var(--text-secondary); margin-bottom: 8px;">Pattern: 3, 6, 9, 12...</div>
                        <div style="font-size: 1.1rem;">
                            Position 1: 3 ร 1 = 3<br>
                            Position 2: 3 ร 2 = 6<br>
                            Position 3: 3 ร 3 = 9<br>
                            Position n: <span style="color: var(--accent-teal);">3 ร n</span> or <span style="color: var(--accent-teal);">3n</span>
                        </div>
                    </div>
                `;
            }
            
            return visualHTML;
        }

        // Create process display
        function createProcessDisplay() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            let processHTML = '';
            
            if (question.type.includes("substitution")) {
                processHTML = `
                    <div class="process-step">
                        <div class="step-icon">1๏ธโฃ</div>
                        <div class="step-content">
                            <h4>Identify Variable</h4>
                            <p>Find which letter represents the variable (x, y, n, etc.)</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">2๏ธโฃ</div>
                        <div class="step-content">
                            <h4>Find Value</h4>
                            <p>Look for what number the variable equals</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">3๏ธโฃ</div>
                        <div class="step-content">
                            <h4>Substitute</h4>
                            <p>Replace the variable in the expression with its value</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">โ</div>
                        <div class="step-content">
                            <h4>Calculate</h4>
                            <p>Perform the arithmetic operations to find the answer</p>
                        </div>
                    </div>
                `;
            } else if (question.type.includes("writing")) {
                processHTML = `
                    <div class="process-step">
                        <div class="step-icon">1๏ธโฃ</div>
                        <div class="step-content">
                            <h4>Choose Variable</h4>
                            <p>Select a letter to represent the unknown number</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">2๏ธโฃ</div>
                        <div class="step-content">
                            <h4>Identify Operation</h4>
                            <p>Look for key words that tell you what operation to use</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">3๏ธโฃ</div>
                        <div class="step-content">
                            <h4>Write Expression</h4>
                            <p>Put the variable and numbers in the correct order</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">โ</div>
                        <div class="step-content">
                            <h4>Check Meaning</h4>
                            <p>Read your expression to make sure it matches the words</p>
                        </div>
                    </div>
                `;
            } else if (question.type.includes("patterns")) {
                processHTML = `
                    <div class="process-step">
                        <div class="step-icon">1๏ธโฃ</div>
                        <div class="step-content">
                            <h4>Find Pattern</h4>
                            <p>Look at the numbers to see how they change</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">2๏ธโฃ</div>
                        <div class="step-content">
                            <h4>Connect to Position</h4>
                            <p>See how each number relates to its position (1st, 2nd, 3rd...)</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">3๏ธโฃ</div>
                        <div class="step-content">
                            <h4>Write Rule</h4>
                            <p>Create an expression using n for position number</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">โ</div>
                        <div class="step-content">
                            <h4>Test Rule</h4>
                            <p>Check if your expression works for several positions</p>
                        </div>
                    </div>
                `;
            } else {
                processHTML = `
                    <div class="process-step">
                        <div class="step-icon">๐</div>
                        <div class="step-content">
                            <h4>Understand the Problem</h4>
                            <p>Read carefully to know what's being asked</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">๐</div>
                        <div class="step-content">
                            <h4>Identify Variables</h4>
                            <p>Find what letters represent unknown numbers</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">๐งฎ</div>
                        <div class="step-content">
                            <h4>Perform Operation</h4>
                            <p>Substitute values or write expressions as needed</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">โ</div>
                        <div class="step-content">
                            <h4>Verify Answer</h4>
                            <p>Make sure your answer makes sense in context</p>
                        </div>
                    </div>
                `;
            }
            
            return processHTML;
        }

        // Load current question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            // Update displays
            expressionDisplay.innerHTML = createExpressionDisplay();
            variableInput.innerHTML = createVariableInput();
            mathFact.innerHTML = createMathFact();
            visualDisplay.innerHTML = createVisualDisplay();
            processDisplay.innerHTML = createProcessDisplay();
            
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            // Create answer options
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                optionElement.classList.add('pulse');
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation, question.answer);
            }
            
            nextQuestionBtn.disabled = false;
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackMessage = feedbackContainer.querySelector('.feedback-message');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = 'โ';
                feedbackTitle.textContent = 'Correct!';
                feedbackMessage.textContent = positiveMessages[Math.floor(Math.random() * positiveMessages.length)];
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = 'โ';
                feedbackTitle.textContent = 'Incorrect';
                if (correctAnswer) {
                    const correctOption = String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65));
                    const correctText = questions.find(q => 
                        appState.currentQuestions[appState.currentQuestionIndex].question === q.question
                    )?.options[correctAnswer.charCodeAt(0) - 65];
                    
                    feedbackMessage.textContent = `Correct answer: ${correctOption} (${correctText})`;
                }
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip current question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry the topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            initializeQuestions();
            
            saveStateToStorage();
            showPracticePage();
        }

        // Go back to home page
        function backToHome() {
            showWelcomePage();
        }

        // Go back to topics page
        function backToTopics() {
            alert("In a complete implementation, this would navigate to the topics selection page.");
        }

        // Start practice session
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name to begin!");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            if (appState.currentQuestions.length === 0) {
                initializeQuestions();
            }
            
            saveStateToStorage();
            showPracticePage();
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 7 English - Formal & Informal Letters | Ideolix Learning Hub</title>
    <style>
        /* CSS Variables for Letter Writing Theme */
        :root {
            --primary-blue: #2962FF;
            --secondary-teal: #00BFA5;
            --accent-amber: #FFAB00;
            --accent-purple: #AA00FF;
            --accent-pink: #FF4081;
            --accent-green: #00C853;
            --accent-orange: #FF6D00;
            --accent-cyan: #00B8D4;
            --dark-bg: #0D1B2A;
            --dark-surface: #1B2B3A;
            --dark-card: #253447;
            --dark-border: #3A4A5A;
            --text-primary: #FFFFFF;
            --text-secondary: #B8D0E0;
            --text-muted: #7A94A8;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            --glow: 0 0 20px rgba(41, 98, 255, 0.3);
            --formal-glow: 0 0 15px rgba(0, 191, 165, 0.4);
            --informal-glow: 0 0 15px rgba(255, 171, 0, 0.4);
            --letter-glow: 0 0 15px rgba(170, 0, 255, 0.4);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Letter Pattern Background */
        .letter-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: 
                radial-gradient(circle at 20% 30%, rgba(41, 98, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 191, 165, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 171, 0, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #0D1B2A, #1B2B3A);
            opacity: 0.8;
        }

        .floating-text {
            position: absolute;
            color: rgba(255, 255, 255, 0.05);
            font-size: 1.5rem;
            font-weight: normal;
            animation: floatText 30s linear infinite;
            font-family: 'Georgia', serif;
            max-width: 200px;
            text-align: center;
            line-height: 1.3;
        }

        @keyframes floatText {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.1; }
            25% { transform: translateY(-100px) translateX(100px) rotate(5deg); opacity: 0.05; }
            50% { transform: translateY(-50px) translateX(-100px) rotate(-5deg); opacity: 0.1; }
            75% { transform: translateY(100px) translateX(50px) rotate(5deg); opacity: 0.05; }
            100% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.1; }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 27, 42, 0.9);
            z-index: -1;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            position: sticky;
            top: 20px;
            z-index: 100;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(10px);
        }

        .logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info {
            flex: 1;
        }

        .brand-info h1 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        /* Card Styles */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(5px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow), var(--glow);
        }

        /* Welcome Page */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-logo {
            width: 140px;
            height: 140px;
            margin-bottom: 25px;
            border-radius: 20px;
            overflow: hidden;
            background-color: var(--dark-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .welcome-logo img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .welcome-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 700px;
            line-height: 1.6;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(41, 98, 255, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 25px;
            border: 1px solid var(--primary-blue);
        }

        .topic-icon {
            font-size: 1.5rem;
        }

        .topic-name {
            font-weight: 600;
            color: var(--primary-blue);
        }

        .input-group {
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 1.1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(41, 98, 255, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.4);
        }

        .btn-primary:hover {
            background: #1A56DB;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(41, 98, 255, 0.5);
        }

        .btn-secondary {
            background: var(--secondary-teal);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 191, 165, 0.4);
        }

        .btn-secondary:hover {
            background: #009688;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 191, 165, 0.5);
        }

        .btn-amber {
            background: var(--accent-amber);
            color: #000;
            box-shadow: 0 4px 15px rgba(255, 171, 0, 0.4);
        }

        .btn-amber:hover {
            background: #FF9800;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 171, 0, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-blue);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Practice Mode */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-bar {
            height: 12px;
            background: var(--dark-surface);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(41, 98, 255, 0.5);
        }

        .question-container {
            margin-bottom: 25px;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .writing-fact {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-purple);
            font-style: italic;
            color: var(--text-secondary);
        }

        /* Content Layout */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 25px 0;
        }

        @media (max-width: 992px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .question-side {
            display: flex;
            flex-direction: column;
        }

        .visualization-side {
            display: flex;
            flex-direction: column;
        }

        .concept-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .concept-box {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            padding: 20px 30px;
            border-radius: 12px;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            min-width: 180px;
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .concept-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .concept-label {
            font-size: 1rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 5px;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }

        .option {
            padding: 18px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--dark-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: rgba(41, 98, 255, 0.05);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(0, 200, 83, 0.1);
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .option.incorrect {
            background: rgba(255, 64, 129, 0.1);
            border-color: var(--accent-pink);
            color: var(--accent-pink);
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--dark-card);
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
            color: white;
            background: var(--secondary-teal);
        }

        .option.correct .option-letter {
            background: var(--accent-green);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--accent-pink);
            color: white;
        }

        .feedback-container {
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            display: none;
        }

        .feedback-correct {
            background: rgba(0, 200, 83, 0.1);
            border-left: 5px solid var(--accent-green);
        }

        .feedback-incorrect {
            background: rgba(255, 64, 129, 0.1);
            border-left: 5px solid var(--accent-pink);
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--accent-green);
        }

        .feedback-incorrect .feedback-icon {
            background: var(--accent-pink);
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .feedback-correct .feedback-title {
            color: var(--accent-green);
        }

        .feedback-incorrect .feedback-title {
            color: var(--accent-pink);
        }

        .feedback-message {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        /* Visualization Components */
        .visualization-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 25px;
            height: 100%;
            border: 1px solid var(--dark-border);
            overflow: auto;
            backdrop-filter: blur(5px);
        }

        /* Letter Writing Display */
        .letter-display {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
        }

        .display-title {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            font-size: 1.3rem;
        }

        .letter-container {
            padding: 20px;
            background: var(--dark-surface);
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--accent-purple);
        }

        .letter-scenario {
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .letter-highlight {
            background: rgba(170, 0, 255, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid var(--accent-purple);
        }

        .highlight-text {
            color: var(--accent-purple);
            font-weight: bold;
        }

        /* Letter Skills Grid */
        .skills-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 992px) {
            .skills-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .skills-grid {
                grid-template-columns: 1fr;
            }
        }

        .skill-card {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid transparent;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .skill-card:hover {
            transform: translateY(-5px);
        }

        .skill-card.formal {
            border-color: var(--secondary-teal);
        }

        .skill-card.informal {
            border-color: var(--accent-amber);
        }

        .skill-card.structure {
            border-color: var(--accent-purple);
        }

        .skill-card.tone {
            border-color: var(--accent-pink);
        }

        .skill-card.language {
            border-color: var(--accent-green);
        }

        .skill-card.format {
            border-color: var(--accent-orange);
        }

        .skill-card.purpose {
            border-color: var(--accent-cyan);
        }

        .skill-card.audience {
            border-color: var(--primary-blue);
        }

        .skill-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .formal .skill-icon {
            color: var(--secondary-teal);
        }

        .informal .skill-icon {
            color: var(--accent-amber);
        }

        .structure .skill-icon {
            color: var(--accent-purple);
        }

        .tone .skill-icon {
            color: var(--accent-pink);
        }

        .language .skill-icon {
            color: var(--accent-green);
        }

        .format .skill-icon {
            color: var(--accent-orange);
        }

        .purpose .skill-icon {
            color: var(--accent-cyan);
        }

        .audience .skill-icon {
            color: var(--primary-blue);
        }

        .skill-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .formal .skill-title {
            color: var(--secondary-teal);
        }

        .informal .skill-title {
            color: var(--accent-amber);
        }

        .structure .skill-title {
            color: var(--accent-purple);
        }

        .tone .skill-title {
            color: var(--accent-pink);
        }

        .language .skill-title {
            color: var(--accent-green);
        }

        .format .skill-title {
            color: var(--accent-orange);
        }

        .purpose .skill-title {
            color: var(--accent-cyan);
        }

        .audience .skill-title {
            color: var(--primary-blue);
        }

        .skill-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .skill-examples {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 10px;
            background: var(--dark-surface);
            padding: 8px;
            border-radius: 4px;
        }

        /* Letter Writing Table */
        .letter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--dark-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .letter-table th {
            background: var(--dark-surface);
            padding: 12px;
            text-align: left;
            color: var(--accent-purple);
            border-bottom: 2px solid var(--accent-purple);
        }

        .letter-table td {
            padding: 10px;
            border-bottom: 1px solid var(--dark-border);
            color: var(--text-primary);
        }

        .letter-table tr:hover {
            background: rgba(170, 0, 255, 0.05);
        }

        /* Detailed Skills Display */
        .skills-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--secondary-teal);
        }

        .skills-title {
            color: var(--secondary-teal);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .skills-inner-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .skills-inner-grid {
                grid-template-columns: 1fr;
            }
        }

        .skill-detail-card {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .skill-detail-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--secondary-teal);
        }

        .skill-detail-type {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--secondary-teal);
            font-size: 1.2rem;
        }

        .skill-detail-steps {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Formal vs Informal Display */
        .comparison-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-amber);
        }

        .comparison-title {
            color: var(--accent-amber);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }

        .comparison-card {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .comparison-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .comparison-type {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        /* Interactive Letter Builder */
        .builder-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--primary-blue);
        }

        .builder-title {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .builder-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .builder-select {
            padding: 10px 15px;
            background: var(--dark-surface);
            border: 2px solid var(--primary-blue);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .builder-input {
            padding: 15px;
            background: var(--dark-surface);
            border: 2px solid var(--primary-blue);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
        }

        .builder-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .builder-btn {
            padding: 10px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--primary-blue);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .builder-btn:hover {
            background: rgba(41, 98, 255, 0.1);
            transform: translateY(-2px);
        }

        .builder-display {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 8px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        /* Writing Study Display */
        .writing-study-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .writing-study-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .writing-study-grid {
                grid-template-columns: 1fr;
            }
        }

        .study-card {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--accent-green);
        }

        .study-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--accent-green);
        }

        .study-concept {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--accent-green);
        }

        .study-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .results-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .score-percentage {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--dark-border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Letter Writing Visual Elements */
        .letter-step {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 191, 165, 0.05);
            border-radius: 6px;
            border-left: 4px solid var(--secondary-teal);
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--secondary-teal);
            color: white;
            border-radius: 50%;
            font-weight: bold;
        }

        .step-description {
            flex: 1;
        }

        .word-box {
            display: inline-block;
            padding: 5px 10px;
            margin: 0 5px;
            background: rgba(255, 171, 0, 0.1);
            border-radius: 4px;
            border: 1px solid var(--accent-amber);
            font-weight: bold;
        }

        .key-point {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--accent-pink);
            border-radius: 50%;
            margin: 0 5px;
        }

        .detail-line {
            display: inline-block;
            height: 2px;
            width: 30px;
            background: var(--primary-blue);
            margin: 0 5px;
            vertical-align: middle;
        }

        .letter-marker {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid var(--accent-amber);
            margin: 0 5px;
            position: relative;
        }

        .letter-marker::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-amber);
            opacity: 0.3;
        }

        /* Example Letters */
        .example-letter {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-amber);
        }

        .letter-title {
            color: var(--accent-amber);
            font-weight: bold;
            margin-bottom: 15px;
        }

        .letter-content {
            line-height: 1.6;
            color: var(--text-primary);
            margin-bottom: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }

        /* Key Points List */
        .key-points {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .key-points-title {
            color: var(--primary-blue);
            font-weight: bold;
            margin-bottom: 15px;
        }

        .key-point-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: var(--dark-card);
            border-radius: 6px;
        }

        .key-point-icon {
            color: var(--accent-green);
            font-size: 1.2rem;
            margin-top: 2px;
        }

        /* Before-After Examples */
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .before-after {
                grid-template-columns: 1fr;
            }
        }

        .before-example {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid var(--accent-pink);
        }

        .after-example {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid var(--accent-green);
        }

        .example-title {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .before-example .example-title {
            color: var(--accent-pink);
        }

        .after-example .example-title {
            color: var(--accent-green);
        }

        /* Step-by-Step Process */
        .process-steps {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .process-title {
            color: var(--accent-purple);
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .process-step {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--dark-surface);
            border-radius: 8px;
            border-left: 4px solid var(--accent-purple);
        }

        .step-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-purple);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-heading {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--accent-purple);
        }

        /* Common Mistakes */
        .mistakes-container {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid var(--accent-pink);
        }

        .mistakes-title {
            color: var(--accent-pink);
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .mistake-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 15px;
            padding: 15px;
            background: var(--dark-surface);
            border-radius: 6px;
        }

        .mistake-icon {
            color: var(--accent-pink);
            font-size: 1.2rem;
            margin-top: 2px;
        }

        .mistake-heading {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--accent-pink);
        }

        /* Formal Letter Structure Display */
        .formal-structure {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid var(--secondary-teal);
        }

        .structure-title {
            color: var(--secondary-teal);
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .structure-diagram {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .structure-part {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-teal);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .part-number {
            width: 30px;
            height: 30px;
            background: var(--secondary-teal);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2rem;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .score-value {
                font-size: 3rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons .btn {
                width: 100%;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .concept-box {
                min-width: 140px;
                font-size: 1.5rem;
                padding: 15px 20px;
            }
            
            .skills-grid {
                grid-template-columns: 1fr;
            }
            
            .skills-inner-grid {
                grid-template-columns: 1fr;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes grow {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .grow {
            animation: grow 0.5s ease forwards;
        }
        
        @keyframes letterReveal {
            0% { transform: translateX(-100px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        .letter-reveal {
            animation: letterReveal 0.5s ease forwards;
        }
        
        @keyframes formalGlow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 191, 165, 0.4); }
            50% { box-shadow: 0 0 15px 5px rgba(0, 191, 165, 0.2); }
        }
        
        .formal-glow {
            animation: formalGlow 2s ease-in-out infinite;
        }
        
        @keyframes informalGlow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 171, 0, 0.4); }
            50% { box-shadow: 0 0 15px 5px rgba(255, 171, 0, 0.2); }
        }
        
        .informal-glow {
            animation: informalGlow 2s ease-in-out infinite;
        }
        
        @keyframes letterGlow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(170, 0, 255, 0.4); }
            50% { box-shadow: 0 0 15px 5px rgba(170, 0, 255, 0.2); }
        }
        
        .letter-glow {
            animation: letterGlow 2s ease-in-out infinite;
        }
        
        @keyframes floatSymbol {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        
        .float-symbol {
            animation: floatSymbol 3s ease-in-out infinite;
        }
        
        @keyframes writingGlow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .writing-glow {
            animation: writingGlow 2s ease-in-out infinite;
        }
        
        @keyframes constructLetter {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .construct-letter {
            animation: constructLetter 0.5s ease forwards;
        }
        
        /* Letter Text Styling */
        .letter-text {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            white-space: pre-wrap;
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--dark-border);
        }
        
        .salutation {
            font-weight: bold;
            margin: 15px 0;
            color: var(--accent-amber);
        }
        
        .closing {
            font-weight: bold;
            margin: 15px 0;
            color: var(--accent-amber);
        }
        
        .signature {
            font-style: italic;
            margin-top: 30px;
        }
        
        /* Interactive Letter Elements */
        .letter-element {
            padding: 10px 15px;
            margin: 5px;
            border-radius: 6px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        .letter-element:hover {
            transform: translateY(-2px);
        }
        
        .formal-element {
            border-color: var(--secondary-teal);
            background: rgba(0, 191, 165, 0.1);
        }
        
        .informal-element {
            border-color: var(--accent-amber);
            background: rgba(255, 171, 0, 0.1);
        }
        
        .element-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- Letter Pattern Background -->
    <div class="letter-bg" id="letterBg">
        <!-- Text snippets will be generated by JavaScript -->
    </div>
    <div class="overlay"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToTopics">Other Topics</button>
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card fade-in" id="welcomePage">
            <div class="welcome-logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <h1 class="welcome-title">Grade 7 English - Formal & Informal Letters</h1>
            <p class="welcome-subtitle">Master the art of letter writing! Learn to write formal letters for professional communication and informal letters for personal correspondence. Develop essential communication skills for academic, professional, and personal situations!</p>
            
            <div class="topic-badge">
                <span class="topic-icon">üìù ‚úâÔ∏è üè¢ üè† üëî üëï</span>
                <span class="topic-name">Formal vs Informal Communication</span>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your full name:</label>
                <input type="text" id="studentName" placeholder="Your full name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">
                    <span>Start Letter Writing Journey</span>
                </button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 80</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 1.25%"></div>
                </div>
            </div>

            <div class="question-container">
                <!-- Writing fact display -->
                <div id="writingFact"></div>
                
                <!-- Concept display area -->
                <div id="conceptDisplay"></div>
                
                <!-- Content Wrapper: Questions on left, Visualizations on right -->
                <div class="content-wrapper" id="contentWrapper">
                    <!-- Left side: Question and Options -->
                    <div class="question-side">
                        <h2 class="question-text" id="questionText"></h2>
                        
                        <div class="options-container" id="optionsContainer"></div>
                        
                        <div class="feedback-container" id="feedbackContainer">
                            <div class="feedback-header">
                                <div class="feedback-icon"></div>
                                <div class="feedback-title"></div>
                            </div>
                            <div class="feedback-message"></div>
                            <div class="feedback-explanation"></div>
                        </div>
                    </div>
                    
                    <!-- Right side: Visualizations -->
                    <div class="visualization-side">
                        <div class="visualization-container" id="visualizationContainer">
                            <!-- All visualizations will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip Question</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next Question</button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Letter Writing Mastery Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                <div class="score-message" id="scoreMessage"></div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="highestScore">0</div>
                        <div class="stat-label">Highest Score</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Practice Again</button>
                <button class="btn btn-secondary" id="viewTopics">Other English Topics</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize background
        function initBackground() {
            const letterBg = document.getElementById('letterBg');
            
            // Create floating text snippets
            const textSnippets = [
                "Formal",
                "Informal",
                "Salutation",
                "Closing",
                "Signature",
                "Address",
                "Date",
                "Subject",
                "Body",
                "Paragraph"
            ];
            
            for (let i = 0; i < 20; i++) {
                const text = document.createElement('div');
                text.className = 'floating-text float-symbol';
                text.textContent = textSnippets[Math.floor(Math.random() * textSnippets.length)];
                text.style.left = `${Math.random() * 100}%`;
                text.style.top = `${Math.random() * 100}%`;
                text.style.animationDelay = `${Math.random() * 5}s`;
                text.style.fontSize = `${1 + Math.random() * 1.5}rem`;
                
                // Color based on text content
                const colors = [
                    'rgba(0, 191, 165, 0.1)',    // Teal (Formal)
                    'rgba(255, 171, 0, 0.1)',    // Amber (Informal)
                    'rgba(170, 0, 255, 0.1)',    // Purple
                    'rgba(255, 64, 129, 0.1)',   // Pink
                    'rgba(0, 200, 83, 0.1)',     // Green
                    'rgba(41, 98, 255, 0.1)'     // Blue
                ];
                text.style.color = colors[Math.floor(Math.random() * colors.length)];
                
                letterBg.appendChild(text);
            }
        }

        // Questions array - 80+ Grade 7 Formal & Informal Letters Questions
        const questions = [
            // What is Letter Writing? (1-10)
            {
                type: "basics",
                question: "What is a formal letter?",
                options: ["A letter written for professional or official purposes", "A letter to friends or family", "A short text message", "A creative story"],
                answer: "A",
                explanation: "A formal letter is written for professional, official, or business purposes and follows specific conventions."
            },
            {
                type: "basics",
                question: "What is an informal letter?",
                options: ["A personal letter to friends or family", "A business letter", "An official complaint", "A job application"],
                answer: "A",
                explanation: "An informal letter is a personal letter written to friends, family, or acquaintances in a casual style."
            },
            {
                type: "basics",
                question: "What is the main purpose of letter writing?",
                options: ["To communicate messages in written form", "To show handwriting skills", "To use fancy stationery", "To practice grammar only"],
                answer: "A",
                explanation: "The main purpose is to communicate messages, thoughts, or information in written form to another person."
            },
            // Formal Letters (11-20)
            {
                type: "formal",
                question: "When should you write a formal letter?",
                options: ["When writing to organizations, officials, or for business", "When texting a friend", "When writing in a diary", "When posting on social media"],
                answer: "A",
                explanation: "Formal letters are used for official, business, or professional communication with organizations or individuals you don't know personally."
            },
            {
                type: "formal",
                question: "Which salutation is appropriate for a formal letter?",
                options: ["Dear Mr. Smith,", "Hey there!", "Hi buddy,", "Yo!"],
                answer: "A",
                explanation: "Formal letters use respectful salutations like 'Dear Mr./Ms./Dr. [Last Name],'"
            },
            {
                type: "formal",
                question: "What is the typical structure of a formal letter?",
                options: ["Sender's address, date, recipient's address, salutation, body, closing, signature", "Just the message", "Only the body", "No structure needed"],
                answer: "A",
                explanation: "Formal letters have a specific structure including addresses, date, formal salutation, organized body, formal closing, and signature."
            },
            // Informal Letters (21-30)
            {
                type: "informal",
                question: "When should you write an informal letter?",
                options: ["When writing to friends or family", "When applying for a job", "When complaining to a company", "When writing to government officials"],
                answer: "A",
                explanation: "Informal letters are for personal communication with people you know well like friends and family."
            },
            {
                type: "informal",
                question: "Which salutation is appropriate for an informal letter?",
                options: ["Dear Sarah,", "Dear Sir/Madam,", "To Whom It May Concern,", "Respected Sir,"],
                answer: "A",
                explanation: "Informal letters use casual but polite salutations like 'Dear [First Name],'"
            },
            {
                type: "informal",
                question: "What is NOT a characteristic of informal letters?",
                options: ["Strict formatting rules", "Personal tone", "Use of contractions", "Casual language"],
                answer: "A",
                explanation: "Informal letters are flexible and don't have strict formatting rules like formal letters."
            },
            // Differences Between Formal & Informal (31-40)
            {
                type: "differences",
                question: "What is a key difference between formal and informal letters?",
                options: ["Formal letters use formal language; informal letters use casual language", "Formal letters are shorter", "Informal letters require a subject line", "Only informal letters have addresses"],
                answer: "A",
                explanation: "The key difference is language style: formal letters use professional language while informal letters use casual, personal language."
            },
            {
                type: "differences",
                question: "Which closing is for formal letters?",
                options: ["Yours sincerely,", "Love,", "Take care,", "Bye for now,"],
                answer: "A",
                explanation: "'Yours sincerely' and 'Yours faithfully' are formal closings. Informal letters use casual closings like 'Love,' or 'Best wishes,'"
            },
            // Letter Structure (41-50)
            {
                type: "structure",
                question: "What comes first in a formal letter?",
                options: ["Sender's address", "Date", "Recipient's address", "Salutation"],
                answer: "A",
                explanation: "The sender's address is placed at the top right corner of a formal letter."
            },
            {
                type: "structure",
                question: "Where is the date placed in a formal letter?",
                options: ["Below sender's address", "At the end", "In the body", "Not included"],
                answer: "A",
                explanation: "The date is placed below the sender's address in a formal letter."
            },
            // Tone and Language (51-60)
            {
                type: "tone",
                question: "What tone should a formal letter have?",
                options: ["Respectful and professional", "Casual and friendly", "Humorous and joking", "Angry and demanding"],
                answer: "A",
                explanation: "Formal letters should maintain a respectful, professional, and polite tone throughout."
            },
            {
                type: "tone",
                question: "What type of language is appropriate in informal letters?",
                options: ["Casual and conversational", "Complex technical terms", "Legal jargon", "Highly formal vocabulary"],
                answer: "A",
                explanation: "Informal letters use casual, conversational language similar to how you speak to friends."
            },
            // Letter Components (61-70)
            {
                type: "components",
                question: "What is the 'body' of a letter?",
                options: ["The main content/message of the letter", "The address part", "The salutation", "The envelope"],
                answer: "A",
                explanation: "The body contains the main message or content of the letter."
            },
            {
                type: "components",
                question: "What is a 'salutation'?",
                options: ["The greeting at the beginning of a letter", "The closing", "The address", "The subject line"],
                answer: "A",
                explanation: "The salutation is the greeting that opens the letter, like 'Dear...'"
            },
            // Common Letter Types (71-80)
            {
                type: "types",
                question: "What type of letter would you write to apply for a job?",
                options: ["Formal letter", "Informal letter", "Text message", "Social media post"],
                answer: "A",
                explanation: "Job applications require formal letters to make a professional impression."
            },
            {
                type: "types",
                question: "What type of letter would you write to invite a friend to a party?",
                options: ["Informal letter", "Formal letter", "Business letter", "Official complaint"],
                answer: "A",
                explanation: "Personal invitations to friends are typically informal letters."
            },
            // Application Questions (81-90)
            {
                type: "application",
                question: "You need to write to the principal about a school issue. What type of letter?",
                options: ["Formal letter", "Informal letter", "Text message", "Email to a friend"],
                answer: "A",
                explanation: "Writing to school officials requires formal letters to show respect and seriousness."
            },
            {
                type: "application",
                question: "You're writing to your cousin about your summer vacation. What type of letter?",
                options: ["Informal letter", "Formal letter", "Business letter", "Application letter"],
                answer: "A",
                explanation: "Personal communication with family members uses informal letters."
            },
            // Formatting (91-100)
            {
                type: "formatting",
                question: "In a formal letter, how should paragraphs be organized?",
                options: ["Clear, separate paragraphs with one main idea each", "No paragraphs needed", "One long paragraph", "Bullet points only"],
                answer: "A",
                explanation: "Formal letters should have clear paragraphs, each focusing on one main idea or topic."
            },
            {
                type: "formatting",
                question: "What is correct about informal letter formatting?",
                options: ["More flexible formatting than formal letters", "Must follow strict rules", "Requires official letterhead", "Needs references"],
                answer: "A",
                explanation: "Informal letters have flexible formatting and don't need to follow strict rules."
            },
            // Language Features (101-110)
            {
                type: "language",
                question: "Which sentence is from a formal letter?",
                options: ["I am writing to inquire about the position advertised.", "Hey, what's up with that job?", "Got any jobs going?", "Job please?"],
                answer: "A",
                explanation: "Formal letters use complete sentences and professional language like 'I am writing to inquire...'"
            },
            {
                type: "language",
                question: "Which is appropriate in an informal letter?",
                options: ["Can't wait to see you!", "I cannot wait to see you.", "I am eagerly anticipating our meeting.", "Our forthcoming interaction is anticipated."],
                answer: "A",
                explanation: "Informal letters use contractions and casual expressions like 'Can't wait to see you!'"
            },
            // Common Mistakes (111-120)
            {
                type: "mistakes",
                question: "What is a common mistake in formal letters?",
                options: ["Using slang or informal language", "Being polite", "Using proper grammar", "Organizing ideas clearly"],
                answer: "A",
                explanation: "Using slang, contractions, or informal language is inappropriate in formal letters."
            },
            {
                type: "mistakes",
                question: "What should you avoid in informal letters?",
                options: ["Being too formal or stiff", "Sharing personal news", "Using friendly tone", "Telling stories"],
                answer: "A",
                explanation: "Informal letters should sound natural and conversational, not formal or stiff."
            },
            // Advanced Concepts (121-130)
            {
                type: "advanced",
                question: "What does 'Yours faithfully' mean?",
                options: ["A formal closing when you don't know the recipient's name", "A friendly goodbye", "An informal closing", "A way to start a letter"],
                answer: "A",
                explanation: "'Yours faithfully' is used in formal letters when you don't know the recipient's name (started with 'Dear Sir/Madam')."
            },
            {
                type: "advanced",
                question: "When should you use 'Yours sincerely'?",
                options: ["In formal letters when you know the recipient's name", "In all informal letters", "Only in emails", "Never in letters"],
                answer: "A",
                explanation: "'Yours sincerely' is used in formal letters when you know the recipient's name (started with 'Dear Mr. Smith')."
            }
        ];

        // Letter writing skills
        const letterSkills = [
            {
                name: "Formal Letter Writing",
                description: "Writing professional letters for official purposes",
                examples: "Job applications, complaints, inquiries, official requests",
                characteristics: "Professional tone, specific structure, formal language",
                icon: "üè¢",
                color: "#00BFA5"
            },
            {
                name: "Informal Letter Writing",
                description: "Writing personal letters to friends and family",
                examples: "Catching up, invitations, thank you notes, personal news",
                characteristics: "Casual tone, flexible structure, personal language",
                icon: "üè†",
                color: "#FFAB00"
            },
            {
                name: "Letter Structure",
                description: "Organizing letters with proper components",
                examples: "Addresses, date, salutation, body, closing, signature",
                characteristics: "Logical order, clear sections, proper placement",
                icon: "üìù",
                color: "#AA00FF"
            },
            {
                name: "Tone Adjustment",
                description: "Using appropriate tone for different letters",
                examples: "Formal vs informal, respectful vs casual, serious vs light",
                characteristics: "Matches purpose and audience, consistent throughout",
                icon: "üé≠",
                color: "#FF4081"
            },
            {
                name: "Language Style",
                description: "Choosing appropriate vocabulary and expressions",
                examples: "Formal vocabulary vs colloquial language, complete sentences vs contractions",
                characteristics: "Appropriate for context, clear communication",
                icon: "üí¨",
                color: "#00C853"
            },
            {
                name: "Formatting Skills",
                description: "Proper layout and presentation of letters",
                examples: "Margins, spacing, alignment, paragraphing",
                characteristics: "Neat appearance, easy to read, professional look",
                icon: "üìÑ",
                color: "#FF6D00"
            },
            {
                name: "Purpose Clarity",
                description: "Clearly stating the reason for writing",
                examples: "Stating purpose early, being direct, providing context",
                characteristics: "Clear objective, focused content, relevant details",
                icon: "üéØ",
                color: "#00B8D4"
            },
            {
                name: "Audience Awareness",
                description: "Writing appropriately for the recipient",
                examples: "Considering relationship, knowledge level, expectations",
                characteristics: "Recipient-focused, appropriate level, respectful",
                icon: "üë•",
                color: "#2962FF"
            }
        ];

        // Example letters
        const exampleLetters = [
            {
                type: "formal",
                title: "Formal Letter of Complaint",
                content: `123 Main Street
Cityville, ST 12345
October 26, 2023

The Manager
QuickFix Electronics
456 Market Street
Cityville, ST 12345

Dear Mr. Johnson,

I am writing to express my dissatisfaction with a laptop I purchased from your store on October 15, 2023. The product model is QuickTech Pro X15, and the receipt number is QT789012.

Despite being advertised as having a 10-hour battery life, the laptop barely lasts for two hours on a full charge. Additionally, the keyboard has several keys that stick when pressed, making typing difficult.

I have attempted to resolve this issue by visiting your store on October 20, 2023, but was informed that I needed to contact the manufacturer directly. However, according to your store's return policy displayed at the checkout counter, electronic items can be returned within 30 days of purchase.

I would appreciate it if you could either replace the laptop with a functioning model or provide a full refund. I have attached a copy of the receipt and the warranty card for your reference.

Thank you for your attention to this matter. I look forward to your prompt response.

Yours sincerely,

[Signature]

Alex Thompson`,
                analysis: "This formal complaint letter includes all necessary components: addresses, date, formal salutation, clear explanation of the problem, specific details, polite but firm request, formal closing, and signature."
            },
            {
                type: "informal",
                title: "Informal Letter to a Friend",
                content: `Dear Sarah,

How are you? I hope this letter finds you well and happy. It feels like ages since we last met at the summer camp, and I've been meaning to write to you for weeks!

Life here has been quite busy but exciting. I started eighth grade last month, and my new school is really nice. My favorite subject is Science ‚Äì we're learning about ecosystems, and it's fascinating! I've also joined the school basketball team, which means practice three times a week. It's tiring but so much fun.

Remember how we talked about wanting to learn guitar? Well, I finally started lessons last week! It's harder than I expected, but I can already play three chords. My fingers are sore, but it's worth it.

How are things with you? How's your new art class going? You were so excited about it in your last letter. Have you finished any new paintings? I'd love to see photos if you have any.

Mom says we might be visiting your city during the winter break. If we do, we should definitely meet up! It would be amazing to see you again.

Write back when you have time. I'd love to hear all your news.

Take care and keep smiling!

Love,

[Your Name]

P.S. I'm including a photo from our basketball team's first practice. Look at that determined face!`,
                analysis: "This informal letter has a friendly tone, personal news, questions to engage the recipient, natural language, and a warm closing ‚Äì perfect for correspondence between friends."
            }
        ];

        // Formal vs Informal comparisons
        const comparisons = [
            {
                aspect: "Language",
                formal: "Professional, precise, no contractions",
                informal: "Casual, conversational, uses contractions",
                example: {
                    formal: "I am writing to inquire about...",
                    informal: "I'm writing to ask about..."
                }
            },
            {
                aspect: "Salutation",
                formal: "Dear Mr./Ms./Dr. [Last Name],",
                informal: "Dear [First Name], or Hi [First Name],",
                example: {
                    formal: "Dear Professor Johnson,",
                    informal: "Hi Alex,"
                }
            },
            {
                aspect: "Closing",
                formal: "Yours sincerely/faithfully, Respectfully,",
                informal: "Love, Best wishes, Take care,",
                example: {
                    formal: "Yours sincerely,",
                    informal: "Best wishes,"
                }
            },
            {
                aspect: "Structure",
                formal: "Strict format with addresses, date, subject",
                informal: "Flexible, can start directly with greeting",
                example: {
                    formal: "Formal structure required",
                    informal: "Flexible structure"
                }
            }
        ];

        // Common mistakes
        const commonMistakes = [
            {
                mistake: "Mixing Formal and Informal Styles",
                description: "Using informal language in formal letters or vice versa",
                example: "Using 'Hey there!' in a job application letter",
                correction: "Match style to letter type: formal for professional, informal for personal"
            },
            {
                mistake: "Incomplete Information",
                description: "Missing important details like date or return address",
                example: "Forgetting to include the date in a formal letter",
                correction: "Use a checklist to ensure all components are included"
            },
            {
                mistake: "Unclear Purpose",
                description: "Not stating the reason for writing clearly",
                example: "Rambling without getting to the point",
                correction: "State purpose in first paragraph, be direct and clear"
            },
            {
                mistake: "Inappropriate Tone",
                description: "Using wrong tone for the situation",
                example: "Being too casual in a complaint letter",
                correction: "Consider audience and purpose when choosing tone"
            }
        ];

        // Letter writing steps
        const letterSteps = [
            {
                step: 1,
                title: "Identify Purpose & Audience",
                description: "Determine why you're writing and who will read it",
                tips: "Ask: Is this formal or informal? Who am I writing to?"
            },
            {
                step: 2,
                title: "Choose Appropriate Format",
                description: "Select formal or informal structure based on purpose",
                tips: "Formal for officials/business, informal for friends/family"
            },
            {
                step: 3,
                title: "Plan Your Content",
                description: "Outline main points you want to include",
                tips: "Jot down key ideas before writing the full letter"
            },
            {
                step: 4,
                title: "Write the Opening",
                description: "Start with appropriate salutation and introduction",
                tips: "Formal: State purpose early. Informal: Start with greeting and pleasantries"
            },
            {
                step: 5,
                title: "Develop the Body",
                description: "Present main content in clear paragraphs",
                tips: "One main idea per paragraph, use examples if needed"
            },
            {
                step: 6,
                title: "Write the Closing",
                description: "End with appropriate closing and signature",
                tips: "Formal closings match salutation, include full name"
            },
            {
                step: 7,
                title: "Review and Revise",
                description: "Check for errors and clarity",
                tips: "Read aloud, check spelling/grammar, ensure tone is appropriate"
            }
        ];

        // Writing facts
        const writingFacts = [
            "The oldest known personal letter dates back to 500 BC in Ancient Persia!",
            "Before email, people waited weeks for letters to travel between countries!",
            "Formal business letters are still essential for official communications!",
            "The 'PS' in letters stands for 'postscript' - added after the main message!",
            "Queen Elizabeth II sent her first email in 1976 from a military base!",
            "The art of letter writing is called 'epistolary'!",
            "Abraham Lincoln's Gettysburg Address was originally a letter!",
            "Handwritten letters are considered more personal than digital messages!"
        ];

        // Letter study concepts
        const letterStudyConcepts = [
            {
                concept: "Audience Analysis",
                description: "Understanding who will read your letter",
                examples: "Considering age, relationship, position, expectations"
            },
            {
                concept: "Purpose Clarity",
                description: "Making the reason for writing clear",
                examples: "Stating objective early, staying focused, being specific"
            },
            {
                concept: "Tone Management",
                description: "Controlling the emotional quality of writing",
                examples: "Formal vs informal, serious vs light, respectful vs casual"
            },
            {
                concept: "Revision Strategies",
                description: "Improving letters through careful review",
                examples: "Reading aloud, peer feedback, checking against criteria"
            }
        ];

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // Positive feedback messages
        const positiveMessages = [
            "Excellent letter writing skills!",
            "Perfect understanding of formal/informal differences!",
            "Great attention to letter structure!",
            "Amazing! You're a communication champion!",
            "Perfect grasp of appropriate tone!",
            "You're a future diplomat or writer in the making!",
            "Outstanding audience awareness!",
            "Brilliant letter composition skills!",
            "You think like a professional communicator!",
            "Letter writing mastery achieved!"
        ];

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const writingFact = document.getElementById('writingFact');
        const conceptDisplay = document.getElementById('conceptDisplay');
        const visualizationContainer = document.getElementById('visualizationContainer');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const backToTopicsBtn = document.getElementById('backToTopics');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const scoreMessage = document.getElementById('scoreMessage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const highestScore = document.getElementById('highestScore');

        // Initialize the app
        function initApp() {
            initBackground();
            loadStateFromStorage();
            setupEventListeners();
            
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Load state from localStorage
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixGrade7Letters');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // Save state to localStorage
        function saveStateToStorage() {
            localStorage.setItem('ideolixGrade7Letters', JSON.stringify(appState));
        }

        // Initialize and shuffle questions
        function initializeQuestions() {
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', backToHome);
            backToTopicsBtn.addEventListener('click', backToTopics);
            viewTopicsBtn.addEventListener('click', backToTopics);
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startPractice();
                }
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            
            const highest = localStorage.getItem('ideolixGrade7Letters_highestScore') || 0;
            highestScore.textContent = Math.max(highest, appState.score);
            
            if (percentage >= 90) {
                scoreMessage.textContent = "Outstanding! You're a letter writing expert!";
            } else if (percentage >= 80) {
                scoreMessage.textContent = "Great job! You have excellent communication skills!";
            } else if (percentage >= 70) {
                scoreMessage.textContent = "Good work! Keep practicing your letter writing!";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "Not bad! Review letter types and try again!";
            } else {
                scoreMessage.textContent = "Keep learning! Letter writing builds essential communication skills for life!";
            }
        }

        // Create writing fact display
        function createWritingFact() {
            const factDiv = document.createElement('div');
            factDiv.className = 'writing-fact';
            
            factDiv.innerHTML = `<strong>Interesting Writing Fact:</strong> ${writingFacts[Math.floor(Math.random() * writingFacts.length)]}`;
            
            return factDiv;
        }

        // Create concept display
        function createConceptDisplay() {
            const display = document.createElement('div');
            display.className = 'concept-display';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            const conceptIcons = {
                "basics": "üìù",
                "formal": "üè¢",
                "informal": "üè†",
                "differences": "‚ÜîÔ∏è",
                "structure": "üèóÔ∏è",
                "tone": "üé≠",
                "components": "üß©",
                "types": "üì®",
                "application": "üí°",
                "formatting": "üìÑ",
                "language": "üí¨",
                "mistakes": "‚ö†Ô∏è",
                "advanced": "üöÄ"
            };
            
            let conceptName = "Basics";
            let conceptIcon = "üìù";
            
            if (question.type.includes("basics")) {
                conceptName = "Letter Writing Basics";
                conceptIcon = conceptIcons.basics;
            } else if (question.type.includes("formal")) {
                conceptName = "Formal Letters";
                conceptIcon = conceptIcons.formal;
            } else if (question.type.includes("informal")) {
                conceptName = "Informal Letters";
                conceptIcon = conceptIcons.informal;
            } else if (question.type.includes("differences")) {
                conceptName = "Formal vs Informal";
                conceptIcon = conceptIcons.differences;
            } else if (question.type.includes("structure")) {
                conceptName = "Letter Structure";
                conceptIcon = conceptIcons.structure;
            } else if (question.type.includes("tone")) {
                conceptName = "Tone";
                conceptIcon = conceptIcons.tone;
            } else if (question.type.includes("components")) {
                conceptName = "Letter Components";
                conceptIcon = conceptIcons.components;
            } else if (question.type.includes("types")) {
                conceptName = "Letter Types";
                conceptIcon = conceptIcons.types;
            } else if (question.type.includes("application")) {
                conceptName = "Application";
                conceptIcon = conceptIcons.application;
            } else if (question.type.includes("formatting")) {
                conceptName = "Formatting";
                conceptIcon = conceptIcons.formatting;
            } else if (question.type.includes("language")) {
                conceptName = "Language";
                conceptIcon = conceptIcons.language;
            } else if (question.type.includes("mistakes")) {
                conceptName = "Common Mistakes";
                conceptIcon = conceptIcons.mistakes;
            } else if (question.type.includes("advanced")) {
                conceptName = "Advanced Concepts";
                conceptIcon = conceptIcons.advanced;
            }
            
            const conceptBox = document.createElement('div');
            conceptBox.className = 'concept-box grow';
            conceptBox.innerHTML = `
                <div class="concept-icon">${conceptIcon}</div>
                <div class="concept-text">${conceptName.toUpperCase()}</div>
            `;
            
            const label = document.createElement('div');
            label.className = 'concept-label';
            
            if (question.type.includes("basics")) {
                label.textContent = "Understanding letter writing fundamentals";
            } else if (question.type.includes("formal")) {
                label.textContent = "Professional letters for official communication";
            } else if (question.type.includes("informal")) {
                label.textContent = "Personal letters for friends and family";
            } else if (question.type.includes("differences")) {
                label.textContent = "Comparing formal and informal letter characteristics";
            } else if (question.type.includes("structure")) {
                label.textContent = "Organizing letters with proper components";
            } else if (question.type.includes("tone")) {
                label.textContent = "Using appropriate emotional quality in writing";
            } else if (question.type.includes("components")) {
                label.textContent = "Understanding parts of a letter";
            } else if (question.type.includes("types")) {
                label.textContent = "Different purposes for letter writing";
            } else if (question.type.includes("application")) {
                label.textContent = "Applying letter writing skills to situations";
            } else if (question.type.includes("formatting")) {
                label.textContent = "Proper layout and presentation";
            } else if (question.type.includes("language")) {
                label.textContent = "Choosing appropriate vocabulary and style";
            } else if (question.type.includes("mistakes")) {
                label.textContent = "Common errors to avoid in letter writing";
            } else if (question.type.includes("advanced")) {
                label.textContent = "Advanced letter writing concepts";
            }
            
            display.appendChild(conceptBox);
            display.appendChild(label);
            
            return display;
        }

        // Create letter writing visualization
        function createLetterVisualization() {
            const vizDiv = document.createElement('div');
            vizDiv.className = 'visualization-container';
            
            const currentQuestion = appState.currentQuestions[appState.currentQuestionIndex];
            
            vizDiv.innerHTML = `
                <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary-blue);">Letter Writing Explorer</h3>
                
                <div class="letter-display">
                    <div class="display-title">Current Letter Writing Concept</div>
                    <div class="letter-container">
                        <div class="letter-scenario">${currentQuestion.question}</div>
                        <div class="letter-highlight">
                            <strong>Key Concept:</strong> <span class="highlight-text">${getLetterConcept(currentQuestion.type)}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Example Letters -->
                <div style="background: var(--dark-card); padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <div class="display-title">Example Letters</div>
                    ${exampleLetters.map((letter, index) => `
                        <div class="example-letter" style="border-color: ${letter.type === 'formal' ? 'var(--secondary-teal)' : 'var(--accent-amber)'};">
                            <div class="letter-title" style="color: ${letter.type === 'formal' ? 'var(--secondary-teal)' : 'var(--accent-amber)'};">${letter.title}</div>
                            <div class="letter-content">${letter.content}</div>
                            <div style="margin-top: 15px; padding: 10px; background: var(--dark-surface); border-radius: 6px; font-size: 0.9rem; color: var(--text-secondary);">
                                <strong>Analysis:</strong> ${letter.analysis}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <!-- Skills Grid -->
                <div class="skills-grid">
                    ${letterSkills.map(skill => `
                        <div class="skill-card ${skill.name.toLowerCase().replace(/ /g, '-')}" style="border-color: ${skill.color}" onclick="showSkillDemo('${skill.name}')">
                            <div class="skill-icon writing-glow" style="color: ${skill.color}">${skill.icon}</div>
                            <div class="skill-title" style="color: ${skill.color}">${skill.name}</div>
                            <div class="skill-description">${skill.description}</div>
                            <div class="skill-examples">
                                <strong>Examples:</strong> ${skill.examples}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <!-- Formal vs Informal Comparison -->
                <div class="comparison-container">
                    <div class="comparison-title">Formal vs Informal Letters Comparison</div>
                    <div class="comparison-grid">
                        ${comparisons.map((item, index) => `
                            <div class="comparison-card">
                                <div class="comparison-type">${item.aspect}</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                    <div style="padding: 10px; background: rgba(0, 191, 165, 0.1); border-radius: 6px; border: 1px solid var(--secondary-teal);">
                                        <div style="font-weight: bold; color: var(--secondary-teal); margin-bottom: 5px;">Formal</div>
                                        <div style="font-size: 0.9rem; color: var(--text-secondary);">${item.formal}</div>
                                        <div style="margin-top: 5px; font-style: italic; font-size: 0.8rem; color: var(--accent-green);">"${item.example.formal}"</div>
                                    </div>
                                    <div style="padding: 10px; background: rgba(255, 171, 0, 0.1); border-radius: 6px; border: 1px solid var(--accent-amber);">
                                        <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 5px;">Informal</div>
                                        <div style="font-size: 0.9rem; color: var(--text-secondary);">${item.informal}</div>
                                        <div style="margin-top: 5px; font-style: italic; font-size: 0.8rem; color: var(--accent-orange);">"${item.example.informal}"</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Formal Letter Structure -->
                <div class="formal-structure">
                    <div class="structure-title">Formal Letter Structure</div>
                    <div class="structure-diagram">
                        ${[
                            {number: 1, part: "Sender's Address", description: "Your address at the top right"},
                            {number: 2, part: "Date", description: "Below sender's address"},
                            {number: 3, part: "Recipient's Address", description: "Left side, below date"},
                            {number: 4, part: "Salutation", description: "Dear Mr./Ms./Dr. [Last Name],"},
                            {number: 5, part: "Subject Line (Optional)", description: "Brief statement of purpose"},
                            {number: 6, part: "Body", description: "Main content in paragraphs"},
                            {number: 7, part: "Closing", description: "Yours sincerely/faithfully,"},
                            {number: 8, part: "Signature", description: "Your signature above typed name"}
                        ].map(item => `
                            <div class="structure-part">
                                <div class="part-number">${item.number}</div>
                                <div>
                                    <div style="font-weight: bold; color: var(--secondary-teal);">${item.part}</div>
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">${item.description}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Step-by-Step Process -->
                <div class="process-steps">
                    <div class="process-title">7-Step Letter Writing Process</div>
                    ${letterSteps.map((step, index) => `
                        <div class="process-step" style="animation-delay: ${index * 0.1}s">
                            <div class="step-icon">${step.step}</div>
                            <div class="step-content">
                                <div class="step-heading">${step.title}</div>
                                <div style="color: var(--text-secondary); margin-bottom: 5px;">${step.description}</div>
                                <div style="font-size: 0.9rem; color: var(--accent-amber);">
                                    <strong>Tip:</strong> ${step.tips}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <!-- Common Mistakes -->
                <div class="mistakes-container">
                    <div class="mistakes-title">Common Mistakes to Avoid</div>
                    ${commonMistakes.map((mistake, index) => `
                        <div class="mistake-item" style="animation-delay: ${index * 0.1}s">
                            <div class="mistake-icon">‚ùå</div>
                            <div style="flex: 1;">
                                <div class="mistake-heading">${mistake.mistake}</div>
                                <div style="color: var(--text-secondary); margin-bottom: 5px;">${mistake.description}</div>
                                <div style="background: var(--dark-card); padding: 8px; border-radius: 4px; margin: 5px 0; font-size: 0.9rem;">
                                    <strong>Example:</strong> ${mistake.example}
                                </div>
                                <div style="font-size: 0.9rem; color: var(--accent-green);">
                                    <strong>Correction:</strong> ${mistake.correction}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <!-- Interactive Letter Builder -->
                <div class="builder-container">
                    <div class="builder-title">Interactive Letter Builder</div>
                    <div class="builder-controls">
                        <select class="builder-select" id="letterType">
                            <option value="formal">Formal Letter</option>
                            <option value="informal">Informal Letter</option>
                        </select>
                        <textarea class="builder-input" id="letterContent" placeholder="Enter your letter content here..."></textarea>
                        <div class="builder-buttons">
                            <button class="builder-btn" onclick="analyzeLetter()">Analyze Letter</button>
                            <button class="builder-btn" onclick="generateLetterTemplate()">Get Template</button>
                            <button class="builder-btn" onclick="checkFormalElements()">Check Formal Elements</button>
                            <button class="builder-btn" onclick="clearLetterBuilder()">Clear</button>
                        </div>
                    </div>
                    <div class="builder-display" id="builderDisplay">
                        Your letter analysis will appear here...
                    </div>
                </div>
                
                <!-- Practice Activities -->
                <div style="background: var(--dark-card); padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <div class="display-title">Practice Activities</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                        <button class="builder-btn" onclick="practiceFormalSalutation()">Practice Formal Salutations</button>
                        <button class="builder-btn" onclick="practiceInformalClosings()">Practice Informal Closings</button>
                        <button class="builder-btn" onclick="practiceToneAdjustment()">Practice Tone Adjustment</button>
                        <button class="builder-btn" onclick="practiceLetterStructure()">Practice Letter Structure</button>
                    </div>
                </div>
                
                <!-- Letter Writing Tips -->
                <div style="background: var(--dark-card); padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid var(--secondary-teal);">
                    <div style="color: var(--secondary-teal); font-weight: bold; margin-bottom: 15px; text-align: center;">Letter Writing Tips</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="padding: 15px; background: var(--dark-surface); border-radius: 8px;">
                            <div style="font-weight: bold; color: var(--secondary-teal); margin-bottom: 10px;">Formal Letter Tips</div>
                            <ul style="color: var(--text-secondary); font-size: 0.9rem; padding-left: 20px;">
                                <li>Use professional language</li>
                                <li>Be clear and concise</li>
                                <li>Proofread carefully</li>
                                <li>Include all necessary details</li>
                                <li>Maintain respectful tone</li>
                            </ul>
                        </div>
                        <div style="padding: 15px; background: var(--dark-surface); border-radius: 8px;">
                            <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 10px;">Informal Letter Tips</div>
                            <ul style="color: var(--text-secondary); font-size: 0.9rem; padding-left: 20px;">
                                <li>Write like you're talking</li>
                                <li>Share personal news</li>
                                <li>Ask questions</li>
                                <li>Use friendly tone</li>
                                <li>Add personal touches</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            return vizDiv;
        }

        // Helper functions
        function getLetterConcept(typeString) {
            const conceptMap = {
                "basics": "Letter Writing Basics - Understanding what letters are and their purposes",
                "formal": "Formal Letters - Professional communication for official purposes",
                "informal": "Informal Letters - Personal communication with friends and family",
                "differences": "Formal vs Informal - Comparing characteristics of different letter types",
                "structure": "Letter Structure - Organizing letters with proper components and format",
                "tone": "Tone - Using appropriate emotional quality in writing",
                "components": "Letter Components - Understanding different parts of a letter",
                "types": "Letter Types - Different purposes and situations for letter writing",
                "application": "Application - Applying letter writing skills to real situations",
                "formatting": "Formatting - Proper layout, spacing, and presentation of letters",
                "language": "Language - Choosing appropriate vocabulary and style for different letters",
                "mistakes": "Common Mistakes - Errors to avoid in letter writing",
                "advanced": "Advanced Concepts - Complex aspects of letter writing"
            };
            
            return conceptMap[typeString] || "Letter Writing";
        }

        // Interactive practice functions
        window.practiceFormalSalutation = function() {
            const builderDisplay = document.getElementById('builderDisplay');
            if (!builderDisplay) return;
            
            builderDisplay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3rem; color: var(--primary-blue); margin-bottom: 15px;">Practice: Formal Letter Salutations</div>
                    
                    <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid var(--secondary-teal);">
                        <div style="font-weight: bold; margin-bottom: 10px; color: var(--secondary-teal);">Guidelines for Formal Salutations:</div>
                        <div style="color: var(--text-secondary); line-height: 1.6; text-align: left;">
                            <ul style="padding-left: 20px;">
                                <li>Use "Dear" followed by title and last name</li>
                                <li>If you know the name: "Dear Mr. Smith," or "Dear Dr. Johnson,"</li>
                                <li>If you don't know the name: "Dear Sir/Madam," or "To Whom It May Concern,"</li>
                                <li>Always use a comma after the salutation</li>
                                <li>Never use first names unless you have a personal relationship</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="text-align: left; margin-top: 20px;">
                        <div style="color: var(--secondary-teal); font-weight: bold; margin-bottom: 10px;">Practice Examples:</div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 5px;">Situation 1: Writing to a company manager named John Smith</div>
                            <div style="color: var(--text-primary);">Correct: Dear Mr. Smith,</div>
                            <div style="color: var(--accent-pink); font-size: 0.9rem; margin-top: 5px;">Incorrect: Hi John, or Hey Mr. Smith,</div>
                        </div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 5px;">Situation 2: Writing to a female doctor named Sarah Johnson</div>
                            <div style="color: var(--text-primary);">Correct: Dear Dr. Johnson,</div>
                            <div style="color: var(--accent-pink); font-size: 0.9rem; margin-top: 5px;">Incorrect: Dear Sarah, or Hello Dr. Johnson</div>
                        </div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 5px;">Situation 3: Writing to a company when you don't know who will read it</div>
                            <div style="color: var(--text-primary);">Correct: Dear Sir/Madam, or To Whom It May Concern,</div>
                            <div style="color: var(--accent-pink); font-size: 0.9rem; margin-top: 5px;">Incorrect: Dear Company, or Hello there,</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: var(--dark-surface); border-radius: 6px; color: var(--text-secondary); font-size: 0.9rem;">
                        <strong>Remember:</strong> The salutation sets the tone for your entire letter. A proper formal salutation shows respect and professionalism.
                    </div>
                </div>
            `;
        };

        window.practiceInformalClosings = function() {
            const builderDisplay = document.getElementById('builderDisplay');
            if (!builderDisplay) return;
            
            builderDisplay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3rem; color: var(--primary-blue); margin-bottom: 15px;">Practice: Informal Letter Closings</div>
                    
                    <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid var(--accent-amber);">
                        <div style="font-weight: bold; margin-bottom: 10px; color: var(--accent-amber);">Common Informal Closings:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 15px;">
                            ${["Love,", "Best wishes,", "Take care,", "Your friend,", "Warmly,", "Cheers,", "Talk soon,", "Miss you,"].map(closing => `
                                <div style="padding: 10px 15px; background: var(--dark-surface); border-radius: 20px; border: 2px solid var(--accent-amber); color: var(--accent-amber); font-weight: bold;">
                                    ${closing}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="text-align: left; margin-top: 20px;">
                        <div style="color: var(--accent-amber); font-weight: bold; margin-bottom: 10px;">Choosing the Right Closing:</div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 5px;">For close friends or family:</div>
                            <div style="color: var(--text-primary);">Love, Your friend, Miss you,</div>
                        </div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 5px;">For acquaintances or less close friends:</div>
                            <div style="color: var(--text-primary);">Best wishes, Take care, Warmly,</div>
                        </div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 5px;">For casual correspondence:</div>
                            <div style="color: var(--text-primary);">Cheers, Talk soon, See you soon,</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: var(--dark-surface); border-radius: 6px; color: var(--text-secondary); font-size: 0.9rem;">
                        <strong>Tip:</strong> Your closing should match the tone and relationship established in the letter. More personal relationships allow for more affectionate closings.
                    </div>
                </div>
            `;
        };

        window.practiceToneAdjustment = function() {
            const builderDisplay = document.getElementById('builderDisplay');
            if (!builderDisplay) return;
            
            builderDisplay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3rem; color: var(--primary-blue); margin-bottom: 15px;">Practice: Adjusting Tone for Different Letters</div>
                    
                    <div class="before-after">
                        <div class="before-example">
                            <div class="example-title">Formal Version</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5;">
                                "I am writing to inquire about the availability of summer internship positions at your organization. I have reviewed your company's website and am particularly interested in the marketing department opportunities."
                            </div>
                        </div>
                        <div class="after-example">
                            <div class="example-title">Informal Version</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5;">
                                "I'm writing to ask if there are any summer internships available at your company. I checked out your website and think the marketing stuff looks really cool!"
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: left; margin-top: 20px;">
                        <div style="color: var(--accent-purple); font-weight: bold; margin-bottom: 10px;">Tone Adjustment Techniques:</div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-purple); margin-bottom: 5px;">Formal to Informal:</div>
                            <div style="color: var(--text-secondary);">
                                ‚Ä¢ Use contractions (I am ‚Üí I'm)<br>
                                ‚Ä¢ Use simpler vocabulary (inquire ‚Üí ask)<br>
                                ‚Ä¢ Add personal expressions (looks really cool)<br>
                                ‚Ä¢ Remove overly formal phrases
                            </div>
                        </div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-purple); margin-bottom: 5px;">Informal to Formal:</div>
                            <div style="color: var(--text-secondary);">
                                ‚Ä¢ Remove contractions (I'm ‚Üí I am)<br>
                                ‚Ä¢ Use more precise vocabulary (stuff ‚Üí opportunities)<br>
                                ‚Ä¢ Remove slang and casual expressions<br>
                                ‚Ä¢ Add formal opening/closing phrases
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: var(--dark-surface); border-radius: 6px; color: var(--text-secondary); font-size: 0.9rem;">
                        <strong>Practice:</strong> Take a sentence and rewrite it in both formal and informal versions to practice tone adjustment.
                    </div>
                </div>
            `;
        };

        window.practiceLetterStructure = function() {
            const builderDisplay = document.getElementById('builderDisplay');
            if (!builderDisplay) return;
            
            builderDisplay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3rem; color: var(--primary-blue); margin-bottom: 15px;">Practice: Letter Structure</div>
                    
                    <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid var(--secondary-teal);">
                        <div style="font-weight: bold; margin-bottom: 10px; color: var(--secondary-teal);">Formal Letter Structure:</div>
                        <div style="color: var(--text-secondary); line-height: 1.6; text-align: left; font-family: monospace; font-size: 0.9rem;">
                            1. Sender's Address (top right)<br>
                            2. Date (below address)<br>
                            3. Recipient's Address (left side)<br>
                            4. Salutation (Dear...)<br>
                            5. Subject Line (optional)<br>
                            6. Body (paragraphs)<br>
                            7. Closing (Yours...)<br>
                            8. Signature & Name
                        </div>
                    </div>
                    
                    <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid var(--accent-amber);">
                        <div style="font-weight: bold; margin-bottom: 10px; color: var(--accent-amber);">Informal Letter Structure:</div>
                        <div style="color: var(--text-secondary); line-height: 1.6; text-align: left; font-family: monospace; font-size: 0.9rem;">
                            1. Date (optional, top right)<br>
                            2. Salutation (Dear/Hi...)<br>
                            3. Body (casual paragraphs)<br>
                            4. Closing (Love/Best...)<br>
                            5. Signature (name)
                        </div>
                    </div>
                    
                    <div style="text-align: left; margin-top: 20px;">
                        <div style="color: var(--accent-green); font-weight: bold; margin-bottom: 10px;">Structure Practice:</div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-green); margin-bottom: 5px;">Activity 1: Label the parts</div>
                            <div style="color: var(--text-secondary);">
                                Given a letter, identify each structural component
                            </div>
                        </div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-green); margin-bottom: 5px;">Activity 2: Arrange in order</div>
                            <div style="color: var(--text-secondary);">
                                Place letter components in correct order
                            </div>
                        </div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-green); margin-bottom: 5px;">Activity 3: Identify errors</div>
                            <div style="color: var(--text-secondary);">
                                Find structural errors in sample letters
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // Letter builder functions
        window.analyzeLetter = function() {
            const letterContent = document.getElementById('letterContent');
            const builderDisplay = document.getElementById('builderDisplay');
            
            if (!letterContent || !builderDisplay) return;
            
            const content = letterContent.value.trim();
            
            if (!content) {
                builderDisplay.innerHTML = "Please enter letter content to analyze.";
                return;
            }
            
            // Simple analysis
            const hasDear = content.includes("Dear");
            const hasLove = content.includes("Love") || content.includes("Best") || content.includes("Take care");
            const hasSincerely = content.includes("Yours") || content.includes("Sincerely");
            const hasContractions = (content.match(/\b(I'm|you're|he's|she's|it's|we're|they're|don't|can't|won't|isn't|aren't|wasn't|weren't)\b/g) || []).length;
            
            let letterType = "Mixed/Unclear";
            let analysis = "";
            
            if (hasSincerely && !hasContractions) {
                letterType = "Formal Letter";
                analysis = "This appears to be a formal letter (uses formal closing, no contractions).";
            } else if (hasLove && hasContractions) {
                letterType = "Informal Letter";
                analysis = "This appears to be an informal letter (uses casual closing, has contractions).";
            } else if (hasDear) {
                letterType = "Possibly Formal";
                analysis = "Uses 'Dear' salutation but other features are mixed.";
            } else {
                letterType = "Informal or Missing Elements";
                analysis = "Missing clear formal or informal markers.";
            }
            
            builderDisplay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3rem; color: var(--primary-blue); margin-bottom: 15px;">Letter Analysis</div>
                    
                    <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid var(--accent-purple);">
                        <div style="font-weight: bold; margin-bottom: 10px; color: var(--accent-purple);">Analysis Results:</div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                            <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: ${letterType.includes('Formal') ? 'var(--secondary-teal)' : 'var(--accent-amber)'};">${letterType}</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">Letter Type</div>
                            </div>
                            
                            <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--secondary-teal);">${hasContractions}</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">Contractions Found</div>
                            </div>
                        </div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 5px;">Analysis:</div>
                            <div style="color: var(--text-primary);">${analysis}</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: var(--dark-surface); border-radius: 6px; color: var(--text-secondary); font-size: 0.9rem;">
                        <strong>Tip:</strong> For clearer letter type identification, ensure you use appropriate salutations, closings, and language style consistently.
                    </div>
                </div>
            `;
        };

        window.generateLetterTemplate = function() {
            const letterType = document.getElementById('letterType').value;
            const builderDisplay = document.getElementById('builderDisplay');
            
            if (!builderDisplay) return;
            
            let template = "";
            
            if (letterType === "formal") {
                template = `[Your Address]
[City, State ZIP Code]
[Date]

[Recipient's Name]
[Recipient's Title]
[Company/Organization Name]
[Company Address]
[City, State ZIP Code]

Dear [Mr./Ms./Dr. Last Name],

[Subject: Brief statement of purpose]

I am writing to [state the purpose of your letter clearly and concisely]. 

[Provide details, explanations, or background information in separate paragraphs. Each paragraph should focus on one main idea.]

[Include any necessary supporting information or requests.]

Thank you for your attention to this matter. I look forward to your response.

Yours sincerely,

[Your Signature]

[Your Typed Name]`;
            } else {
                template = `[Date - optional]

Dear [First Name],

[Start with a friendly greeting or personal news. For example: How are you? I hope this letter finds you well.]

[Share your news, stories, or information in a casual, conversational way. Write as if you're talking to the person.]

[Ask questions about the recipient's life to continue the conversation.]

[End with closing thoughts or plans for the future.]

[Choose an appropriate closing]

[Your Name or Nickname]`;
            }
            
            const letterContent = document.getElementById('letterContent');
            if (letterContent) {
                letterContent.value = template;
                letterContent.focus();
            }
            
            builderDisplay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3rem; color: var(--primary-blue); margin-bottom: 15px;">${letterType === "formal" ? "Formal" : "Informal"} Letter Template Generated</div>
                    
                    <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid ${letterType === "formal" ? "var(--secondary-teal)" : "var(--accent-amber)"};">
                        <div style="font-weight: bold; margin-bottom: 10px; color: ${letterType === "formal" ? "var(--secondary-teal)" : "var(--accent-amber)"};">Template Instructions:</div>
                        <div style="color: var(--text-secondary); line-height: 1.6; text-align: left; font-family: monospace; white-space: pre-wrap; font-size: 0.9rem;">
                            ${template}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: var(--dark-surface); border-radius: 6px; color: var(--text-secondary); font-size: 0.9rem;">
                        <strong>Instructions:</strong> Replace the bracketed information [like this] with your specific details. The template has been added to the text area above.
                    </div>
                </div>
            `;
        };

        window.checkFormalElements = function() {
            const letterContent = document.getElementById('letterContent');
            const builderDisplay = document.getElementById('builderDisplay');
            
            if (!letterContent || !builderDisplay) return;
            
            const content = letterContent.value;
            
            // Check for formal elements
            const checks = [
                { name: "Formal Salutation", pattern: /Dear (Mr\.|Ms\.|Mrs\.|Dr\.|Professor)\s+[A-Z]/i, found: false },
                { name: "Complete Sentences", pattern: /[A-Z][^.!?]*[.!?]/g, found: false },
                { name: "No Contractions", pattern: /\b(I'm|you're|he's|she's|it's|we're|they're|don't|can't|won't|isn't|aren't|wasn't|weren't)\b/i, found: true, invert: true },
                { name: "Formal Closing", pattern: /Yours (sincerely|faithfully)|Respectfully|Sincerely/i, found: false },
                { name: "Clear Purpose Statement", pattern: /I am writing to|This letter is to|The purpose of this letter/i, found: false }
            ];
            
            checks.forEach(check => {
                if (check.invert) {
                    check.found = !check.pattern.test(content);
                } else {
                    check.found = check.pattern.test(content);
                }
            });
            
            const formalScore = checks.filter(c => c.found).length;
            const totalChecks = checks.length;
            
            builderDisplay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3rem; color: var(--primary-blue); margin-bottom: 15px;">Formal Letter Elements Check</div>
                    
                    <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid var(--secondary-teal);">
                        <div style="font-weight: bold; margin-bottom: 10px; color: var(--secondary-teal);">Formal Elements Analysis:</div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                            <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--secondary-teal);">${formalScore}/${totalChecks}</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">Formal Elements Present</div>
                            </div>
                            
                            <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: ${formalScore >= 4 ? 'var(--accent-green)' : formalScore >= 2 ? 'var(--accent-amber)' : 'var(--accent-pink)'};">${formalScore >= 4 ? 'Good' : formalScore >= 2 ? 'Fair' : 'Needs Work'}</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">Formality Level</div>
                            </div>
                        </div>
                        
                        <div style="background: var(--dark-surface); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; color: var(--accent-amber); margin-bottom: 5px;">Element Checklist:</div>
                            ${checks.map((check, index) => `
                                <div style="display: flex; align-items: center; gap: 10px; margin: 5px 0; padding: 5px; background: ${check.found ? 'rgba(0, 200, 83, 0.1)' : 'rgba(255, 64, 129, 0.1)'}; border-radius: 4px; border-left: 4px solid ${check.found ? 'var(--accent-green)' : 'var(--accent-pink)'};">
                                    <div style="color: ${check.found ? 'var(--accent-green)' : 'var(--accent-pink)'}">${check.found ? '‚úì' : '‚úó'}</div>
                                    <div style="flex: 1; color: var(--text-primary);">${check.name}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: var(--dark-surface); border-radius: 6px; color: var(--text-secondary); font-size: 0.9rem;">
                        <strong>Tips:</strong> For a strong formal letter, aim for 4-5 checks. Review missing elements and add them to improve your letter's formality.
                    </div>
                </div>
            `;
        };

        window.clearLetterBuilder = function() {
            const letterContent = document.getElementById('letterContent');
            const builderDisplay = document.getElementById('builderDisplay');
            
            if (letterContent) letterContent.value = '';
            if (builderDisplay) {
                builderDisplay.innerHTML = "Your letter analysis will appear here...";
            }
        };

        window.showSkillDemo = function(skillName) {
            const builderDisplay = document.getElementById('builderDisplay');
            
            const skill = letterSkills.find(s => s.name === skillName);
            if (!skill || !builderDisplay) return;
            
            builderDisplay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; color: ${skill.color}; margin-bottom: 15px;">
                        ${skill.icon} ${skill.name} Details
                    </div>
                    
                    <div style="background: rgba(${parseInt(skill.color.slice(1,3), 16)}, ${parseInt(skill.color.slice(3,5), 16)}, ${parseInt(skill.color.slice(5,7), 16)}, 0.1); padding: 20px; border-radius: 8px; margin: 15px 0; border: 2px solid ${skill.color};">
                        <div style="font-weight: bold; margin-bottom: 10px; color: ${skill.color};">Definition:</div>
                        <div style="margin-bottom: 15px;">${skill.description}</div>
                        
                        <div style="font-weight: bold; margin-bottom: 10px; color: ${skill.color};">Key Characteristics:</div>
                        <div style="margin-bottom: 15px;">${skill.characteristics}</div>
                        
                        <div style="font-weight: bold; margin-bottom: 10px; color: ${skill.color};">Examples:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                            ${skill.examples.split(', ').map(example => `
                                <div style="padding: 8px 12px; background: var(--dark-surface); border-radius: 20px; border: 1px solid ${skill.color}; color: ${skill.color};">
                                    ${example}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; color: var(--text-secondary); font-size: 0.9rem;">
                        <strong>Practice Tip:</strong> ${getSkillPracticeTip(skillName)}
                    </div>
                </div>
            `;
        };

        function getSkillPracticeTip(skillName) {
            const tips = {
                "Formal Letter Writing": "Practice by writing mock job applications or complaint letters to companies.",
                "Informal Letter Writing": "Write real letters to friends or family members instead of texting or emailing.",
                "Letter Structure": "Create flashcards with different letter components and practice arranging them in order.",
                "Tone Adjustment": "Take a formal sentence and rewrite it informally, or vice versa.",
                "Language Style": "Make lists of formal and informal versions of common phrases and vocabulary.",
                "Formatting Skills": "Use templates to practice proper letter layout and spacing.",
                "Purpose Clarity": "Before writing, state the purpose in one sentence to stay focused.",
                "Audience Awareness": "Write the same message to different people (friend, teacher, principal) and compare."
            };
            return tips[skillName] || "Practice this skill with different types of letters regularly.";
        }

        // Load current question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            writingFact.innerHTML = '';
            conceptDisplay.innerHTML = '';
            visualizationContainer.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            writingFact.appendChild(createWritingFact());
            conceptDisplay.appendChild(createConceptDisplay());
            visualizationContainer.appendChild(createLetterVisualization());
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                optionElement.classList.add('pulse');
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation, question.answer);
            }
            
            nextQuestionBtn.disabled = false;
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackMessage = feedbackContainer.querySelector('.feedback-message');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '‚úì';
                feedbackTitle.textContent = 'Correct!';
                feedbackMessage.textContent = positiveMessages[Math.floor(Math.random() * positiveMessages.length)];
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '‚úó';
                feedbackTitle.textContent = 'Incorrect';
                if (correctAnswer) {
                    const correctOption = String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65));
                    const correctText = questions.find(q => 
                        appState.currentQuestions[appState.currentQuestionIndex].question === q.question
                    )?.options[correctAnswer.charCodeAt(0) - 65];
                    
                    feedbackMessage.textContent = `Correct answer: ${correctOption} (${correctText})`;
                }
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
            feedbackContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip current question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry the topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            initializeQuestions();
            
            saveStateToStorage();
            showPracticePage();
        }

        // Go back to home page
        function backToHome() {
            showWelcomePage();
        }

        // Go back to topics page
        function backToTopics() {
            alert("In a complete implementation, this would navigate to the topics selection page.");
        }

        // Start practice session
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name to begin your letter writing journey!");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            if (appState.currentQuestions.length === 0) {
                initializeQuestions();
            }
            
            saveStateToStorage();
            showPracticePage();
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

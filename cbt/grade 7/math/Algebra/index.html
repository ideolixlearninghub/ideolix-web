<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 7 Math - Algebra | Ideolix Learning Hub</title>
    <style>
        /* CSS Variables for Algebra Theme */
        :root {
            --primary-blue: #2962FF;
            --secondary-teal: #00BFA5;
            --accent-amber: #FFAB00;
            --accent-purple: #AA00FF;
            --accent-pink: #FF4081;
            --accent-green: #00C853;
            --dark-bg: #0D1B2A;
            --dark-surface: #1B2B3A;
            --dark-card: #253447;
            --dark-border: #3A4A5A;
            --text-primary: #FFFFFF;
            --text-secondary: #B8D0E0;
            --text-muted: #7A94A8;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            --glow: 0 0 20px rgba(41, 98, 255, 0.3);
            --expression-glow: 0 0 15px rgba(0, 191, 165, 0.4);
            --simplify-glow: 0 0 15px rgba(255, 171, 0, 0.4);
            --substitute-glow: 0 0 15px rgba(170, 0, 255, 0.4);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Algebra Pattern Background */
        .algebra-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: 
                radial-gradient(circle at 20% 30%, rgba(41, 98, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 191, 165, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 171, 0, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #0D1B2A, #1B2B3A);
            opacity: 0.8;
        }

        .floating-symbols {
            position: absolute;
            color: rgba(255, 255, 255, 0.05);
            font-size: 3rem;
            font-weight: bold;
            animation: floatSymbols 20s linear infinite;
        }

        @keyframes floatSymbols {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.1; }
            25% { transform: translateY(-100px) translateX(100px) rotate(90deg); opacity: 0.05; }
            50% { transform: translateY(-50px) translateX(-100px) rotate(180deg); opacity: 0.1; }
            75% { transform: translateY(100px) translateX(50px) rotate(270deg); opacity: 0.05; }
            100% { transform: translateY(0) translateX(0) rotate(360deg); opacity: 0.1; }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 27, 42, 0.9);
            z-index: -1;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            position: sticky;
            top: 20px;
            z-index: 100;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(10px);
        }

        .logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info {
            flex: 1;
        }

        .brand-info h1 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        /* Card Styles */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(5px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow), var(--glow);
        }

        /* Welcome Page */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-logo {
            width: 140px;
            height: 140px;
            margin-bottom: 25px;
            border-radius: 20px;
            overflow: hidden;
            background-color: var(--dark-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .welcome-logo img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .welcome-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 700px;
            line-height: 1.6;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(41, 98, 255, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 25px;
            border: 1px solid var(--primary-blue);
        }

        .topic-icon {
            font-size: 1.5rem;
        }

        .topic-name {
            font-weight: 600;
            color: var(--primary-blue);
        }

        .input-group {
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 1.1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(41, 98, 255, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.4);
        }

        .btn-primary:hover {
            background: #1A56DB;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(41, 98, 255, 0.5);
        }

        .btn-secondary {
            background: var(--secondary-teal);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 191, 165, 0.4);
        }

        .btn-secondary:hover {
            background: #009688;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 191, 165, 0.5);
        }

        .btn-amber {
            background: var(--accent-amber);
            color: #000;
            box-shadow: 0 4px 15px rgba(255, 171, 0, 0.4);
        }

        .btn-amber:hover {
            background: #FF9800;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 171, 0, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-blue);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Practice Mode */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-bar {
            height: 12px;
            background: var(--dark-surface);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(41, 98, 255, 0.5);
        }

        .question-container {
            margin-bottom: 25px;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .algebra-fact {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-purple);
            font-style: italic;
            color: var(--text-secondary);
        }

        /* Content Layout */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 25px 0;
        }

        @media (max-width: 992px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .question-side {
            display: flex;
            flex-direction: column;
        }

        .visualization-side {
            display: flex;
            flex-direction: column;
        }

        .concept-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .concept-box {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            padding: 20px 30px;
            border-radius: 12px;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            min-width: 180px;
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .concept-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .concept-label {
            font-size: 1rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 5px;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }

        .option {
            padding: 18px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--dark-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: rgba(41, 98, 255, 0.05);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(0, 200, 83, 0.1);
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .option.incorrect {
            background: rgba(255, 64, 129, 0.1);
            border-color: var(--accent-pink);
            color: var(--accent-pink);
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--dark-card);
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
            color: white;
            background: var(--secondary-teal);
        }

        .option.correct .option-letter {
            background: var(--accent-green);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--accent-pink);
            color: white;
        }

        .feedback-container {
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            display: none;
        }

        .feedback-correct {
            background: rgba(0, 200, 83, 0.1);
            border-left: 5px solid var(--accent-green);
        }

        .feedback-incorrect {
            background: rgba(255, 64, 129, 0.1);
            border-left: 5px solid var(--accent-pink);
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--accent-green);
        }

        .feedback-incorrect .feedback-icon {
            background: var(--accent-pink);
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .feedback-correct .feedback-title {
            color: var(--accent-green);
        }

        .feedback-incorrect .feedback-title {
            color: var(--accent-pink);
        }

        .feedback-message {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        /* Visualization Components */
        .visualization-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 25px;
            height: 100%;
            border: 1px solid var(--dark-border);
            overflow: auto;
            backdrop-filter: blur(5px);
        }

        /* Algebra Display */
        .algebra-display {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
        }

        .display-title {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            font-size: 1.3rem;
        }

        .algebra-container {
            padding: 20px;
            background: var(--dark-surface);
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--accent-purple);
        }

        .algebra-scenario {
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .algebra-highlight {
            background: rgba(170, 0, 255, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid var(--accent-purple);
        }

        .highlight-text {
            color: var(--accent-purple);
            font-weight: bold;
        }

        /* Expression Visualizer */
        .expression-visualizer {
            width: 100%;
            height: 250px;
            background: var(--dark-surface);
            border-radius: 12px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
            border: 2px solid var(--secondary-teal);
            padding: 20px;
        }

        .algebra-element {
            position: absolute;
            padding: 12px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease;
            border: 2px solid transparent;
        }

        .algebra-element:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .algebra-connection {
            position: absolute;
            background: var(--primary-blue);
            height: 2px;
            border-radius: 2px;
            opacity: 0.6;
        }

        /* Algebra Types Grid */
        .algebra-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 992px) {
            .algebra-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .algebra-grid {
                grid-template-columns: 1fr;
            }
        }

        .algebra-card {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid transparent;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .algebra-card:hover {
            transform: translateY(-5px);
        }

        .algebra-card.expressions {
            border-color: var(--secondary-teal);
        }

        .algebra-card.simplification {
            border-color: var(--accent-amber);
        }

        .algebra-card.substitution {
            border-color: var(--accent-purple);
        }

        .algebra-card.operations {
            border-color: var(--accent-green);
        }

        .algebra-card.variables {
            border-color: var(--accent-pink);
        }

        .algebra-card.applications {
            border-color: var(--primary-blue);
        }

        .algebra-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .expressions .algebra-icon {
            color: var(--secondary-teal);
        }

        .simplification .algebra-icon {
            color: var(--accent-amber);
        }

        .substitution .algebra-icon {
            color: var(--accent-purple);
        }

        .operations .algebra-icon {
            color: var(--accent-green);
        }

        .variables .algebra-icon {
            color: var(--accent-pink);
        }

        .applications .algebra-icon {
            color: var(--primary-blue);
        }

        .algebra-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .expressions .algebra-title {
            color: var(--secondary-teal);
        }

        .simplification .algebra-title {
            color: var(--accent-amber);
        }

        .substitution .algebra-title {
            color: var(--accent-purple);
        }

        .operations .algebra-title {
            color: var(--accent-green);
        }

        .variables .algebra-title {
            color: var(--accent-pink);
        }

        .applications .algebra-title {
            color: var(--primary-blue);
        }

        .algebra-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .algebra-examples {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 10px;
            background: var(--dark-surface);
            padding: 8px;
            border-radius: 4px;
        }

        /* Algebra Operations Table */
        .operations-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--dark-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .operations-table th {
            background: var(--dark-surface);
            padding: 12px;
            text-align: left;
            color: var(--accent-purple);
            border-bottom: 2px solid var(--accent-purple);
        }

        .operations-table td {
            padding: 10px;
            border-bottom: 1px solid var(--dark-border);
            color: var(--text-primary);
        }

        .operations-table tr:hover {
            background: rgba(170, 0, 255, 0.05);
        }

        /* Expressions Display */
        .expressions-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--secondary-teal);
        }

        .expressions-title {
            color: var(--secondary-teal);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .expressions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .expressions-grid {
                grid-template-columns: 1fr;
            }
        }

        .expression-card {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .expression-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--secondary-teal);
        }

        .expression-type {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--secondary-teal);
            font-size: 1.2rem;
        }

        .expression-example {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Simplification Display */
        .simplification-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-amber);
        }

        .simplification-title {
            color: var(--accent-amber);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .simplification-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .simplification-grid {
                grid-template-columns: 1fr;
            }
        }

        .simplification-card {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .simplification-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--accent-amber);
        }

        .simplification-type {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--accent-amber);
            font-size: 1.2rem;
        }

        .simplification-example {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Substitution Display */
        .substitution-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-purple);
        }

        .substitution-title {
            color: var(--accent-purple);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .substitution-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .substitution-grid {
                grid-template-columns: 1fr;
            }
        }

        .substitution-card {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .substitution-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--accent-purple);
        }

        .substitution-type {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--accent-purple);
            font-size: 1.2rem;
        }

        .substitution-example {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Interactive Algebra Builder */
        .builder-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--primary-blue);
        }

        .builder-title {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .builder-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .builder-select {
            padding: 10px 15px;
            background: var(--dark-surface);
            border: 2px solid var(--primary-blue);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .builder-input {
            padding: 15px;
            background: var(--dark-surface);
            border: 2px solid var(--primary-blue);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            resize: vertical;
            min-height: 60px;
        }

        .builder-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .builder-btn {
            padding: 10px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--primary-blue);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .builder-btn:hover {
            background: rgba(41, 98, 255, 0.1);
            transform: translateY(-2px);
        }

        .builder-display {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 8px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        /* Algebra Study Display */
        .algebra-study-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .algebra-study-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .algebra-study-grid {
                grid-template-columns: 1fr;
            }
        }

        .study-card {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--accent-green);
        }

        .study-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--accent-green);
        }

        .study-concept {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--accent-green);
        }

        .study-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .results-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal), var(--accent-amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .score-percentage {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--dark-border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Algebra Visual Elements */
        .expression-box {
            display: inline-block;
            padding: 8px 12px;
            margin: 5px;
            background: rgba(0, 191, 165, 0.1);
            border-radius: 6px;
            border: 1px solid var(--secondary-teal);
            font-family: monospace;
        }

        .variable-box {
            display: inline-block;
            padding: 8px 12px;
            margin: 5px;
            background: rgba(255, 64, 129, 0.1);
            border-radius: 50%;
            border: 1px solid var(--accent-pink);
            font-weight: bold;
        }

        .coefficient-box {
            display: inline-block;
            padding: 8px 12px;
            margin: 5px;
            background: rgba(255, 171, 0, 0.1);
            border-radius: 6px;
            border: 1px solid var(--accent-amber);
            font-weight: bold;
        }

        .simplification-step {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }

        .simplification-arrow {
            color: var(--accent-amber);
            font-weight: bold;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2rem;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .score-value {
                font-size: 3rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons .btn {
                width: 100%;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .concept-box {
                min-width: 140px;
                font-size: 1.5rem;
                padding: 15px 20px;
            }
            
            .algebra-grid {
                grid-template-columns: 1fr;
            }
            
            .expressions-grid {
                grid-template-columns: 1fr;
            }
            
            .simplification-grid {
                grid-template-columns: 1fr;
            }
            
            .substitution-grid {
                grid-template-columns: 1fr;
            }
            
            .algebra-study-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes grow {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .grow {
            animation: grow 0.5s ease forwards;
        }
        
        @keyframes algebraReveal {
            0% { transform: translateX(-100px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        .algebra-reveal {
            animation: algebraReveal 0.5s ease forwards;
        }
        
        @keyframes expressionGlow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 191, 165, 0.4); }
            50% { box-shadow: 0 0 15px 5px rgba(0, 191, 165, 0.2); }
        }
        
        .expression-glow {
            animation: expressionGlow 2s ease-in-out infinite;
        }
        
        @keyframes simplifyGlow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 171, 0, 0.4); }
            50% { box-shadow: 0 0 15px 5px rgba(255, 171, 0, 0.2); }
        }
        
        .simplify-glow {
            animation: simplifyGlow 2s ease-in-out infinite;
        }
        
        @keyframes substituteGlow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(170, 0, 255, 0.4); }
            50% { box-shadow: 0 0 15px 5px rgba(170, 0, 255, 0.2); }
        }
        
        .substitute-glow {
            animation: substituteGlow 2s ease-in-out infinite;
        }
        
        @keyframes floatSymbol {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        
        .float-symbol {
            animation: floatSymbol 3s ease-in-out infinite;
        }
        
        @keyframes algebraGlow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .algebra-glow {
            animation: algebraGlow 2s ease-in-out infinite;
        }
        
        @keyframes calculate {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .calculate {
            animation: calculate 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Algebra Pattern Background -->
    <div class="algebra-bg" id="algebraBg">
        <!-- Algebra symbols will be generated by JavaScript -->
    </div>
    <div class="overlay"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToTopics">Other Topics</button>
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card fade-in" id="welcomePage">
            <div class="welcome-logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <h1 class="welcome-title">Grade 7 Math - Algebra</h1>
            <p class="welcome-subtitle">Master the language of mathematics! Learn to work with algebraic expressions, simplify them using rules, substitute values for variables, and solve real-world problems. Build a strong foundation for advanced mathematics and develop critical thinking skills!</p>
            
            <div class="topic-badge">
                <span class="topic-icon">ùë• ùë¶ ùëß + ‚àí √ó √∑ =</span>
                <span class="topic-name">Expressions, Simplification & Substitution</span>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your full name:</label>
                <input type="text" id="studentName" placeholder="Your full name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">
                    <span>Start Algebra Journey</span>
                </button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 80</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 1.25%"></div>
                </div>
            </div>

            <div class="question-container">
                <!-- Algebra fact display -->
                <div id="algebraFact"></div>
                
                <!-- Concept display area -->
                <div id="conceptDisplay"></div>
                
                <!-- Content Wrapper: Questions on left, Visualizations on right -->
                <div class="content-wrapper" id="contentWrapper">
                    <!-- Left side: Question and Options -->
                    <div class="question-side">
                        <h2 class="question-text" id="questionText"></h2>
                        
                        <div class="options-container" id="optionsContainer"></div>
                        
                        <div class="feedback-container" id="feedbackContainer">
                            <div class="feedback-header">
                                <div class="feedback-icon"></div>
                                <div class="feedback-title"></div>
                            </div>
                            <div class="feedback-message"></div>
                            <div class="feedback-explanation"></div>
                        </div>
                    </div>
                    
                    <!-- Right side: Visualizations -->
                    <div class="visualization-side">
                        <div class="visualization-container" id="visualizationContainer">
                            <!-- All visualizations will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip Question</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next Question</button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Algebra Mastery Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                <div class="score-message" id="scoreMessage"></div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="highestScore">0</div>
                        <div class="stat-label">Highest Score</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Practice Again</button>
                <button class="btn btn-secondary" id="viewTopics">Other Math Topics</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize background
        function initBackground() {
            const algebraBg = document.getElementById('algebraBg');
            
            // Create floating algebra symbols
            const symbols = ['ùë•', 'ùë¶', 'ùëß', 'ùëé', 'ùëè', 'ùëê', '+', '‚àí', '√ó', '√∑', '=', '‚àö', '¬≤', '¬≥', '(', ')', '[', ']', '{', '}'];
            
            for (let i = 0; i < 25; i++) {
                const symbol = document.createElement('div');
                symbol.className = 'floating-symbols float-symbol';
                symbol.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                symbol.style.left = `${Math.random() * 100}%`;
                symbol.style.top = `${Math.random() * 100}%`;
                symbol.style.animationDelay = `${Math.random() * 5}s`;
                symbol.style.fontSize = `${2 + Math.random() * 4}rem`;
                
                // Color based on symbol type
                if (symbol.textContent.match(/[ùë•ùë¶ùëßùëéùëèùëê]/)) {
                    symbol.style.color = 'rgba(0, 191, 165, 0.1)';
                } else if (symbol.textContent.match(/[+\-√ó√∑]/)) {
                    symbol.style.color = 'rgba(255, 171, 0, 0.1)';
                } else if (symbol.textContent === '=') {
                    symbol.style.color = 'rgba(170, 0, 255, 0.1)';
                } else {
                    symbol.style.color = 'rgba(41, 98, 255, 0.1)';
                }
                
                algebraBg.appendChild(symbol);
            }
        }

        // Questions array - 80+ Grade 7 Algebra Questions
        const questions = [
            // Algebraic Expressions Basics (1-20)
            {
                type: "expressions_basics",
                question: "What is an algebraic expression?",
                options: ["A mathematical phrase with variables and operations", "An equation with an equals sign", "A number by itself", "A geometric shape"],
                answer: "A",
                explanation: "An algebraic expression contains numbers, variables, and operations but no equals sign. Example: 3x + 2."
            },
            {
                type: "expressions_basics",
                question: "In the expression 5x + 3, what is the coefficient?",
                options: ["5", "x", "3", "+"],
                answer: "A",
                explanation: "The coefficient is the number multiplying the variable. In 5x, 5 is the coefficient."
            },
            {
                type: "expressions_basics",
                question: "What is the constant in the expression 2y - 7?",
                options: ["-7", "2", "y", "2y"],
                answer: "A",
                explanation: "The constant is the term without a variable. In 2y - 7, -7 is the constant."
            },
            {
                type: "expressions_basics",
                question: "How many terms are in the expression 3x + 2y - 5?",
                options: ["3", "2", "1", "4"],
                answer: "A",
                explanation: "Terms are separated by + or - signs. 3x, 2y, and -5 are the three terms."
            },
            {
                type: "expressions_basics",
                question: "Identify the variable in the expression 4a + 3:",
                options: ["a", "4", "3", "4a"],
                answer: "A",
                explanation: "A variable is a letter that represents an unknown value. In 4a + 3, 'a' is the variable."
            },
            // Like Terms (21-40)
            {
                type: "like_terms",
                question: "What are like terms?",
                options: ["Terms with the same variable and exponent", "Terms that look similar", "Terms next to each other", "Terms with the same coefficient"],
                answer: "A",
                explanation: "Like terms have the exact same variable(s) raised to the same power. Example: 3x and 5x are like terms."
            },
            {
                type: "like_terms",
                question: "Which terms are like terms with 4x?",
                options: ["7x", "4y", "x¬≤", "4"],
                answer: "A",
                explanation: "7x has the same variable (x) raised to the same power (1) as 4x."
            },
            {
                type: "like_terms",
                question: "Combine like terms: 3x + 2x",
                options: ["5x", "6x", "5x¬≤", "3x + 2x"],
                answer: "A",
                explanation: "3x + 2x = (3+2)x = 5x. Add the coefficients, keep the variable the same."
            },
            {
                type: "like_terms",
                question: "Simplify: 5y + 3 - 2y",
                options: ["3y + 3", "8y", "3y - 3", "7y + 3"],
                answer: "A",
                explanation: "5y - 2y = 3y, then +3. So 5y + 3 - 2y = 3y + 3."
            },
            {
                type: "like_terms",
                question: "Which terms are NOT like terms?",
                options: ["2x and 2y", "3x and 5x", "4y and 7y", "2x¬≤ and 3x¬≤"],
                answer: "A",
                explanation: "2x and 2y have different variables (x vs y), so they are NOT like terms."
            },
            // Simplification (41-60)
            {
                type: "simplification",
                question: "Simplify: 3(x + 2)",
                options: ["3x + 6", "3x + 2", "x + 6", "3x + 5"],
                answer: "A",
                explanation: "Use distributive property: 3(x + 2) = 3√óx + 3√ó2 = 3x + 6."
            },
            {
                type: "simplification",
                question: "Simplify: 2x + 3x + 4",
                options: ["5x + 4", "9x", "5x¬≤ + 4", "6x + 4"],
                answer: "A",
                explanation: "Combine like terms: 2x + 3x = 5x, then +4 = 5x + 4."
            },
            {
                type: "simplification",
                question: "Simplify: 4(2x - 3)",
                options: ["8x - 12", "8x - 3", "6x - 12", "8x + 12"],
                answer: "A",
                explanation: "Distribute: 4(2x - 3) = 4√ó2x + 4√ó(-3) = 8x - 12."
            },
            {
                type: "simplification",
                question: "Simplify: 5x + 2 - 3x + 4",
                options: ["2x + 6", "8x + 6", "2x + 2", "8x + 2"],
                answer: "A",
                explanation: "Combine like terms: 5x - 3x = 2x, and 2 + 4 = 6. So 2x + 6."
            },
            {
                type: "simplification",
                question: "Simplify: 3(x + 2) + 4(x - 1)",
                options: ["7x + 2", "7x + 10", "3x + 6 + 4x - 4", "7x - 2"],
                answer: "A",
                explanation: "3(x+2)=3x+6, 4(x-1)=4x-4. Combine: 3x+6+4x-4=7x+2."
            },
            // Substitution (61-80)
            {
                type: "substitution",
                question: "If x = 3, what is 2x + 4?",
                options: ["10", "9", "11", "12"],
                answer: "A",
                explanation: "Substitute x=3: 2(3) + 4 = 6 + 4 = 10."
            },
            {
                type: "substitution",
                question: "If a = 2 and b = 5, what is 3a + b?",
                options: ["11", "16", "8", "10"],
                answer: "A",
                explanation: "Substitute: 3(2) + 5 = 6 + 5 = 11."
            },
            {
                type: "substitution",
                question: "If y = 4, what is y¬≤ - 3?",
                options: ["13", "1", "7", "16"],
                answer: "A",
                explanation: "Substitute y=4: 4¬≤ - 3 = 16 - 3 = 13."
            },
            {
                type: "substitution",
                question: "If x = 3 and y = 2, what is 2x + 3y?",
                options: ["12", "11", "13", "10"],
                answer: "A",
                explanation: "Substitute: 2(3) + 3(2) = 6 + 6 = 12."
            },
            {
                type: "substitution",
                question: "If m = 5, what is 4(m - 2)?",
                options: ["12", "3", "7", "20"],
                answer: "A",
                explanation: "Substitute m=5: 4(5-2) = 4(3) = 12."
            },
            // Writing Expressions (81-100)
            {
                type: "writing_expressions",
                question: "Write an expression for '5 more than x':",
                options: ["x + 5", "5x", "x - 5", "5 - x"],
                answer: "A",
                explanation: "'More than' means addition. 5 more than x is x + 5."
            },
            {
                type: "writing_expressions",
                question: "Write an expression for 'twice a number n':",
                options: ["2n", "n¬≤", "n + 2", "n/2"],
                answer: "A",
                explanation: "'Twice' means 2 times. Twice n is 2n."
            },
            {
                type: "writing_expressions",
                question: "Write an expression for '3 less than y':",
                options: ["y - 3", "3 - y", "y + 3", "3y"],
                answer: "A",
                explanation: "'Less than' means subtraction. 3 less than y is y - 3."
            },
            {
                type: "writing_expressions",
                question: "Write an expression for 'the product of 4 and x':",
                options: ["4x", "x + 4", "x/4", "4 - x"],
                answer: "A",
                explanation: "'Product' means multiplication. The product of 4 and x is 4x."
            },
            {
                type: "writing_expressions",
                question: "Write an expression for 'the sum of a number and 7':",
                options: ["n + 7", "7n", "n - 7", "n/7"],
                answer: "A",
                explanation: "'Sum' means addition. Sum of n and 7 is n + 7."
            },
            // Advanced Simplification (101-120)
            {
                type: "advanced_simplification",
                question: "Simplify: 2x + 3y + 4x - y",
                options: ["6x + 2y", "6x + 4y", "2x + 2y", "6x - 2y"],
                answer: "A",
                explanation: "Combine like terms: 2x+4x=6x, 3y-y=2y. So 6x + 2y."
            },
            {
                type: "advanced_simplification",
                question: "Simplify: 3(2x + 1) - 4",
                options: ["6x - 1", "6x + 3 - 4", "6x + 7", "6x - 7"],
                answer: "A",
                explanation: "3(2x+1)=6x+3. Then 6x+3-4=6x-1."
            },
            {
                type: "advanced_simplification",
                question: "Simplify: 5 - 2(x - 3)",
                options: ["11 - 2x", "5 - 2x + 6", "2x + 11", "5 - 2x - 6"],
                answer: "A",
                explanation: "-2(x-3) = -2x + 6. Then 5 + (-2x + 6) = 11 - 2x."
            },
            {
                type: "advanced_simplification",
                question: "Simplify: 4x + 2(x + 3)",
                options: ["6x + 6", "4x + 2x + 6", "6x + 3", "4x + 2x + 3"],
                answer: "A",
                explanation: "2(x+3)=2x+6. Then 4x+2x+6=6x+6."
            },
            // Word Problems (121-140)
            {
                type: "word_problems",
                question: "A rectangle has length 2x and width x. What is its perimeter?",
                options: ["6x", "3x", "2x¬≤", "4x"],
                answer: "A",
                explanation: "Perimeter = 2(length + width) = 2(2x + x) = 2(3x) = 6x."
            },
            {
                type: "word_problems",
                question: "John has x apples. Mary has 3 more than John. How many apples do they have together?",
                options: ["2x + 3", "x + 3", "3x", "x + 4"],
                answer: "A",
                explanation: "John: x, Mary: x+3. Together: x + (x+3) = 2x + 3."
            },
            {
                type: "word_problems",
                question: "A book costs $5 more than a pen. If pen costs p dollars, book costs:",
                options: ["p + 5", "p - 5", "5p", "p/5"],
                answer: "A",
                explanation: "$5 more than p is p + 5."
            },
            {
                type: "word_problems",
                question: "Samantha is twice as old as her brother. If brother is b years, Samantha is:",
                options: ["2b", "b + 2", "b/2", "b¬≤"],
                answer: "A",
                explanation: "Twice as old means 2 times b, or 2b."
            },
            // Mixed Operations (141-160)
            {
                type: "mixed_operations",
                question: "Simplify then substitute x=2: 3x + 2(x + 1)",
                options: ["12", "10", "14", "16"],
                answer: "A",
                explanation: "Simplify: 3x+2(x+1)=3x+2x+2=5x+2. Substitute x=2: 5(2)+2=10+2=12."
            },
            {
                type: "mixed_operations",
                question: "If a=3, b=2, evaluate: 2a¬≤ - b",
                options: ["16", "14", "18", "12"],
                answer: "A",
                explanation: "Substitute: 2(3)¬≤ - 2 = 2(9) - 2 = 18 - 2 = 16."
            },
            {
                type: "mixed_operations",
                question: "Which expression equals 4x + 8?",
                options: ["4(x + 2)", "2(2x + 4)", "Both A and B", "Neither"],
                answer: "C",
                explanation: "4(x+2)=4x+8 and 2(2x+4)=4x+8. Both simplify to 4x+8."
            }
        ];

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // Positive feedback messages
        const positiveMessages = [
            "Excellent algebraic thinking!",
            "Perfect simplification!",
            "Great job with expressions!",
            "Amazing! You're an algebra champion!",
            "Perfect understanding of variables!",
            "You're a future mathematician in the making!",
            "Outstanding problem-solving skills!",
            "Brilliant algebraic reasoning!",
            "You think like a mathematician!",
            "Algebra mastery achieved!"
        ];

        // Algebra concepts
        const algebraConcepts = [
            {
                name: "Expressions",
                description: "Mathematical phrases with variables",
                icon: "ùë•+ùë¶"
            },
            {
                name: "Simplification",
                description: "Making expressions simpler",
                icon: "‚áí"
            },
            {
                name: "Substitution",
                description: "Replacing variables with values",
                icon: "‚Üí"
            },
            {
                name: "Variables",
                description: "Letters representing unknowns",
                icon: "ùë•"
            },
            {
                name: "Like Terms",
                description: "Terms with same variables",
                icon: "‚âà"
            },
            {
                name: "Operations",
                description: "Add, subtract, multiply expressions",
                icon: "+‚àí√ó"
            }
        ];

        // Algebra types
        const algebraTypes = [
            {
                name: "Expressions",
                description: "Mathematical phrases containing variables, numbers, and operations",
                examples: "3x + 2, 4y - 7, 2a + 3b - 5",
                characteristics: "No equals sign, can be evaluated, can be simplified",
                icon: "ùë•+ùë¶",
                color: "#00BFA5"
            },
            {
                name: "Simplification",
                description: "Making algebraic expressions simpler or more compact",
                examples: "3x + 2x = 5x, 4(x+2) = 4x+8, 2y+3+4y = 6y+3",
                characteristics: "Combine like terms, use distributive property, remove parentheses",
                icon: "‚áí",
                color: "#FFAB00"
            },
            {
                name: "Substitution",
                description: "Replacing variables with given numerical values",
                examples: "If x=3, then 2x+1 = 2(3)+1 = 7",
                characteristics: "Replace variables, follow order of operations, calculate result",
                icon: "‚Üí",
                color: "#AA00FF"
            },
            {
                name: "Variables",
                description: "Symbols (usually letters) that represent unknown values",
                examples: "x, y, a, b, n (for number)",
                characteristics: "Can represent any number, used in expressions and equations",
                icon: "ùë•",
                color: "#00C853"
            },
            {
                name: "Like Terms",
                description: "Terms that have the same variable raised to the same power",
                examples: "3x and 5x, 2y¬≤ and 7y¬≤, 4 and 9 (constants)",
                characteristics: "Can be combined by adding/subtracting coefficients",
                icon: "‚âà",
                color: "#FF4081"
            },
            {
                name: "Word Problems",
                description: "Real-world situations expressed algebraically",
                examples: "'Twice a number' = 2n, '5 more than x' = x+5",
                characteristics: "Translate words to algebra, identify key phrases",
                icon: "üìù",
                color: "#2962FF"
            }
        ];

        // Expression examples
        const expressionExamples = [
            {
                type: "Simple Expression",
                example: "3x + 2",
                components: "Coefficient: 3, Variable: x, Constant: 2, Terms: 2"
            },
            {
                type: "With Multiple Variables",
                example: "2x + 3y - 5",
                components: "Variables: x and y, Constants: -5, Terms: 3"
            },
            {
                type: "With Exponents",
                example: "x¬≤ + 3x - 4",
                components: "x¬≤ (x squared), 3x (x to first power), Constant: -4"
            },
            {
                type: "With Parentheses",
                example: "3(x + 2)",
                components: "Can be expanded to 3x + 6 using distributive property"
            },
            {
                type: "Combination",
                example: "2a + 3b - a + 4",
                components: "Like terms: 2a and -a, Unlike: 3b and 4"
            },
            {
                type: "Real-world",
                example: "2n + 5 (twice a number plus five)",
                components: "Represents a real situation algebraically"
            }
        ];

        // Simplification examples
        const simplificationExamples = [
            {
                operation: "Combine Like Terms",
                example: "3x + 2x = 5x",
                steps: "Add coefficients (3+2=5), keep variable"
            },
            {
                operation: "Distributive Property",
                example: "2(x + 3) = 2x + 6",
                steps: "Multiply each term inside by outside number"
            },
            {
                operation: "Multiple Steps",
                example: "3x + 2 + 4x - 1 = 7x + 1",
                steps: "Combine x terms: 3x+4x=7x, constants: 2-1=1"
            },
            {
                operation: "With Parentheses",
                example: "2(x+1) + 3(x-2) = 2x+2+3x-6 = 5x-4",
                steps: "Distribute, combine like terms"
            },
            {
                operation: "Complex Simplification",
                example: "4(2x-3) - 2(x+1) = 8x-12-2x-2 = 6x-14",
                steps: "Distribute carefully with negatives, combine"
            },
            {
                operation: "With Fractions",
                example: "¬Ωx + ¬ºx = ¬æx",
                steps: "Find common denominator for coefficients"
            }
        ];

        // Substitution examples
        const substitutionExamples = [
            {
                scenario: "Single Variable",
                example: "If x=4, then 2x+3 = 2(4)+3 = 8+3 = 11",
                steps: "Replace x with 4, multiply, then add"
            },
            {
                scenario: "Multiple Variables",
                example: "If a=2, b=3, then 3a+2b = 3(2)+2(3) = 6+6 = 12",
                steps: "Replace each variable, calculate"
            },
            {
                scenario: "With Exponents",
                example: "If x=5, then x¬≤-4 = 5¬≤-4 = 25-4 = 21",
                steps: "Square first, then subtract"
            },
            {
                scenario: "In Parentheses",
                example: "If y=3, then 4(y+2) = 4(3+2) = 4(5) = 20",
                steps: "Add inside parentheses first, then multiply"
            },
            {
                scenario: "Negative Values",
                example: "If x=-2, then 3x-5 = 3(-2)-5 = -6-5 = -11",
                steps: "Careful with negative signs"
            },
            {
                scenario: "Fraction Values",
                example: "If x=¬Ω, then 4x+1 = 4(¬Ω)+1 = 2+1 = 3",
                steps: "Multiply fraction, then add"
            }
        ];

        // Word problem translations
        const wordProblemTranslations = [
            {
                phrase: "A number increased by 5",
                expression: "n + 5",
                explanation: "'Increased by' means add"
            },
            {
                phrase: "Twice a number",
                expression: "2n",
                explanation: "'Twice' means 2 times"
            },
            {
                phrase: "Three less than a number",
                expression: "n - 3",
                explanation: "'Less than' means subtract (order matters!)"
            },
            {
                phrase: "The product of 4 and a number",
                expression: "4n",
                explanation: "'Product' means multiply"
            },
            {
                phrase: "The quotient of a number and 2",
                expression: "n √∑ 2 or n/2",
                explanation: "'Quotient' means divide"
            },
            {
                phrase: "Five more than twice a number",
                expression: "2n + 5",
                explanation: "Combine operations: twice then add 5"
            }
        ];

        // Algebra facts
        const algebraFacts = [
            "The word 'algebra' comes from Arabic 'al-jabr' meaning 'reunion of broken parts'!",
            "The letter 'x' is most commonly used for variables, but any letter can be used!",
            "Algebra was developed by Persian mathematician Al-Khwarizmi in the 9th century!",
            "The equals sign (=) was invented in 1557 by Welsh mathematician Robert Recorde!",
            "Variables allow us to solve problems without knowing the exact numbers first!",
            "The distributive property is one of the most important algebraic rules!",
            "Algebra is used in computer programming, engineering, economics, and many other fields!",
            "The longest equation in mathematics has over 200 terms!"
        ];

        // Algebra study concepts
        const algebraStudyConcepts = [
            {
                concept: "Order of Operations",
                description: "Rules for which operations to do first",
                examples: "PEMDAS: Parentheses, Exponents, Multiply/Divide, Add/Subtract"
            },
            {
                concept: "Common Phrases",
                description: "Translating words to algebraic expressions",
                examples: "More than = add, Less than = subtract, Product = multiply, Quotient = divide"
            },
            {
                concept: "Checking Your Work",
                description: "Verifying algebraic solutions",
                examples: "Substitute your answer back into original expression, Use different values to test"
            },
            {
                concept: "Common Mistakes",
                description: "Errors to avoid in algebra",
                examples: "Forgetting negative signs, Not distributing properly, Combining unlike terms"
            }
        ];

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const algebraFact = document.getElementById('algebraFact');
        const conceptDisplay = document.getElementById('conceptDisplay');
        const visualizationContainer = document.getElementById('visualizationContainer');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const backToTopicsBtn = document.getElementById('backToTopics');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const scoreMessage = document.getElementById('scoreMessage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const highestScore = document.getElementById('highestScore');

        // Initialize the app
        function initApp() {
            initBackground();
            loadStateFromStorage();
            setupEventListeners();
            
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Load state from localStorage
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixGrade7Algebra');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // Save state to localStorage
        function saveStateToStorage() {
            localStorage.setItem('ideolixGrade7Algebra', JSON.stringify(appState));
        }

        // Initialize and shuffle questions
        function initializeQuestions() {
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', backToHome);
            backToTopicsBtn.addEventListener('click', backToTopics);
            viewTopicsBtn.addEventListener('click', backToTopics);
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startPractice();
                }
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            
            const highest = localStorage.getItem('ideolixGrade7Algebra_highestScore') || 0;
            highestScore.textContent = Math.max(highest, appState.score);
            
            if (appState.score > highest) {
                localStorage.setItem('ideolixGrade7Algebra_highestScore', appState.score);
            }
            
            if (percentage >= 90) {
                scoreMessage.textContent = "Outstanding! You're an algebra expert!";
            } else if (percentage >= 80) {
                scoreMessage.textContent = "Great job! You have excellent algebraic skills!";
            } else if (percentage >= 70) {
                scoreMessage.textContent = "Good work! Keep practicing your algebra!";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "Not bad! Review expressions and try again!";
            } else {
                scoreMessage.textContent = "Keep learning! Algebra is the foundation for higher mathematics!";
            }
        }

        // Create algebra fact display
        function createAlgebraFact() {
            const factDiv = document.createElement('div');
            factDiv.className = 'algebra-fact';
            
            factDiv.innerHTML = `<strong>Interesting Algebra Fact:</strong> ${algebraFacts[Math.floor(Math.random() * algebraFacts.length)]}`;
            
            return factDiv;
        }

        // Create concept display
        function createConceptDisplay() {
            const display = document.createElement('div');
            display.className = 'concept-display';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            const conceptIcons = {
                "expressions_basics": "ùë•+ùë¶",
                "like_terms": "‚âà",
                "simplification": "‚áí",
                "substitution": "‚Üí",
                "writing_expressions": "üìù",
                "advanced_simplification": "‚ö°",
                "word_problems": "üî¢",
                "mixed_operations": "‚ûó"
            };
            
            let conceptName = "Algebraic Expressions";
            let conceptIcon = "ùë•+ùë¶";
            
            if (question.type.includes("expressions_basics")) {
                conceptName = "Algebraic Expressions";
                conceptIcon = conceptIcons.expressions_basics;
            } else if (question.type.includes("like_terms")) {
                conceptName = "Like Terms";
                conceptIcon = conceptIcons.like_terms;
            } else if (question.type.includes("simplification")) {
                conceptName = "Simplification";
                conceptIcon = conceptIcons.simplification;
            } else if (question.type.includes("substitution")) {
                conceptName = "Substitution";
                conceptIcon = conceptIcons.substitution;
            } else if (question.type.includes("writing_expressions")) {
                conceptName = "Writing Expressions";
                conceptIcon = conceptIcons.writing_expressions;
            } else if (question.type.includes("advanced_simplification")) {
                conceptName = "Advanced Simplification";
                conceptIcon = conceptIcons.advanced_simplification;
            } else if (question.type.includes("word_problems")) {
                conceptName = "Word Problems";
                conceptIcon = conceptIcons.word_problems;
            } else if (question.type.includes("mixed_operations")) {
                conceptName = "Mixed Operations";
                conceptIcon = conceptIcons.mixed_operations;
            }
            
            const conceptBox = document.createElement('div');
            conceptBox.className = 'concept-box grow';
            conceptBox.innerHTML = `
                <div class="concept-icon">${conceptIcon}</div>
                <div class="concept-text">${conceptName.toUpperCase()}</div>
            `;
            
            const label = document.createElement('div');
            label.className = 'concept-label';
            
            if (question.type.includes("expressions_basics")) {
                label.textContent = "Understanding algebraic expressions, terms, coefficients, and constants";
            } else if (question.type.includes("like_terms")) {
                label.textContent = "Identifying and combining like terms in algebraic expressions";
            } else if (question.type.includes("simplification")) {
                label.textContent = "Simplifying expressions using distributive property and combining like terms";
            } else if (question.type.includes("substitution")) {
                label.textContent = "Substituting values for variables and evaluating expressions";
            } else if (question.type.includes("writing_expressions")) {
                label.textContent = "Translating word phrases into algebraic expressions";
            } else if (question.type.includes("advanced_simplification")) {
                label.textContent = "Complex simplification with multiple steps and operations";
            } else if (question.type.includes("word_problems")) {
                label.textContent = "Applying algebra to solve real-world problems";
            } else if (question.type.includes("mixed_operations")) {
                label.textContent = "Combining multiple algebraic concepts in single problems";
            }
            
            display.appendChild(conceptBox);
            display.appendChild(label);
            
            return display;
        }

        // Create algebra visualization
        function createAlgebraVisualization() {
            const vizDiv = document.createElement('div');
            vizDiv.className = 'visualization-container';
            
            const currentQuestion = appState.currentQuestions[appState.currentQuestionIndex];
            
            vizDiv.innerHTML = `
                <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary-blue);">Algebra Explorer</h3>
                
                <div class="algebra-display">
                    <div class="display-title">Current Algebra Concept</div>
                    <div class="algebra-container">
                        <div class="algebra-scenario">${currentQuestion.question}</div>
                        <div class="algebra-highlight">
                            <strong>Key Concept:</strong> <span class="highlight-text">${getAlgebraConcept(currentQuestion.type)}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Expression Visualizer -->
                <div class="expression-visualizer" id="expressionVisualizer">
                    <!-- Expression visualization will be animated by JavaScript -->
                </div>
                <div style="text-align: center; margin-bottom: 20px; color: var(--text-secondary); font-size: 0.9rem;">
                    Interactive Algebra Visualizer - See expressions, simplification, and substitution in action
                </div>
                
                <div class="algebra-grid">
                    ${algebraTypes.map(type => `
                        <div class="algebra-card ${type.name.toLowerCase()} ${type.name.toLowerCase()}-glow" style="border-color: ${type.color}" onclick="showAlgebraDemo('${type.name}')">
                            <div class="algebra-icon algebra-glow" style="color: ${type.color}">${type.icon}</div>
                            <div class="algebra-title" style="color: ${type.color}">${type.name}</div>
                            <div class="algebra-description">${type.description}</div>
                            <div class="algebra-examples">
                                <strong>Examples:</strong> ${type.examples}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <table class="operations-table">
                    <thead>
                        <tr>
                            <th>Algebra Concept</th>
                            <th>Definition</th>
                            <th>Key Idea</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${algebraTypes.slice(0, 4).map(type => `
                            <tr>
                                <td style="font-weight: bold; color: ${type.color};">${type.name}</td>
                                <td>${type.description}</td>
                                <td style="color: var(--accent-purple);">${type.characteristics.split(', ')[0]}</td>
                                <td style="font-style: italic; color: ${type.color};">${type.examples.split(', ')[0]}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div class="expressions-container expression-glow">
                    <div class="expressions-title">Algebraic Expressions</div>
                    <div class="expressions-grid">
                        ${expressionExamples.slice(0, 4).map(expression => `
                            <div class="expression-card">
                                <div class="expression-icon">ùë•</div>
                                <div class="expression-type">${expression.type}</div>
                                <div class="expression-example">
                                    <strong>Example:</strong> ${expression.example}<br>
                                    <strong>Components:</strong> ${expression.components}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="simplification-container simplify-glow">
                    <div class="simplification-title">Simplification Examples</div>
                    <div class="simplification-grid">
                        ${simplificationExamples.slice(0, 4).map(simplification => `
                            <div class="simplification-card">
                                <div class="simplification-icon">‚áí</div>
                                <div class="simplification-type">${simplification.operation}</div>
                                <div class="simplification-example">
                                    <strong>Example:</strong> ${simplification.example}<br>
                                    <strong>Steps:</strong> ${simplification.steps}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="substitution-container substitute-glow">
                    <div class="substitution-title">Substitution Examples</div>
                    <div class="substitution-grid">
                        ${substitutionExamples.slice(0, 4).map(substitution => `
                            <div class="substitution-card">
                                <div class="substitution-icon">‚Üí</div>
                                <div class="substitution-type">${substitution.scenario}</div>
                                <div class="substitution-example">
                                    <strong>Example:</strong> ${substitution.example}<br>
                                    <strong>Steps:</strong> ${substitution.steps}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="builder-container">
                    <div class="builder-title">Interactive Algebra Calculator</div>
                    <div class="builder-controls">
                        <select class="builder-select" id="algebraType">
                            <option value="">Select Operation</option>
                            <option value="simplify_expression">Simplify Expression</option>
                            <option value="substitute_values">Substitute Values</option>
                            <option value="combine_terms">Combine Like Terms</option>
                            <option value="translate_words">Translate Words to Algebra</option>
                        </select>
                        <textarea class="builder-input" id="algebraInput" placeholder="Enter an expression or problem... Example: '3x + 2x + 4' or 'If x=3, find 2x+5'"></textarea>
                        <div class="builder-buttons">
                            <button class="builder-btn" onclick="calculateAlgebra()">Calculate</button>
                            <button class="builder-btn" onclick="getAlgebraChallenge()">Get Challenge</button>
                            <button class="builder-btn" onclick="clearAlgebraBuilder()">Clear</button>
                        </div>
                    </div>
                    <div class="builder-display" id="builderDisplay">
                        Your algebra calculation will appear here...
                    </div>
                </div>
                
                <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid var(--accent-purple);">
                    <div style="color: var(--accent-purple); font-weight: bold; margin-bottom: 10px;">Quick Algebra Guide:</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        1. Variable: A letter representing an unknown (x, y, a, b)<br>
                        2. Coefficient: Number multiplying a variable (in 3x, 3 is coefficient)<br>
                        3. Constant: Number without a variable (in 2x+5, 5 is constant)<br>
                        4. Like Terms: Same variable to same power (3x and 5x are like terms)<br>
                        5. Simplify: Combine like terms, use distributive property<br>
                        6. Substitute: Replace variables with given numbers<br>
                        7. Expression: Math phrase without equals sign (3x+2)
                    </div>
                </div>
                
                <div class="algebra-study-container">
                    <div class="display-title">Algebra Study Strategies</div>
                    <div class="algebra-study-grid">
                        ${algebraStudyConcepts.map(concept => `
                            <div class="study-card">
                                <div class="study-icon">üìö</div>
                                <div class="study-concept">${concept.concept}</div>
                                <div class="study-description">
                                    <strong>Description:</strong> ${concept.description}<br>
                                    <strong>Examples:</strong> ${concept.examples}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="solution-container">
                    <div class="display-title">Step-by-Step Learning Path</div>
                    <div class="solution-steps" id="solutionSteps">
                        ${generateLearningPath(currentQuestion)}
                    </div>
                </div>
                
                <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin-top: 20px; border: 2px solid var(--secondary-teal);">
                    <div style="color: var(--secondary-teal); font-weight: bold; margin-bottom: 10px; text-align: center;">Algebra Building Tips</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center;">
                        <strong>Practice Regularly:</strong> Algebra skills improve with consistent practice<br>
                        <strong>Learn Key Phrases:</strong> Memorize common word-to-algebra translations<br>
                        <strong>Check Your Work:</strong> Always substitute values to verify simplifications<br>
                        <strong>Show Your Steps:</strong> Write out each step clearly to avoid mistakes<br>
                        <strong>Understand Concepts:</strong> Don't just memorize - understand why rules work<br>
                        <em>Algebra is the gateway to advanced mathematics, science, and technology!</em>
                    </div>
                </div>
            `;
            
            // Initialize expression visualizer
            initializeExpressionVisualizer(currentQuestion);
            
            return vizDiv;
        }

        // Helper functions
        function getAlgebraConcept(typeString) {
            const conceptMap = {
                "expressions_basics": "Algebraic Expressions - Understanding variables, coefficients, constants, and terms",
                "like_terms": "Like Terms - Identifying and combining terms with same variables and powers",
                "simplification": "Simplification - Making expressions simpler using algebraic rules",
                "substitution": "Substitution - Replacing variables with values and evaluating",
                "writing_expressions": "Writing Expressions - Translating word phrases into algebraic form",
                "advanced_simplification": "Advanced Simplification - Complex expressions with multiple steps",
                "word_problems": "Word Problems - Applying algebra to real-world situations",
                "mixed_operations": "Mixed Operations - Combining multiple algebraic concepts"
            };
            
            return conceptMap[typeString] || "Algebra Operations";
        }

        function generateLearningPath(question) {
            let steps = [];
            
            if (question.type.includes("expressions_basics")) {
                steps = [
                    "Step 1: Identify the variable(s) in the expression",
                    "Step 2: Identify the coefficient(s) - numbers multiplying variables",
                    "Step 3: Identify the constant(s) - numbers without variables",
                    "Step 4: Count the number of terms (separated by + or -)",
                    "Step 5: Understand what each part represents"
                ];
            } else if (question.type.includes("like_terms")) {
                steps = [
                    "Step 1: Identify terms with the same variable(s)",
                    "Step 2: Check that variables have the same exponent/power",
                    "Step 3: Add or subtract the coefficients of like terms",
                    "Step 4: Keep the variable part unchanged",
                    "Step 5: Write the simplified expression"
                ];
            } else if (question.type.includes("simplification")) {
                steps = [
                    "Step 1: Apply distributive property if there are parentheses",
                    "Step 2: Combine like terms by adding/subtracting coefficients",
                    "Step 3: Arrange terms in standard order (variables then constants)",
                    "Step 4: Check for any further simplification",
                    "Step 5: Write the final simplified expression"
                ];
            } else if (question.type.includes("substitution")) {
                steps = [
                    "Step 1: Replace each variable with the given value",
                    "Step 2: Use parentheses when substituting to avoid sign errors",
                    "Step 3: Follow order of operations (PEMDAS)",
                    "Step 4: Calculate step by step",
                    "Step 5: Verify your calculation"
                ];
            } else {
                steps = [
                    "Step 1: Read the problem carefully",
                    "Step 2: Identify the algebra concept being tested",
                    "Step 3: Determine the correct approach or formula",
                    "Step 4: Apply your knowledge to solve",
                    "Step 5: Verify your answer makes sense"
                ];
            }
            
            return steps.map((step, index) => `
                <div class="solution-step algebra-reveal" style="animation-delay: ${index * 0.1}s">
                    <span class="step-number">${index + 1}</span>
                    <span class="step-description">${step}</span>
                    ${index === steps.length - 1 ? `
                        <div class="step-calculation">
                            <strong>Correct Answer:</strong> ${question.options[question.answer.charCodeAt(0) - 65]}
                        </div>
                        <div class="step-explanation">
                            ${question.explanation}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Initialize expression visualizer
        function initializeExpressionVisualizer(question) {
            const expressionVisualizer = document.getElementById('expressionVisualizer');
            if (!expressionVisualizer) return;
            
            // Create visualization based on question type
            expressionVisualizer.innerHTML = '';
            
            if (question.type.includes("expressions_basics") || question.type.includes("like_terms")) {
                // Show expression parts
                expressionVisualizer.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                        <div style="font-size: 1.8rem; margin-bottom: 20px; color: var(--secondary-teal);">
                            <span class="coefficient-box">3</span>
                            <span class="variable-box">x</span>
                            <span style="color: white;"> + </span>
                            <span class="coefficient-box">2</span>
                            <span style="color: white;"> = ?</span>
                        </div>
                        
                        <div style="display: flex; gap: 30px; margin-bottom: 20px;">
                            <div style="text-align: center;">
                                <div class="coefficient-box">3</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Coefficient</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div class="variable-box">x</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Variable</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div class="expression-box">+</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Operation</div>
                            </div>
                        </div>
                        
                        <div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center; max-width: 80%;">
                            <strong>3x + 2 is an algebraic expression.</strong><br>
                            It has 2 terms: 3x (variable term) and 2 (constant term).
                        </div>
                    </div>
                    
                    <div style="position: absolute; bottom: 10px; left: 0; right: 0; text-align: center; color: var(--text-secondary); font-size: 0.8rem;">
                        Parts of an Algebraic Expression
                    </div>
                `;
            } else if (question.type.includes("simplification")) {
                // Show simplification process
                expressionVisualizer.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                        <div style="font-size: 1.5rem; margin-bottom: 20px; color: var(--accent-amber);">
                            <div class="simplification-step">
                                <span class="expression-box">3x + 2x + 4</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">5x + 4</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1rem; color: var(--accent-amber);">3x + 2x</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Like Terms</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div style="font-size: 1rem; color: var(--accent-amber);">3 + 2 = 5</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Add Coefficients</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div style="font-size: 1rem; color: var(--accent-amber);">5x</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">New Term</div>
                            </div>
                        </div>
                        
                        <div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center; max-width: 80%;">
                            <strong>Simplification combines like terms.</strong><br>
                            Like terms have the same variable(s) to the same power.
                        </div>
                    </div>
                    
                    <div style="position: absolute; bottom: 10px; left: 0; right: 0; text-align: center; color: var(--text-secondary); font-size: 0.8rem;">
                        Simplification Process - Combining Like Terms
                    </div>
                `;
            } else if (question.type.includes("substitution")) {
                // Show substitution process
                expressionVisualizer.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                        <div style="font-size: 1.5rem; margin-bottom: 20px; color: var(--accent-purple);">
                            <div class="simplification-step">
                                <span class="expression-box">If x=3, then 2x+4</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">2(3)+4</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">6+4</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">10</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1rem; color: var(--accent-purple);">x = 3</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Given Value</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div style="font-size: 1rem; color: var(--accent-purple);">2x ‚Üí 2(3)</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Substitute</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div style="font-size: 1rem; color: var(--accent-purple);">2(3)=6</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Multiply</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div style="font-size: 1rem; color: var(--accent-purple);">6+4=10</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Add</div>
                            </div>
                        </div>
                        
                        <div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center; max-width: 80%;">
                            <strong>Substitution replaces variables with values.</strong><br>
                            Then follow order of operations to calculate the result.
                        </div>
                    </div>
                    
                    <div style="position: absolute; bottom: 10px; left: 0; right: 0; text-align: center; color: var(--text-secondary); font-size: 0.8rem;">
                        Substitution Process - Replacing Variables with Values
                    </div>
                `;
            }
        }

        // Global functions for interactive features
        window.showAlgebraDemo = function(algebraName) {
            const expressionVisualizer = document.getElementById('expressionVisualizer');
            if (!expressionVisualizer) return;
            
            const algebra = algebraTypes.find(a => a.name === algebraName);
            if (!algebra) return;
            
            // Show the selected algebra type
            expressionVisualizer.innerHTML = '';
            
            if (algebraName === "Expressions") {
                expressionVisualizer.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <div style="text-align: center;">
                                <div class="expression-box">3x + 2</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Linear Expression</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div class="expression-box">x¬≤ + 3x - 4</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Quadratic Expression</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div class="expression-box">2a + 3b - 5</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Two Variables</div>
                            </div>
                        </div>
                        
                        <div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center; max-width: 90%;">
                            <strong>Algebraic expressions:</strong><br>
                            1. Contain numbers, variables, and operations<br>
                            2. Do NOT have an equals sign (=)<br>
                            3. Can be evaluated for specific values<br>
                            4. Can be simplified using algebraic rules
                        </div>
                    </div>
                    
                    <div style="position: absolute; bottom: 10px; left: 0; right: 0; text-align: center; color: var(--text-secondary); font-size: 0.8rem;">
                        <strong>${algebra.name}:</strong> ${algebra.description}
                    </div>
                `;
            } else if (algebraName === "Simplification") {
                expressionVisualizer.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                        <div style="font-size: 1.3rem; margin-bottom: 20px; color: var(--accent-amber);">
                            <div class="simplification-step">
                                <span class="expression-box">3(x+2) + 2x - 4</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">3x+6 + 2x - 4</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">5x + 2</span>
                            </div>
                        </div>
                        
                        <div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center; max-width: 90%; margin-bottom: 20px;">
                            <strong>Simplification Steps:</strong><br>
                            1. <span style="color: var(--accent-amber);">Distribute:</span> 3(x+2) = 3x + 6<br>
                            2. <span style="color: var(--accent-amber);">Combine like terms:</span> 3x + 2x = 5x<br>
                            3. <span style="color: var(--accent-amber);">Combine constants:</span> 6 - 4 = 2<br>
                            4. <span style="color: var(--accent-amber);">Write result:</span> 5x + 2
                        </div>
                    </div>
                    
                    <div style="position: absolute; bottom: 10px; left: 0; right: 0; text-align: center; color: var(--text-secondary); font-size: 0.8rem;">
                        <strong>${algebra.name}:</strong> ${algebra.description}
                    </div>
                `;
            } else if (algebraName === "Substitution") {
                expressionVisualizer.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                        <div style="font-size: 1.3rem; margin-bottom: 20px; color: var(--accent-purple);">
                            <div class="simplification-step">
                                <span class="expression-box">If x=3, y=2</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">3x + 2y</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">3(3) + 2(2)</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">9 + 4</span>
                                <span class="simplification-arrow">‚áí</span>
                                <span class="expression-box">13</span>
                            </div>
                        </div>
                        
                        <div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center; max-width: 90%; margin-bottom: 20px;">
                            <strong>Substitution Steps:</strong><br>
                            1. <span style="color: var(--accent-purple);">Replace variables:</span> x‚Üí3, y‚Üí2<br>
                            2. <span style="color: var(--accent-purple);">Write new expression:</span> 3(3) + 2(2)<br>
                            3. <span style="color: var(--accent-purple);">Multiply:</span> 3√ó3=9, 2√ó2=4<br>
                            4. <span style="color: var(--accent-purple);">Add:</span> 9 + 4 = 13
                        </div>
                    </div>
                    
                    <div style="position: absolute; bottom: 10px; left: 0; right: 0; text-align: center; color: var(--text-secondary); font-size: 0.8rem;">
                        <strong>${algebra.name}:</strong> ${algebra.description}
                    </div>
                `;
            }
        };

        // Algebra calculation function
        window.calculateAlgebra = function() {
            const algebraTypeSelect = document.getElementById('algebraType');
            const algebraInput = document.getElementById('algebraInput');
            const builderDisplay = document.getElementById('builderDisplay');
            
            if (!algebraTypeSelect || !algebraInput || !builderDisplay) return;
            
            const activityType = algebraTypeSelect.value;
            const userInput = algebraInput.value.trim();
            
            if (!activityType) {
                builderDisplay.innerHTML = "Please select an operation type.";
                return;
            }
            
            if (!userInput) {
                builderDisplay.innerHTML = "Please enter an algebra problem to calculate.";
                return;
            }
            
            const activityData = {
                simplify_expression: {
                    title: "Simplify Expression",
                    color: "#FFAB00",
                    icon: "‚áí",
                    calculate: function(expression) {
                        try {
                            // Simple expression simplifier
                            const simplified = simplifyAlgebraicExpression(expression);
                            return `
                                <strong>Original Expression:</strong> ${expression}<br>
                                <strong>Simplified:</strong> ${simplified.result}<br>
                                <strong>Steps:</strong> ${simplified.steps.join('<br>')}
                            `;
                        } catch (e) {
                            return `Error simplifying. Try expressions like: "3x + 2x + 4" or "2(x+3) + x"`;
                        }
                    }
                },
                substitute_values: {
                    title: "Substitute Values",
                    color: "#AA00FF",
                    icon: "‚Üí",
                    calculate: function(problem) {
                        try {
                            // Simple substitution calculator
                            if (problem.includes("x=") || problem.includes("y=") || problem.includes("a=") || problem.includes("b=")) {
                                const substitution = evaluateSubstitution(problem);
                                return `
                                    <strong>Problem:</strong> ${problem}<br>
                                    <strong>Result:</strong> ${substitution.result}<br>
                                    <strong>Steps:</strong> ${substitution.steps.join('<br>')}
                                `;
                            } else {
                                return `Please include variable values. Example: "If x=3, find 2x+5" or "Evaluate 3y-2 when y=4"`;
                            }
                        } catch (e) {
                            return `Error calculating. Try format like: "If x=3, find 2x+5" or "Evaluate 3y-2 when y=4"`;
                        }
                    }
                },
                combine_terms: {
                    title: "Combine Like Terms",
                    color: "#00BFA5",
                    icon: "‚âà",
                    calculate: function(expression) {
                        try {
                            const combined = combineLikeTerms(expression);
                            return `
                                <strong>Original:</strong> ${expression}<br>
                                <strong>Combined Like Terms:</strong> ${combined.result}<br>
                                <strong>Steps:</strong> ${combined.steps.join('<br>')}
                            `;
                        } catch (e) {
                            return `Error combining terms. Try expressions like: "3x + 2x + 4y - y"`;
                        }
                    }
                },
                translate_words: {
                    title: "Translate Words to Algebra",
                    color: "#2962FF",
                    icon: "üìù",
                    calculate: function(phrase) {
                        try {
                            const translation = translateToAlgebra(phrase);
                            return `
                                <strong>Phrase:</strong> "${phrase}"<br>
                                <strong>Algebraic Expression:</strong> ${translation.expression}<br>
                                <strong>Explanation:</strong> ${translation.explanation}<br>
                                <strong>Key Words:</strong> ${translation.keywords.join(', ')}
                            `;
                        } catch (e) {
                            return `Error translating. Try phrases like: "twice a number plus five" or "three less than x"`;
                        }
                    }
                }
            };
            
            const data = activityData[activityType];
            if (!data) {
                builderDisplay.innerHTML = "Invalid operation type selected.";
                return;
            }
            
            const calculation = data.calculate(userInput);
            
            builderDisplay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: 10px; color: ${data.color};">
                        ${data.icon} ${data.title}
                    </div>
                    
                    <div style="background: var(--dark-surface); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>Your Input:</strong><br>
                        <span style="color: ${data.color}; font-style: italic;">${userInput}</span>
                    </div>
                    
                    <div style="background: rgba(${parseInt(data.color.slice(1,3), 16)}, ${parseInt(data.color.slice(3,5), 16)}, ${parseInt(data.color.slice(5,7), 16)}, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0; border: 1px solid ${data.color};">
                        ${calculation}
                    </div>
                    
                    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 15px;">
                        <strong>Algebra Tip:</strong> Always check your work by substituting values or working backward!
                    </div>
                </div>
            `;
        };

        // Helper functions for algebra calculations
        function simplifyAlgebraicExpression(expression) {
            const steps = [];
            let result = expression;
            
            // Remove spaces
            result = result.replace(/\s+/g, '');
            steps.push("Remove spaces for clarity");
            
            // Handle distribution: a(b+c) -> ab + ac
            const distRegex = /(\d+)\(([a-z])\+?(\d+)\)/;
            const distMatch = result.match(distRegex);
            if (distMatch) {
                const [_, coef, variable, constant] = distMatch;
                result = result.replace(distRegex, `${coef}${variable}+${coef*constant}`);
                steps.push(`Distribute ${coef} over (${variable}+${constant}): ${coef}√ó${variable}=${coef}${variable}, ${coef}√ó${constant}=${coef*constant}`);
            }
            
            // Combine like terms for simple cases
            const likeTermsRegex = /(\d+)([a-z])\+?(\d+)(\2)/;
            const likeMatch = result.match(likeTermsRegex);
            if (likeMatch) {
                const [_, coef1, variable, coef2] = likeMatch;
                const sum = parseInt(coef1) + parseInt(coef2);
                result = result.replace(likeTermsRegex, `${sum}${variable}`);
                steps.push(`Combine like terms: ${coef1}${variable} + ${coef2}${variable} = ${sum}${variable}`);
            }
            
            // Combine constants if present
            const constantsRegex = /(\d+)\+?(\d+)(?![a-z])/;
            const constMatch = result.match(constantsRegex);
            if (constMatch) {
                const [_, const1, const2] = constMatch;
                const sum = parseInt(const1) + parseInt(const2);
                result = result.replace(constantsRegex, `${sum}`);
                steps.push(`Combine constants: ${const1} + ${const2} = ${sum}`);
            }
            
            return { result, steps };
        }

        function evaluateSubstitution(problem) {
            const steps = [];
            let result = "";
            
            // Extract variable and value
            const varMatch = problem.match(/([a-z])=(\d+)/);
            if (!varMatch) {
                throw new Error("Could not parse variable assignment");
            }
            
            const variable = varMatch[1];
            const value = parseInt(varMatch[2]);
            steps.push(`Given: ${variable} = ${value}`);
            
            // Extract expression
            const exprMatch = problem.match(/find\s+([^,]+)|Evaluate\s+([^,]+)/i);
            if (!exprMatch) {
                throw new Error("Could not find expression to evaluate");
            }
            
            const expression = exprMatch[1] || exprMatch[2];
            steps.push(`Expression: ${expression}`);
            
            // Replace variable with value
            let calculation = expression.replace(new RegExp(variable, 'g'), `(${value})`);
            steps.push(`Substitute ${variable} with ${value}: ${calculation}`);
            
            // Evaluate simple expressions
            try {
                // Handle multiplication: 2(3) -> 2*3
                calculation = calculation.replace(/(\d+)\((\d+)\)/g, '$1*$2');
                
                // Evaluate using safe eval
                const evalResult = Function(`"use strict"; return (${calculation})`)();
                result = evalResult.toString();
                steps.push(`Calculate: ${calculation} = ${result}`);
            } catch (e) {
                result = `Could not evaluate: ${calculation}`;
                steps.push(`Calculation error for: ${calculation}`);
            }
            
            return { result, steps };
        }

        function combineLikeTerms(expression) {
            const steps = [];
            let result = expression.replace(/\s+/g, '');
            
            steps.push(`Original: ${result}`);
            
            // Simple combination for patterns like 3x+2x
            const termRegex = /([+-]?\d*)([a-z]?)/g;
            const terms = [];
            let match;
            
            while ((match = termRegex.exec(result)) !== null) {
                if (match[0]) {
                    terms.push({
                        coef: match[1] ? parseInt(match[1]) : (match[2] ? 1 : 0),
                        variable: match[2] || 'constant'
                    });
                }
            }
            
            // Group like terms
            const grouped = {};
            terms.forEach(term => {
                const key = term.variable;
                if (!grouped[key]) grouped[key] = 0;
                grouped[key] += term.coef;
            });
            
            // Build result
            const parts = [];
            if (grouped.constant !== 0) parts.push(grouped.constant);
            Object.keys(grouped).forEach(key => {
                if (key !== 'constant' && grouped[key] !== 0) {
                    const coef = grouped[key];
                    parts.push(`${coef}${key}`);
                }
            });
            
            result = parts.join('+').replace(/\+\-/g, '-').replace(/^\+/, '');
            if (result === '') result = '0';
            
            steps.push(`Combined like terms: ${result}`);
            
            return { result, steps };
        }

        function translateToAlgebra(phrase) {
            phrase = phrase.toLowerCase();
            const keywords = [];
            let expression = "";
            let explanation = "";
            
            // Check for common phrases
            if (phrase.includes("twice") || phrase.includes("double")) {
                keywords.push("twice/double");
                expression = "2n";
                explanation = "'Twice' or 'double' means multiply by 2";
            } else if (phrase.includes("more than")) {
                keywords.push("more than");
                const match = phrase.match(/(\d+)\s+more than/);
                if (match) {
                    expression = `n + ${match[1]}`;
                    explanation = `'${match[1]} more than' means add ${match[1]}`;
                }
            } else if (phrase.includes("less than")) {
                keywords.push("less than");
                const match = phrase.match(/(\d+)\s+less than/);
                if (match) {
                    expression = `n - ${match[1]}`;
                    explanation = `'${match[1]} less than' means subtract ${match[1]} (order matters!)`;
                }
            } else if (phrase.includes("product")) {
                keywords.push("product");
                const match = phrase.match(/product of (\d+) and/);
                if (match) {
                    expression = `${match[1]}n`;
                    explanation = `'Product' means multiply`;
                }
            } else if (phrase.includes("sum")) {
                keywords.push("sum");
                expression = "n + m";
                explanation = "'Sum' means add two numbers";
            } else if (phrase.includes("difference")) {
                keywords.push("difference");
                expression = "n - m";
                explanation = "'Difference' means subtract";
            } else {
                expression = "Could not translate";
                explanation = "Try common phrases like 'twice a number', '5 more than x', or '3 less than y'";
            }
            
            return { expression, explanation, keywords };
        }

        window.getAlgebraChallenge = function() {
            const algebraTypeSelect = document.getElementById('algebraType');
            const algebraInput = document.getElementById('algebraInput');
            
            if (!algebraTypeSelect || !algebraInput) return;
            
            const activityType = algebraTypeSelect.value;
            
            if (!activityType) {
                alert("Please select an operation type first!");
                return;
            }
            
            const challenges = {
                simplify_expression: [
                    "Simplify: 3x + 2x + 4",
                    "Simplify: 2(x+3) - x",
                    "Simplify: 4y + 3 - 2y + 5",
                    "Simplify: 3(2x-1) + 4",
                    "Simplify: 5a + 2b - 3a + b"
                ],
                substitute_values: [
                    "If x=3, find 2x+5",
                    "If y=4, evaluate y¬≤ - 3",
                    "If a=2, b=5, find 3a + 2b",
                    "If x=5, evaluate 4(x-2)",
                    "If m=3, n=2, find 2m + 3n"
                ],
                combine_terms: [
                    "Combine like terms: 3x + 2x",
                    "Combine like terms: 5y - 3y + 2",
                    "Combine like terms: 2a + 3b + a - b",
                    "Combine like terms: 4x¬≤ + 3x - 2x¬≤",
                    "Combine like terms: 7 + 3x - 2 + 5x"
                ],
                translate_words: [
                    "Translate: 'Twice a number'",
                    "Translate: '5 more than x'",
                    "Translate: '3 less than y'",
                    "Translate: 'The product of 4 and n'",
                    "Translate: 'The sum of a number and 7'"
                ]
            };
            
            const activityChallenges = challenges[activityType];
            if (activityChallenges) {
                const randomChallenge = activityChallenges[Math.floor(Math.random() * activityChallenges.length)];
                algebraInput.value = randomChallenge;
                algebraInput.focus();
            }
        };

        window.clearAlgebraBuilder = function() {
            const algebraInput = document.getElementById('algebraInput');
            const builderDisplay = document.getElementById('builderDisplay');
            
            if (algebraInput) algebraInput.value = '';
            if (builderDisplay) {
                builderDisplay.innerHTML = "Your algebra calculation will appear here...";
            }
        };

        // Load current question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            algebraFact.innerHTML = '';
            conceptDisplay.innerHTML = '';
            visualizationContainer.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            algebraFact.appendChild(createAlgebraFact());
            conceptDisplay.appendChild(createConceptDisplay());
            visualizationContainer.appendChild(createAlgebraVisualization());
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                optionElement.classList.add('pulse');
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation, question.answer);
            }
            
            nextQuestionBtn.disabled = false;
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackMessage = feedbackContainer.querySelector('.feedback-message');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '‚úì';
                feedbackTitle.textContent = 'Correct!';
                feedbackMessage.textContent = positiveMessages[Math.floor(Math.random() * positiveMessages.length)];
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '‚úó';
                feedbackTitle.textContent = 'Incorrect';
                if (correctAnswer) {
                    const correctOption = String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65));
                    const correctText = questions.find(q => 
                        appState.currentQuestions[appState.currentQuestionIndex].question === q.question
                    )?.options[correctAnswer.charCodeAt(0) - 65];
                    
                    feedbackMessage.textContent = `Correct answer: ${correctOption} (${correctText})`;
                }
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
            feedbackContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip current question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry the topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            initializeQuestions();
            
            saveStateToStorage();
            showPracticePage();
        }

        // Go back to home page
        function backToHome() {
            showWelcomePage();
        }

        // Go back to topics page
        function backToTopics() {
            alert("In a complete implementation, this would navigate to the topics selection page.");
        }

        // Start practice session
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name to begin your algebra journey!");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            if (appState.currentQuestions.length === 0) {
                initializeQuestions();
            }
            
            saveStateToStorage();
            showPracticePage();
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

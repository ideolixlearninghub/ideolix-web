<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 8 English - Direct/Indirect Speech & Active/Passive Voice | Ideolix Learning Hub</title>
    <style>
        /* CSS Variables for Speech & Voice Theme */
        :root {
            --direct-blue: #2196F3;
            --indirect-purple: #9C27B0;
            --active-green: #4CAF50;
            --passive-orange: #FF9800;
            --transformation-teal: #009688;
            --error-red: #F44336;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --direct-glow: 0 0 20px rgba(33, 150, 243, 0.4);
            --indirect-glow: 0 0 20px rgba(156, 39, 176, 0.4);
            --active-glow: 0 0 20px rgba(76, 175, 80, 0.4);
            --passive-glow: 0 0 20px rgba(255, 152, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(33, 150, 243, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(156, 39, 176, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 30% 70%, rgba(76, 175, 80, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 152, 0, 0.05) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(10px);
        }

        .logo {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            border-radius: 10px;
            overflow: hidden;
            background-color: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info h1 {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }

        /* Card Styles */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(5px);
        }

        /* Welcome Page */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 30px 20px;
        }

        .welcome-title {
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--direct-blue), var(--indirect-purple), var(--active-green), var(--passive-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 25px;
            max-width: 800px;
            line-height: 1.6;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(33, 150, 243, 0.15);
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 20px;
            border: 2px solid var(--direct-blue);
        }

        .topic-icon {
            font-size: 1.5rem;
        }

        .topic-name {
            font-weight: 600;
            color: var(--direct-blue);
        }

        .input-group {
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--dark-border);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--direct-blue);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
        }

        /* Grammar Grid */
        .grammar-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin: 25px 0;
        }

        @media (max-width: 768px) {
            .grammar-grid {
                grid-template-columns: 1fr;
            }
        }

        .grammar-card {
            background: var(--dark-surface);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .grammar-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }

        .grammar-card.direct {
            border-color: var(--direct-blue);
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), transparent);
        }

        .grammar-card.indirect {
            border-color: var(--indirect-purple);
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), transparent);
        }

        .grammar-card.active {
            border-color: var(--active-green);
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), transparent);
        }

        .grammar-card.passive {
            border-color: var(--passive-orange);
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), transparent);
        }

        .grammar-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .grammar-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .grammar-card.direct .grammar-title {
            color: var(--direct-blue);
        }

        .grammar-card.indirect .grammar-title {
            color: var(--indirect-purple);
        }

        .grammar-card.active .grammar-title {
            color: var(--active-green);
        }

        .grammar-card.passive .grammar-title {
            color: var(--passive-orange);
        }

        .grammar-description {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.6;
            flex-grow: 1;
        }

        .grammar-features {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--dark-border);
        }

        .grammar-features h4 {
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-list {
            list-style-type: none;
        }

        .feature-list li {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 6px;
            padding-left: 20px;
            position: relative;
        }

        .feature-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
        }

        .grammar-card.direct .feature-list li:before {
            color: var(--direct-blue);
        }

        .grammar-card.indirect .feature-list li:before {
            color: var(--indirect-purple);
        }

        .grammar-card.active .feature-list li:before {
            color: var(--active-green);
        }

        .grammar-card.passive .feature-list li:before {
            color: var(--passive-orange);
        }

        /* Buttons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--direct-blue);
            color: white;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .btn-primary:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(33, 150, 243, 0.4);
        }

        .btn-secondary {
            background: var(--indirect-purple);
            color: white;
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
        }

        .btn-secondary:hover {
            background: #7B1FA2;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(156, 39, 176, 0.4);
        }

        .btn-success {
            background: var(--active-green);
            color: white;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-success:hover {
            background: #388E3C;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
        }

        .btn-warning {
            background: var(--passive-orange);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }

        .btn-warning:hover {
            background: #F57C00;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 152, 0, 0.4);
        }

        .btn-teal {
            background: var(--transformation-teal);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 150, 136, 0.3);
        }

        .btn-teal:hover {
            background: #00796B;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 150, 136, 0.4);
        }

        .btn-danger {
            background: var(--error-red);
            color: white;
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }

        .btn-danger:hover {
            background: #D32F2F;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(244, 67, 54, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--direct-blue);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Practice Page */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 20px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-bar {
            height: 8px;
            background: var(--dark-surface);
            border-radius: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--direct-blue), var(--indirect-purple), var(--active-green), var(--passive-orange));
            border-radius: 8px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
        }

        .question-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .grammar-tip {
            background: rgba(255, 193, 7, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--passive-orange);
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Options */
        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 20px 0;
        }

        .option {
            padding: 15px;
            background: var(--dark-card);
            border: 2px solid var(--dark-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--direct-blue);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--active-green);
            color: var(--active-green);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: var(--error-red);
            color: var(--error-red);
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 25px;
            height: 25px;
            background: var(--transformation-teal);
            border-radius: 50%;
            margin-right: 12px;
            font-weight: bold;
            color: white;
        }

        .option.correct .option-letter {
            background: var(--active-green);
        }

        .option.incorrect .option-letter {
            background: var(--error-red);
        }

        /* Feedback */
        .feedback-container {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .feedback-correct {
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid var(--active-green);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid var(--error-red);
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--active-green);
        }

        .feedback-incorrect .feedback-icon {
            background: var(--error-red);
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .feedback-correct .feedback-title {
            color: var(--active-green);
        }

        .feedback-incorrect .feedback-title {
            color: var(--error-red);
        }

        .feedback-explanation {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Navigation */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        /* Visualization Side */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 20px 0;
        }

        @media (max-width: 992px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .visualization-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--dark-border);
            overflow: auto;
            max-height: 800px;
        }

        /* Grammar Visualizers */
        .grammar-visualizer {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid;
        }

        .direct-visualizer {
            border-color: var(--direct-blue);
        }

        .indirect-visualizer {
            border-color: var(--indirect-purple);
        }

        .active-visualizer {
            border-color: var(--active-green);
        }

        .passive-visualizer {
            border-color: var(--passive-orange);
        }

        .visualizer-title {
            color: inherit;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .sentence-example {
            background: var(--dark-surface);
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .direct-example {
            border-left: 3px solid var(--direct-blue);
        }

        .indirect-example {
            border-left: 3px solid var(--indirect-purple);
        }

        .active-example {
            border-left: 3px solid var(--active-green);
        }

        .passive-example {
            border-left: 3px solid var(--passive-orange);
        }

        .highlight-word {
            background: rgba(255, 193, 7, 0.3);
            padding: 2px 4px;
            border-radius: 3px;
            cursor: pointer;
        }

        /* Comparison Tables */
        .comparison-section {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--transformation-teal);
        }

        .comparison-tables {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .comparison-tables {
                grid-template-columns: 1fr;
            }
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--dark-surface);
            border-radius: 6px;
            overflow: hidden;
        }

        .comparison-table th {
            background: var(--dark-card);
            padding: 12px;
            text-align: left;
            font-size: 0.9rem;
            border-bottom: 2px solid;
        }

        .direct-table th {
            color: var(--direct-blue);
            border-color: var(--direct-blue);
        }

        .indirect-table th {
            color: var(--indirect-purple);
            border-color: var(--indirect-purple);
        }

        .comparison-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--dark-border);
            color: var(--text-primary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .comparison-table td:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Transformation Rules */
        .rules-section {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--error-red);
        }

        .rules-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .rules-grid {
                grid-template-columns: 1fr;
            }
        }

        .rule-card {
            background: var(--dark-surface);
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            border: 1px solid var(--dark-border);
        }

        .rule-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .rule-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .rule-text {
            font-size: 0.9rem;
            font-weight: bold;
            line-height: 1.4;
        }

        /* Sentence Transformation */
        .transformation-section {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--transformation-teal);
        }

        .sentence-display {
            background: var(--dark-surface);
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1rem;
            line-height: 1.6;
            border: 2px dashed var(--dark-border);
        }

        /* Interactive Editor */
        .editor-section {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--direct-blue);
        }

        .text-editor {
            width: 100%;
            height: 150px;
            background: var(--dark-surface);
            border: 2px solid var(--dark-border);
            border-radius: 6px;
            padding: 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            line-height: 1.5;
            resize: vertical;
            margin: 10px 0;
        }

        .text-editor:focus {
            outline: none;
            border-color: var(--direct-blue);
        }

        .editor-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        /* Error Detection */
        .error-detection-section {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--error-red);
        }

        .error-text {
            background: var(--dark-surface);
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-size: 0.95rem;
            line-height: 1.6;
            position: relative;
        }

        .error-highlight {
            background: rgba(244, 67, 54, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
            cursor: pointer;
        }

        /* Classification */
        .classification-section {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--transformation-teal);
        }

        .classification-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .classification-items {
                grid-template-columns: 1fr;
            }
        }

        .classification-item {
            padding: 10px;
            background: var(--dark-surface);
            border: 2px dashed var(--dark-border);
            border-radius: 6px;
            text-align: center;
            cursor: grab;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .classification-item:hover {
            border-color: var(--transformation-teal);
        }

        .classification-zones {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .classification-zones {
                grid-template-columns: 1fr;
            }
        }

        .classification-zone {
            padding: 15px;
            border: 2px dashed var(--dark-border);
            border-radius: 8px;
            min-height: 100px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .classification-zone.active {
            border-color: var(--active-green);
            background: rgba(76, 175, 80, 0.1);
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 30px 20px;
        }

        .results-title {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--direct-blue), var(--indirect-purple), var(--active-green), var(--passive-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            margin: 0 auto 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--direct-blue), var(--indirect-purple), var(--active-green), var(--passive-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .score-percentage {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-value.direct {
            color: var(--direct-blue);
        }

        .stat-value.indirect {
            color: var(--indirect-purple);
        }

        .stat-value.active {
            color: var(--active-green);
        }

        .stat-value.passive {
            color: var(--passive-orange);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 0.5s ease;
        }

        @keyframes highlight {
            0% { background-color: transparent; }
            50% { background-color: rgba(33, 150, 243, 0.2); }
            100% { background-color: transparent; }
        }

        .highlight {
            animation: highlight 1s ease;
        }

        /* Quotation Marks */
        .quotation {
            color: var(--direct-blue);
            font-weight: bold;
        }

        /* Tense Indicators */
        .tense-indicator {
            display: inline-block;
            background: rgba(156, 39, 176, 0.2);
            color: var(--indirect-purple);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin: 0 5px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 1.8rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons .btn {
                width: 100%;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card fade-in" id="welcomePage">
            <h1 class="welcome-title">Grade 8 English: Direct/Indirect Speech & Active/Passive Voice</h1>
            <p class="welcome-subtitle">Master the art of speech transformation and voice conversion! Learn to convert between direct and indirect speech, and transform sentences between active and passive voice.</p>
            
            <div class="topic-badge">
                <span class="topic-icon">üí¨‚ÜîÔ∏èüó£Ô∏è‚ÜïÔ∏è</span>
                <span class="topic-name">Reported Speech, Narration, Voice Transformation</span>
            </div>
            
            <div class="grammar-grid">
                <div class="grammar-card direct" onclick="showGrammarDetail('direct')">
                    <div class="grammar-icon">üí¨</div>
                    <h3 class="grammar-title">Direct Speech</h3>
                    <p class="grammar-description">Quoting the exact words spoken, using quotation marks. Preserves original wording, punctuation, and speaker's exact expression.</p>
                    <div class="grammar-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Uses quotation marks</li>
                            <li>Exact words of speaker</li>
                            <li>Reporting verb + comma</li>
                            <li>Original punctuation</li>
                            <li>First person pronouns</li>
                            <li>Present tense verbs</li>
                        </ul>
                    </div>
                </div>
                
                <div class="grammar-card indirect" onclick="showGrammarDetail('indirect')">
                    <div class="grammar-icon">‚ÜîÔ∏è</div>
                    <h3 class="grammar-title">Indirect Speech</h3>
                    <p class="grammar-description">Reporting what someone said without using exact words. Changes pronouns, tenses, and time expressions.</p>
                    <div class="grammar-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>No quotation marks</li>
                            <li>Reporting verb + that</li>
                            <li>Pronoun changes</li>
                            <li>Tense backshifting</li>
                            <li>Time expression changes</li>
                            <li>Third person perspective</li>
                        </ul>
                    </div>
                </div>

                <div class="grammar-card active" onclick="showGrammarDetail('active')">
                    <div class="grammar-icon">üó£Ô∏è</div>
                    <h3 class="grammar-title">Active Voice</h3>
                    <p class="grammar-description">The subject performs the action. Creates direct, clear sentences that emphasize who is doing the action.</p>
                    <div class="grammar-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Subject does action</li>
                            <li>Direct sentence structure</li>
                            <li>Emphasizes doer</li>
                            <li>Shorter sentences</li>
                            <li>More engaging</li>
                            <li>Clear responsibility</li>
                        </ul>
                    </div>
                </div>

                <div class="grammar-card passive" onclick="showGrammarDetail('passive')">
                    <div class="grammar-icon">‚ÜïÔ∏è</div>
                    <h3 class="grammar-title">Passive Voice</h3>
                    <p class="grammar-description">The subject receives the action. Used when the doer is unknown, unimportant, or when focusing on the action/result.</p>
                    <div class="grammar-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Subject receives action</li>
                            <li>Form of 'be' + past participle</li>
                            <li>Optional 'by' phrase</li>
                            <li>Emphasizes action/receiver</li>
                            <li>More formal tone</li>
                            <li>Object becomes subject</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your name:</label>
                <input type="text" id="studentName" placeholder="Your name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">
                    <span>üìö Begin Grammar Practice</span>
                </button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 80</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 1.25%"></div>
                </div>
            </div>

            <div class="question-container">
                <div id="grammarTip"></div>
                
                <h2 class="question-text" id="questionText"></h2>
                
                <div class="options-container" id="optionsContainer"></div>
                
                <div class="feedback-container" id="feedbackContainer">
                    <div class="feedback-header">
                        <div class="feedback-icon"></div>
                        <div class="feedback-title"></div>
                    </div>
                    <div class="feedback-explanation" id="feedbackExplanation"></div>
                </div>
            </div>
            
            <!-- Visualization Area -->
            <div class="content-wrapper">
                <div class="visualization-container">
                    <!-- Examples -->
                    <div class="grammar-visualizer direct-visualizer">
                        <div class="visualizer-title">Direct Speech Examples</div>
                        <div class="sentence-example direct-example">
                            Maria said, <span class="quotation">"I am studying for my exams."</span>
                        </div>
                        <div class="sentence-example direct-example">
                            John exclaimed, <span class="quotation">"What a beautiful day!"</span>
                        </div>
                        <div class="sentence-example direct-example">
                            The teacher asked, <span class="quotation">"Have you completed your homework?"</span>
                        </div>
                    </div>
                    
                    <div class="grammar-visualizer indirect-visualizer">
                        <div class="visualizer-title">Indirect Speech Examples</div>
                        <div class="sentence-example indirect-example">
                            Maria said <span class="tense-indicator">that she was</span> studying for her exams.
                        </div>
                        <div class="sentence-example indirect-example">
                            John exclaimed <span class="tense-indicator">that it was</span> a beautiful day.
                        </div>
                        <div class="sentence-example indirect-example">
                            The teacher asked <span class="tense-indicator">if we had</span> completed our homework.
                        </div>
                    </div>
                    
                    <div class="grammar-visualizer active-visualizer">
                        <div class="visualizer-title">Active Voice Examples</div>
                        <div class="sentence-example active-example">
                            <span class="highlight-word">The chef</span> prepared a delicious meal.
                        </div>
                        <div class="sentence-example active-example">
                            <span class="highlight-word">Scientists</span> discovered a new planet.
                        </div>
                        <div class="sentence-example active-example">
                            <span class="highlight-word">The storm</span> damaged several houses.
                        </div>
                    </div>
                    
                    <div class="grammar-visualizer passive-visualizer">
                        <div class="visualizer-title">Passive Voice Examples</div>
                        <div class="sentence-example passive-example">
                            A delicious meal <span class="highlight-word">was prepared</span> by the chef.
                        </div>
                        <div class="sentence-example passive-example">
                            A new planet <span class="highlight-word">was discovered</span> by scientists.
                        </div>
                        <div class="sentence-example passive-example">
                            Several houses <span class="highlight-word">were damaged</span> by the storm.
                        </div>
                    </div>
                    
                    <!-- Transformation Rules -->
                    <div class="rules-section">
                        <div class="visualizer-title">Transformation Rules</div>
                        <div class="rules-grid">
                            <div class="rule-card" onclick="showRuleDetail('pronoun_change')">
                                <div class="rule-label">Direct ‚Üí Indirect</div>
                                <div class="rule-text">Pronoun Changes</div>
                            </div>
                            <div class="rule-card" onclick="showRuleDetail('tense_shift')">
                                <div class="rule-label">Direct ‚Üí Indirect</div>
                                <div class="rule-text">Tense Backshifting</div>
                            </div>
                            <div class="rule-card" onclick="showRuleDetail('time_expressions')">
                                <div class="rule-label">Direct ‚Üí Indirect</div>
                                <div class="rule-text">Time Expressions</div>
                            </div>
                            <div class="rule-card" onclick="showRuleDetail('active_passive')">
                                <div class="rule-label">Active ‚Üí Passive</div>
                                <div class="rule-text">Sentence Structure</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Comparison Tables -->
                    <div class="comparison-section">
                        <div class="visualizer-title">Direct vs Indirect Speech</div>
                        <div class="comparison-tables">
                            <table class="comparison-table direct-table">
                                <thead>
                                    <tr>
                                        <th colspan="2">Direct Speech</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr onclick="showComparisonDetail('direct_quotes')">
                                        <td>Quotation Marks</td>
                                        <td>Always used</td>
                                    </tr>
                                    <tr onclick="showComparisonDetail('direct_pronouns')">
                                        <td>Pronouns</td>
                                        <td>Original (I, we, you)</td>
                                    </tr>
                                    <tr onclick="showComparisonDetail('direct_tenses')">
                                        <td>Tenses</td>
                                        <td>Original tenses</td>
                                    </tr>
                                    <tr onclick="showComparisonDetail('direct_time')">
                                        <td>Time Words</td>
                                        <td>Now, today, tomorrow</td>
                                    </tr>
                                    <tr onclick="showComparisonDetail('direct_punctuation')">
                                        <td>Punctuation</td>
                                        <td>Comma before quote</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <table class="comparison-table indirect-table">
                                <thead>
                                    <tr>
                                        <th colspan="2">Indirect Speech</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr onclick="showComparisonDetail('indirect_quotes')">
                                        <td>Quotation Marks</td>
                                        <td>Never used</td>
                                    </tr>
                                    <tr onclick="showComparisonDetail('indirect_pronouns')">
                                        <td>Pronouns</td>
                                        <td>Changed (he, she, they)</td>
                                    </tr>
                                    <tr onclick="showComparisonDetail('indirect_tenses')">
                                        <td>Tenses</td>
                                        <td>Backshifted</td>
                                    </tr>
                                    <tr onclick="showComparisonDetail('indirect_time')">
                                        <td>Time Words</td>
                                        <td>Then, that day, next day</td>
                                    </tr>
                                    <tr onclick="showComparisonDetail('indirect_conj')">
                                        <td>Conjunctions</td>
                                        <td>That, if, whether</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Tense Transformation Practice -->
                    <div class="transformation-section">
                        <div class="visualizer-title">Tense Transformation Practice</div>
                        <div id="transformationInstruction" style="margin-bottom: 10px; color: var(--text-secondary); text-align: center;">
                            Convert between direct and indirect speech
                        </div>
                        
                        <div class="sentence-display" id="originalSentence">
                            She said, "I am reading a book."
                        </div>
                        
                        <div class="editor-controls">
                            <button class="btn btn-small btn-primary" onclick="convertToIndirect()">To Indirect</button>
                            <button class="btn btn-small btn-secondary" onclick="convertToDirect()">To Direct</button>
                            <button class="btn btn-small btn-teal" onclick="showTransformationSteps()">Show Steps</button>
                            <button class="btn btn-small btn-warning" onclick="newTransformationExample()">New Example</button>
                        </div>
                        
                        <div class="sentence-display" id="transformedSentence">
                            Transformed sentence appears here
                        </div>
                    </div>
                    
                    <!-- Voice Transformation Practice -->
                    <div class="transformation-section" style="border-color: var(--active-green);">
                        <div class="visualizer-title">Voice Transformation Practice</div>
                        <div id="voiceInstruction" style="margin-bottom: 10px; color: var(--text-secondary); text-align: center;">
                            Convert between active and passive voice
                        </div>
                        
                        <div class="sentence-display" id="originalVoice">
                            The committee approved the proposal.
                        </div>
                        
                        <div class="editor-controls">
                            <button class="btn btn-small btn-success" onclick="convertToPassive()">To Passive</button>
                            <button class="btn btn-small btn-warning" onclick="convertToActive()">To Active</button>
                            <button class="btn btn-small btn-teal" onclick="showVoiceSteps()">Show Steps</button>
                            <button class="btn btn-small btn-secondary" onclick="newVoiceExample()">New Example</button>
                        </div>
                        
                        <div class="sentence-display" id="transformedVoice">
                            Voice transformation appears here
                        </div>
                    </div>
                    
                    <!-- Interactive Editor -->
                    <div class="editor-section">
                        <div class="visualizer-title">Practice Transformation</div>
                        <textarea class="text-editor" id="sentenceEditor" placeholder="Type a sentence to transform..."></textarea>
                        
                        <div class="editor-controls">
                            <button class="btn btn-small btn-primary" onclick="analyzeSentence()">Analyze</button>
                            <button class="btn btn-small btn-secondary" onclick="transformDirectIndirect()">Direct‚ÜîIndirect</button>
                            <button class="btn btn-small btn-success" onclick="transformActivePassive()">Active‚ÜîPassive</button>
                            <button class="btn btn-small btn-danger" onclick="clearEditor()">Clear</button>
                        </div>
                        
                        <div id="editorFeedback" style="margin-top: 10px; color: var(--text-secondary); font-size: 0.9rem; text-align: center;">
                            Type a sentence and transform it
                        </div>
                    </div>
                    
                    <!-- Error Detection -->
                    <div class="error-detection-section">
                        <div class="visualizer-title">Common Transformation Errors</div>
                        <div class="error-text" id="errorText">
                            She said that <span class="error-highlight" onclick="explainError('tense_error')">I am</span> going to the market yesterday. He said that <span class="error-highlight" onclick="explainError('pronoun_error')">you should</span> finish your work. The book <span class="error-highlight" onclick="explainError('passive_error')">was wrote</span> by the author.
                        </div>
                        
                        <div class="editor-controls">
                            <button class="btn btn-small btn-warning" onclick="newErrorExample()">New Example</button>
                            <button class="btn btn-small btn-success" onclick="showCorrectedVersion()">Show Correction</button>
                            <button class="btn btn-small btn-primary" onclick="highlightErrors()">Find Errors</button>
                        </div>
                        
                        <div id="errorExplanation" style="margin-top: 10px; color: var(--text-secondary); font-size: 0.9rem;">
                            Click highlighted errors for explanations
                        </div>
                    </div>
                    
                    <!-- Sentence Classification -->
                    <div class="classification-section">
                        <div class="visualizer-title">Sentence Type Classification</div>
                        <div id="classificationInstruction" style="margin-bottom: 10px; color: var(--text-primary); text-align: center;">
                            Drag sentences to correct category:
                        </div>
                        
                        <div class="classification-items" id="classificationItems">
                            <!-- Items will be populated by JavaScript -->
                        </div>
                        
                        <div class="classification-zones">
                            <div class="classification-zone" id="zoneDirect" ondrop="drop(event)" ondragover="allowDrop(event)">
                                <div style="color: var(--direct-blue); font-weight: bold;">Direct Speech</div>
                            </div>
                            <div class="classification-zone" id="zoneIndirect" ondrop="drop(event)" ondragover="allowDrop(event)">
                                <div style="color: var(--indirect-purple); font-weight: bold;">Indirect Speech</div>
                            </div>
                            <div class="classification-zone" id="zoneActive" ondrop="drop(event)" ondragover="allowDrop(event)">
                                <div style="color: var(--active-green); font-weight: bold;">Active Voice</div>
                            </div>
                            <div class="classification-zone" id="zonePassive" ondrop="drop(event)" ondragover="allowDrop(event)">
                                <div style="color: var(--passive-orange); font-weight: bold;">Passive Voice</div>
                            </div>
                        </div>
                        
                        <div id="classificationFeedback" style="margin-top: 10px; color: var(--text-secondary); text-align: center; font-size: 0.9rem;"></div>
                        
                        <div class="editor-controls">
                            <button class="btn btn-small btn-secondary" onclick="newClassificationChallenge()">New Challenge</button>
                            <button class="btn btn-small btn-success" onclick="checkClassification()">Check Answers</button>
                            <button class="btn btn-small btn-warning" onclick="resetClassification()">Reset</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="btn btn-secondary" id="skipQuestion">Skip Question</button>
                <button class="btn btn-primary" id="nextQuestion" disabled>Next Question</button>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Grammar Practice Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                <div class="score-message" id="scoreMessage"></div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value direct" id="directScore">0</div>
                        <div class="stat-label">Direct Speech Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value indirect" id="indirectScore">0</div>
                        <div class="stat-label">Indirect Speech Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value active" id="activeScore">0</div>
                        <div class="stat-label">Active Voice Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value passive" id="passiveScore">0</div>
                        <div class="stat-label">Passive Voice Questions</div>
                    </div>
                </div>
                
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-primary" id="retryTopic">Try Again</button>
                    <button class="btn btn-secondary" id="viewTopics">Other Topics</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Comprehensive questions array - 80+ questions
        const questions = [
            // Direct vs Indirect Speech Identification (1-20)
            {
                question: "Which sentence is in direct speech?",
                options: ['Maria said, "I am going to the market."', "Maria said that she was going to the market.", "Maria told me about going to the market.", "According to Maria, she went to the market."],
                answer: "A",
                explanation: "Direct speech uses quotation marks and reports the exact words spoken: 'I am going to the market.'",
                type: "direct"
            },
            {
                question: "Which sentence is in indirect speech?",
                options: ["He said that he would come tomorrow.", 'He said, "I will come tomorrow."', "He announced his arrival tomorrow.", '"I will come tomorrow," he said.'],
                answer: "A",
                explanation: "Indirect speech reports what someone said without quotation marks and changes pronouns/tenses: 'he would come tomorrow.'",
                type: "indirect"
            },
            {
                question: "What punctuation is used in direct speech?",
                options: ["Quotation marks", "Parentheses", "Brackets", "Italics only"],
                answer: "A",
                explanation: "Direct speech always uses quotation marks to indicate the exact words spoken.",
                type: "direct"
            },
            {
                question: "Which word often introduces indirect speech?",
                options: ["That", "Quote", "Said", "Exclaimed"],
                answer: "A",
                explanation: "Indirect speech often uses 'that' after the reporting verb (though it can be omitted).",
                type: "indirect"
            },
            {
                question: "What changes in pronouns when converting direct to indirect speech?",
                options: ["First person becomes third person", "Third person becomes first person", "All pronouns remain the same", "Pronouns become reflexive"],
                answer: "A",
                explanation: "First person pronouns (I, we, my, our) change to third person (he, she, they, his, her, their) in indirect speech.",
                type: "indirect"
            },
            {
                question: "Which is direct speech? 'I love this song,' she said.",
                options: ["Yes, it uses quotation marks", "No, it doesn't have 'that'", "No, pronouns aren't changed", "Yes, but it should be past tense"],
                answer: "A",
                explanation: "This is direct speech because it uses quotation marks for exact words, even though 'she said' comes after.",
                type: "direct"
            },
            {
                question: "What happens to tenses in indirect speech?",
                options: ["They usually shift back (present‚Üípast)", "They become future tense", "They remain exactly the same", "They become present perfect"],
                answer: "A",
                explanation: "Tenses in indirect speech usually shift back (backshift): present becomes past, past becomes past perfect.",
                type: "indirect"
            },
            {
                question: "Which time expression changes in indirect speech?",
                options: ["Today ‚Üí that day", "Yesterday ‚Üí tomorrow", "Now ‚Üí never", "Here ‚Üí nowhere"],
                answer: "A",
                explanation: "'Today' becomes 'that day' in indirect speech when reporting something said on a different day.",
                type: "indirect"
            },
            {
                question: "How are questions changed to indirect speech?",
                options: ["Word order becomes statement order", "Add more question marks", "Keep exact question words", "Use quotation marks"],
                answer: "A",
                explanation: "Questions in indirect speech use statement word order (subject before verb), not question word order.",
                type: "indirect"
            },
            {
                question: "What punctuation follows the reporting verb in direct speech?",
                options: ["A comma", "A colon", "A semicolon", "No punctuation"],
                answer: "A",
                explanation: "In direct speech, a comma typically follows the reporting verb before the quotation.",
                type: "direct"
            },
            {
                question: "Which reporting verb is commonly used for questions in indirect speech?",
                options: ["Asked", "Said", "Told", "Exclaimed"],
                answer: "A",
                explanation: "'Asked' is commonly used to report questions in indirect speech.",
                type: "indirect"
            },
            {
                question: "What happens to imperatives in indirect speech?",
                options: ["Use 'to' + infinitive", "Keep the command form", "Add 'please'", "Use quotation marks"],
                answer: "A",
                explanation: "Imperatives (commands) in indirect speech typically use 'to' + infinitive: 'He told me to wait.'",
                type: "indirect"
            },
            {
                question: "Which sentence shows correct direct speech?",
                options: ['John said, "I need help."', "John said that I need help.", 'John said "I need help."', "John said, I need help."],
                answer: "A",
                explanation: "Correct direct speech uses: comma after reporting verb, opening quotation marks, capital letter for first word of quote, closing quotation marks.",
                type: "direct"
            },
            {
                question: "What changes 'here' to in indirect speech?",
                options: ["There", "Where", "Somewhere", "Nowhere"],
                answer: "A",
                explanation: "The adverb 'here' typically changes to 'there' in indirect speech when location changes.",
                type: "indirect"
            },
            {
                question: "Which is NOT a feature of direct speech?",
                options: ["Pronoun changes", "Quotation marks", "Exact words", "Original punctuation"],
                answer: "A",
                explanation: "Pronoun changes occur in indirect speech, not direct speech which preserves original pronouns.",
                type: "direct"
            },
            {
                question: "How do you report 'yes/no' questions in indirect speech?",
                options: ["Use 'if' or 'whether'", "Keep the question mark", "Use 'that'", "Add 'or not'"],
                answer: "A",
                explanation: "Yes/no questions in indirect speech use 'if' or 'whether' to introduce the reported question.",
                type: "indirect"
            },
            {
                question: "What happens to exclamations in indirect speech?",
                options: ["Become statements with 'that'", "Keep exclamation marks", "Add more emotion", "Use quotation marks"],
                answer: "A",
                explanation: "Exclamations become statements in indirect speech, often introduced by 'that' with an appropriate reporting verb.",
                type: "indirect"
            },
            {
                question: "Which tense does NOT backshift in indirect speech?",
                options: ["Past perfect", "Present simple", "Present continuous", "Present perfect"],
                answer: "A",
                explanation: "Past perfect doesn't backshift because there's no further past tense to shift to.",
                type: "indirect"
            },
            {
                question: "What changes 'tomorrow' to in indirect speech?",
                options: ["The next day", "Yesterday", "Today", "Soon"],
                answer: "A",
                explanation: "'Tomorrow' becomes 'the next day' or 'the following day' in indirect speech.",
                type: "indirect"
            },
            {
                question: "Which punctuation ends a direct speech sentence?",
                options: ["Inside quotation marks", "Outside quotation marks", "Before quotation marks", "No punctuation needed"],
                answer: "A",
                explanation: "End punctuation (period, question mark, exclamation) goes inside the closing quotation marks in direct speech.",
                type: "direct"
            },

            // Active vs Passive Voice Identification (21-40)
            {
                question: "Which sentence is in active voice?",
                options: ["The cat chased the mouse.", "The mouse was chased by the cat.", "The mouse got chased by the cat.", "Chasing occurred by the cat of the mouse."],
                answer: "A",
                explanation: "Active voice: subject (cat) performs the action (chased) on the object (mouse).",
                type: "active"
            },
            {
                question: "Which sentence is in passive voice?",
                options: ["The letter was written by Sarah.", "Sarah wrote the letter.", "Writing the letter was done by Sarah.", "Sarah did write the letter."],
                answer: "A",
                explanation: "Passive voice: subject (letter) receives the action, uses 'was written' (be + past participle).",
                type: "passive"
            },
            {
                question: "What is the structure of passive voice?",
                options: ["Form of 'be' + past participle", "Subject + verb + object", "Do/does + base verb", "Have/has + past participle"],
                answer: "A",
                explanation: "Passive voice uses a form of 'be' (am, is, are, was, were, be, being, been) + past participle of the main verb.",
                type: "passive"
            },
            {
                question: "What does active voice emphasize?",
                options: ["Who performs the action", "The action itself", "The result of the action", "When action occurred"],
                answer: "A",
                explanation: "Active voice emphasizes the doer of the action (the subject).",
                type: "active"
            },
            {
                question: "When is passive voice commonly used?",
                options: ["When the doer is unknown or unimportant", "To make sentences shorter", "To emphasize the doer", "In casual conversation"],
                answer: "A",
                explanation: "Passive voice is used when who performed the action is unknown, unimportant, or obvious from context.",
                type: "passive"
            },
            {
                question: "Which sentence is passive? 'The window was broken.'",
                options: ["Yes, it's passive (doer not mentioned)", "No, it doesn't have 'by' phrase", "No, it's active voice", "Yes, but incomplete"],
                answer: "A",
                explanation: "This is passive voice: 'was broken' (be + past participle). The 'by' phrase is optional in passive voice.",
                type: "passive"
            },
            {
                question: "What changes when converting active to passive?",
                options: ["Object becomes subject", "Subject becomes verb", "Verb becomes noun", "Tense changes"],
                answer: "A",
                explanation: "In active‚Üípassive transformation, the object of the active sentence becomes the subject of the passive sentence.",
                type: "passive"
            },
            {
                question: "Which is NOT a reason to use passive voice?",
                options: ["To emphasize who did the action", "When the doer is unknown", "In scientific writing", "To be more formal"],
                answer: "A",
                explanation: "Passive voice de-emphasizes the doer; use active voice to emphasize who performed the action.",
                type: "passive"
            },
            {
                question: "What is the 'by' phrase in passive voice?",
                options: ["Shows who performed the action", "Indicates when action happened", "Shows location of action", "Indicates reason for action"],
                answer: "A",
                explanation: "The optional 'by' phrase in passive voice indicates who or what performed the action.",
                type: "passive"
            },
            {
                question: "Which tense is 'is being built'?",
                options: ["Present continuous passive", "Present perfect active", "Past simple passive", "Future active"],
                answer: "A",
                explanation: "'Is being built' = present continuous passive (be + being + past participle).",
                type: "passive"
            },
            {
                question: "Why is active voice generally preferred?",
                options: ["More direct and concise", "More formal sounding", "Longer sentences", "Hides the doer"],
                answer: "A",
                explanation: "Active voice is usually more direct, concise, and clear than passive voice.",
                type: "active"
            },
            {
                question: "Which sentence has no passive equivalent?",
                options: ["She has a car.", "She drives a car.", "She bought a car.", "She sold a car."],
                answer: "A",
                explanation: "Intransitive verbs (like 'have') don't take objects, so they can't be made passive.",
                type: "active"
            },
            {
                question: "What is 'will be completed'?",
                options: ["Future simple passive", "Present perfect passive", "Future perfect active", "Conditional passive"],
                answer: "A",
                explanation: "'Will be completed' = future simple passive (will + be + past participle).",
                type: "passive"
            },
            {
                question: "When should you avoid passive voice?",
                options: ["When you want to emphasize responsibility", "In laboratory reports", "When the doer is unknown", "In formal announcements"],
                answer: "A",
                explanation: "Avoid passive voice when you need to clearly indicate who is responsible for an action.",
                type: "passive"
            },
            {
                question: "Which is correct passive voice?",
                options: ["The book was written by the author.", "The book written by the author.", "The book was wrote by the author.", "The book is wrote by author."],
                answer: "A",
                explanation: "Correct passive: 'was written' (past simple passive with correct past participle 'written').",
                type: "passive"
            },
            {
                question: "What is the passive form of 'They are building a house.'?",
                options: ["A house is being built.", "A house is built.", "A house was being built.", "A house has been built."],
                answer: "A",
                explanation: "Present continuous active ‚Üí present continuous passive: 'are building' ‚Üí 'is being built'.",
                type: "passive"
            },
            {
                question: "Which voice is more common in scientific writing?",
                options: ["Passive voice", "Active voice", "Both equally", "Neither is used"],
                answer: "A",
                explanation: "Scientific writing traditionally uses passive voice to focus on the research rather than the researchers.",
                type: "passive"
            },
            {
                question: "What is 'had been finished'?",
                options: ["Past perfect passive", "Present perfect passive", "Past continuous passive", "Future perfect passive"],
                answer: "A",
                explanation: "'Had been finished' = past perfect passive (had + been + past participle).",
                type: "passive"
            },
            {
                question: "Which cannot be made passive?",
                options: ["Intransitive verbs", "Transitive verbs", "Action verbs", "Regular verbs"],
                answer: "A",
                explanation: "Intransitive verbs (no object) cannot be made passive; only transitive verbs (with objects) can be passive.",
                type: "active"
            },
            {
                question: "What is the main difference between active and passive?",
                options: ["Focus on doer vs. receiver", "Tense used", "Sentence length", "Word order"],
                answer: "A",
                explanation: "Active focuses on who does the action; passive focuses on what receives the action.",
                type: "active"
            },

            // Transformation Rules (41-60)
            {
                question: "How does present simple change in indirect speech?",
                options: ["Present simple ‚Üí past simple", "Present simple ‚Üí present perfect", "Present simple ‚Üí future simple", "Present simple remains same"],
                answer: "A",
                explanation: "Present simple usually changes to past simple in indirect speech: 'I like' ‚Üí 'he said he liked'.",
                type: "indirect"
            },
            {
                question: "What happens to modal verbs in indirect speech?",
                options: ["Will ‚Üí would, can ‚Üí could", "Will ‚Üí will, can ‚Üí can", "Will ‚Üí shall, can ‚Üí may", "Modal verbs disappear"],
                answer: "A",
                explanation: "Modal verbs often change: will‚Üíwould, can‚Üícould, may‚Üímight, shall‚Üíshould (though some can remain).",
                type: "indirect"
            },
            {
                question: "How is present perfect changed in indirect speech?",
                options: ["Present perfect ‚Üí past perfect", "Present perfect ‚Üí present simple", "Present perfect ‚Üí past simple", "Present perfect remains"],
                answer: "A",
                explanation: "Present perfect usually changes to past perfect in indirect speech: 'I have finished' ‚Üí 'he said he had finished'.",
                type: "indirect"
            },
            {
                question: "What changes in active‚Üípassive for present simple?",
                options: ["Active: writes ‚Üí Passive: is written", "Active: writes ‚Üí Passive: was written", "Active: writes ‚Üí Passive: has written", "Active: writes ‚Üí Passive: will write"],
                answer: "A",
                explanation: "Present simple active 'writes' becomes present simple passive 'is written'.",
                type: "passive"
            },
            {
                question: "How does 'this' change in indirect speech?",
                options: ["This ‚Üí that", "This ‚Üí these", "This ‚Üí the", "This ‚Üí it"],
                answer: "A",
                explanation: "'This' (near reference) usually becomes 'that' (distant reference) in indirect speech.",
                type: "indirect"
            },
            {
                question: "What is the passive of 'Someone stole my wallet.'?",
                options: ["My wallet was stolen.", "My wallet stole.", "My wallet has stolen.", "My wallet is stolen."],
                answer: "A",
                explanation: "Active with indefinite subject 'someone' becomes passive without 'by' phrase: 'My wallet was stolen.'",
                type: "passive"
            },
            {
                question: "How does past simple change in indirect speech?",
                options: ["Past simple ‚Üí past perfect", "Past simple ‚Üí present perfect", "Past simple remains past simple", "Past simple ‚Üí would + base"],
                answer: "A",
                explanation: "Past simple usually changes to past perfect in indirect speech, though it can sometimes remain past simple.",
                type: "indirect"
            },
            {
                question: "What is the passive of 'They have completed the project.'?",
                options: ["The project has been completed.", "The project was completed.", "The project is completed.", "The project had been completed."],
                answer: "A",
                explanation: "Present perfect active 'have completed' ‚Üí present perfect passive 'has been completed'.",
                type: "passive"
            },
            {
                question: "How do you report commands in indirect speech?",
                options: ["Use 'told/asked + to + infinitive'", "Use 'said + that'", "Keep imperative form", "Add 'please' and quote"],
                answer: "A",
                explanation: "Commands in indirect speech: 'He told me to wait.' or 'She asked him to be quiet.'",
                type: "indirect"
            },
            {
                question: "What is the passive of 'People speak English here.'?",
                options: ["English is spoken here.", "English was spoken here.", "English has been spoken here.", "English speaks here."],
                answer: "A",
                explanation: "General statements often use passive without 'by' phrase: 'English is spoken here.'",
                type: "passive"
            },
            {
                question: "How does 'now' change in indirect speech?",
                options: ["Now ‚Üí then", "Now ‚Üí at that time", "Now ‚Üí immediately", "All of the above"],
                answer: "D",
                explanation: "'Now' can become 'then,' 'at that time,' 'at the moment,' etc. depending on context.",
                type: "indirect"
            },
            {
                question: "What is the passive of 'The storm damaged the roof.'?",
                options: ["The roof was damaged by the storm.", "The roof damaged by the storm.", "The roof has damaged by storm.", "Damaged was the roof by storm."],
                answer: "A",
                explanation: "Past simple active ‚Üí past simple passive: 'damaged' ‚Üí 'was damaged', with optional 'by the storm'.",
                type: "passive"
            },
            {
                question: "How are 'yes/no' questions reported?",
                options: ["Use 'asked if/whether'", "Use 'said that'", "Keep question word order", "Add question marks"],
                answer: "A",
                explanation: "Yes/no questions in indirect speech: 'She asked if/whether I was coming.'",
                type: "indirect"
            },
            {
                question: "What is the passive of 'They will announce the results tomorrow.'?",
                options: ["The results will be announced tomorrow.", "The results are announced tomorrow.", "The results were announced tomorrow.", "The results have been announced tomorrow."],
                answer: "A",
                explanation: "Future simple active ‚Üí future simple passive: 'will announce' ‚Üí 'will be announced'.",
                type: "passive"
            },
            {
                question: "How does 'today' change in indirect speech?",
                options: ["Today ‚Üí that day", "Today ‚Üí yesterday", "Today ‚Üí the day", "Today ‚Üí this day"],
                answer: "A",
                explanation: "When reporting on a different day, 'today' becomes 'that day' in indirect speech.",
                type: "indirect"
            },
            {
                question: "What is the passive of 'Someone is cleaning the room.'?",
                options: ["The room is being cleaned.", "The room was being cleaned.", "The room has been cleaned.", "The room will be cleaned."],
                answer: "A",
                explanation: "Present continuous active ‚Üí present continuous passive: 'is cleaning' ‚Üí 'is being cleaned'.",
                type: "passive"
            },
            {
                question: "How are 'wh-' questions reported?",
                options: ["Keep question word, use statement order", "Remove question word", "Keep exact question", "Add 'that' after question word"],
                answer: "A",
                explanation: "Wh- questions keep the question word but use statement word order in indirect speech.",
                type: "indirect"
            },
            {
                question: "What is the passive of 'They had eaten all the cookies.'?",
                options: ["All the cookies had been eaten.", "All the cookies were eaten.", "All the cookies have been eaten.", "All the cookies are eaten."],
                answer: "A",
                explanation: "Past perfect active ‚Üí past perfect passive: 'had eaten' ‚Üí 'had been eaten'.",
                type: "passive"
            },
            {
                question: "How does 'yesterday' change in indirect speech?",
                options: ["Yesterday ‚Üí the day before", "Yesterday ‚Üí today", "Yesterday ‚Üí tomorrow", "Yesterday ‚Üí that day"],
                answer: "A",
                explanation: "'Yesterday' becomes 'the day before' or 'the previous day' in indirect speech.",
                type: "indirect"
            },
            {
                question: "What is the passive of 'You must complete this form.'?",
                options: ["This form must be completed.", "This form must completed.", "This form is must completed.", "This form has must completed."],
                answer: "A",
                explanation: "Modal verbs in passive: modal + be + past participle: 'must complete' ‚Üí 'must be completed'.",
                type: "passive"
            },

            // Application and Conversion (61-80)
            {
                question: "Convert to indirect: She said, 'I am reading a book.'",
                options: ["She said that she was reading a book.", "She said that she is reading a book.", "She said that she read a book.", "She said that she has been reading a book."],
                answer: "A",
                explanation: "Present continuous 'am reading' ‚Üí past continuous 'was reading'; pronoun 'I' ‚Üí 'she'.",
                type: "indirect"
            },
            {
                question: "Convert to passive: The dog bit the man.",
                options: ["The man was bitten by the dog.", "The man bit by the dog.", "The man has bitten by the dog.", "The man is bitten by the dog."],
                answer: "A",
                explanation: "Past simple active ‚Üí past simple passive: object 'the man' becomes subject; 'bit' ‚Üí 'was bitten'.",
                type: "passive"
            },
            {
                question: "Convert to direct: He said that he would come later.",
                options: ['He said, "I will come later."', 'He said, "I would come later."', 'He said, "He will come later."', 'He said, "Will I come later?"'],
                answer: "A",
                explanation: "Indirect 'he would come' ‚Üí direct 'I will come'; add quotation marks and change pronoun.",
                type: "direct"
            },
            {
                question: "Convert to active: The cake was baked by my mother.",
                options: ["My mother baked the cake.", "My mother bakes the cake.", "My mother has baked the cake.", "My mother is baking the cake."],
                answer: "A",
                explanation: "Passive subject 'the cake' becomes active object; 'by my mother' becomes subject; 'was baked' ‚Üí 'baked'.",
                type: "active"
            },
            {
                question: "Convert to indirect: 'What time does the store close?' she asked.",
                options: ["She asked what time the store closed.", "She asked what time does the store close.", "She asked what time the store closes.", "She asked what time the store did close."],
                answer: "A",
                explanation: "Wh- question keeps 'what time' but changes to statement order; present simple 'does close' ‚Üí past simple 'closed'.",
                type: "indirect"
            },
            {
                question: "Convert to passive: Someone will deliver the package tomorrow.",
                options: ["The package will be delivered tomorrow.", "The package is delivered tomorrow.", "The package was delivered tomorrow.", "The package has been delivered tomorrow."],
                answer: "A",
                explanation: "Future active 'will deliver' ‚Üí future passive 'will be delivered'; indefinite 'someone' omitted.",
                type: "passive"
            },
            {
                question: "Convert to direct: They told us to wait there.",
                options: ['They said, "Wait there."', 'They said, "You wait there."', 'They said, "We should wait there."', 'They said, "They wait there."'],
                answer: "A",
                explanation: "Indirect command 'told us to wait' ‚Üí direct imperative 'Wait there.' (addressing 'us' as 'you').",
                type: "direct"
            },
            {
                question: "Convert to active: The report is being reviewed by the committee.",
                options: ["The committee is reviewing the report.", "The committee reviews the report.", "The committee reviewed the report.", "The committee has reviewed the report."],
                answer: "A",
                explanation: "Present continuous passive 'is being reviewed' ‚Üí present continuous active 'is reviewing'.",
                type: "active"
            },
            {
                question: "Convert to indirect: 'Don't touch that!' he shouted.",
                options: ["He shouted not to touch that.", "He shouted that don't touch that.", "He shouted to not touch that.", "He shouted that I shouldn't touch that."],
                answer: "A",
                explanation: "Negative command in direct speech ‚Üí indirect using 'not to' + infinitive.",
                type: "indirect"
            },
            {
                question: "Convert to passive: People have used this method for centuries.",
                options: ["This method has been used for centuries.", "This method was used for centuries.", "This method is used for centuries.", "This method had been used for centuries."],
                answer: "A",
                explanation: "Present perfect active 'have used' ‚Üí present perfect passive 'has been used'; indefinite 'people' omitted.",
                type: "passive"
            },
            {
                question: "Convert to direct: She asked if I had seen her keys.",
                options: ['She asked, "Have you seen my keys?"', 'She asked, "Did you see my keys?"', 'She asked, "Do you see my keys?"', 'She asked, "Had you seen my keys?"'],
                answer: "A",
                explanation: "Indirect yes/no question 'if I had seen' ‚Üí direct present perfect question 'Have you seen'; pronouns change.",
                type: "direct"
            },
            {
                question: "Convert to active: The new policy will be implemented next month.",
                options: ["They will implement the new policy next month.", "They implement the new policy next month.", "They implemented the new policy next month.", "They have implemented the new policy next month."],
                answer: "A",
                explanation: "Future passive 'will be implemented' ‚Üí future active 'will implement'; add unspecified subject 'they'.",
                type: "active"
            },
            {
                question: "Convert to indirect: 'I can help you tomorrow,' he said.",
                options: ["He said he could help me the next day.", "He said he can help me tomorrow.", "He said he could help me tomorrow.", "He said he can help me the next day."],
                answer: "A",
                explanation: "Modal 'can' ‚Üí 'could'; pronoun 'I' ‚Üí 'he', 'you' ‚Üí 'me'; 'tomorrow' ‚Üí 'the next day'.",
                type: "indirect"
            },
            {
                question: "Convert to passive: The company is developing a new product.",
                options: ["A new product is being developed by the company.", "A new product was developed by the company.", "A new product has been developed by the company.", "A new product will be developed by the company."],
                answer: "A",
                explanation: "Present continuous active 'is developing' ‚Üí present continuous passive 'is being developed'.",
                type: "passive"
            },
            {
                question: "Convert to direct: He exclaimed that it was a wonderful surprise.",
                options: ['He exclaimed, "What a wonderful surprise!"', 'He said, "It is a wonderful surprise."', 'He said, "That was a wonderful surprise."', 'He said, "This is wonderful surprise."'],
                answer: "A",
                explanation: "Indirect exclamation ‚Üí direct exclamation with appropriate structure; past 'was' could remain past in direct.",
                type: "direct"
            },
            {
                question: "Convert to active: The decision has been made by the board.",
                options: ["The board has made the decision.", "The board made the decision.", "The board makes the decision.", "The board is making the decision."],
                answer: "A",
                explanation: "Present perfect passive 'has been made' ‚Üí present perfect active 'has made'.",
                type: "active"
            },
            {
                question: "Convert to indirect: 'Where do you live?' she asked me.",
                options: ["She asked me where I lived.", "She asked me where do I live.", "She asked me where I live.", "She asked me where did I live."],
                answer: "A",
                explanation: "Wh- question keeps 'where'; present simple 'do live' ‚Üí past simple 'lived'; pronoun 'you' ‚Üí 'I'.",
                type: "indirect"
            },
            {
                question: "Convert to passive: They were painting the house when I arrived.",
                options: ["The house was being painted when I arrived.", "The house was painted when I arrived.", "The house had been painted when I arrived.", "The house is being painted when I arrived."],
                answer: "A",
                explanation: "Past continuous active 'were painting' ‚Üí past continuous passive 'was being painted'.",
                type: "passive"
            },
            {
                question: "Convert to direct: She told him not to be late.",
                options: ['She said, "Don\'t be late."', 'She said, "You not be late."', 'She said, "Not to be late."', 'She said, "He shouldn\'t be late."'],
                answer: "A",
                explanation: "Indirect negative command 'told him not to be' ‚Üí direct negative imperative 'Don't be late.'",
                type: "direct"
            },
            {
                question: "Convert to active: The work must be finished by Friday.",
                options: ["You must finish the work by Friday.", "You finish the work by Friday.", "You finished the work by Friday.", "You are finishing the work by Friday."],
                answer: "A",
                explanation: "Modal passive 'must be finished' ‚Üí modal active 'must finish'; add appropriate subject 'you'.",
                type: "active"
            }
        ];

        // Additional questions beyond 80
        const additionalQuestions = [
            {
                question: "Which doesn't change in indirect speech when reporting universal truths?",
                options: ["Present simple tense", "Pronouns", "Time expressions", "Reporting verb"],
                answer: "A",
                explanation: "Universal truths (scientific facts, general truths) often keep present simple tense in indirect speech.",
                type: "indirect"
            },
            {
                question: "What is 'get' passive used for?",
                options: ["Unexpected or negative events", "Formal writing", "Scientific reports", "Historical facts"],
                answer: "A",
                explanation: "'Get' passive (got + past participle) often emphasizes unexpected or negative events: 'He got fired.'",
                type: "passive"
            },
            {
                question: "How to report 'Let's go' in indirect speech?",
                options: ["He suggested going/that we go", "He said to go", "He said let's go", "He told to go"],
                answer: "A",
                explanation: "Suggestions with 'let's' are reported with 'suggested' + gerund or 'suggested that' + clause.",
                type: "indirect"
            },
            {
                question: "Which voice is more appropriate for instructions?",
                options: ["Active voice (imperative)", "Passive voice", "Either works", "Neither is appropriate"],
                answer: "A",
                explanation: "Instructions and commands typically use active voice in imperative form for directness.",
                type: "active"
            }
        ];

        // Combine all questions
        const allQuestions = [...questions, ...additionalQuestions];

        // Grammar tips
        const grammarTips = [
            "Direct speech uses quotation marks; indirect speech doesn't.",
            "Active voice: subject does action. Passive voice: subject receives action.",
            "When converting direct to indirect speech: pronouns change, tenses backshift, time expressions change.",
            "Passive voice: form of 'be' + past participle. Optional 'by' phrase shows who did the action.",
            "Questions in indirect speech use statement word order (subject before verb).",
            "Use active voice for clarity and directness; use passive when doer is unknown/unimportant.",
            "Modal verbs in indirect speech: will‚Üíwould, can‚Üícould, may‚Üímight, shall‚Üíshould.",
            "Commands in indirect speech: use 'told/asked + to + infinitive'."
        ];

        // Classification items
        const classificationItems = [
            { name: 'She said, "I am tired."', type: "direct", color: "#2196F3" },
            { name: "He told me that he was busy.", type: "indirect", color: "#9C27B0" },
            { name: "The team won the championship.", type: "active", color: "#4CAF50" },
            { name: "The letter was written yesterday.", type: "passive", color: "#FF9800" },
            { name: '"What time is it?" he asked.', type: "direct", color: "#2196F3" },
            { name: "She asked if I had finished.", type: "indirect", color: "#9C27B0" },
            { name: "The chef prepares delicious meals.", type: "active", color: "#4CAF50" },
            { name: "The building was constructed in 1990.", type: "passive", color: "#FF9800" }
        ];

        // Transformation examples for practice
        const transformationExamples = [
            {
                direct: 'She said, "I am reading a book."',
                indirect: "She said that she was reading a book.",
                steps: [
                    "Remove quotation marks",
                    "Add 'that' (optional)",
                    "Change pronoun: I ‚Üí she",
                    "Change tense: am reading ‚Üí was reading",
                    "Remove comma after reporting verb"
                ]
            },
            {
                direct: 'He said, "I will come tomorrow."',
                indirect: "He said that he would come the next day.",
                steps: [
                    "Remove quotation marks",
                    "Add 'that'",
                    "Change pronoun: I ‚Üí he",
                    "Change modal: will ‚Üí would",
                    "Change time: tomorrow ‚Üí the next day"
                ]
            },
            {
                direct: 'They asked, "Where do you live?"',
                indirect: "They asked where I lived.",
                steps: [
                    "Remove quotation marks",
                    "Keep question word 'where'",
                    "Change pronoun: you ‚Üí I",
                    "Change to statement order: do you live ‚Üí I lived",
                    "Change tense: do live ‚Üí lived"
                ]
            }
        ];

        // Voice transformation examples
        const voiceExamples = [
            {
                active: "The committee approved the proposal.",
                passive: "The proposal was approved by the committee.",
                steps: [
                    "Object becomes subject: the proposal",
                    "Subject becomes optional 'by' phrase: by the committee",
                    "Change verb: approved ‚Üí was approved (past simple passive)",
                    "Adjust word order"
                ]
            },
            {
                active: "Someone has stolen my bicycle.",
                passive: "My bicycle has been stolen.",
                steps: [
                    "Object becomes subject: my bicycle",
                    "Omit indefinite subject 'someone'",
                    "Change verb: has stolen ‚Üí has been stolen (present perfect passive)",
                    "No 'by' phrase needed"
                ]
            },
            {
                active: "They are building a new hospital.",
                passive: "A new hospital is being built.",
                steps: [
                    "Object becomes subject: a new hospital",
                    "Omit subject 'they' (optional 'by them')",
                    "Change verb: are building ‚Üí is being built (present continuous passive)",
                    "Adjust for singular subject"
                ]
            }
        ];

        // Error examples
        const errorExamples = [
            {
                text: "She said that I am going to the market yesterday. He said that you should finish your work. The book was wrote by the author.",
                errors: [
                    { word: "I am", type: "tense_error", fix: "she was" },
                    { word: "yesterday", type: "time_error", fix: "the day before" },
                    { word: "you should", type: "pronoun_error", fix: "I should" },
                    { word: "was wrote", type: "passive_error", fix: "was written" }
                ],
                corrected: "She said that she was going to the market the day before. He said that I should finish my work. The book was written by the author."
            },
            {
                text: "He told that he can help me. She asked that where I live. The letter has wrote by me.",
                errors: [
                    { word: "told that", type: "missing_object", fix: "told me that" },
                    { word: "can", type: "modal_error", fix: "could" },
                    { word: "asked that where", type: "question_error", fix: "asked where" },
                    { word: "has wrote", type: "passive_error", fix: "has been written" }
                ],
                corrected: "He told me that he could help me. She asked where I lived. The letter has been written by me."
            },
            {
                text: "She said me to wait here. The building is build in 2020. He asked that am I coming.",
                errors: [
                    { word: "said me", type: "verb_error", fix: "told me" },
                    { word: "here", type: "adverb_error", fix: "there" },
                    { word: "is build", type: "passive_error", fix: "was built" },
                    { word: "asked that am I", type: "question_error", fix: "asked if I was" }
                ],
                corrected: "She told me to wait there. The building was built in 2020. He asked if I was coming."
            }
        ];

        // Current example indices
        let currentTransformationIndex = 0;
        let currentVoiceIndex = 0;
        let currentErrorIndex = 0;

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            studentName: "",
            startTime: null,
            currentClassification: [],
            draggedItem: null,
            directScore: 0,
            indirectScore: 0,
            activeScore: 0,
            passiveScore: 0
        };

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const backToHomeBtn = document.getElementById('backToHome');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const grammarTip = document.getElementById('grammarTip');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const feedbackExplanation = document.getElementById('feedbackExplanation');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const scoreMessage = document.getElementById('scoreMessage');
        const directScore = document.getElementById('directScore');
        const indirectScore = document.getElementById('indirectScore');
        const activeScore = document.getElementById('activeScore');
        const passiveScore = document.getElementById('passiveScore');
        const timeSpent = document.getElementById('timeSpent');
        const classificationItemsContainer = document.getElementById('classificationItems');
        const classificationFeedback = document.getElementById('classificationFeedback');
        const originalSentence = document.getElementById('originalSentence');
        const transformedSentence = document.getElementById('transformedSentence');
        const originalVoice = document.getElementById('originalVoice');
        const transformedVoice = document.getElementById('transformedVoice');
        const sentenceEditor = document.getElementById('sentenceEditor');
        const editorFeedback = document.getElementById('editorFeedback');
        const errorText = document.getElementById('errorText');
        const errorExplanation = document.getElementById('errorExplanation');

        // Initialize
        function initApp() {
            setupEventListeners();
            showWelcomePage();
            setupClassification();
            updateTransformationDisplay();
            updateVoiceDisplay();
            updateErrorDisplay();
        }

        // Setup classification
        function setupClassification() {
            newClassificationChallenge();
        }

        function newClassificationChallenge() {
            // Shuffle and select items
            const shuffled = [...classificationItems].sort(() => Math.random() - 0.5);
            appState.currentClassification = shuffled;
            
            classificationItemsContainer.innerHTML = '';
            classificationFeedback.textContent = 'Drag sentences to correct category';
            classificationFeedback.style.color = 'var(--text-secondary)';
            
            // Clear zones
            document.getElementById('zoneDirect').innerHTML = '<div style="color: var(--direct-blue); font-weight: bold;">Direct Speech</div>';
            document.getElementById('zoneIndirect').innerHTML = '<div style="color: var(--indirect-purple); font-weight: bold;">Indirect Speech</div>';
            document.getElementById('zoneActive').innerHTML = '<div style="color: var(--active-green); font-weight: bold;">Active Voice</div>';
            document.getElementById('zonePassive').innerHTML = '<div style="color: var(--passive-orange); font-weight: bold;">Passive Voice</div>';
            
            shuffled.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'classification-item';
                itemDiv.textContent = item.name;
                itemDiv.style.backgroundColor = item.color;
                itemDiv.style.color = 'white';
                itemDiv.draggable = true;
                itemDiv.id = `item-${index}`;
                itemDiv.dataset.type = item.type;
                
                itemDiv.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', index);
                    appState.draggedItem = item;
                    itemDiv.style.opacity = '0.5';
                });
                
                itemDiv.addEventListener('dragend', () => {
                    itemDiv.style.opacity = '1';
                });
                
                classificationItemsContainer.appendChild(itemDiv);
            });
        }

        function allowDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.add('active');
        }

        function drop(event) {
            event.preventDefault();
            const zone = event.currentTarget;
            zone.classList.remove('active');
            
            if (appState.draggedItem) {
                const itemDiv = document.createElement('div');
                itemDiv.textContent = appState.draggedItem.name;
                itemDiv.style.margin = '5px';
                itemDiv.style.padding = '5px';
                itemDiv.style.backgroundColor = appState.draggedItem.color;
                itemDiv.style.color = 'white';
                itemDiv.style.borderRadius = '4px';
                itemDiv.style.fontSize = '0.8rem';
                
                zone.appendChild(itemDiv);
                classificationFeedback.textContent = `Placed in ${zone.id.replace('zone', '')} category`;
            }
        }

        function checkClassification() {
            let correct = 0;
            let total = appState.currentClassification.length;
            
            // Check each zone
            const zones = {
                zoneDirect: 'direct',
                zoneIndirect: 'indirect',
                zoneActive: 'active',
                zonePassive: 'passive'
            };
            
            for (const [zoneId, correctType] of Object.entries(zones)) {
                const zone = document.getElementById(zoneId);
                const items = zone.querySelectorAll('div:not(:first-child)');
                
                items.forEach(item => {
                    const itemName = item.textContent;
                    const originalItem = appState.currentClassification.find(i => i.name === itemName);
                    
                    if (originalItem && originalItem.type === correctType) {
                        correct++;
                        item.style.border = '2px solid var(--active-green)';
                    } else {
                        item.style.border = '2px solid var(--error-red)';
                    }
                });
            }
            
            const percentage = Math.round((correct / total) * 100);
            classificationFeedback.textContent = `Score: ${correct}/${total} (${percentage}%)`;
            classificationFeedback.style.color = percentage >= 80 ? 'var(--active-green)' : 
                                               percentage >= 60 ? 'var(--passive-orange)' : 'var(--error-red)';
            
            if (percentage === 100) {
                classificationFeedback.textContent += ' - Perfect classification!';
            }
        }

        function resetClassification() {
            newClassificationChallenge();
        }

        // Transformation functions
        function updateTransformationDisplay() {
            const example = transformationExamples[currentTransformationIndex];
            originalSentence.textContent = `"${example.direct}"`;
            transformedSentence.textContent = "Transformed sentence appears here";
            transformedSentence.style.color = "var(--text-secondary)";
        }

        function newTransformationExample() {
            currentTransformationIndex = (currentTransformationIndex + 1) % transformationExamples.length;
            updateTransformationDisplay();
        }

        function convertToIndirect() {
            const example = transformationExamples[currentTransformationIndex];
            transformedSentence.textContent = `"${example.indirect}"`;
            transformedSentence.style.color = "var(--indirect-purple)";
            transformedSentence.classList.add('highlight');
            setTimeout(() => transformedSentence.classList.remove('highlight'), 1000);
        }

        function convertToDirect() {
            const example = transformationExamples[currentTransformationIndex];
            transformedSentence.textContent = `"${example.direct}"`;
            transformedSentence.style.color = "var(--direct-blue)";
            transformedSentence.classList.add('highlight');
            setTimeout(() => transformedSentence.classList.remove('highlight'), 1000);
        }

        function showTransformationSteps() {
            const example = transformationExamples[currentTransformationIndex];
            let steps = "TRANSFORMATION STEPS:\n\n";
            example.steps.forEach((step, index) => {
                steps += `${index + 1}. ${step}\n`;
            });
            
            steps += `\nDirect: ${example.direct}`;
            steps += `\nIndirect: ${example.indirect}`;
            
            alert(steps);
        }

        // Voice transformation functions
        function updateVoiceDisplay() {
            const example = voiceExamples[currentVoiceIndex];
            originalVoice.textContent = `"${example.active}"`;
            transformedVoice.textContent = "Voice transformation appears here";
            transformedVoice.style.color = "var(--text-secondary)";
        }

        function newVoiceExample() {
            currentVoiceIndex = (currentVoiceIndex + 1) % voiceExamples.length;
            updateVoiceDisplay();
        }

        function convertToPassive() {
            const example = voiceExamples[currentVoiceIndex];
            transformedVoice.textContent = `"${example.passive}"`;
            transformedVoice.style.color = "var(--passive-orange)";
            transformedVoice.classList.add('highlight');
            setTimeout(() => transformedVoice.classList.remove('highlight'), 1000);
        }

        function convertToActive() {
            const example = voiceExamples[currentVoiceIndex];
            transformedVoice.textContent = `"${example.active}"`;
            transformedVoice.style.color = "var(--active-green)";
            transformedVoice.classList.add('highlight');
            setTimeout(() => transformedVoice.classList.remove('highlight'), 1000);
        }

        function showVoiceSteps() {
            const example = voiceExamples[currentVoiceIndex];
            let steps = "VOICE TRANSFORMATION STEPS:\n\n";
            example.steps.forEach((step, index) => {
                steps += `${index + 1}. ${step}\n`;
            });
            
            steps += `\nActive: ${example.active}`;
            steps += `\nPassive: ${example.passive}`;
            
            alert(steps);
        }

        // Editor functions
        function analyzeSentence() {
            const text = sentenceEditor.value.trim();
            if (!text) {
                editorFeedback.textContent = "Please enter a sentence first.";
                editorFeedback.style.color = "var(--passive-orange)";
                return;
            }
            
            let analysis = `<strong>Sentence Analysis:</strong><br>`;
            
            // Check for direct speech
            if (text.includes('"') || text.includes("'")) {
                analysis += "‚Ä¢ <span style='color: var(--direct-blue)'>Likely Direct Speech</span> (contains quotation marks)<br>";
                
                // Check for proper direct speech structure
                const hasCommaBeforeQuote = /,\s*["']/.test(text) || /["']\s*,/.test(text);
                const hasReportingVerb = /\b(said|asked|exclaimed|shouted|whispered|replied|answered)\b/i.test(text);
                
                if (hasCommaBeforeQuote && hasReportingVerb) {
                    analysis += "‚Ä¢ Proper direct speech structure<br>";
                } else if (!hasCommaBeforeQuote) {
                    analysis += "‚Ä¢ Missing comma before/after quotation<br>";
                }
            } else {
                analysis += "‚Ä¢ No quotation marks (not direct speech)<br>";
            }
            
            // Check for indirect speech indicators
            if (text.includes('that') || text.includes('asked if') || text.includes('asked whether') || 
                text.includes('told to') || text.includes('said he') || text.includes('said she')) {
                analysis += "‚Ä¢ <span style='color: var(--indirect-purple)'>Likely Indirect Speech</span><br>";
            }
            
            // Check for passive voice
            const passivePattern = /\b(am|is|are|was|were|be|being|been)\s+\w+ed\b|\b(get|got)\s+\w+ed\b/i;
            if (passivePattern.test(text)) {
                analysis += "‚Ä¢ <span style='color: var(--passive-orange)'>Contains Passive Voice</span><br>";
                
                // Check for 'by' phrase
                if (text.includes(' by ')) {
                    analysis += "‚Ä¢ Includes 'by' phrase (specifies doer)<br>";
                }
            }
            
            // Check for active voice structure
            const hasSubjectVerbObject = /^[A-Z][a-z]*\s+\w+[s]?\s+[a-z]+\s+[a-z]+/i.test(text);
            if (hasSubjectVerbObject && !passivePattern.test(text)) {
                analysis += "‚Ä¢ <span style='color: var(--active-green)'>Likely Active Voice</span><br>";
            }
            
            // Word count and structure
            const wordCount = text.split(/\s+/).length;
            analysis += `‚Ä¢ Word count: ${wordCount}<br>`;
            
            // Check sentence type
            if (text.endsWith('?')) {
                analysis += "‚Ä¢ Question sentence<br>";
            } else if (text.endsWith('!')) {
                analysis += "‚Ä¢ Exclamation sentence<br>";
            } else if (text.endsWith('.')) {
                analysis += "‚Ä¢ Statement sentence<br>";
            }
            
            editorFeedback.innerHTML = analysis;
            editorFeedback.style.color = "var(--text-primary)";
        }

        function transformDirectIndirect() {
            const text = sentenceEditor.value.trim();
            if (!text) {
                editorFeedback.textContent = "Please enter a sentence first.";
                editorFeedback.style.color = "var(--passive-orange)";
                return;
            }
            
            let transformed = "";
            let explanation = "";
            
            // Check if it's direct speech (has quotes)
            if ((text.includes('"') || text.includes("'")) && 
                (text.includes('said') || text.includes('asked') || text.includes('exclaimed'))) {
                
                // Direct ‚Üí Indirect
                transformed = text;
                
                // Remove quotes
                transformed = transformed.replace(/["']/g, '');
                
                // Change pronouns (simplified)
                transformed = transformed.replace(/\bI\b/g, 'he/she');
                transformed = transformed.replace(/\bmy\b/g, 'his/her');
                transformed = transformed.replace(/\bme\b/g, 'him/her');
                transformed = transformed.replace(/\bwe\b/g, 'they');
                transformed = transformed.replace(/\bour\b/g, 'their');
                transformed = transformed.replace(/\bus\b/g, 'them');
                transformed = transformed.replace(/\byou\b/g, 'I/me');
                transformed = transformed.replace(/\byour\b/g, 'my');
                
                // Change tenses (simplified)
                transformed = transformed.replace(/\bam\b|\bis\b|\bare\b/g, 'was/were');
                transformed = transformed.replace(/\bhave\b|\bhas\b/g, 'had');
                transformed = transformed.replace(/\bdo\b|\bdoes\b/g, 'did');
                transformed = transformed.replace(/\bwill\b/g, 'would');
                transformed = transformed.replace(/\bcan\b/g, 'could');
                transformed = transformed.replace(/\bmay\b/g, 'might');
                
                // Change time expressions
                transformed = transformed.replace(/\btoday\b/g, 'that day');
                transformed = transformed.replace(/\btomorrow\b/g, 'the next day');
                transformed = transformed.replace(/\byesterday\b/g, 'the day before');
                transformed = transformed.replace(/\bnow\b/g, 'then');
                transformed = transformed.replace(/\bhere\b/g, 'there');
                
                // Remove comma before quote
                transformed = transformed.replace(/,\s*$/, '');
                
                // Add 'that' if not a question
                if (!text.includes('?')) {
                    transformed = transformed.replace(/(said|asked|exclaimed)\s+/i, '$1 that ');
                }
                
                explanation = "Transformed from Direct to Indirect Speech";
                
            } else {
                // Try Indirect ‚Üí Direct (simplified)
                transformed = text;
                
                // Add quotes
                if (transformed.includes('that')) {
                    const quoteStart = transformed.indexOf('that') + 5;
                    const beforeQuote = transformed.substring(0, quoteStart - 1);
                    const afterQuote = transformed.substring(quoteStart);
                    
                    // Simple transformation for demonstration
                    transformed = beforeQuote + ', "' + afterQuote + '"';
                    
                    // Change pronouns back (simplified)
                    transformed = transformed.replace(/\bhe\/she\b/g, 'I');
                    transformed = transformed.replace(/\bhis\/her\b/g, 'my');
                    transformed = transformed.replace(/\bhim\/her\b/g, 'me');
                    transformed = transformed.replace(/\bthey\b/g, 'we');
                    transformed = transformed.replace(/\btheir\b/g, 'our');
                    transformed = transformed.replace(/\bthem\b/g, 'us');
                    transformed = transformed.replace(/\bI\/me\b/g, 'you');
                    transformed = transformed.replace(/\bmy\b/g, 'your');
                    
                    // Change tenses back
                    transformed = transformed.replace(/\bwas\/were\b/g, 'am/is/are');
                    transformed = transformed.replace(/\bhad\b/g, 'have/has');
                    transformed = transformed.replace(/\bdid\b/g, 'do/does');
                    transformed = transformed.replace(/\bwould\b/g, 'will');
                    transformed = transformed.replace(/\bcould\b/g, 'can');
                    transformed = transformed.replace(/\bmight\b/g, 'may');
                    
                    // Change time expressions back
                    transformed = transformed.replace(/\bthat day\b/g, 'today');
                    transformed = transformed.replace(/\bthe next day\b/g, 'tomorrow');
                    transformed = transformed.replace(/\bthe day before\b/g, 'yesterday');
                    transformed = transformed.replace(/\bthen\b/g, 'now');
                    transformed = transformed.replace(/\bthere\b/g, 'here');
                    
                    explanation = "Transformed from Indirect to Direct Speech";
                } else {
                    editorFeedback.innerHTML = "<span style='color: var(--error-red)'>Cannot determine transformation direction. Enter clear direct or indirect speech.</span>";
                    editorFeedback.style.color = "var(--error-red)";
                    return;
                }
            }
            
            sentenceEditor.value = transformed;
            editorFeedback.innerHTML = `<span style="color: var(--transformation-teal)">${explanation}</span><br>Transformation applied.`;
            editorFeedback.style.color = "var(--transformation-teal)";
        }

        function transformActivePassive() {
            const text = sentenceEditor.value.trim();
            if (!text) {
                editorFeedback.textContent = "Please enter a sentence first.";
                editorFeedback.style.color = "var(--passive-orange)";
                return;
            }
            
            let transformed = text;
            let explanation = "";
            
            // Check for passive voice patterns
            const passivePattern = /\b(am|is|are|was|were|be|being|been)\s+\w+ed\b/i;
            const getPassivePattern = /\b(get|got)\s+\w+ed\b/i;
            
            if (passivePattern.test(text) || getPassivePattern.test(text)) {
                // Passive ‚Üí Active transformation (simplified)
                
                // Find the 'by' phrase
                const byIndex = transformed.indexOf(' by ');
                if (byIndex !== -1) {
                    const byPhrase = transformed.substring(byIndex + 4);
                    const beforeBy = transformed.substring(0, byIndex);
                    
                    // Extract subject and verb
                    const words = beforeBy.split(' ');
                    if (words.length >= 3) {
                        // Simple assumption: first word is subject, next words contain verb
                        const newSubject = byPhrase.split(' ')[0];
                        const oldSubject = words[0];
                        
                        // Remove 'be' verb and adjust
                        transformed = newSubject + ' ' + 
                                    beforeBy.replace(/\b(am|is|are|was|were|be|being|been)\s+/i, '')
                                           .replace(oldSubject + ' ', '');
                        
                        explanation = "Transformed from Passive to Active Voice";
                    }
                } else {
                    editorFeedback.innerHTML = "<span style='color: var(--error-red)'>Passive voice without 'by' phrase. Add a doer or use 'someone/they' as subject for active voice.</span>";
                    editorFeedback.style.color = "var(--error-red)";
                    return;
                }
            } else {
                // Active ‚Üí Passive transformation (simplified)
                const words = transformed.split(' ');
                if (words.length >= 3) {
                    // Simple assumption: subject + verb + object
                    const subject = words[0];
                    const verb = words[1];
                    const object = words.slice(2).join(' ');
                    
                    // Convert verb to past participle (simplified - adds 'ed')
                    let pastParticiple = verb;
                    if (!verb.endsWith('ed')) {
                        pastParticiple = verb + 'ed';
                    }
                    
                    // Determine correct 'be' verb based on original tense (simplified)
                    let beVerb = 'is';
                    if (verb.endsWith('s')) beVerb = 'is'; // present simple
                    if (verb.endsWith('ed')) beVerb = 'was'; // past simple
                    if (verb.includes('will')) beVerb = 'will be'; // future
                    if (verb.includes('have') || verb.includes('has')) beVerb = 'has been'; // present perfect
                    if (verb.includes('had')) beVerb = 'had been'; // past perfect
                    
                    transformed = object + ' ' + beVerb + ' ' + pastParticiple + ' by ' + subject;
                    explanation = "Transformed from Active to Passive Voice";
                }
            }
            
            sentenceEditor.value = transformed;
            editorFeedback.innerHTML = `<span style="color: var(--transformation-teal)">${explanation}</span><br>Transformation applied.`;
            editorFeedback.style.color = "var(--transformation-teal)";
        }

        function clearEditor() {
            sentenceEditor.value = '';
            editorFeedback.textContent = "Type a sentence and transform it";
            editorFeedback.style.color = "var(--text-secondary)";
        }

        // Error detection functions
        function updateErrorDisplay() {
            const example = errorExamples[currentErrorIndex];
            let html = example.text;
            
            // Highlight errors
            example.errors.forEach(error => {
                const regex = new RegExp(`\\b${error.word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'gi');
                html = html.replace(regex, `<span class="error-highlight" onclick="explainError('${error.type}', '${error.fix}')">$&</span>`);
            });
            
            errorText.innerHTML = html;
            errorExplanation.textContent = "Click highlighted errors for explanations";
        }

        function newErrorExample() {
            currentErrorIndex = (currentErrorIndex + 1) % errorExamples.length;
            updateErrorDisplay();
        }

        function explainError(type, fix) {
            let explanation = "";
            
            switch(type) {
                case 'tense_error':
                    explanation = "Tense not backshifted in indirect speech. Present tense should become past tense when reporting past speech.";
                    break;
                case 'pronoun_error':
                    explanation = "Pronoun not changed in indirect speech. Second person 'you' should change based on context (to I, he, she, etc.).";
                    break;
                case 'time_error':
                    explanation = "Time expression not adjusted. 'Yesterday' in direct speech becomes 'the day before' in indirect speech.";
                    break;
                case 'passive_error':
                    explanation = "Incorrect past participle. Regular verbs add '-ed' for past participle (write‚Üíwritten is irregular).";
                    break;
                case 'missing_object':
                    explanation = "'Told' requires an indirect object. Use 'told me/him/us' not just 'told that'.";
                    break;
                case 'modal_error':
                    explanation = "Modal verb not backshifted. 'Can' should become 'could' in reported speech.";
                    break;
                case 'question_error':
                    explanation = "Incorrect question structure in indirect speech. Don't use 'that' with questions; use correct word order.";
                    break;
                case 'verb_error':
                    explanation = "Wrong reporting verb. Use 'told' for commands, not 'said'.";
                    break;
                case 'adverb_error':
                    explanation = "Adverb of place not changed. 'Here' becomes 'there' when location changes.";
                    break;
                default:
                    explanation = "This contains a grammatical error in speech or voice transformation.";
            }
            
            if (fix) {
                explanation += `\n\nCorrection: '${fix}'`;
            }
            
            errorExplanation.innerHTML = `<strong>Error:</strong> ${explanation}`;
            errorExplanation.style.color = "var(--passive-orange)";
        }

        function showCorrectedVersion() {
            const example = errorExamples[currentErrorIndex];
            errorExplanation.innerHTML = `<strong>Corrected Version:</strong><br>"${example.corrected}"`;
            errorExplanation.style.color = "var(--active-green)";
        }

        function highlightErrors() {
            const spans = errorText.querySelectorAll('.error-highlight');
            spans.forEach(span => {
                span.classList.add('highlight');
                setTimeout(() => span.classList.remove('highlight'), 2000);
            });
            errorExplanation.textContent = "Errors are highlighted. Click on them for explanations.";
        }

        // Grammar detail
        window.showGrammarDetail = function(type) {
            let info = "";
            
            if (type === 'direct') {
                info = "üí¨ DIRECT SPEECH üí¨\n\nDefinition: Reporting the exact words spoken, using quotation marks.\n\nStructure:\n‚Ä¢ Reporting clause + comma + quotation marks + exact words + quotation marks\n‚Ä¢ Example: She said, \"I am happy.\"\n\nKey Features:\n1. Uses quotation marks (\" \") or (' ')\n2. Reports exact words with original punctuation\n3. Keeps original pronouns (I, we, you)\n4. Maintains original tenses\n5. Preserves original word order\n6. Can include questions/exclamations as spoken\n\nPunctuation Rules:\n‚Ä¢ Comma after reporting verb (usually)\n‚Ä¢ Capital letter starts quoted speech\n‚Ä¢ End punctuation inside quotation marks\n‚Ä¢ Question/exclamation marks kept if in original\n\nCommon Reporting Verbs:\n‚Ä¢ Said, asked, replied, answered\n‚Ä¢ Exclaimed, shouted, whispered\n‚Ä¢ Added, continued, explained";
            } else if (type === 'indirect') {
                info = "‚ÜîÔ∏è INDIRECT SPEECH ‚ÜîÔ∏è\n\nDefinition: Reporting what someone said without using exact words.\n\nStructure:\n‚Ä¢ Reporting verb + that (optional) + reported clause\n‚Ä¢ Example: She said that she was happy.\n\nKey Changes from Direct Speech:\n1. NO quotation marks\n2. Pronouns change (I ‚Üí he/she, we ‚Üí they)\n3. Tenses usually backshift (present‚Üípast)\n4. Time expressions change (now‚Üíthen, today‚Üíthat day)\n5. Place references change (here‚Üíthere)\n6. Word order changes for questions\n\nTense Backshifting:\n‚Ä¢ Present simple ‚Üí Past simple: \"I like\" ‚Üí she said she liked\n‚Ä¢ Present continuous ‚Üí Past continuous: \"I am going\" ‚Üí she said she was going\n‚Ä¢ Present perfect ‚Üí Past perfect: \"I have finished\" ‚Üí she said she had finished\n‚Ä¢ Past simple ‚Üí Past perfect: \"I saw\" ‚Üí she said she had seen\n‚Ä¢ Will ‚Üí Would, Can ‚Üí Could, May ‚Üí Might\n\nTime Expression Changes:\n‚Ä¢ Now ‚Üí Then, Today ‚Üí That day\n‚Ä¢ Tomorrow ‚Üí The next/following day\n‚Ä¢ Yesterday ‚Üí The day before\n‚Ä¢ This ‚Üí That, These ‚Üí Those";
            } else if (type === 'active') {
                info = "üó£Ô∏è ACTIVE VOICE üó£Ô∏è\n\nDefinition: The subject performs the action expressed by the verb.\n\nStructure:\n‚Ä¢ Subject + Verb + Object\n‚Ä¢ Example: The cat (subject) chased (verb) the mouse (object).\n\nKey Features:\n1. Subject does the action\n2. Direct and clear structure\n3. Emphasizes who performs the action\n4. Generally shorter and more concise\n5. More engaging and dynamic\n6. Preferred for most writing\n\nWhen to Use Active Voice:\n‚Ä¢ To emphasize who is responsible\n‚Ä¢ For clarity and directness\n‚Ä¢ In instructions and commands\n‚Ä¢ In most academic and business writing\n‚Ä¢ When you want to sound more engaging\n\nAdvantages:\n‚Ä¢ Clear responsibility assignment\n‚Ä¢ More concise sentences\n‚Ä¢ Easier to read and understand\n‚Ä¢ More engaging for readers\n‚Ä¢ Better for SEO and web writing\n\nExamples:\n‚Ä¢ The committee approved the proposal.\n‚Ä¢ Scientists discovered a new planet.\n‚Ä¢ I wrote the report yesterday.\n‚Ä¢ The storm damaged several houses.";
            } else {
                info = "‚ÜïÔ∏è PASSIVE VOICE ‚ÜïÔ∏è\n\nDefinition: The subject receives the action expressed by the verb.\n\nStructure:\n‚Ä¢ Subject + Form of 'be' + Past Participle + (by + agent)\n‚Ä¢ Example: The mouse (subject) was chased (was + past participle) by the cat (agent).\n\nKey Features:\n1. Subject receives the action\n2. Uses form of 'be' + past participle\n3. Optional 'by' phrase shows who did action\n4. Emphasizes action or receiver\n5. Often more formal sounding\n6. Can make sentences longer\n\nWhen to Use Passive Voice:\n‚Ä¢ When who did action is unknown\n‚Ä¢ When who did action is unimportant\n‚Ä¢ When focusing on action/receiver\n‚Ä¢ In scientific/technical writing\n‚Ä¢ To be more formal or diplomatic\n\nVerb Forms in Passive:\n‚Ä¢ Present simple: is/are + past participle\n‚Ä¢ Past simple: was/were + past participle\n‚Ä¢ Present perfect: has/have been + past participle\n‚Ä¢ Future: will be + past participle\n‚Ä¢ Modal: can/must/should be + past participle\n\nExamples:\n‚Ä¢ The proposal was approved (by the committee).\n‚Ä¢ A new planet was discovered.\n‚Ä¢ The report was written yesterday.\n‚Ä¢ Several houses were damaged by the storm.";
            }
            
            alert(info);
        };

        // Rule detail
        window.showRuleDetail = function(rule) {
            let info = "";
            
            switch(rule) {
                case 'pronoun_change':
                    info = "PRONOUN CHANGES IN INDIRECT SPEECH\n\nDirect speech pronouns change in indirect speech:\n\nFirst Person ‚Üí Third Person:\n‚Ä¢ I ‚Üí he/she\n‚Ä¢ me ‚Üí him/her\n‚Ä¢ my ‚Üí his/her\n‚Ä¢ mine ‚Üí his/hers\n‚Ä¢ we ‚Üí they\n‚Ä¢ us ‚Üí them\n‚Ä¢ our ‚Üí their\n‚Ä¢ ours ‚Üí theirs\n\nSecond Person ‚Üí Based on context:\n‚Ä¢ you ‚Üí I/me/he/him/she/her/we/us/they/them\n‚Ä¢ your ‚Üí my/his/her/our/their\n\nExamples:\nDirect: \"I need help.\" ‚Üí Indirect: He said he needed help.\nDirect: \"We are coming.\" ‚Üí Indirect: They said they were coming.\nDirect: \"You should try.\" ‚Üí Indirect: She told me I should try.";
                    break;
                    
                case 'tense_shift':
                    info = "TENSE BACKSHIFTING IN INDIRECT SPEECH\n\nTenses usually shift back (backshift) in indirect speech:\n\nPresent ‚Üí Past:\n‚Ä¢ Present simple ‚Üí Past simple: \"I like\" ‚Üí he said he liked\n‚Ä¢ Present continuous ‚Üí Past continuous: \"I am going\" ‚Üí she said she was going\n‚Ä¢ Present perfect ‚Üí Past perfect: \"I have finished\" ‚Üí he said he had finished\n‚Ä¢ Present perfect continuous ‚Üí Past perfect continuous: \"I have been waiting\" ‚Üí she said she had been waiting\n\nPast ‚Üí Past Perfect:\n‚Ä¢ Past simple ‚Üí Past perfect: \"I saw\" ‚Üí he said he had seen\n‚Ä¢ Past continuous ‚Üí Past perfect continuous: \"I was sleeping\" ‚Üí she said she had been sleeping\n\nModals:\n‚Ä¢ Will ‚Üí Would\n‚Ä¢ Can ‚Üí Could\n‚Ä¢ May ‚Üí Might\n‚Ä¢ Shall ‚Üí Should\n‚Ä¢ Must ‚Üí Had to\n\nExceptions:\n‚Ä¢ Universal truths remain present: \"The sun rises in the east\" ‚Üí He said the sun rises in the east.\n‚Ä¢ Past perfect doesn't change.\n‚Ä¢ Could, would, should, might often don't change.";
                    break;
                    
                case 'time_expressions':
                    info = "TIME EXPRESSION CHANGES IN INDIRECT SPEECH\n\nTime references change when reporting on a different day/time:\n\nToday ‚Üí That day\nTomorrow ‚Üí The next day / The following day\nYesterday ‚Üí The day before / The previous day\nNow ‚Üí Then / At that time\nThis morning ‚Üí That morning\nTonight ‚Üí That night\nLast week ‚Üí The week before / The previous week\nNext week ‚Üí The following week\nHere ‚Üí There\nThis ‚Üí That\nThese ‚Üí Those\n\nExamples:\nDirect (Monday): \"I'm busy today.\"\nIndirect (Tuesday): She said she was busy yesterday.\n\nDirect: \"I'll see you tomorrow.\"\nIndirect: He said he would see me the next day.\n\nDirect: \"I was here yesterday.\"\nIndirect: She said she had been there the day before.";
                    break;
                    
                case 'active_passive':
                    info = "ACTIVE TO PASSIVE TRANSFORMATION\n\nSteps to convert active to passive voice:\n\n1. Identify the object of the active sentence\n2. Make the object the subject of the passive sentence\n3. Use the appropriate form of 'be' + past participle of main verb\n4. Add optional 'by' phrase with original subject\n5. Adjust word order and pronouns\n\nTense Changes:\n‚Ä¢ Present simple: writes ‚Üí is written\n‚Ä¢ Past simple: wrote ‚Üí was written\n‚Ä¢ Present continuous: is writing ‚Üí is being written\n‚Ä¢ Past continuous: was writing ‚Üí was being written\n‚Ä¢ Present perfect: has written ‚Üí has been written\n‚Ä¢ Future: will write ‚Üí will be written\n‚Ä¢ Modal: can write ‚Üí can be written\n\nExamples:\nActive: The chef prepares the meal.\nPassive: The meal is prepared by the chef.\n\nActive: They built this house in 1990.\nPassive: This house was built in 1990 (by them).\n\nActive: Someone has stolen my bike.\nPassive: My bike has been stolen.";
                    break;
                    
                default:
                    info = "Select a specific rule for detailed information.";
            }
            
            alert(info);
        };

        // Comparison detail
        window.showComparisonDetail = function(detail) {
            let info = "";
            
            switch(detail) {
                case 'direct_quotes':
                    info = "QUOTATION MARKS IN DIRECT SPEECH\n\nDirect speech ALWAYS uses quotation marks:\n\nTypes of quotation marks:\n‚Ä¢ Double quotes: \"I'm coming,\" he said.\n‚Ä¢ Single quotes: 'I'm coming,' he said. (Common in British English)\n\nPlacement:\n‚Ä¢ Open quotation marks before exact words\n‚Ä¢ Close quotation marks after exact words\n‚Ä¢ Punctuation usually inside quotation marks\n\nExamples:\n‚Ä¢ She said, \"Wait here.\"\n‚Ä¢ \"Wait here,\" she said.\n‚Ä¢ \"Wait here,\" she said, \"and don't move.\"\n\nNote: Quotation marks show these are the exact words spoken.";
                    break;
                    
                case 'direct_pronouns':
                    info = "PRONOUNS IN DIRECT SPEECH\n\nDirect speech keeps the original pronouns used by the speaker:\n\nIf speaker said \"I,\" report as \"I\"\nIf speaker said \"we,\" report as \"we\"\nIf speaker said \"you,\" report as \"you\"\n\nExamples:\n‚Ä¢ Maria (speaking): \"I am tired.\" ‚Üí Reported: Maria said, \"I am tired.\"\n‚Ä¢ Teacher to students: \"You should study.\" ‚Üí Reported: The teacher said, \"You should study.\"\n‚Ä¢ Team members: \"We will win.\" ‚Üí Reported: They said, \"We will win.\"\n\nNo pronoun changes occur in direct speech - report exactly what was said.";
                    break;
                    
                case 'direct_tenses':
                    info = "TENSES IN DIRECT SPEECH\n\nDirect speech preserves the original tenses used by the speaker:\n\nIf speaker used present tense, keep present\nIf speaker used past tense, keep past\nIf speaker used future, keep future\n\nExamples:\n‚Ä¢ Present: \"I like ice cream.\" ‚Üí She said, \"I like ice cream.\"\n‚Ä¢ Past: \"I went yesterday.\" ‚Üí He said, \"I went yesterday.\"\n‚Ä¢ Future: \"I will come.\" ‚Üí They said, \"I will come.\"\n‚Ä¢ Present perfect: \"I have finished.\" ‚Üí She said, \"I have finished.\"\n\nDirect speech is like a recording - it captures the exact words including verb tenses.";
                    break;
                    
                case 'direct_time':
                    info = "TIME EXPRESSIONS IN DIRECT SPEECH\n\nDirect speech keeps the original time references:\n\nIf speaker said \"now,\" report as \"now\"\nIf speaker said \"today,\" report as \"today\"\nIf speaker said \"tomorrow,\" report as \"tomorrow\"\n\nExamples:\n‚Ä¢ \"I'm busy now.\" ‚Üí He said, \"I'm busy now.\"\n‚Ä¢ \"I saw her yesterday.\" ‚Üí She said, \"I saw her yesterday.\"\n‚Ä¢ \"I'll call you tomorrow.\" ‚Üí They said, \"I'll call you tomorrow.\"\n‚Ä¢ \"Meet me here today.\" ‚Üí He said, \"Meet me here today.\"\n\nTime words are reported exactly as spoken in direct speech.";
                    break;
                    
                case 'direct_punctuation':
                    info = "PUNCTUATION IN DIRECT SPEECH\n\nKey punctuation rules for direct speech:\n\n1. Comma after reporting verb (usually):\n   ‚Ä¢ She said, \"Hello.\"\n   ‚Ä¢ \"Hello,\" she said.\n\n2. Capital letter starts quoted speech:\n   ‚Ä¢ He said, \"Come here.\" (Correct)\n   ‚Ä¢ He said, \"come here.\" (Incorrect)\n\n3. End punctuation inside quotation marks:\n   ‚Ä¢ She asked, \"Are you coming?\"\n   ‚Ä¢ He shouted, \"Stop!\"\n   ‚Ä¢ I said, \"I'm tired.\"\n\n4. Question/exclamation marks replace commas:\n   ‚Ä¢ \"Are you coming?\" she asked.\n   ‚Ä¢ \"Stop!\" he shouted.\n\n5. Split quotes use commas:\n   ‚Ä¢ \"I'm tired,\" she said, \"and I want to sleep.\"";
                    break;
                    
                case 'indirect_quotes':
                    info = "NO QUOTATION MARKS IN INDIRECT SPEECH\n\nIndirect speech NEVER uses quotation marks:\n\nInstead of quotes:\n‚Ä¢ Use reporting verbs (said, told, asked)\n‚Ä¢ Use conjunctions (that, if, whether)\n‚Ä¢ Adjust pronouns and tenses\n\nExamples:\nDirect: She said, \"I'm coming.\"\nIndirect: She said that she was coming.\n\nDirect: He asked, \"Are you ready?\"\nIndirect: He asked if I was ready.\n\nDirect: \"Help me!\" she shouted.\nIndirect: She shouted for help.\n\nWhy no quotes? Indirect speech summarizes or paraphrases what was said, rather than quoting exact words.";
                    break;
                    
                case 'indirect_pronouns':
                    info = "PRONOUN CHANGES IN INDIRECT SPEECH\n\nPronouns change based on perspective in indirect speech:\n\nBasic changes:\n‚Ä¢ First person (I, me, my, we, us, our) ‚Üí Third person\n‚Ä¢ Second person (you, your) ‚Üí Based on who is being addressed\n\nExamples:\n‚Ä¢ Speaker: \"I am tired.\" ‚Üí He said he was tired.\n‚Ä¢ Speaker about others: \"We are coming.\" ‚Üí They said they were coming.\n‚Ä¢ To listener: \"You should try.\" ‚Üí She told me I should try.\n‚Ä¢ About listener: \"He likes you.\" ‚Üí She said he liked me.\n\nContext matters - pronouns change to reflect who said what to whom.";
                    break;
                    
                case 'indirect_tenses':
                    info = "TENSE BACKSHIFTING IN INDIRECT SPEECH\n\nTenses usually move back (backshift) in indirect speech:\n\nPresent ‚Üí Past:\n‚Ä¢ \"I like\" ‚Üí he said he liked\n‚Ä¢ \"I am going\" ‚Üí she said she was going\n‚Ä¢ \"I have finished\" ‚Üí he said he had finished\n\nPast ‚Üí Past Perfect:\n‚Ä¢ \"I saw\" ‚Üí he said he had seen\n‚Ä¢ \"I was sleeping\" ‚Üí she said she had been sleeping\n\nFuture ‚Üí Conditional:\n‚Ä¢ \"I will come\" ‚Üí he said he would come\n\nExceptions:\n‚Ä¢ Universal truths remain present\n‚Ä¢ Past perfect doesn't change\n‚Ä¢ Could, would, should, might often don't change";
                    break;
                    
                case 'indirect_time':
                    info = "TIME EXPRESSION CHANGES IN INDIRECT SPEECH\n\nTime words change when reporting from a different time:\n\nNow ‚Üí Then / At that time\nToday ‚Üí That day\nTonight ‚Üí That night\nTomorrow ‚Üí The next day / Following day\nYesterday ‚Üí The day before / Previous day\nThis week ‚Üí That week\nLast week ‚Üí The week before\nNext week ‚Üí The following week\nHere ‚Üí There\nThis ‚Üí That\nThese ‚Üí Those\n\nExamples:\n‚Ä¢ \"I'm busy now.\" (said Monday) ‚Üí She said she was busy then. (reported Tuesday)\n‚Ä¢ \"I'll see you tomorrow.\" ‚Üí He said he would see me the next day.\n‚Ä¢ \"I was here yesterday.\" ‚Üí She said she had been there the day before.";
                    break;
                    
                case 'indirect_conj':
                    info = "CONJUNCTIONS IN INDIRECT SPEECH\n\nDifferent conjunctions for different sentence types:\n\nStatements: Use 'that' (often optional)\n‚Ä¢ \"I'm tired.\" ‚Üí He said (that) he was tired.\n\nYes/No Questions: Use 'if' or 'whether'\n‚Ä¢ \"Are you coming?\" ‚Üí She asked if I was coming.\n‚Ä¢ \"Did you finish?\" ‚Üí He asked whether I had finished.\n\nWh- Questions: Keep question word\n‚Ä¢ \"Where do you live?\" ‚Üí She asked where I lived.\n‚Ä¢ \"When will you come?\" ‚Üí He asked when I would come.\n\nCommands: Use infinitive\n‚Ä¢ \"Wait here.\" ‚Üí He told me to wait there.\n‚Ä¢ \"Don't go.\" ‚Üí She told me not to go.";
                    break;
                    
                default:
                    info = "Select a specific comparison point for detailed information.";
            }
            
            alert(info);
        };

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', showWelcomePage);
            viewTopicsBtn.addEventListener('click', () => alert("Other English topics would be available here."));
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') startPractice();
            });
        }

        // Create grammar tip display
        function createGrammarTip() {
            const tipDiv = document.createElement('div');
            tipDiv.className = 'grammar-tip';
            tipDiv.innerHTML = `<strong>Grammar Tip:</strong> ${grammarTips[Math.floor(Math.random() * grammarTips.length)]}`;
            return tipDiv;
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            appState.startTime = new Date();
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const percentage = Math.round((appState.score / allQuestions.length) * 100);
            const timeDiff = new Date() - appState.startTime;
            const minutes = Math.floor(timeDiff / 60000);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            directScore.textContent = appState.directScore;
            indirectScore.textContent = appState.indirectScore;
            activeScore.textContent = appState.activeScore;
            passiveScore.textContent = appState.passiveScore;
            timeSpent.textContent = `${minutes}min`;
            
            if (percentage >= 90) {
                scoreMessage.textContent = "Outstanding! You've mastered direct/indirect speech and active/passive voice!";
            } else if (percentage >= 75) {
                scoreMessage.textContent = "Excellent work! Your grammar transformation skills are strong!";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "Good job! You're developing solid grammar transformation abilities!";
            } else {
                scoreMessage.textContent = "Keep practicing! Mastering these grammar concepts is key to effective communication!";
            }
        }

        // Load question
        function loadQuestion() {
            const question = allQuestions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${allQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / allQuestions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            grammarTip.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            grammarTip.appendChild(createGrammarTip());
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = allQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                
                // Track scores by grammar type
                if (question.type === 'direct') appState.directScore++;
                if (question.type === 'indirect') appState.indirectScore++;
                if (question.type === 'active') appState.activeScore++;
                if (question.type === 'passive') appState.passiveScore++;
                
                optionElement.classList.add('pulse');
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation);
            }
            
            nextQuestionBtn.disabled = false;
        }

        // Show feedback
        function showFeedback(isCorrect, explanation) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '‚úì';
                feedbackTitle.textContent = 'Correct!';
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '‚úó';
                feedbackTitle.textContent = 'Incorrect';
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
            feedbackContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < allQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
        }

        // Skip question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < allQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
        }

        // Retry topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            appState.directScore = 0;
            appState.indirectScore = 0;
            appState.activeScore = 0;
            appState.passiveScore = 0;
            showPracticePage();
        }

        // Start practice
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name to begin grammar practice!");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            appState.directScore = 0;
            appState.indirectScore = 0;
            appState.activeScore = 0;
            appState.passiveScore = 0;
            
            showPracticePage();
        }

        // Initialize app
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

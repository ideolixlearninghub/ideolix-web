<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 6 English - Active & Passive Voice | Ideolix Learning Hub</title>
    <style>
        /* CSS Variables for Voice Theme */
        :root {
            --primary-indigo: #3F51B5;
            --secondary-cyan: #00BCD4;
            --accent-amber: #FFC107;
            --accent-green: #4CAF50;
            --accent-red: #F44336;
            --accent-purple: #9C27B0;
            --accent-orange: #FF9800;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --text-muted: #888;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --active-glow: 0 0 20px rgba(63, 81, 181, 0.4);
            --passive-glow: 0 0 20px rgba(0, 188, 212, 0.4);
            --voice-glow: 0 0 20px rgba(255, 193, 7, 0.4);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Voice Pattern Background */
        .voice-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: 
                radial-gradient(circle at 20% 30%, rgba(63, 81, 181, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 188, 212, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 193, 7, 0.1) 0%, transparent 50%);
            opacity: 0.3;
        }

        .floating-element {
            position: absolute;
            font-size: 3rem;
            font-weight: bold;
            animation: floatElement 25s linear infinite;
        }

        @keyframes floatElement {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.1; }
            25% { transform: translateY(-150px) translateX(100px) rotate(90deg); opacity: 0.05; }
            50% { transform: translateY(-50px) translateX(-150px) rotate(180deg); opacity: 0.1; }
            75% { transform: translateY(150px) translateX(50px) rotate(270deg); opacity: 0.05; }
            100% { transform: translateY(0) translateX(0) rotate(360deg); opacity: 0.1; }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: -1;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            position: sticky;
            top: 20px;
            z-index: 100;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(10px);
        }

        .logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info {
            flex: 1;
        }

        .brand-info h1 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        /* Card Styles */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(5px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow), var(--active-glow);
        }

        /* Welcome Page */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-logo {
            width: 140px;
            height: 140px;
            margin-bottom: 25px;
            border-radius: 20px;
            overflow: hidden;
            background-color: var(--dark-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .welcome-logo img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .welcome-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-indigo), var(--secondary-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 700px;
            line-height: 1.6;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(63, 81, 181, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 25px;
            border: 1px solid var(--primary-indigo);
        }

        .topic-icon {
            font-size: 1.5rem;
        }

        .topic-name {
            font-weight: 600;
            color: var(--primary-indigo);
        }

        .input-group {
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 1.1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-indigo);
            box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-indigo);
            color: white;
            box-shadow: 0 4px 15px rgba(63, 81, 181, 0.4);
        }

        .btn-primary:hover {
            background: #303F9F;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(63, 81, 181, 0.5);
        }

        .btn-secondary {
            background: var(--secondary-cyan);
            color: #212121;
            box-shadow: 0 4px 15px rgba(0, 188, 212, 0.4);
        }

        .btn-secondary:hover {
            background: #0097A7;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 188, 212, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-indigo);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Practice Mode */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-bar {
            height: 12px;
            background: var(--dark-surface);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-indigo), var(--secondary-cyan));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(63, 81, 181, 0.5);
        }

        .question-container {
            margin-bottom: 25px;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .language-fact {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-amber);
            font-style: italic;
            color: var(--text-secondary);
        }

        /* Content Layout */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 25px 0;
        }

        @media (max-width: 992px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .question-side {
            display: flex;
            flex-direction: column;
        }

        .visualization-side {
            display: flex;
            flex-direction: column;
        }

        .concept-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .concept-box {
            background: linear-gradient(135deg, var(--primary-indigo), var(--secondary-cyan));
            padding: 20px 30px;
            border-radius: 12px;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            min-width: 180px;
            box-shadow: 0 4px 15px rgba(63, 81, 181, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .concept-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .concept-label {
            font-size: 1rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 5px;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }

        .option {
            padding: 18px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--dark-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-indigo);
            background: rgba(63, 81, 181, 0.05);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(63, 81, 181, 0.1);
            border-color: var(--primary-indigo);
            color: var(--primary-indigo);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: #F44336;
            color: #F44336;
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--dark-card);
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
            color: white;
            background: var(--secondary-cyan);
            color: #212121;
        }

        .option.correct .option-letter {
            background: var(--primary-indigo);
            color: white;
        }

        .option.incorrect .option-letter {
            background: #F44336;
            color: white;
        }

        .feedback-container {
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            display: none;
        }

        .feedback-correct {
            background: rgba(63, 81, 181, 0.1);
            border-left: 5px solid var(--primary-indigo);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 5px solid #F44336;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--primary-indigo);
        }

        .feedback-incorrect .feedback-icon {
            background: #F44336;
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .feedback-correct .feedback-title {
            color: var(--primary-indigo);
        }

        .feedback-incorrect .feedback-title {
            color: #F44336;
        }

        .feedback-message {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        /* Visualization Components */
        .visualization-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 25px;
            height: 100%;
            border: 1px solid var(--dark-border);
            overflow: auto;
            backdrop-filter: blur(5px);
        }

        /* Voice Display */
        .voice-display {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid var(--accent-amber);
            text-align: center;
        }

        .display-title {
            color: var(--primary-indigo);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            font-size: 1.3rem;
        }

        /* Active vs Passive Comparison */
        .comparison-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .comparison-box {
            background: var(--dark-card);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            min-width: 200px;
            transition: transform 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .comparison-box.active {
            border-color: var(--primary-indigo);
            background: rgba(63, 81, 181, 0.1);
        }

        .comparison-box.passive {
            border-color: var(--secondary-cyan);
            background: rgba(0, 188, 212, 0.1);
        }

        .comparison-box:hover {
            transform: scale(1.05);
        }

        .comparison-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .comparison-box.active .comparison-name {
            color: var(--primary-indigo);
        }

        .comparison-box.passive .comparison-name {
            color: var(--secondary-cyan);
        }

        .comparison-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* Voice Structure */
        .structure-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-green);
        }

        .voice-diagram {
            position: relative;
            width: 100%;
            height: 200px;
            margin: 20px auto;
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.1), transparent 70%);
            border-radius: 8px;
            padding: 20px;
        }

        .voice-part {
            position: absolute;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--accent-green);
            border-radius: 4px;
            padding: 8px;
            font-size: 0.9rem;
            text-align: center;
            min-width: 100px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-part:hover {
            background: rgba(76, 175, 80, 0.4);
            transform: scale(1.1);
        }

        /* Verb Forms */
        .verb-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-red);
        }

        .verb-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .verb-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .verb-box {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .verb-box:hover {
            transform: translateY(-3px);
        }

        .verb-box.active {
            border-color: var(--primary-indigo);
            background: rgba(63, 81, 181, 0.1);
        }

        .verb-box.passive {
            border-color: var(--secondary-cyan);
            background: rgba(0, 188, 212, 0.1);
        }

        .verb-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .verb-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .verb-box.active .verb-name {
            color: var(--primary-indigo);
        }

        .verb-box.passive .verb-name {
            color: var(--secondary-cyan);
        }

        /* Conversion Patterns */
        .conversion-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-purple);
        }

        .conversion-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 15px 0;
        }

        .conversion-box {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            min-width: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .conversion-box:hover {
            transform: scale(1.05);
            border-color: var(--accent-purple);
        }

        .conversion-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .conversion-name {
            font-weight: bold;
            color: var(--accent-purple);
            margin-bottom: 5px;
        }

        /* Tenses in Passive */
        .tense-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-orange);
        }

        .tense-types {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .tense-types {
                grid-template-columns: 1fr;
            }
        }

        .tense-box {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .tense-box:hover {
            transform: translateY(-3px);
        }

        .tense-box.present {
            border-color: var(--accent-green);
            background: rgba(76, 175, 80, 0.1);
        }

        .tense-box.past {
            border-color: var(--accent-orange);
            background: rgba(255, 152, 0, 0.1);
        }

        .tense-box.future {
            border-color: var(--accent-blue);
            background: rgba(33, 150, 243, 0.1);
        }

        .tense-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .tense-name {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tense-box.present .tense-name {
            color: var(--accent-green);
        }

        .tense-box.past .tense-name {
            color: var(--accent-orange);
        }

        .tense-box.future .tense-name {
            color: var(--accent-blue);
        }

        /* Voice Table */
        .voice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--dark-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .voice-table th {
            background: var(--dark-surface);
            padding: 12px;
            text-align: left;
            color: var(--accent-amber);
            border-bottom: 2px solid var(--accent-amber);
        }

        .voice-table td {
            padding: 10px;
            border-bottom: 1px solid var(--dark-border);
            color: var(--text-primary);
        }

        .voice-table tr:hover {
            background: rgba(255, 193, 7, 0.05);
        }

        /* Interactive Practice */
        .interactive-practice {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid var(--accent-purple);
        }

        .practice-title {
            color: var(--accent-purple);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .practice-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .practice-button {
            padding: 10px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--accent-purple);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .practice-button:hover {
            background: rgba(156, 39, 176, 0.1);
            transform: translateY(-2px);
        }

        .practice-display {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .results-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-indigo), var(--secondary-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-indigo), var(--secondary-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .score-percentage {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--dark-border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-indigo);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2rem;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .score-value {
                font-size: 3rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons .btn {
                width: 100%;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .concept-box {
                min-width: 140px;
                font-size: 1.5rem;
                padding: 15px 20px;
            }
            
            .tense-types {
                grid-template-columns: 1fr;
            }
            
            .verb-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease;
        }
        
        @keyframes grow {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .grow {
            animation: grow 0.5s ease forwards;
        }
        
        @keyframes voiceTransform {
            0% { transform: translateX(-100%) scale(0.5); opacity: 0; }
            50% { transform: translateX(0) scale(1.1); opacity: 0.8; }
            100% { transform: translateX(0) scale(1); opacity: 1; }
        }
        
        .voice-transform {
            animation: voiceTransform 1s ease forwards;
        }
        
        @keyframes activeFlow {
            0% { transform: translateX(-50px); background-color: rgba(63, 81, 181, 0.2); }
            50% { transform: translateX(0); background-color: rgba(63, 81, 181, 0.4); }
            100% { transform: translateX(50px); background-color: rgba(63, 81, 181, 0.2); }
        }
        
        .active-flow {
            animation: activeFlow 3s linear infinite;
        }
        
        @keyframes passiveFlow {
            0% { transform: translateX(50px); background-color: rgba(0, 188, 212, 0.2); }
            50% { transform: translateX(0); background-color: rgba(0, 188, 212, 0.4); }
            100% { transform: translateX(-50px); background-color: rgba(0, 188, 212, 0.2); }
        }
        
        .passive-flow {
            animation: passiveFlow 3s linear infinite;
        }
        
        @keyframes voiceConversion {
            0% { transform: scale(1); background-color: rgba(63, 81, 181, 0.2); }
            50% { transform: scale(1.1); background-color: rgba(0, 188, 212, 0.4); }
            100% { transform: scale(1); background-color: rgba(63, 81, 181, 0.2); }
        }
        
        .voice-conversion {
            animation: voiceConversion 2s ease-in-out infinite;
        }
        
        @keyframes tenseShift {
            0% { background-color: rgba(76, 175, 80, 0.2); }
            33% { background-color: rgba(255, 152, 0, 0.2); }
            66% { background-color: rgba(33, 150, 243, 0.2); }
            100% { background-color: rgba(76, 175, 80, 0.2); }
        }
        
        .tense-shift {
            animation: tenseShift 5s linear infinite;
        }
        
        @keyframes verbForms {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .verb-forms {
            animation: verbForms 3s linear infinite;
        }
    </style>
</head>
<body>
    <!-- Voice Pattern Background -->
    <div class="voice-bg" id="voiceBg">
        <!-- Elements will be generated by JavaScript -->
    </div>
    <div class="overlay"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToTopics">Other Topics</button>
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card fade-in" id="welcomePage">
            <div class="welcome-logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <h1 class="welcome-title">Grade 6 English</h1>
            <p class="welcome-subtitle">Master the power of voice in writing! Explore active and passive voice - learn how to identify them, convert between them, and use them effectively. Discover when to use active voice for clear, direct communication and when passive voice is appropriate. Build your grammar skills to create powerful, precise sentences!</p>
            
            <div class="topic-badge">
                <span class="topic-icon">üé≠üîÄ‚ú®</span>
                <span class="topic-name">Active & Passive Voice</span>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your full name:</label>
                <input type="text" id="studentName" placeholder="Your full name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">
                    <span>Start Voice Journey</span>
                </button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 120</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0.8%"></div>
                </div>
            </div>

            <div class="question-container">
                <!-- Language fact display -->
                <div id="languageFact"></div>
                
                <!-- Concept display area -->
                <div id="conceptDisplay"></div>
                
                <!-- Content Wrapper: Questions on left, Visualizations on right -->
                <div class="content-wrapper" id="contentWrapper">
                    <!-- Left side: Question and Options -->
                    <div class="question-side">
                        <h2 class="question-text" id="questionText"></h2>
                        
                        <div class="options-container" id="optionsContainer"></div>
                        
                        <div class="feedback-container" id="feedbackContainer">
                            <div class="feedback-header">
                                <div class="feedback-icon"></div>
                                <div class="feedback-title"></div>
                            </div>
                            <div class="feedback-message"></div>
                            <div class="feedback-explanation"></div>
                        </div>
                    </div>
                    
                    <!-- Right side: Visualizations -->
                    <div class="visualization-side">
                        <div class="visualization-container" id="visualizationContainer">
                            <!-- All visualizations will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip Question</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next Question</button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Voice Mastery Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                <div class="score-message" id="scoreMessage"></div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="highestScore">0</div>
                        <div class="stat-label">Highest Score</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Try Again</button>
                <button class="btn btn-secondary" id="viewTopics">Explore Other Topics</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize background
        function initBackground() {
            const voiceBg = document.getElementById('voiceBg');
            
            // Create floating voice symbols
            const elements = ['üé≠', 'üîÄ', '‚ú®', 'üó£Ô∏è', 'üì¢', 'üîä', 'üí¨', 'üìù', '‚úèÔ∏è', 'üìö', 'üî§', '‚ö°', 'üéØ', 'üåü'];
            
            for (let i = 0; i < 25; i++) {
                const element = document.createElement('div');
                element.className = 'floating-element';
                element.textContent = elements[Math.floor(Math.random() * elements.length)];
                element.style.left = `${Math.random() * 100}%`;
                element.style.top = `${Math.random() * 100}%`;
                element.style.animationDelay = `${Math.random() * 20}s`;
                element.style.fontSize = `${2 + Math.random() * 3}rem`;
                
                // Color different types
                if (['üé≠', 'üîÄ', '‚ú®', '‚ö°'].includes(element.textContent)) {
                    element.style.color = 'rgba(63, 81, 181, 0.1)'; // Indigo for transformation
                } else if (['üó£Ô∏è', 'üì¢', 'üîä', 'üí¨'].includes(element.textContent)) {
                    element.style.color = 'rgba(0, 188, 212, 0.1)'; // Cyan for voice
                } else if (['üìù', '‚úèÔ∏è', 'üìö', 'üî§'].includes(element.textContent)) {
                    element.style.color = 'rgba(255, 193, 7, 0.1)'; // Amber for writing
                } else {
                    element.style.color = 'rgba(63, 81, 181, 0.1)'; // Default indigo
                }
                
                voiceBg.appendChild(element);
            }
        }

        // Questions array - 120+ Grade 6 Active and Passive Voice questions
        const questions = [
            // Basic Voice Concepts (1-20)
            {
                type: "basic_concepts",
                question: "What is active voice?",
                options: ["Subject performs the action", "Subject receives the action", "No subject in sentence", "Using 'to be' verbs"],
                answer: "A",
                explanation: "Active voice: subject does the action. Example: 'The cat chased the mouse.'"
            },
            {
                type: "basic_concepts",
                question: "What is passive voice?",
                options: ["Subject receives the action", "Subject performs the action", "Short sentence", "Question form"],
                answer: "A",
                explanation: "Passive voice: subject receives the action. Example: 'The mouse was chased by the cat.'"
            },
            {
                type: "basic_concepts",
                question: "Active voice example:",
                options: ["The teacher graded the papers.", "The papers were graded by the teacher.", "Graded were the papers.", "By the teacher papers graded."],
                answer: "A",
                explanation: "'The teacher graded the papers.' = Active (teacher does the grading)."
            },
            {
                type: "basic_concepts",
                question: "Passive voice example:",
                options: ["The ball was thrown by the player.", "The player threw the ball.", "Threw the ball the player.", "Player ball thrown."],
                answer: "A",
                explanation: "'The ball was thrown by the player.' = Passive (ball receives the throwing)."
            },
            {
                type: "basic_concepts",
                question: "Which voice is usually clearer and more direct?",
                options: ["Active voice", "Passive voice", "Both equally", "Neither"],
                answer: "A",
                explanation: "Active voice is generally clearer because it shows who is doing what directly."
            },
            // Identifying Voice (21-40)
            {
                type: "identifying",
                question: "Identify voice: 'The committee approved the plan.'",
                options: ["Active", "Passive", "Neither", "Both"],
                answer: "A",
                explanation: "Active - subject (committee) performs action (approved)."
            },
            {
                type: "identifying",
                question: "Identify voice: 'The plan was approved by the committee.'",
                options: ["Passive", "Active", "Neither", "Both"],
                answer: "A",
                explanation: "Passive - subject (plan) receives action (was approved)."
            },
            {
                type: "identifying",
                question: "Identify voice: 'Students complete homework.'",
                options: ["Active", "Passive", "Neither", "Can't tell"],
                answer: "A",
                explanation: "Active - students (subject) do the action (complete)."
            },
            {
                type: "identifying",
                question: "Identify voice: 'Homework is completed by students.'",
                options: ["Passive", "Active", "Neither", "Confusing"],
                answer: "A",
                explanation: "Passive - homework (subject) receives action (is completed)."
            },
            // Verb Forms in Voice (41-60)
            {
                type: "verb_forms",
                question: "Passive voice always includes:",
                options: ["A form of 'to be' + past participle", "Only action verbs", "No helping verbs", "Present tense only"],
                answer: "A",
                explanation: "Passive: form of 'be' (am, is, are, was, were) + past participle (eaten, written, done)."
            },
            {
                type: "verb_forms",
                question: "Active voice verb form:",
                options: ["Simple verb (no 'to be')", "Always 'to be' + verb", "Only past tense", "Only present tense"],
                answer: "A",
                explanation: "Active voice uses simple verb forms without 'to be' helping verbs."
            },
            {
                type: "verb_forms",
                question: "Passive form of 'The chef cooks dinner.'",
                options: ["Dinner is cooked by the chef.", "The chef is cooked dinner.", "Cooked dinner by chef.", "Dinner cooks by chef."],
                answer: "A",
                explanation: "Active to passive: object becomes subject + 'is cooked' + 'by the chef'."
            },
            {
                type: "verb_forms",
                question: "Active form of 'The song was sung by the choir.'",
                options: ["The choir sang the song.", "The song sang the choir.", "Sang the choir the song.", "The choir was singing song."],
                answer: "A",
                explanation: "Passive to active: 'by' phrase becomes subject + active verb (sang)."
            },
            // Converting Voice (61-80)
            {
                type: "converting",
                question: "Convert to passive: 'The dog bit the man.'",
                options: ["The man was bitten by the dog.", "The dog was bitten by the man.", "Bitten was the man by dog.", "The man bit the dog."],
                answer: "A",
                explanation: "Object (man) becomes subject + 'was bitten' + 'by the dog'."
            },
            {
                type: "converting",
                question: "Convert to active: 'The window was broken by the ball.'",
                options: ["The ball broke the window.", "The window broke the ball.", "Broke the ball the window.", "The ball was broken window."],
                answer: "A",
                explanation: "'By' phrase (ball) becomes subject + active verb (broke) + object (window)."
            },
            // When to Use Each Voice (81-100)
            {
                type: "usage",
                question: "When is passive voice appropriate?",
                options: ["When doer is unknown/unimportant", "Always", "Never", "Only in questions"],
                answer: "A",
                explanation: "Use passive when focus is on action/receiver, not doer. Example: 'My bike was stolen.' (don't know who)."
            },
            {
                type: "usage",
                question: "When is active voice better?",
                options: ["For clear, direct communication", "When hiding the doer", "In scientific writing", "Never"],
                answer: "A",
                explanation: "Active voice is clearer and more engaging for most writing."
            },
            {
                type: "usage",
                question: "Good use of passive voice:",
                options: ["The results were announced yesterday.", "John announced results yesterday.", "Yesterday announced results.", "Announced were results."],
                answer: "A",
                explanation: "Passive works when focus is on results, not who announced them."
            },
            {
                type: "usage",
                question: "Active voice preferred in:",
                options: ["Most everyday writing", "Scientific reports only", "Never use it", "Only in stories"],
                answer: "A",
                explanation: "Active voice makes writing clearer and more engaging for readers."
            },
            // Tenses in Passive Voice (101-120)
            {
                type: "tenses",
                question: "Present simple passive:",
                options: ["am/is/are + past participle", "was/were + past participle", "will be + past participle", "have been + past participle"],
                answer: "A",
                explanation: "Present passive: am/is/are + past participle. Example: 'The room is cleaned daily.'"
            },
            {
                type: "tenses",
                question: "Past simple passive:",
                options: ["was/were + past participle", "am/is/are + past participle", "will be + past participle", "has been + past participle"],
                answer: "A",
                explanation: "Past passive: was/were + past participle. Example: 'The letter was written yesterday.'"
            },
            {
                type: "tenses",
                question: "Future passive:",
                options: ["will be + past participle", "am/is/are + past participle", "was/were + past participle", "has been + past participle"],
                answer: "A",
                explanation: "Future passive: will be + past participle. Example: 'The project will be completed soon.'"
            },
            // Common Errors (121-140)
            {
                type: "common_errors",
                question: "What's wrong: 'The cake was eaten.'",
                options: ["Missing 'by' phrase if doer is important", "Should be active", "Wrong verb tense", "Nothing wrong"],
                answer: "A",
                explanation: "If who ate the cake matters, add 'by' phrase or use active voice."
            },
            {
                type: "common_errors",
                question: "Problem with overusing passive:",
                options: ["Makes writing wordy/indirect", "Makes it too short", "Changes meaning", "No problem"],
                answer: "A",
                explanation: "Too much passive voice makes writing less clear and engaging."
            }
        ];

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // Positive feedback messages
        const positiveMessages = [
            "Excellent voice identification!",
            "Perfect conversion skills!",
            "Great understanding of verb forms!",
            "You're a voice expert!",
            "Perfect tense usage!",
            "You're a voice transformation champion!",
            "Outstanding grammar skills!",
            "Brilliant understanding of active/passive!",
            "You think like an editor!",
            "Voice mastery achieved!"
        ];

        // Language terms and definitions
        const languageTerms = [
            {
                term: "Active Voice",
                definition: "Subject performs the action",
                example: "The cat chased the mouse."
            },
            {
                term: "Passive Voice",
                definition: "Subject receives the action",
                example: "The mouse was chased by the cat."
            },
            {
                term: "Subject",
                definition: "Who/what performs or receives action",
                example: "In active: doer; in passive: receiver"
            },
            {
                term: "Past Participle",
                definition: "Verb form used in passive",
                example: "eaten, written, done, seen"
            },
            {
                term: "By-phrase",
                definition: "Shows who performs action in passive",
                example: "by the teacher, by the students"
            }
        ];

        // Voice examples by category
        const voiceExamples = [
            {
                category: "School",
                active: "The teacher explains the lesson.",
                passive: "The lesson is explained by the teacher.",
                conversion: "Object (lesson) becomes subject + is explained + by-phrase"
            },
            {
                category: "Home",
                active: "My mother bakes delicious cookies.",
                passive: "Delicious cookies are baked by my mother.",
                conversion: "Object (cookies) becomes subject + are baked + by-phrase"
            },
            {
                category: "Sports",
                active: "The player kicked the ball.",
                passive: "The ball was kicked by the player.",
                conversion: "Object (ball) becomes subject + was kicked + by-phrase"
            },
            {
                category: "Nature",
                active: "The wind blows the leaves.",
                passive: "The leaves are blown by the wind.",
                conversion: "Object (leaves) becomes subject + are blown + by-phrase"
            }
        ];

        // Verb forms for passive voice
        const passiveVerbForms = [
            {
                tense: "Present Simple",
                structure: "am/is/are + past participle",
                examples: "is eaten, are written, am told",
                icon: "‚è≥"
            },
            {
                tense: "Past Simple",
                structure: "was/were + past participle",
                examples: "was eaten, were written, was told",
                icon: "üìÖ"
            },
            {
                tense: "Future Simple",
                structure: "will be + past participle",
                examples: "will be eaten, will be written, will be told",
                icon: "üöÄ"
            },
            {
                tense: "Present Perfect",
                structure: "have/has been + past participle",
                examples: "has been eaten, have been written, has been told",
                icon: "‚úÖ"
            },
            {
                tense: "Past Perfect",
                structure: "had been + past participle",
                examples: "had been eaten, had been written, had been told",
                icon: "‚èÆÔ∏è"
            },
            {
                tense: "Modal Verbs",
                structure: "modal + be + past participle",
                examples: "can be eaten, should be written, must be told",
                icon: "üîß"
            }
        ];

        // Conversion patterns
        const conversionPatterns = [
            {
                pattern: "Active ‚Üí Passive",
                steps: ["1. Object becomes subject", "2. Add appropriate 'to be' verb", "3. Use past participle", "4. Add 'by' + original subject"],
                example: "Active: Cats eat mice. ‚Üí Passive: Mice are eaten by cats.",
                icon: "‚û°Ô∏è"
            },
            {
                pattern: "Passive ‚Üí Active",
                steps: ["1. 'By' phrase becomes subject", "2. Remove 'to be' verb", "3. Use simple verb form", "4. Make original subject the object"],
                example: "Passive: Books are read by students. ‚Üí Active: Students read books.",
                icon: "‚¨ÖÔ∏è"
            }
        ];

        // When to use each voice
        const voiceUsage = [
            {
                voice: "Active Voice",
                whenToUse: ["Most everyday writing", "Clear, direct communication", "Emphasizing who does action", "Making writing engaging"],
                examples: ["I completed the project.", "She teaches mathematics.", "We won the game."],
                icon: "üéØ"
            },
            {
                voice: "Passive Voice",
                whenToUse: ["Doer is unknown/unimportant", "Focus is on action/receiver", "Scientific/formal writing", "Being diplomatic/polite"],
                examples: ["The window was broken.", "Mistakes were made.", "The results were announced."],
                icon: "üîç"
            }
        ];

        // Common past participles
        const pastParticiples = [
            {
                base: "eat",
                past: "ate",
                participle: "eaten",
                example: "The cake was eaten."
            },
            {
                base: "write",
                past: "wrote",
                participle: "written",
                example: "The letter was written."
            },
            {
                base: "see",
                past: "saw",
                participle: "seen",
                example: "The movie was seen."
            },
            {
                base: "do",
                past: "did",
                participle: "done",
                example: "The work was done."
            },
            {
                base: "take",
                past: "took",
                participle: "taken",
                example: "The photo was taken."
            },
            {
                base: "give",
                past: "gave",
                participle: "given",
                example: "The gift was given."
            }
        ];

        // Interesting language facts
        const languageFacts = [
            "Active voice sentences are usually shorter than passive ones!",
            "Scientific writing often uses passive voice to sound objective!",
            "The passive voice always includes a form of the verb 'to be'!",
            "You can make any active sentence passive, but not all passive sentences can be made active!",
            "News reports often use passive voice when the doer is unknown!",
            "The word 'by' is the key indicator of who does the action in passive voice!",
            "Some verbs don't have passive forms, like 'exist' or 'seem'!",
            "Great writers use both active and passive voice strategically!"
        ];

        // Voice in different contexts
        const voiceContexts = [
            {
                context: "News Headlines",
                active: "Mayor Announces New Park",
                passive: "New Park Announced by Mayor",
                reason: "Active emphasizes who; passive emphasizes what"
            },
            {
                context: "Instructions",
                active: "Press the button to start",
                passive: "The button should be pressed to start",
                reason: "Active is more direct for instructions"
            },
            {
                context: "Scientific Reports",
                active: "We conducted three experiments",
                passive: "Three experiments were conducted",
                reason: "Passive sounds more objective in science"
            },
            {
                context: "Stories",
                active: "The hero saved the village",
                passive: "The village was saved by the hero",
                reason: "Active creates more engaging narratives"
            }
        ];

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const languageFact = document.getElementById('languageFact');
        const conceptDisplay = document.getElementById('conceptDisplay');
        const visualizationContainer = document.getElementById('visualizationContainer');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const backToTopicsBtn = document.getElementById('backToTopics');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const scoreMessage = document.getElementById('scoreMessage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const highestScore = document.getElementById('highestScore');

        // Initialize the app
        function initApp() {
            initBackground();
            loadStateFromStorage();
            setupEventListeners();
            
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Load state from localStorage
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixGrade6EnglishVoice');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // Save state to localStorage
        function saveStateToStorage() {
            localStorage.setItem('ideolixGrade6EnglishVoice', JSON.stringify(appState));
        }

        // Initialize and shuffle questions
        function initializeQuestions() {
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', backToHome);
            backToTopicsBtn.addEventListener('click', backToTopics);
            viewTopicsBtn.addEventListener('click', backToTopics);
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startPractice();
                }
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            
            const highest = localStorage.getItem('ideolixGrade6EnglishVoice_highestScore') || 0;
            highestScore.textContent = Math.max(highest, appState.score);
            
            if (appState.score > highest) {
                localStorage.setItem('ideolixGrade6EnglishVoice_highestScore', appState.score);
            }
            
            if (percentage >= 90) {
                scoreMessage.textContent = "Outstanding! You're a voice expert!";
            } else if (percentage >= 80) {
                scoreMessage.textContent = "Great job! You have excellent voice conversion skills!";
            } else if (percentage >= 70) {
                scoreMessage.textContent = "Good work! Keep practicing active/passive voice!";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "Not bad! Review verb forms and conversion patterns!";
            } else {
                scoreMessage.textContent = "Keep exploring! Mastering voice will make your writing powerful!";
            }
        }

        // Create language fact display
        function createLanguageFact() {
            const factDiv = document.createElement('div');
            factDiv.className = 'language-fact';
            
            factDiv.innerHTML = `<strong>Amazing Voice Fact:</strong> ${languageFacts[Math.floor(Math.random() * languageFacts.length)]}`;
            
            return factDiv;
        }

        // Create concept display
        function createConceptDisplay() {
            const display = document.createElement('div');
            display.className = 'concept-display';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            const conceptIcons = {
                "basic_concepts": "üé≠",
                "identifying": "üîç",
                "verb_forms": "üìù",
                "converting": "üîÑ",
                "usage": "üéØ",
                "tenses": "‚è≥",
                "common_errors": "‚ö†Ô∏è"
            };
            
            let conceptName = "Basic Concepts";
            let conceptIcon = "üé≠";
            
            if (question.type.includes("basic_concepts")) {
                conceptName = "Basic Concepts";
                conceptIcon = conceptIcons.basic_concepts;
            } else if (question.type.includes("identifying")) {
                conceptName = "Identifying Voice";
                conceptIcon = conceptIcons.identifying;
            } else if (question.type.includes("verb_forms")) {
                conceptName = "Verb Forms";
                conceptIcon = conceptIcons.verb_forms;
            } else if (question.type.includes("converting")) {
                conceptName = "Converting Voice";
                conceptIcon = conceptIcons.converting;
            } else if (question.type.includes("usage")) {
                conceptName = "When to Use";
                conceptIcon = conceptIcons.usage;
            } else if (question.type.includes("tenses")) {
                conceptName = "Tenses in Passive";
                conceptIcon = conceptIcons.tenses;
            } else if (question.type.includes("common_errors")) {
                conceptName = "Common Errors";
                conceptIcon = conceptIcons.common_errors;
            }
            
            const conceptBox = document.createElement('div');
            conceptBox.className = 'concept-box grow';
            conceptBox.innerHTML = `
                <div class="concept-icon">${conceptIcon}</div>
                <div class="concept-text">${conceptName.toUpperCase()}</div>
            `;
            
            const label = document.createElement('div');
            label.className = 'concept-label';
            
            if (question.type.includes("basic_concepts")) {
                label.textContent = "Understanding active vs passive voice";
            } else if (question.type.includes("identifying")) {
                label.textContent = "Recognizing active and passive sentences";
            } else if (question.type.includes("verb_forms")) {
                label.textContent = "Verb structures in different voices";
            } else if (question.type.includes("converting")) {
                label.textContent = "Changing between active and passive";
            } else if (question.type.includes("usage")) {
                label.textContent = "When to use each voice effectively";
            } else if (question.type.includes("tenses")) {
                label.textContent = "Passive voice in different tenses";
            } else if (question.type.includes("common_errors")) {
                label.textContent = "Avoiding common voice mistakes";
            }
            
            display.appendChild(conceptBox);
            display.appendChild(label);
            
            return display;
        }

        // Create voice visualization
        function createVoiceVisualization() {
            const vizDiv = document.createElement('div');
            vizDiv.className = 'visualization-container';
            
            const voiceExample = voiceExamples[Math.floor(Math.random() * voiceExamples.length)];
            const voiceContext = voiceContexts[Math.floor(Math.random() * voiceContexts.length)];
            const passiveForm = passiveVerbForms[Math.floor(Math.random() * passiveVerbForms.length)];
            
            vizDiv.innerHTML = `
                <h3 style="text-align: center; margin-bottom: 20px; color: var(--accent-amber);">Active & Passive Voice Explorer</h3>
                
                <div class="comparison-container">
                    <div class="comparison-box active active-flow" onclick="showVoiceDetails('Active')">
                        <div class="comparison-icon">üéØ</div>
                        <div class="comparison-name">Active Voice</div>
                        <div class="comparison-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 5px;">
                            Subject does action
                        </div>
                    </div>
                    <div class="comparison-box passive passive-flow" onclick="showVoiceDetails('Passive')">
                        <div class="comparison-icon">üîç</div>
                        <div class="comparison-name">Passive Voice</div>
                        <div class="comparison-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 5px;">
                            Subject receives action
                        </div>
                    </div>
                </div>
                
                <div class="voice-display voice-conversion">
                    <div style="font-size: 1.5rem; margin-bottom: 15px;">
                        Category: <span style="color: var(--primary-indigo); font-weight: bold;">${voiceExample.category}</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; color: var(--primary-indigo); margin-bottom: 10px;">Active Voice</div>
                            <div style="font-size: 1rem; color: var(--text-secondary); font-style: italic;">${voiceExample.active}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">Subject ‚Üí Verb ‚Üí Object</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; color: var(--secondary-cyan); margin-bottom: 10px;">Passive Voice</div>
                            <div style="font-size: 1rem; color: var(--text-secondary); font-style: italic;">${voiceExample.passive}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">Object ‚Üí "to be" + Past Participle ‚Üí "by" + Subject</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 10px; background: rgba(255, 193, 7, 0.1); border-radius: 6px; border-left: 3px solid var(--accent-amber);">
                        <div style="font-size: 0.9rem; color: var(--accent-amber);"><strong>Conversion:</strong> ${voiceExample.conversion}</div>
                    </div>
                </div>
                
                <div class="structure-container voice-transform">
                    <div class="display-title">Voice Structure - How They're Built</div>
                    <div style="text-align: center; margin-bottom: 15px; color: var(--text-secondary);">
                        Understanding the building blocks of each voice
                    </div>
                    
                    <div class="voice-diagram">
                        <div class="voice-part" style="top: 20%; left: 10%;" onclick="showVoicePart('Active Subject')">
                            Active Subject<br>(Doer)
                        </div>
                        <div class="voice-part" style="top: 20%; right: 10%;" onclick="showVoicePart('Active Verb')">
                            Active Verb<br>(Simple)
                        </div>
                        <div class="voice-part" style="bottom: 20%; left: 10%;" onclick="showVoicePart('Active Object')">
                            Active Object<br>(Receiver)
                        </div>
                        <div class="voice-part" style="bottom: 20%; right: 10%;" onclick="showVoicePart('Passive Subject')">
                            Passive Subject<br>(Receiver)
                        </div>
                        <div class="voice-part" style="top: 50%; left: 40%; transform: translateY(-50%);" onclick="showVoicePart('To Be Verb')">
                            "To Be" Verb
                        </div>
                        <div class="voice-part" style="top: 50%; right: 40%; transform: translateY(-50%);" onclick="showVoicePart('Past Participle')">
                            Past Participle
                        </div>
                        <div class="voice-part" style="bottom: 50%; left: 50%; transform: translateX(-50%);" onclick="showVoicePart('By-Phrase')">
                            By-Phrase<br>(Optional Doer)
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <div style="font-weight: bold; color: var(--accent-green);">Formula:</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 5px;">
                            Active: Subject + Verb + Object<br>
                            Passive: Subject + "to be" + Past Participle + (by + Agent)
                        </div>
                    </div>
                </div>
                
                <div class="verb-container">
                    <div class="display-title">Passive Verb Forms - Different Tenses</div>
                    <div style="text-align: center; margin-bottom: 15px; color: var(--text-secondary);">
                        ${passiveForm.tense}: ${passiveForm.structure}
                    </div>
                    
                    <div class="verb-grid">
                        ${passiveVerbForms.slice(0, 6).map((form, idx) => `
                            <div class="verb-box passive" onclick="showPassiveForm('${form.tense}')">
                                <div class="verb-icon">${form.icon}</div>
                                <div class="verb-name">${form.tense}</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">${form.structure}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="conversion-container">
                    <div class="display-title">Conversion Patterns - Changing Voice</div>
                    <div style="text-align: center; margin-bottom: 15px; color: var(--text-secondary);">
                        Step-by-step process for converting between voices
                    </div>
                    
                    <div class="conversion-methods">
                        ${conversionPatterns.map((pattern, idx) => `
                            <div class="conversion-box" onclick="showConversionPattern('${pattern.pattern}')">
                                <div class="conversion-icon">${pattern.icon}</div>
                                <div class="conversion-name">${pattern.pattern}</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">${pattern.steps.length} steps</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(156, 39, 176, 0.1); border-radius: 8px; border: 1px solid var(--accent-purple);">
                        <div style="color: var(--accent-purple); font-weight: bold; margin-bottom: 10px;">Quick Conversion Tip:</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">
                            To convert Active ‚Üí Passive:<br>
                            1. Make object the subject<br>
                            2. Add "to be" verb matching tense<br>
                            3. Use past participle of main verb<br>
                            4. Add "by" + original subject (optional)
                        </div>
                    </div>
                </div>
                
                <div class="tense-container tense-shift">
                    <div class="display-title">When to Use Each Voice - Context Matters</div>
                    <div style="text-align: center; margin-bottom: 15px; color: var(--text-secondary);">
                        ${voiceContext.context}: Active vs Passive
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                        ${voiceUsage.map((usage, idx) => `
                            <div class="tense-box ${usage.voice.includes('Active') ? 'present' : 'past'}" onclick="showVoiceUsage('${usage.voice}')">
                                <div class="tense-icon">${usage.icon}</div>
                                <div class="tense-name">${usage.voice}</div>
                                <div style="font-size: 0.9rem; margin: 10px 0;">
                                    ${usage.whenToUse.slice(0, 2).map(item => `‚Ä¢ ${item}`).join('<br>')}
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Example: ${usage.examples[0]}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <table class="voice-table">
                    <thead>
                        <tr>
                            <th>Tense</th>
                            <th>Active Voice</th>
                            <th>Passive Voice</th>
                            <th>Example (Passive)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="font-weight: bold; color: var(--accent-green);">Present Simple</td>
                            <td>eat/eats</td>
                            <td>am/is/are eaten</td>
                            <td style="font-style: italic;">The apple is eaten.</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: var(--accent-orange);">Past Simple</td>
                            <td>ate</td>
                            <td>was/were eaten</td>
                            <td style="font-style: italic;">The apple was eaten.</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: var(--accent-blue);">Future Simple</td>
                            <td>will eat</td>
                            <td>will be eaten</td>
                            <td style="font-style: italic;">The apple will be eaten.</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: var(--accent-purple);">Present Perfect</td>
                            <td>have/has eaten</td>
                            <td>have/has been eaten</td>
                            <td style="font-style: italic;">The apple has been eaten.</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: var(--accent-red);">Past Perfect</td>
                            <td>had eaten</td>
                            <td>had been eaten</td>
                            <td style="font-style: italic;">The apple had been eaten.</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="real-world-example" style="background: var(--dark-card); padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid var(--accent-orange); font-style: italic; color: var(--text-secondary);">
                    <div style="color: var(--accent-orange); font-weight: bold; margin-bottom: 10px;">Real-World Voice Usage:</div>
                    "In a news report about a stolen painting: Active voice: 'Thieves stole the valuable painting last night.' (emphasizes who did it). Passive voice: 'The valuable painting was stolen last night.' (emphasizes what happened, useful if thieves unknown). In instructions: Active: 'Press the red button to start.' (clear, direct). Passive: 'The red button should be pressed to start.' (more formal). In science: Passive: 'The experiment was conducted three times.' (focus on process, not researcher)."
                    <div style="margin-top: 10px;">
                        <strong>Key concepts:</strong> Active = clear/direct, Passive = focus on action/receiver, formal/objective.
                    </div>
                </div>
                
                <div class="interactive-practice">
                    <div class="practice-title">Interactive Voice Practice</div>
                    <div class="practice-controls">
                        <div class="practice-button" onclick="identifyVoice()">Identify Voice</div>
                        <div class="practice-button" onclick="convertVoice()">Convert Voice</div>
                        <div class="practice-button" onclick="completePassive()">Complete Passive</div>
                        <div class="practice-button" onclick="voiceChallenge()">Voice Challenge</div>
                    </div>
                    <div class="practice-display" id="practiceDisplay">
                        Click buttons above to practice voice concepts
                    </div>
                </div>
                
                <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid var(--accent-red);">
                    <div style="color: var(--accent-red); font-weight: bold; margin-bottom: 10px;">Quick Practice:</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        1. Identify: "The book was read by the student." (Active/Passive?)<br>
                        2. Convert to passive: "The chef cooked the meal."<br>
                        3. Convert to active: "The letter was written by Maria."<br>
                        4. When should you use passive voice?<br>
                        5. What verb form is always in passive voice?
                    </div>
                </div>
                
                <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin-top: 20px; border: 2px solid var(--primary-indigo);">
                    <div style="color: var(--primary-indigo); font-weight: bold; margin-bottom: 10px; text-align: center;">Voice Tips</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center;">
                        <strong>Active:</strong> Subject ‚Üí Verb ‚Üí Object (clear, direct)<br>
                        <strong>Passive:</strong> Subject + "to be" + Past Participle (+ by-agent)<br>
                        <strong>Check:</strong> Who's doing the action? Is that important?
                    </div>
                </div>
            `;
            
            return vizDiv;
        }

        // Helper functions
        function getIconForTense(tenseName) {
            const iconMap = {
                "Present Simple": "‚è≥",
                "Past Simple": "üìÖ",
                "Future Simple": "üöÄ",
                "Present Perfect": "‚úÖ",
                "Past Perfect": "‚èÆÔ∏è",
                "Modal Verbs": "üîß"
            };
            return iconMap[tenseName] || "üìù";
        }

        // Global functions for interactive practice
        window.showVoiceDetails = function(voiceType) {
            if (voiceType === 'Active') {
                alert(`üéØ Active Voice\n\nStructure: Subject + Verb + Object\n\nExample: "The cat chased the mouse."\n\n‚Ä¢ Subject (cat) performs action\n‚Ä¢ Verb (chased) shows action\n‚Ä¢ Object (mouse) receives action\n\nUse active voice for clear, direct communication.`);
            } else {
                alert(`üîç Passive Voice\n\nStructure: Subject + "to be" + Past Participle + (by + Agent)\n\nExample: "The mouse was chased by the cat."\n\n‚Ä¢ Subject (mouse) receives action\n‚Ä¢ "to be" verb (was) + past participle (chased)\n‚Ä¢ "by" phrase shows who did it (optional)\n\nUse passive when focus is on action/receiver, not doer.`);
            }
        };

        window.showVoicePart = function(partName) {
            const parts = {
                "Active Subject": "Who performs the action in active voice\n\n‚Ä¢ Usually comes first in sentence\n‚Ä¢ Does the action\n‚Ä¢ Examples: 'The teacher', 'She', 'Our team'",
                "Active Verb": "Action performed by subject in active voice\n\n‚Ä¢ Shows what happens\n‚Ä¢ Simple verb form (no 'to be')\n‚Ä¢ Examples: 'teaches', 'wrote', 'will study'",
                "Active Object": "Receives the action in active voice\n\n‚Ä¢ Usually comes after verb\n‚Ä¢ Answers 'what?' or 'whom?'\n‚Ä¢ Examples: 'the lesson', 'a letter', 'mathematics'",
                "Passive Subject": "Receives the action in passive voice\n\n‚Ä¢ Was the object in active voice\n‚Ä¢ Now comes first in sentence\n‚Ä¢ Examples: 'The lesson', 'A letter', 'The work'",
                "To Be Verb": "Required in all passive voice sentences\n\n‚Ä¢ am, is, are, was, were, be, been\n‚Ä¢ Matches tense of original active verb\n‚Ä¢ Examples: 'is', 'was', 'will be', 'has been'",
                "Past Participle": "Main verb form in passive voice\n\n‚Ä¢ Third form of verb (eaten, written, done)\n‚Ä¢ Comes after 'to be' verb\n‚Ä¢ Shows the action that was received",
                "By-Phrase": "Shows who performed the action (optional)\n\n‚Ä¢ Starts with 'by'\n‚Ä¢ Contains the original subject\n‚Ä¢ Can be omitted if doer is unknown/unimportant"
            };
            
            alert(`${partName}\n\n${parts[partName]}`);
        };

        window.showPassiveForm = function(tenseName) {
            const form = passiveVerbForms.find(f => f.tense === tenseName);
            if (!form) return;
            
            alert(`${form.tense} Passive\n\nStructure: ${form.structure}\n\nExamples: ${form.examples}\n\nThis form is used when you want to focus on the action/receiver in the ${form.tense.toLowerCase()}.`);
        };

        window.showConversionPattern = function(patternName) {
            const pattern = conversionPatterns.find(p => p.pattern === patternName);
            if (!pattern) return;
            
            alert(`${pattern.pattern}\n\nSteps:\n${pattern.steps.join('\n')}\n\nExample:\n${pattern.example}\n\nRemember: Not all passive sentences can be converted to active if the 'by' phrase is missing.`);
        };

        window.showVoiceUsage = function(voiceName) {
            const usage = voiceUsage.find(u => u.voice === voiceName);
            if (!usage) return;
            
            alert(`${usage.voice}\n\nWhen to use:\n${usage.whenToUse.map(item => `‚Ä¢ ${item}`).join('\n')}\n\nExamples:\n${usage.examples.map(ex => `‚Ä¢ ${ex}`).join('\n')}\n\n${usage.voice.includes('Active') ? 'Active voice makes writing clearer and more engaging.' : 'Passive voice focuses on the action or result, not who did it.'}`);
        };

        window.identifyVoice = function() {
            const practiceDisplay = document.getElementById('practiceDisplay');
            if (!practiceDisplay) return;
            
            const sentences = [
                {
                    sentence: "The students completed the assignment.",
                    voice: "Active",
                    explanation: "'students' (subject) performs action 'completed'"
                },
                {
                    sentence: "The assignment was completed by the students.",
                    voice: "Passive",
                    explanation: "'assignment' (subject) receives action 'was completed'"
                },
                {
                    sentence: "Someone left the door open.",
                    voice: "Active",
                    explanation: "'someone' (subject) performs action 'left'"
                },
                {
                    sentence: "The door was left open.",
                    voice: "Passive",
                    explanation: "'door' (subject) receives action 'was left'"
                }
            ];
            
            const currentSentence = sentences[Math.floor(Math.random() * sentences.length)];
            
            practiceDisplay.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--primary-indigo);">Identify Voice</div>
                    <div style="font-size: 1.3rem; margin-bottom: 15px; font-style: italic; color: var(--text-primary);">
                        "${currentSentence.sentence}"
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr; gap: 10px; margin: 20px 0;">
                        ${["Active", "Passive"].map((voice, idx) => `
                            <div class="option" onclick="checkVoiceIdentification(this, '${voice}', '${currentSentence.voice}')">
                                <div class="option-letter">${String.fromCharCode(65 + idx)}</div>
                                <div class="option-text">${voice} Voice</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div id="voiceIdentificationResult" style="margin-top: 20px; min-height: 30px; font-weight: bold;"></div>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                        <strong>Hint:</strong> Look for "to be" + past participle = passive. Who does the action?
                    </div>
                </div>
            `;
            
            window.currentSentenceExplanation = currentSentence.explanation;
        };

        window.checkVoiceIdentification = function(element, selectedVoice, correctVoice) {
            const resultDiv = document.getElementById('voiceIdentificationResult');
            if (!resultDiv) return;
            
            const options = element.parentElement.querySelectorAll('.option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            if (selectedVoice === correctVoice) {
                element.classList.add('correct');
                resultDiv.textContent = `Correct! This is ${correctVoice} voice. ${window.currentSentenceExplanation}`;
                resultDiv.style.color = correctVoice === 'Active' ? 'var(--primary-indigo)' : 'var(--secondary-cyan)';
            } else {
                element.classList.add('incorrect');
                // Find and highlight correct option
                options.forEach(opt => {
                    if (opt.querySelector('.option-text').textContent.includes(correctVoice)) {
                        opt.classList.add('correct');
                    }
                });
                resultDiv.textContent = `Incorrect. This is ${correctVoice} voice. ${window.currentSentenceExplanation}`;
                resultDiv.style.color = 'var(--accent-orange)';
            }
            
            resultDiv.classList.add('pulse');
            setTimeout(() => resultDiv.classList.remove('pulse'), 500);
        };

        window.convertVoice = function() {
            const practiceDisplay = document.getElementById('practiceDisplay');
            if (!practiceDisplay) return;
            
            const conversions = [
                {
                    direction: "Active to Passive",
                    sentence: "The chef prepared the meal.",
                    answer: "The meal was prepared by the chef.",
                    explanation: "Object (meal) becomes subject + 'was prepared' + 'by the chef'"
                },
                {
                    direction: "Passive to Active",
                    sentence: "The letter was written by Sarah.",
                    answer: "Sarah wrote the letter.",
                    explanation: "'by Sarah' becomes subject + active verb 'wrote' + object 'the letter'"
                }
            ];
            
            const currentConversion = conversions[Math.floor(Math.random() * conversions.length)];
            
            practiceDisplay.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--secondary-cyan);">Convert Voice</div>
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 10px;">Convert this sentence:</div>
                        <div style="font-size: 1.3rem; font-style: italic; color: var(--text-primary);">
                            "${currentConversion.sentence}"
                        </div>
                        <div style="font-size: 1rem; color: var(--accent-amber); margin-top: 10px;">
                            ${currentConversion.direction}
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <textarea id="conversionAnswer" placeholder="Type your converted sentence here..." style="width: 100%; min-height: 80px; padding: 15px; background: var(--dark-surface); border: 2px solid var(--dark-border); border-radius: 8px; color: var(--text-primary); font-size: 1rem; resize: vertical;"></textarea>
                    </div>
                    
                    <div>
                        <button class="btn btn-small btn-secondary" onclick="checkConversion()">Check Answer</button>
                        <button class="btn btn-small btn-outline" onclick="showConversionAnswer()">Show Answer</button>
                    </div>
                    
                    <div id="conversionResult" style="margin-top: 20px; min-height: 30px; font-weight: bold;"></div>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                        <strong>Remember:</strong> Active ‚Üí Passive: object becomes subject + "to be" + past participle + by-phrase
                    </div>
                </div>
            `;
            
            window.currentConversionAnswer = currentConversion.answer;
            window.currentConversionExplanation = currentConversion.explanation;
        };

        window.checkConversion = function() {
            const answerInput = document.getElementById('conversionAnswer');
            const resultDiv = document.getElementById('conversionResult');
            
            if (!answerInput || !resultDiv) return;
            
            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = window.currentConversionAnswer.toLowerCase();
            
            // Remove extra spaces and punctuation for comparison
            const cleanUserAnswer = userAnswer.replace(/[.,]/g, '').replace(/\s+/g, ' ');
            const cleanCorrectAnswer = correctAnswer.replace(/[.,]/g, '').replace(/\s+/g, ' ');
            
            // Simple keyword checking
            const keywords = cleanCorrectAnswer.split(' ').filter(word => word.length > 2);
            let matchCount = 0;
            
            keywords.forEach(keyword => {
                if (cleanUserAnswer.includes(keyword)) {
                    matchCount++;
                }
            });
            
            const matchPercentage = (matchCount / keywords.length) * 100;
            
            if (matchPercentage > 80) {
                resultDiv.textContent = "Excellent conversion! Perfect!";
                resultDiv.style.color = 'var(--primary-indigo)';
            } else if (matchPercentage > 60) {
                resultDiv.textContent = "Good attempt! Check the answer for minor adjustments.";
                resultDiv.style.color = 'var(--secondary-cyan)';
            } else if (matchPercentage > 40) {
                resultDiv.textContent = "Partial match. Review the conversion steps.";
                resultDiv.style.color = 'var(--accent-amber)';
            } else {
                resultDiv.textContent = "Try again. Remember the structure for voice conversion.";
                resultDiv.style.color = 'var(--accent-orange)';
            }
        };

        window.showConversionAnswer = function() {
            const resultDiv = document.getElementById('conversionResult');
            if (resultDiv && window.currentConversionAnswer) {
                resultDiv.innerHTML = `
                    <div>
                        <div style="color: var(--secondary-cyan); margin-bottom: 5px;"><strong>Correct answer:</strong> ${window.currentConversionAnswer}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">${window.currentConversionExplanation}</div>
                    </div>
                `;
            }
        };

        window.completePassive = function() {
            const practiceDisplay = document.getElementById('practiceDisplay');
            if (!practiceDisplay) return;
            
            const completions = [
                {
                    base: "The cat (chase) the mouse.",
                    passive: "The mouse ______ by the cat.",
                    answer: "was chased",
                    explanation: "Past simple passive: was + past participle of 'chase'"
                },
                {
                    base: "She (write) a letter every week.",
                    passive: "A letter ______ by her every week.",
                    answer: "is written",
                    explanation: "Present simple passive: is + past participle of 'write'"
                },
                {
                    base: "They (build) this house last year.",
                    passive: "This house ______ by them last year.",
                    answer: "was built",
                    explanation: "Past simple passive: was + past participle of 'build'"
                }
            ];
            
            const currentCompletion = completions[Math.floor(Math.random() * completions.length)];
            
            practiceDisplay.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--accent-green);">Complete the Passive</div>
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 10px;">Active sentence:</div>
                        <div style="font-size: 1.3rem; font-style: italic; color: var(--text-primary);">
                            ${currentCompletion.base}
                        </div>
                        <div style="font-size: 1.1rem; color: var(--text-secondary); margin-top: 15px;">Passive sentence:</div>
                        <div style="font-size: 1.3rem; font-style: italic; color: var(--text-primary); margin-top: 5px;">
                            ${currentCompletion.passive}
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <input type="text" id="completionAnswer" placeholder="Type the missing words..." style="width: 100%; padding: 15px; background: var(--dark-surface); border: 2px solid var(--dark-border); border-radius: 8px; color: var(--text-primary); font-size: 1rem;">
                    </div>
                    
                    <div>
                        <button class="btn btn-small btn-secondary" onclick="checkCompletion()">Check Answer</button>
                        <button class="btn btn-small btn-outline" onclick="showCompletionAnswer()">Show Answer</button>
                    </div>
                    
                    <div id="completionResult" style="margin-top: 20px; min-height: 30px; font-weight: bold;"></div>
                </div>
            `;
            
            window.currentCompletionAnswer = currentCompletion.answer;
            window.currentCompletionExplanation = currentCompletion.explanation;
        };

        window.checkCompletion = function() {
            const answerInput = document.getElementById('completionAnswer');
            const resultDiv = document.getElementById('completionResult');
            
            if (!answerInput || !resultDiv) return;
            
            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = window.currentCompletionAnswer.toLowerCase();
            
            if (userAnswer === correctAnswer) {
                resultDiv.textContent = "Perfect! You completed the passive sentence correctly!";
                resultDiv.style.color = 'var(--primary-indigo)';
            } else if (userAnswer.includes(correctAnswer.split(' ')[0]) || userAnswer.includes(correctAnswer.split(' ')[1])) {
                resultDiv.textContent = "Close! Check the verb form carefully.";
                resultDiv.style.color = 'var(--secondary-cyan)';
            } else {
                resultDiv.textContent = "Try again. Remember: 'to be' + past participle.";
                resultDiv.style.color = 'var(--accent-orange)';
            }
        };

        window.showCompletionAnswer = function() {
            const resultDiv = document.getElementById('completionResult');
            if (resultDiv && window.currentCompletionAnswer) {
                resultDiv.innerHTML = `
                    <div>
                        <div style="color: var(--secondary-cyan); margin-bottom: 5px;"><strong>Correct answer:</strong> ${window.currentCompletionAnswer}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">${window.currentCompletionExplanation}</div>
                    </div>
                `;
            }
        };

        window.voiceChallenge = function() {
            const practiceDisplay = document.getElementById('practiceDisplay');
            if (!practiceDisplay) return;
            
            const challenges = [
                {
                    type: "Error Correction",
                    challenge: "Fix this awkward passive sentence: 'The ball by the player was thrown.'",
                    answer: "The ball was thrown by the player."
                },
                {
                    type: "Voice Choice",
                    challenge: "Which is better and why: 'I made a mistake' or 'A mistake was made'?",
                    answer: "'I made a mistake' (active) is better for personal responsibility. 'A mistake was made' (passive) avoids saying who did it."
                },
                {
                    type: "Tense Challenge",
                    challenge: "Convert to future passive: 'They will announce the results tomorrow.'",
                    answer: "The results will be announced tomorrow."
                }
            ];
            
            const currentChallenge = challenges[Math.floor(Math.random() * challenges.length)];
            
            practiceDisplay.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--accent-purple);">Voice Challenge: ${currentChallenge.type}</div>
                    <div style="font-size: 1.2rem; margin-bottom: 15px; font-style: italic;">
                        "${currentChallenge.challenge}"
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <textarea id="challengeAnswer" placeholder="Type your answer here..." style="width: 100%; min-height: 100px; padding: 15px; background: var(--dark-surface); border: 2px solid var(--dark-border); border-radius: 8px; color: var(--text-primary); font-size: 1rem; resize: vertical;"></textarea>
                    </div>
                    
                    <div>
                        <button class="btn btn-small btn-secondary" onclick="checkVoiceChallenge()">Check Answer</button>
                        <button class="btn btn-small btn-outline" onclick="showVoiceChallengeAnswer()">Show Answer</button>
                    </div>
                    
                    <div id="voiceChallengeResult" style="margin-top: 20px; min-height: 30px; font-weight: bold;"></div>
                </div>
            `;
            
            window.currentVoiceChallengeAnswer = currentChallenge.answer;
        };

        window.checkVoiceChallenge = function() {
            const answerInput = document.getElementById('challengeAnswer');
            const resultDiv = document.getElementById('voiceChallengeResult');
            
            if (!answerInput || !resultDiv) return;
            
            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = window.currentVoiceChallengeAnswer.toLowerCase();
            
            // Simple keyword checking
            const keywords = correctAnswer.split(' ').filter(word => word.length > 3);
            let matchCount = 0;
            
            keywords.forEach(keyword => {
                if (userAnswer.includes(keyword.toLowerCase())) {
                    matchCount++;
                }
            });
            
            const matchPercentage = (matchCount / keywords.length) * 100;
            
            if (matchPercentage > 70) {
                resultDiv.textContent = "Excellent understanding! Well done!";
                resultDiv.style.color = 'var(--primary-indigo)';
            } else if (matchPercentage > 40) {
                resultDiv.textContent = "Good attempt! Check the answer for comparison.";
                resultDiv.style.color = 'var(--secondary-cyan)';
            } else {
                resultDiv.textContent = "Try again! Review voice concepts and try this challenge.";
                resultDiv.style.color = 'var(--accent-orange)';
            }
        };

        window.showVoiceChallengeAnswer = function() {
            const resultDiv = document.getElementById('voiceChallengeResult');
            if (resultDiv && window.currentVoiceChallengeAnswer) {
                resultDiv.textContent = `Suggested answer: ${window.currentVoiceChallengeAnswer}`;
                resultDiv.style.color = 'var(--accent-purple)';
            }
        };

        // Load current question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            languageFact.innerHTML = '';
            conceptDisplay.innerHTML = '';
            visualizationContainer.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            languageFact.appendChild(createLanguageFact());
            conceptDisplay.appendChild(createConceptDisplay());
            visualizationContainer.appendChild(createVoiceVisualization());
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                optionElement.classList.add('pulse');
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation, question.answer);
            }
            
            nextQuestionBtn.disabled = false;
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackMessage = feedbackContainer.querySelector('.feedback-message');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '‚úì';
                feedbackTitle.textContent = 'Correct!';
                feedbackMessage.textContent = positiveMessages[Math.floor(Math.random() * positiveMessages.length)];
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '‚úó';
                feedbackTitle.textContent = 'Incorrect';
                if (correctAnswer) {
                    const correctOption = String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65));
                    const correctText = questions.find(q => 
                        appState.currentQuestions[appState.currentQuestionIndex].question === q.question
                    )?.options[correctAnswer.charCodeAt(0) - 65];
                    
                    feedbackMessage.textContent = `Correct answer: ${correctOption} (${correctText})`;
                }
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
            feedbackContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip current question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry the topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            initializeQuestions();
            
            saveStateToStorage();
            showPracticePage();
        }

        // Go back to home page
        function backToHome() {
            showWelcomePage();
        }

        // Go back to topics page
        function backToTopics() {
            alert("In a complete implementation, this would navigate to the topics selection page.");
        }

        // Start practice session
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name to begin!");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            if (appState.currentQuestions.length === 0) {
                initializeQuestions();
            }
            
            saveStateToStorage();
            showPracticePage();
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 4 English - Letter Writing & Creative Writing | Ideolix Learning Hub</title>
    <style>
        /* CSS Variables for Dark Theme */
        :root {
            --primary-blue: #2962FF;
            --secondary-teal: #00BFA5;
            --accent-purple: #7C4DFF;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --text-muted: #888;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --glow: 0 0 20px rgba(41, 98, 255, 0.3);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Background Slideshow */
        .slideshow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .slide.active {
            opacity: 1;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            position: sticky;
            top: 20px;
            z-index: 100;
            border: 1px solid var(--dark-border);
        }

        .logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info {
            flex: 1;
        }

        .brand-info h1 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        /* Card Styles */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--dark-border);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow), var(--glow);
        }

        /* Welcome Page */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-logo {
            width: 140px;
            height: 140px;
            margin-bottom: 25px;
            border-radius: 20px;
            overflow: hidden;
            background-color: var(--dark-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .welcome-logo img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .welcome-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 700px;
            line-height: 1.6;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(41, 98, 255, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 25px;
            border: 1px solid var(--primary-blue);
        }

        .topic-icon {
            font-size: 1.5rem;
        }

        .topic-name {
            font-weight: 600;
            color: var(--primary-blue);
        }

        .input-group {
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 1.1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(41, 98, 255, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.4);
        }

        .btn-primary:hover {
            background: #1A56FF;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(41, 98, 255, 0.5);
        }

        .btn-secondary {
            background: var(--secondary-teal);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 191, 165, 0.4);
        }

        .btn-secondary:hover {
            background: #00A892;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 191, 165, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-blue);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Practice Mode */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-bar {
            height: 12px;
            background: var(--dark-surface);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-blue), var(--secondary-teal));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(41, 98, 255, 0.5);
        }

        .question-container {
            margin-bottom: 25px;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .letter-example {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--primary-blue);
            font-style: italic;
            color: var(--text-secondary);
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }

        .option {
            padding: 18px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--dark-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: rgba(41, 98, 255, 0.05);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(41, 98, 255, 0.1);
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: #F44336;
            color: #F44336;
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--dark-card);
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
        }

        .option.correct .option-letter {
            background: var(--primary-blue);
            color: white;
        }

        .option.incorrect .option-letter {
            background: #F44336;
            color: white;
        }

        .feedback-container {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: none;
        }

        .feedback-correct {
            background: rgba(41, 98, 255, 0.1);
            border-left: 5px solid var(--primary-blue);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 5px solid #F44336;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--primary-blue);
        }

        .feedback-incorrect .feedback-icon {
            background: #F44336;
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .feedback-correct .feedback-title {
            color: var(--primary-blue);
        }

        .feedback-incorrect .feedback-title {
            color: #F44336;
        }

        .feedback-message {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .results-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .score-percentage {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--dark-border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Letter Writing Diagram */
        .letter-structure-diagram {
            max-width: 500px;
            margin: 20px auto;
            position: relative;
            height: 250px;
        }

        .letter-element {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 120px;
        }

        .letter-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--dark-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            border: 2px solid var(--primary-blue);
            font-size: 1.2rem;
        }

        .letter-label {
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2rem;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .score-value {
                font-size: 3rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons .btn {
                width: 100%;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 5px;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Background Slideshow -->
    <div class="slideshow" id="slideshow">
        <div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1455390582262-044cdead277a?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1516979187457-637abb4f9353?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
    </div>
    <div class="overlay"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToTopics">Other Topics</button>
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card fade-in" id="welcomePage">
            <div class="welcome-logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <h1 class="welcome-title">Grade 4 English</h1>
            <p class="welcome-subtitle">Master the art of letter writing and creative writing! Learn to express yourself clearly and creatively through formal letters, informal notes, stories, descriptions, and reports.</p>
            
            <div class="topic-badge">
                <span class="topic-icon">✉️</span>
                <span class="topic-name">Letter Writing & Creative Writing</span>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your full name:</label>
                <input type="text" id="studentName" placeholder="Your full name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">
                    <span>Start Writing Adventure</span>
                </button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 100</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 1%"></div>
                </div>
            </div>

            <div class="question-container">
                <h2 class="question-text" id="questionText"></h2>
                
                <!-- Letter example or writing tips -->
                <div id="letterExample"></div>
                
                <!-- Letter structure diagram container -->
                <div id="letterStructureDiagram"></div>
                
                <div class="options-container" id="optionsContainer"></div>
                
                <div class="feedback-container" id="feedbackContainer">
                    <div class="feedback-header">
                        <div class="feedback-icon"></div>
                        <div class="feedback-title"></div>
                    </div>
                    <div class="feedback-message"></div>
                    <div class="feedback-explanation"></div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip Question</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next Question</button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Writing Mastery Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                <div class="score-message" id="scoreMessage"></div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="highestScore">0</div>
                        <div class="stat-label">Highest Score</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Try Again</button>
                <button class="btn btn-secondary" id="viewTopics">Explore Other Topics</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize slideshow
        function initSlideshow() {
            let currentSlide = 0;
            const slides = document.querySelectorAll('.slide');
            
            setInterval(() => {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }, 5000);
        }

        // Questions array - 100 Grade 4 English questions covering letter writing and creative writing
        const questions = [
            // Letter Writing - Formal Letters (1-35)
            {
                type: "letter",
                question: "What is the correct way to start a formal letter to someone you don't know?",
                options: ["Dear Sir/Madam", "Hello there", "Hey you", "To whom it may concern"],
                answer: "A",
                explanation: "When you don't know the person's name, use 'Dear Sir/Madam' or 'To whom it may concern'."
            },
            {
                type: "letter",
                question: "Where should your address go in a formal letter?",
                options: ["At the top right corner", "At the bottom", "In the middle", "On the back"],
                answer: "A",
                explanation: "Your address should be at the top right corner of a formal letter, with the date below it."
            },
            {
                type: "letter",
                question: "What is the closing for a formal letter when you don't know the person?",
                options: ["Yours faithfully", "Yours sincerely", "Love from", "Best wishes"],
                answer: "A",
                explanation: "Use 'Yours faithfully' when you start with 'Dear Sir/Madam'. Use 'Yours sincerely' when you know the person's name."
            },
            {
                type: "letter",
                question: "Which of these should NOT be in a formal letter?",
                options: ["Emojis and smiley faces", "Date", "Your address", "Recipient's address"],
                answer: "A",
                explanation: "Formal letters should not contain emojis, slang, or informal language."
            },
            {
                type: "letter",
                question: "What comes after the greeting in a formal letter?",
                options: ["The subject line", "Your signature", "The closing", "Postscript"],
                answer: "A",
                explanation: "After the greeting, include a subject line stating what the letter is about."
            },
            {
                type: "letter",
                question: "How should you sign off a formal letter to your principal?",
                options: ["Yours sincerely", "Yours faithfully", "Love from", "See you later"],
                answer: "A",
                explanation: "Use 'Yours sincerely' when you know the person's name (like your principal)."
            },
            {
                type: "letter",
                question: "What information should be included in a formal letter's heading?",
                options: ["Your address and date", "Your phone number only", "The weather", "Your favorite color"],
                answer: "A",
                explanation: "The heading includes your address and the date you're writing the letter."
            },
            {
                type: "letter",
                question: "Which of these is an appropriate subject for a formal letter?",
                options: ["Application for School Library Monitor", "Hey, about that thing", "Just wanted to say hi", "Can we talk?"],
                answer: "A",
                explanation: "Formal letters should have clear, specific subjects that state the purpose of the letter."
            },
            {
                type: "letter",
                question: "What should you do before sending a formal letter?",
                options: ["Proofread for errors", "Add colorful stickers", "Write in pencil", "Fold it into a shape"],
                answer: "A",
                explanation: "Always proofread formal letters for spelling, grammar, and punctuation errors before sending."
            },
            {
                type: "letter",
                question: "How many paragraphs should a typical formal letter have?",
                options: ["3-4 paragraphs", "1 paragraph", "10 paragraphs", "No paragraphs"],
                answer: "A",
                explanation: "A formal letter typically has an introduction, body (1-2 paragraphs), and conclusion."
            },
            {
                type: "letter",
                question: "What is the purpose of the first paragraph in a formal letter?",
                options: ["State why you're writing", "Ask for money", "Tell a joke", "Describe your weekend"],
                answer: "A",
                explanation: "The first paragraph should clearly state the purpose of your letter."
            },
            {
                type: "letter",
                question: "Which of these is appropriate language for a formal letter?",
                options: ["I am writing to apply for...", "Wassup! I wanna get that...", "Hey, gimme that job!", "Yo, hook me up with..."],
                answer: "A",
                explanation: "Formal letters use polite, clear language without slang or casual expressions."
            },
            {
                type: "letter",
                question: "Where should the recipient's address go in a formal letter?",
                options: ["On the left, below your address", "On the back", "In the middle of the letter", "Nowhere"],
                answer: "A",
                explanation: "The recipient's address goes on the left side, below your address and date."
            },
            {
                type: "letter",
                question: "What should you include in the last paragraph of a formal letter?",
                options: ["A polite closing statement", "A new topic", "Complaints", "Jokes"],
                answer: "A",
                explanation: "The last paragraph should summarize your main points and include a polite closing."
            },
            {
                type: "letter",
                question: "Which of these is a formal letter requirement?",
                options: ["Clear and neat handwriting or typing", "Colorful drawings", "Underlining every word", "Writing in circles"],
                answer: "A",
                explanation: "Formal letters should be neat, clear, and easy to read, whether handwritten or typed."
            },
            {
                type: "letter",
                question: "What is the correct format for the date in a formal letter?",
                options: ["15 March 2024", "March 15th, 2024", "15/3/24", "Today"],
                answer: "A",
                explanation: "In formal letters, write the date in full: day, month, year (e.g., 15 March 2024)."
            },
            {
                type: "letter",
                question: "When writing to a company, how should you address the letter?",
                options: ["The Manager, [Company Name]", "Hey Company", "To the peeps at...", "Company Dudes"],
                answer: "A",
                explanation: "When writing to a company, use a formal title like 'The Manager' followed by the company name."
            },
            {
                type: "letter",
                question: "What should you do if you make a mistake in a handwritten formal letter?",
                options: ["Rewrite the letter neatly", "Scribble it out", "Use correction fluid", "Ignore it"],
                answer: "A",
                explanation: "For important formal letters, it's best to rewrite them neatly if you make mistakes."
            },
            {
                type: "letter",
                question: "Which of these is NOT part of a formal letter structure?",
                options: ["P.S. (Postscript)", "Sender's address", "Date", "Recipient's address"],
                answer: "A",
                explanation: "Postscripts (P.S.) are informal and should not be used in formal letters."
            },
            {
                type: "letter",
                question: "How should you refer to yourself in a formal letter?",
                options: ["Use 'I' and 'my' appropriately", "Never use 'I'", "Only use 'we'", "Use nicknames"],
                answer: "A",
                explanation: "In formal letters, use 'I' and 'my' appropriately while maintaining polite language."
            },
            {
                type: "letter",
                question: "What is the main purpose of a formal letter?",
                options: ["To communicate professionally", "To tell stories", "To make friends", "To show drawings"],
                answer: "A",
                explanation: "Formal letters are for professional or official communication."
            },
            {
                type: "letter",
                question: "Which of these would you write a formal letter for?",
                options: ["Applying for a student council position", "Inviting a friend to a party", "Telling grandma about school", "Writing to a pen pal"],
                answer: "A",
                explanation: "Student council applications require formal letters, while the others are informal situations."
            },
            {
                type: "letter",
                question: "What should come after 'Yours sincerely' in a formal letter?",
                options: ["Your signature and printed name", "Your age", "Your favorite quote", "A drawing"],
                answer: "A",
                explanation: "After the closing, leave space for your signature, then print your name below it."
            },
            {
                type: "letter",
                question: "How should you structure the body paragraphs of a formal letter?",
                options: ["Each paragraph has one main idea", "Write one long paragraph", "Use bullet points only", "Write in poem form"],
                answer: "A",
                explanation: "Each body paragraph should focus on one main idea or point."
            },
            {
                type: "letter",
                question: "What is the tone of a formal letter?",
                options: ["Polite and respectful", "Casual and friendly", "Angry and demanding", "Funny and silly"],
                answer: "A",
                explanation: "Formal letters should always maintain a polite, respectful tone."
            },
            {
                type: "letter",
                question: "Which of these is a good opening for a formal letter of complaint?",
                options: ["I am writing to express my concern about...", "Your product stinks!", "Fix this now!", "Why is this broken?"],
                answer: "A",
                explanation: "Even complaint letters should start politely and state the purpose clearly."
            },
            {
                type: "letter",
                question: "What should you avoid in formal letter writing?",
                options: ["Texting abbreviations (LOL, BRB)", "Complete sentences", "Proper punctuation", "Correct spelling"],
                answer: "A",
                explanation: "Avoid texting abbreviations, slang, and informal language in formal letters."
            },
            {
                type: "letter",
                question: "How should you present numbers in a formal letter?",
                options: ["Write out numbers one to ten, use numerals for larger numbers", "Always use numerals", "Always write them out", "Use Roman numerals"],
                answer: "A",
                explanation: "In formal writing, write out numbers one to ten, and use numerals for 11 and above."
            },
            {
                type: "letter",
                question: "What is the purpose of the inside address in a formal letter?",
                options: ["To show who the letter is for", "To decorate the letter", "To take up space", "To show where you live"],
                answer: "A",
                explanation: "The inside address (recipient's address) identifies who should receive the letter."
            },
            {
                type: "letter",
                question: "Which of these is appropriate for a formal letter closing?",
                options: ["Thank you for your attention to this matter.", "Catch you later!", "Peace out!", "That's all folks!"],
                answer: "A",
                explanation: "Formal closings should be polite and professional."
            },
            {
                type: "letter",
                question: "How should you address a formal letter to a woman when you don't know her marital status?",
                options: ["Ms. [Last Name]", "Mrs. [Last Name]", "Miss [Last Name]", "Hey lady"],
                answer: "A",
                explanation: "Use 'Ms.' when you don't know a woman's marital status in formal correspondence."
            },
            {
                type: "letter",
                question: "What should you do if you're responding to a formal letter?",
                options: ["Mention the date of the letter you received", "Ignore the original letter", "Start a new topic", "Write in a different language"],
                answer: "A",
                explanation: "When responding, reference the original letter's date and subject."
            },
            {
                type: "letter",
                question: "Which of these should be included in a formal application letter?",
                options: ["Your qualifications and interest", "Your favorite movies", "Family gossip", "Jokes"],
                answer: "A",
                explanation: "Application letters should focus on your qualifications and why you're interested."
            },
            {
                type: "letter",
                question: "How long should a formal letter typically be?",
                options: ["One page", "Five pages", "Just a few lines", "As long as possible"],
                answer: "A",
                explanation: "Most formal letters should be concise and fit on one page."
            },
            {
                type: "letter",
                question: "What is the difference between 'Yours faithfully' and 'Yours sincerely'?",
                options: ["Faithfully for unknown recipients, sincerely for known", "Sincerely for unknown, faithfully for known", "They mean the same thing", "Faithfully is for friends"],
                answer: "A",
                explanation: "Use 'Yours faithfully' when you don't know the name, 'Yours sincerely' when you do."
            },
            // Letter Writing - Informal Letters (36-50)
            {
                type: "letter",
                question: "How would you start an informal letter to a friend?",
                options: ["Dear [Friend's Name]", "To whom it may concern", "Dear Sir/Madam", "Hey there!"],
                answer: "A",
                explanation: "Informal letters to friends start with 'Dear [Name]' or even more casual greetings."
            },
            {
                type: "letter",
                question: "Which closing is appropriate for an informal letter to a cousin?",
                options: ["Love from", "Yours faithfully", "Respectfully yours", "Sincerely"],
                answer: "A",
                explanation: "Informal letters to family can use closings like 'Love from', 'Best wishes', or 'Your cousin'."
            },
            {
                type: "letter",
                question: "What can you include in an informal letter that you shouldn't in a formal one?",
                options: ["Personal stories and jokes", "Your address", "The date", "Your name"],
                answer: "A",
                explanation: "Informal letters can include personal anecdotes, jokes, and casual language."
            },
            {
                type: "letter",
                question: "How should you structure an informal letter?",
                options: ["More flexible, can be conversational", "Must have 5 paragraphs", "Always use bullet points", "Write in rhyme"],
                answer: "A",
                explanation: "Informal letters have a more flexible, conversational structure."
            },
            {
                type: "letter",
                question: "What is a common feature of informal letters?",
                options: ["Use of contractions (I'm, you're)", "Formal language", "No personal pronouns", "Latin phrases"],
                answer: "A",
                explanation: "Informal letters naturally use contractions and everyday language."
            },
            {
                type: "letter",
                question: "Which of these is an appropriate opening for an informal letter?",
                options: ["How are you? I hope you're doing well.", "Pursuant to our conversation...", "I am writing to inform you...", "This letter serves to notify..."],
                answer: "A",
                explanation: "Informal letters often start with friendly questions about the recipient's wellbeing."
            },
            {
                type: "letter",
                question: "What might you include at the end of an informal letter?",
                options: ["P.S. (Postscript) with extra news", "Your qualifications", "Legal disclaimer", "Company logo"],
                answer: "A",
                explanation: "Postscripts (P.S.) are common in informal letters for adding forgotten thoughts."
            },
            {
                type: "letter",
                question: "How is the tone of an informal letter different from a formal one?",
                options: ["More personal and friendly", "More serious and strict", "More official", "More complicated"],
                answer: "A",
                explanation: "Informal letters have a personal, friendly tone like having a conversation."
            },
            {
                type: "letter",
                question: "Which of these would you write an informal letter for?",
                options: ["Thanking your aunt for a birthday gift", "Applying for a job", "Complaining to a company", "Requesting information from government"],
                answer: "A",
                explanation: "Thank you notes to family are informal, while the others require formal letters."
            },
            {
                type: "letter",
                question: "What can you use in informal letters that's not appropriate in formal ones?",
                options: ["Emojis or drawings", "Complete sentences", "Paragraphs", "Punctuation"],
                answer: "A",
                explanation: "Informal letters can include emojis, drawings, or other personal touches."
            },
            {
                type: "letter",
                question: "How should you address an informal letter to your best friend?",
                options: ["Use their first name or nickname", "Use their full title", "Don't use any name", "Make up a name"],
                answer: "A",
                explanation: "Use first names or nicknames for friends in informal letters."
            },
            {
                type: "letter",
                question: "What is a common way to end an informal letter to a friend?",
                options: ["Write again soon!", "Yours obediently", "Respectfully submitted", "I remain your servant"],
                answer: "A",
                explanation: "Informal endings encourage continued communication."
            },
            {
                type: "letter",
                question: "Which of these elements is optional in informal letters?",
                options: ["Your address", "The date", "Recipient's name", "Your name"],
                answer: "A",
                explanation: "While it's good practice, your address is often omitted in very informal notes."
            },
            {
                type: "letter",
                question: "What type of language is appropriate in informal letters?",
                options: ["Conversational and natural", "Technical and complex", "Legal jargon", "Old-fashioned English"],
                answer: "A",
                explanation: "Write informal letters as you would speak to the person in conversation."
            },
            {
                type: "letter",
                question: "How can you make an informal letter more personal?",
                options: ["Include inside jokes or shared memories", "Use big, difficult words", "Copy from a textbook", "Write in a foreign language"],
                answer: "A",
                explanation: "Personal references make informal letters special and meaningful."
            },
            // Creative Writing - Stories (51-70)
            {
                type: "creative",
                question: "What is the beginning of a story called?",
                options: ["Introduction", "Climax", "Conclusion", "Conflict"],
                answer: "A",
                explanation: "The introduction sets up the story, characters, and setting."
            },
            {
                type: "creative",
                question: "What do we call the most exciting part of a story?",
                options: ["Climax", "Beginning", "Ending", "Middle"],
                answer: "A",
                explanation: "The climax is the most exciting, turning point of the story."
            },
            {
                type: "creative",
                question: "What should a good story opening do?",
                options: ["Grab the reader's attention", "Introduce every character", "Solve the main problem", "Describe the weather"],
                answer: "A",
                explanation: "A good opening hooks the reader and makes them want to continue."
            },
            {
                type: "creative",
                question: "What are the people or animals in a story called?",
                options: ["Characters", "Plots", "Settings", "Themes"],
                answer: "A",
                explanation: "Characters are the people, animals, or creatures in a story."
            },
            {
                type: "creative",
                question: "Where and when a story takes place is called the...",
                options: ["Setting", "Plot", "Theme", "Conflict"],
                answer: "A",
                explanation: "The setting includes both the location and time period of the story."
            },
            {
                type: "creative",
                question: "What is the sequence of events in a story called?",
                options: ["Plot", "Setting", "Characters", "Dialogue"],
                answer: "A",
                explanation: "The plot is what happens in the story, the sequence of events."
            },
            {
                type: "creative",
                question: "What do we call the problem in a story?",
                options: ["Conflict", "Solution", "Character", "Setting"],
                answer: "A",
                explanation: "Conflict is the problem or challenge the characters face."
            },
            {
                type: "creative",
                question: "How the problem is solved in a story is called the...",
                options: ["Resolution", "Beginning", "Climax", "Introduction"],
                answer: "A",
                explanation: "The resolution shows how the conflict is resolved or the problem is solved."
            },
            {
                type: "creative",
                question: "What is dialogue in a story?",
                options: ["Conversation between characters", "Descriptions of places", "The author's notes", "Chapter titles"],
                answer: "A",
                explanation: "Dialogue is what characters say to each other, shown with quotation marks."
            },
            {
                type: "creative",
                question: "What should you do to show instead of tell in writing?",
                options: ["Use descriptive details and actions", "Explain everything directly", "Use bullet points", "Write in all capitals"],
                answer: "A",
                explanation: "Showing uses vivid details and actions to let readers experience the story."
            },
            {
                type: "creative",
                question: "What are sensory details?",
                options: ["Descriptions using the five senses", "Lists of facts", "Character names", "Chapter numbers"],
                answer: "A",
                explanation: "Sensory details describe what characters see, hear, smell, taste, and touch."
            },
            {
                type: "creative",
                question: "What is the main message or lesson of a story called?",
                options: ["Theme", "Plot", "Setting", "Character"],
                answer: "A",
                explanation: "The theme is the central idea or message the author wants to convey."
            },
            {
                type: "creative",
                question: "What do we call the narrator of a story?",
                options: ["The person telling the story", "The main character", "The author", "The editor"],
                answer: "A",
                explanation: "The narrator is the voice telling the story, which may or may not be a character."
            },
            {
                type: "creative",
                question: "What is 'show, don't tell' in creative writing?",
                options: ["Using actions and details instead of explanations", "Using more adjectives", "Writing longer sentences", "Using fancy words"],
                answer: "A",
                explanation: "This technique creates more engaging writing by showing through action and detail."
            },
            {
                type: "creative",
                question: "What makes a character interesting?",
                options: ["Flaws and personality traits", "Perfect behavior", "Always being right", "Never making mistakes"],
                answer: "A",
                explanation: "Characters with flaws, strengths, and personalities are more realistic and interesting."
            },
            {
                type: "creative",
                question: "What should you do before writing a story?",
                options: ["Plan the main events", "Start writing immediately", "Draw pictures only", "Ask someone to write it"],
                answer: "A",
                explanation: "Planning helps organize your ideas and creates a better story structure."
            },
            {
                type: "creative",
                question: "What is the purpose of a story's ending?",
                options: ["To provide a satisfying conclusion", "To introduce new characters", "To start a new story", "To confuse the reader"],
                answer: "A",
                explanation: "The ending should resolve the main conflict and feel satisfying to the reader."
            },
            {
                type: "creative",
                question: "How can you make your writing more interesting?",
                options: ["Use strong verbs and specific nouns", "Use the same words repeatedly", "Write very short sentences", "Avoid descriptions"],
                answer: "A",
                explanation: "Strong, specific language makes writing more vivid and engaging."
            },
            {
                type: "creative",
                question: "What is a story hook?",
                options: ["An interesting opening that grabs attention", "A fishing tool", "The story's title", "The last sentence"],
                answer: "A",
                explanation: "A hook captures the reader's interest right from the beginning."
            },
            {
                type: "creative",
                question: "Why is conflict important in a story?",
                options: ["It creates interest and drives the plot", "It makes characters perfect", "It avoids problems", "It makes stories shorter"],
                answer: "A",
                explanation: "Conflict creates challenges that characters must overcome, making stories engaging."
            },
            // Creative Writing - Descriptions (71-85)
            {
                type: "creative",
                question: "What should good description include?",
                options: ["Sensory details (sight, sound, smell, etc.)", "Only colors", "Just measurements", "Technical terms"],
                answer: "A",
                explanation: "Good descriptions engage multiple senses to create vivid mental images."
            },
            {
                type: "creative",
                question: "What are adjectives?",
                options: ["Words that describe nouns", "Words that show action", "Words that replace nouns", "Connecting words"],
                answer: "A",
                explanation: "Adjectives describe or modify nouns (e.g., blue sky, tall building, happy child)."
            },
            {
                type: "creative",
                question: "What are adverbs?",
                options: ["Words that describe verbs", "Words that name things", "Words that connect sentences", "Words that show emotion"],
                answer: "A",
                explanation: "Adverbs describe verbs (e.g., ran quickly, spoke softly, ate hungrily)."
            },
            {
                type: "creative",
                question: "How can you describe a character without saying their emotions directly?",
                options: ["Show through actions and dialogue", "Write 'he was sad'", "Ignore emotions", "Use smiley faces"],
                answer: "A",
                explanation: "Showing emotions through actions is more powerful than telling directly."
            },
            {
                type: "creative",
                question: "What is figurative language?",
                options: ["Language that uses comparisons (metaphors, similes)", "Technical language", "Simple language", "Foreign language"],
                answer: "A",
                explanation: "Figurative language uses metaphors, similes, and other creative comparisons."
            },
            {
                type: "creative",
                question: "What is a simile?",
                options: ["A comparison using 'like' or 'as'", "Giving human traits to non-human things", "An exaggeration", "Repeating sounds"],
                answer: "A",
                explanation: "Similes compare using 'like' or 'as' (e.g., as brave as a lion, like a shining star)."
            },
            {
                type: "creative",
                question: "What is a metaphor?",
                options: ["Direct comparison without 'like' or 'as'", "Comparison using 'like' or 'as'", "Sound repetition", "Human characteristics for objects"],
                answer: "A",
                explanation: "Metaphors directly state that one thing is another (e.g., her voice was music)."
            },
            {
                type: "creative",
                question: "What is personification?",
                options: ["Giving human qualities to non-human things", "Comparing with 'like' or 'as'", "Repeating consonant sounds", "Using opposite words"],
                answer: "A",
                explanation: "Personification gives human traits to animals, objects, or ideas."
            },
            {
                type: "creative",
                question: "How can you describe a setting effectively?",
                options: ["Include details that affect the story or mood", "List every single object", "Use only colors", "Ignore the setting"],
                answer: "A",
                explanation: "Choose setting details that create mood or affect the story's events."
            },
            {
                type: "creative",
                question: "What should you avoid in descriptive writing?",
                options: ["Vague, overused words (nice, good, bad)", "Specific details", "Sensory words", "Figurative language"],
                answer: "A",
                explanation: "Replace vague words with specific, vivid descriptions."
            },
            {
                type: "creative",
                question: "How can you describe movement?",
                options: ["Use strong, specific verbs", "Use only 'went' and 'came'", "Avoid movement descriptions", "Use adverbs only"],
                answer: "A",
                explanation: "Strong verbs (dashed, stumbled, floated) create clearer mental images."
            },
            {
                type: "creative",
                question: "What is the 'five senses' rule in description?",
                options: ["Include at least three senses in descriptions", "Describe everything you see", "Ignore all senses", "Use only sight"],
                answer: "A",
                explanation: "Engaging multiple senses creates richer, more immersive descriptions."
            },
            {
                type: "creative",
                question: "How can you describe a character's appearance?",
                options: ["Reveal details gradually through the story", "List everything at once", "Ignore appearance", "Let readers guess"],
                answer: "A",
                explanation: "Revealing appearance details gradually feels more natural than an information dump."
            },
            {
                type: "creative",
                question: "What makes description effective?",
                options: ["Specific, concrete details", "Long, complicated words", "General statements", "Abstract ideas"],
                answer: "A",
                explanation: "Specific details create clearer mental pictures than general statements."
            },
            {
                type: "creative",
                question: "How should you order descriptive details?",
                options: ["From general to specific, or in logical order", "Randomly", "Alphabetically", "Backwards"],
                answer: "A",
                explanation: "Organized description helps readers visualize scenes clearly."
            },
            // Creative Writing - Reports (86-100)
            {
                type: "creative",
                question: "What is the main purpose of a report?",
                options: ["To inform or explain", "To entertain with stories", "To express feelings", "To persuade"],
                answer: "A",
                explanation: "Reports provide factual information about a topic."
            },
            {
                type: "creative",
                question: "What should a report introduction include?",
                options: ["Main topic and what will be covered", "Personal opinions", "Fictional stories", "Jokes"],
                answer: "A",
                explanation: "The introduction states the topic and outlines what the report will cover."
            },
            {
                type: "creative",
                question: "How should information in a report be organized?",
                options: ["In logical sections with headings", "Randomly", "In one long paragraph", "As a poem"],
                answer: "A",
                explanation: "Reports use headings and organized sections for clear information presentation."
            },
            {
                type: "creative",
                question: "What kind of language should reports use?",
                options: ["Clear, factual, and objective", "Emotional and persuasive", "Fictional and imaginative", "Casual and slang"],
                answer: "A",
                explanation: "Reports should present facts clearly without personal bias or emotion."
            },
            {
                type: "creative",
                question: "What should you include in a report conclusion?",
                options: ["Summary of main points", "New information", "Personal stories", "Questions for the reader"],
                answer: "A",
                explanation: "The conclusion summarizes the report's main findings or points."
            },
            {
                type: "creative",
                question: "What is important when writing a report about an event?",
                options: ["Include who, what, when, where, why", "Only include what you liked", "Make up details", "Focus only on colors"],
                answer: "A",
                explanation: "Event reports should answer the basic questions: who, what, when, where, why."
            },
            {
                type: "creative",
                question: "How should you present facts in a report?",
                options: ["Accurately and with evidence", "Dramatically exaggerated", "As opinions", "As guesses"],
                answer: "A",
                explanation: "Reports require accurate information, not opinions or exaggerations."
            },
            {
                type: "creative",
                question: "What should you avoid in report writing?",
                options: ["Personal opinions (I think, I believe)", "Facts", "Headings", "Conclusions"],
                answer: "A",
                explanation: "Reports should be objective, avoiding 'I think' or 'I believe' statements."
            },
            {
                type: "creative",
                question: "What is a bibliography in a report?",
                options: ["List of information sources", "The report title", "Author's biography", "Pictures"],
                answer: "A",
                explanation: "A bibliography lists books, websites, or other sources used for the report."
            },
            {
                type: "creative",
                question: "How can you make a report more readable?",
                options: ["Use subheadings and bullet points", "Write one continuous paragraph", "Use tiny font", "Avoid paragraphs"],
                answer: "A",
                explanation: "Organization tools like headings and lists make reports easier to read and understand."
            },
            {
                type: "creative",
                question: "What should you do before writing a report?",
                options: ["Research and gather information", "Start writing immediately", "Draw the cover", "Ask friends what to write"],
                answer: "A",
                explanation: "Good reports require research and information gathering before writing."
            },
            {
                type: "creative",
                question: "How should you start researching for a report?",
                options: ["Identify key questions about the topic", "Copy from the first source", "Make up information", "Ask unrelated questions"],
                answer: "A",
                explanation: "Start by determining what you need to learn about your topic."
            },
            {
                type: "creative",
                question: "What is the difference between a report and a story?",
                options: ["Reports are factual, stories are fictional", "Stories have headings", "Reports have characters", "Stories avoid facts"],
                answer: "A",
                explanation: "Reports present facts, while stories are creative and often fictional."
            },
            {
                type: "creative",
                question: "How can you organize notes for a report?",
                options: ["Group related information together", "Write everything randomly", "Memorize everything", "Only use one source"],
                answer: "A",
                explanation: "Organizing notes by topic makes writing the report much easier."
            },
            {
                type: "creative",
                question: "What makes a good report title?",
                options: ["Clear and specific to the content", "Mysterious and confusing", "Very long", "Unrelated to content"],
                answer: "A",
                explanation: "A good title clearly indicates what the report is about."
            }
        ];

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // Positive feedback messages
        const positiveMessages = [
            "Excellent writing knowledge!",
            "Fantastic language skills!",
            "Great job! You're a writing star!",
            "Amazing! Your English skills are shining!",
            "Well done! Perfect answer!",
            "You're an English expert!",
            "Perfect! Your writing knowledge is impressive!",
            "Outstanding literary understanding!",
            "Brilliant! You write like a pro!",
            "You're on fire! Great writing insight!"
        ];

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const letterExample = document.getElementById('letterExample');
        const letterStructureDiagram = document.getElementById('letterStructureDiagram');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const backToTopicsBtn = document.getElementById('backToTopics');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const scoreMessage = document.getElementById('scoreMessage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const highestScore = document.getElementById('highestScore');

        // Initialize the app
        function initApp() {
            initSlideshow();
            loadStateFromStorage();
            setupEventListeners();
            
            // Show appropriate page based on state
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Load state from localStorage
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixGrade4EnglishWriting');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                // If we have a saved state but no questions, initialize them
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // Save state to localStorage
        function saveStateToStorage() {
            localStorage.setItem('ideolixGrade4EnglishWriting', JSON.stringify(appState));
        }

        // Initialize and shuffle questions
        function initializeQuestions() {
            // Create a copy of questions and shuffle them
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', backToHome);
            backToTopicsBtn.addEventListener('click', backToTopics);
            viewTopicsBtn.addEventListener('click', backToTopics);
            
            // Allow pressing Enter to start practice
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startPractice();
                }
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            
            // Clear any previous input
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            
            // Display student name
            studentNameDisplay.textContent = appState.studentName;
            
            // Load the current question
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            // Calculate results
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            // Update results display
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            
            // Get highest score from localStorage
            const highest = localStorage.getItem('ideolixGrade4EnglishWriting_highestScore') || 0;
            highestScore.textContent = Math.max(highest, appState.score);
            
            // Save new highest score if applicable
            if (appState.score > highest) {
                localStorage.setItem('ideolixGrade4EnglishWriting_highestScore', appState.score);
            }
            
            // Set encouraging message based on score
            if (percentage >= 90) {
                scoreMessage.textContent = "Outstanding! You're a letter writing and creative writing expert!";
            } else if (percentage >= 80) {
                scoreMessage.textContent = "Great job! You have excellent writing knowledge and skills!";
            } else if (percentage >= 70) {
                scoreMessage.textContent = "Good work! Keep practicing to become a writing master!";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "Not bad! Review the questions you missed and try again!";
            } else {
                scoreMessage.textContent = "Keep practicing! Writing skills improve with practice and learning!";
            }
        }

        // Create letter structure diagram
        function createLetterStructureDiagram() {
            const container = document.createElement('div');
            container.className = 'letter-structure-diagram';
            
            // Create elements for the letter structure
            const elements = [
                {icon: "🏠", label: "Your Address", top: "5%", left: "60%"},
                {icon: "📅", label: "Date", top: "15%", left: "60%"},
                {icon: "👤", label: "Recipient Address", top: "25%", left: "10%"},
                {icon: "📝", label: "Greeting", top: "35%", left: "10%"},
                {icon: "📄", label: "Body Paragraphs", top: "50%", left: "35%"},
                {icon: "✍️", label: "Closing", top: "75%", left: "60%"},
                {icon: "🔏", label: "Signature", top: "85%", left: "60%"}
            ];
            
            elements.forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'letter-element';
                elementDiv.style.top = element.top;
                elementDiv.style.left = element.left;
                
                const iconDiv = document.createElement('div');
                iconDiv.className = 'letter-icon';
                iconDiv.textContent = element.icon;
                
                const labelDiv = document.createElement('div');
                labelDiv.className = 'letter-label';
                labelDiv.textContent = element.label;
                
                elementDiv.appendChild(iconDiv);
                elementDiv.appendChild(labelDiv);
                container.appendChild(elementDiv);
            });
            
            return container;
        }

        // Create letter example
        function createLetterExample() {
            const example = document.createElement('div');
            example.className = 'letter-example';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            if (appState.currentQuestionIndex < 35) {
                // Formal letter example
                example.innerHTML = `
                    <strong>Formal Letter Example:</strong><br>
                    Your Address<br>
                    Date<br><br>
                    Recipient's Address<br><br>
                    Dear Sir/Madam,<br><br>
                    I am writing to...<br><br>
                    Yours faithfully,<br>
                    [Your Signature]<br>
                    Your Printed Name
                `;
            } else if (appState.currentQuestionIndex < 50) {
                // Informal letter example
                example.innerHTML = `
                    <strong>Informal Letter Example:</strong><br><br>
                    Dear [Friend's Name],<br><br>
                    How are you? I hope you're doing well...<br><br>
                    Write back soon!<br><br>
                    Love from,<br>
                    [Your Name]
                `;
            } else if (appState.currentQuestionIndex < 85) {
                // Creative writing tips
                example.innerHTML = `
                    <strong>Writing Tip:</strong> Remember to "show, don't tell" in creative writing. 
                    Instead of saying "She was scared," show it: "Her hands trembled as she heard the noise."
                `;
            } else {
                // Report writing tips
                example.innerHTML = `
                    <strong>Report Writing Tip:</strong> Reports should be factual and organized. 
                    Use headings, include an introduction and conclusion, and present information clearly.
                `;
            }
            
            return example;
        }

        // Load current question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            // Update progress
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            // Set question text
            questionText.textContent = question.question;
            
            // Clear previous content
            letterExample.innerHTML = '';
            letterStructureDiagram.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            // Create letter example or writing tips
            if (question.type === "letter" && appState.currentQuestionIndex < 35) {
                letterExample.appendChild(createLetterExample());
                letterStructureDiagram.appendChild(createLetterStructureDiagram());
            } else if (question.type === "letter") {
                letterExample.appendChild(createLetterExample());
            } else if (question.type === "creative") {
                letterExample.appendChild(createLetterExample());
            }
            
            // Create option elements
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            // Disable all options
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            // Mark correct/incorrect
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                // Correct answer
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                
                // Show positive feedback
                showFeedback(true, question.explanation);
            } else {
                // Incorrect answer
                optionElement.classList.add('incorrect');
                appState.answered++;
                
                // Show negative feedback
                showFeedback(false, question.explanation, question.answer);
            }
            
            // Enable next question button
            nextQuestionBtn.disabled = false;
            
            // Save progress
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackMessage = feedbackContainer.querySelector('.feedback-message');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '✓';
                feedbackTitle.textContent = 'Correct!';
                feedbackMessage.textContent = positiveMessages[Math.floor(Math.random() * positiveMessages.length)];
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '✗';
                feedbackTitle.textContent = 'Incorrect';
                if (correctAnswer) {
                    feedbackMessage.textContent = `Correct answer: ${String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65))}`;
                }
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip current question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry the topic with new shuffled questions
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            // Re-shuffle questions
            initializeQuestions();
            
            saveStateToStorage();
            showPracticePage();
        }

        // Go back to home page
        function backToHome() {
            showWelcomePage();
        }

        // Go back to topics page (simulated)
        function backToTopics() {
            alert("In a complete implementation, this would navigate to the topics selection page.");
            // In a real implementation, this would be: window.location.href = "grade4-english-topics.html";
        }

        // Start practice session
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name to begin!");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            // Initialize questions if needed
            if (appState.currentQuestions.length === 0) {
                initializeQuestions();
            }
            
            saveStateToStorage();
            showPracticePage();
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

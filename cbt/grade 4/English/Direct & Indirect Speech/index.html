<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 4 English - Direct & Indirect Speech | Ideolix Learning Hub</title>
    <style>
        /* CSS Variables for Dark Theme with Green and Dark Orange */
        :root {
            --primary-green: #00C853;
            --secondary-orange: #FF5722;
            --accent-purple: #7C4DFF;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --text-muted: #888;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --glow: 0 0 20px rgba(0, 200, 83, 0.3);
            --orange-glow: 0 0 20px rgba(255, 87, 34, 0.3);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Background Slideshow */
        .slideshow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .slide.active {
            opacity: 1;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            position: sticky;
            top: 20px;
            z-index: 100;
            border: 1px solid var(--dark-border);
        }

        .logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info {
            flex: 1;
        }

        .brand-info h1 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        /* Card Styles */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--dark-border);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow), var(--glow);
        }

        /* Welcome Page */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-logo {
            width: 140px;
            height: 140px;
            margin-bottom: 25px;
            border-radius: 20px;
            overflow: hidden;
            background-color: var(--dark-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .welcome-logo img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .welcome-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 700px;
            line-height: 1.6;
        }

        .input-group {
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 1.1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(0, 200, 83, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-green);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 200, 83, 0.4);
        }

        .btn-primary:hover {
            background: #00B248;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 200, 83, 0.5);
        }

        .btn-secondary {
            background: var(--secondary-orange);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 87, 34, 0.4);
        }

        .btn-secondary:hover {
            background: #E64A19;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 87, 34, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-green);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Practice Mode */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-bar {
            height: 12px;
            background: var(--dark-surface);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-green), var(--secondary-orange));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 200, 83, 0.5);
        }

        .question-container {
            margin-bottom: 25px;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .speech-display {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--dark-border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            position: relative;
            font-size: 1.2rem;
            line-height: 1.6;
        }

        .direct-speech {
            border-left: 4px solid var(--primary-green);
            padding-left: 15px;
            margin: 15px 0;
        }

        .indirect-speech {
            border-left: 4px solid var(--secondary-orange);
            padding-left: 15px;
            margin: 15px 0;
        }

        .speech-guide {
            background: rgba(124, 77, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent-purple);
        }

        .guide-title {
            color: var(--accent-purple);
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .parts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .part-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--dark-border);
        }

        .part-name {
            font-weight: bold;
            color: var(--primary-green);
            margin-bottom: 5px;
        }

        .part-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .parts-grid {
                grid-template-columns: 1fr;
            }
        }

        .option {
            padding: 18px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--dark-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: flex-start;
        }

        .option:hover {
            border-color: var(--primary-green);
            background: rgba(0, 200, 83, 0.05);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(0, 200, 83, 0.1);
            border-color: var(--primary-green);
            color: var(--primary-green);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: #F44336;
            color: #F44336;
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--dark-card);
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .option.correct .option-letter {
            background: var(--primary-green);
            color: white;
        }

        .option.incorrect .option-letter {
            background: #F44336;
            color: white;
        }

        .option-text {
            flex: 1;
        }

        .feedback-container {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: none;
        }

        .feedback-correct {
            background: rgba(0, 200, 83, 0.1);
            border-left: 5px solid var(--primary-green);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 5px solid #F44336;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--primary-green);
        }

        .feedback-incorrect .feedback-icon {
            background: #F44336;
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .feedback-correct .feedback-title {
            color: var(--primary-green);
        }

        .feedback-incorrect .feedback-title {
            color: #F44336;
        }

        .feedback-message {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .part-details {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .detail-item {
            margin-bottom: 8px;
            padding-left: 15px;
            position: relative;
        }

        .detail-item:before {
            content: "•";
            color: var(--primary-green);
            position: absolute;
            left: 0;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .results-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .score-percentage {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--dark-border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-green);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2rem;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .speech-display {
                font-size: 1.1rem;
                padding: 20px;
            }
            
            .score-value {
                font-size: 3rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons .btn {
                width: 100%;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 5px;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Background Slideshow -->
    <div class="slideshow" id="slideshow">
        <div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1481627834876-b7833e8f5570?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1503676260728-1c00da094a0b?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1450101499163-c8848c66ca85?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')"></div>
    </div>
    <div class="overlay"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToTopics">Other Topics</button>
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card fade-in" id="welcomePage">
            <div class="welcome-logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <h1 class="welcome-title">Grade 4 English – Direct & Indirect Speech</h1>
            <p class="welcome-subtitle">Learn to identify and convert between direct speech (exact words spoken) and indirect speech (reporting what someone said).</p>
            
            <div class="input-group">
                <label for="studentName">Enter your full name:</label>
                <input type="text" id="studentName" placeholder="Your full name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">
                    <span>Start Practice Mode</span>
                </button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 100</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 1%"></div>
                </div>
            </div>

            <div class="question-container">
                <h2 class="question-text" id="questionText">Identify the type of speech:</h2>
                
                <div class="speech-display" id="speechDisplay"></div>
                
                <div class="speech-guide">
                    <div class="guide-title">Direct & Indirect Speech Guide</div>
                    <div class="parts-grid">
                        <div class="part-item">
                            <div class="part-name">Direct Speech</div>
                            <div class="part-description">The exact words spoken, in quotation marks</div>
                        </div>
                        <div class="part-item">
                            <div class="part-name">Indirect Speech</div>
                            <div class="part-description">Reporting what someone said without exact words</div>
                        </div>
                        <div class="part-item">
                            <div class="part-name">Quotation Marks</div>
                            <div class="part-description">Used in direct speech to show exact words</div>
                        </div>
                        <div class="part-item">
                            <div class="part-name">Reporting Verbs</div>
                            <div class="part-description">Said, told, asked - used in indirect speech</div>
                        </div>
                    </div>
                </div>
                
                <div class="options-container" id="optionsContainer"></div>
                
                <div class="feedback-container" id="feedbackContainer">
                    <div class="feedback-header">
                        <div class="feedback-icon"></div>
                        <div class="feedback-title"></div>
                    </div>
                    <div class="feedback-message"></div>
                    <div class="feedback-explanation"></div>
                    <div class="part-details" id="partDetails"></div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip Question</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next Question</button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Practice Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                <div class="score-message" id="scoreMessage"></div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="highestScore">0</div>
                        <div class="stat-label">Highest Score</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Retry Topic</button>
                <button class="btn btn-secondary" id="viewTopics">View Other Topics</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize slideshow
        function initSlideshow() {
            let currentSlide = 0;
            const slides = document.querySelectorAll('.slide');
            
            setInterval(() => {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }, 5000);
        }

        // Questions array - 100+ Direct and Indirect Speech questions for Grade 4
        const questions = [
            // Identifying Direct Speech (35 questions)
            {
                type: "identify",
                speech: `Maria said, <span class="direct-speech">"I love reading books."</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech because it shows Maria's exact words in quotation marks.",
                details: [
                    "Direct speech shows the exact words someone said",
                    "It uses quotation marks around the spoken words",
                    "It often includes a reporting clause like 'said Maria'",
                    "Example: John said, 'I am hungry.'"
                ]
            },
            {
                type: "identify",
                speech: `"I finished my homework," <span class="direct-speech">Tom told his mother.</span>`,
                question: "Identify the type of speech:",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech because it shows Tom's exact words in quotation marks.",
                details: [
                    "The exact words are enclosed in quotation marks",
                    "The speaker is identified with a reporting verb",
                    "The reporting clause can come before or after the quote",
                    "Example: 'It's raining,' she said."
                ]
            },
            {
                type: "identify",
                speech: `The teacher announced, <span class="direct-speech">"We will have a test tomorrow."</span>`,
                question: "What type of speech is used here?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech showing the teacher's exact announcement.",
                details: [
                    "Direct speech preserves the original speaker's words",
                    "It creates a more vivid and immediate effect",
                    "Common reporting verbs: said, told, announced, exclaimed",
                    "Example: He shouted, 'Watch out!'"
                ]
            },
            {
                type: "identify",
                speech: `"Can you help me with this problem?" <span class="direct-speech">Sarah asked her friend.</span>`,
                question: "Which type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech because it shows Sarah's exact question.",
                details: [
                    "Questions in direct speech keep their question marks",
                    "The exact wording and punctuation are preserved",
                    "Example: 'Where are you going?' he asked."
                ]
            },
            {
                type: "identify",
                speech: `My little brother exclaimed, <span class="direct-speech">"I see a rainbow!"</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech showing the brother's exact excited words.",
                details: [
                    "Exclamations in direct speech keep exclamation marks",
                    "Emotions are directly expressed in the quoted words",
                    "Example: 'What a beautiful day!' she exclaimed."
                ]
            },
            {
                type: "identify",
                speech: `"Please be quiet during the test," <span class="direct-speech">the teacher said to the class.</span>`,
                question: "Identify the speech type:",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech showing the teacher's exact instruction.",
                details: [
                    "Requests and commands can be in direct speech",
                    "The exact polite or imperative form is preserved",
                    "Example: 'Please sit down,' the host said."
                ]
            },
            {
                type: "identify",
                speech: `"I don't understand this math problem," <span class="direct-speech">complained David.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech showing David's exact complaint.",
                details: [
                    "Different reporting verbs show different tones",
                    "Complained, whispered, shouted add meaning",
                    "Example: 'This is too hard,' he muttered."
                ]
            },
            {
                type: "identify",
                speech: `The coach yelled, <span class="direct-speech">"Run faster!"</span>`,
                question: "Which type of speech is used?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech showing the coach's exact command.",
                details: [
                    "Commands in direct speech use exclamation marks",
                    "The imperative form of the verb is preserved",
                    "Example: 'Stop talking!' the teacher ordered."
                ]
            },
            {
                type: "identify",
                speech: `"My favorite color is blue," <span class="direct-speech">said Emily.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech showing Emily's exact statement.",
                details: [
                    "Simple statements are common in direct speech",
                    "The reporting clause can be inverted",
                    "Example: 'I'm tired,' sighed the worker."
                ]
            },
            {
                type: "identify",
                speech: `The baby cried, <span class="direct-speech">"I want my mommy!"</span>`,
                question: "Identify the speech type:",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "This is direct speech showing the baby's exact words.",
                details: [
                    "Even simple expressions use direct speech",
                    "Emotional content is directly quoted",
                    "Example: 'I'm scared,' whispered the child."
                ]
            },
            // 25 more direct speech identification questions...
            {
                type: "identify",
                speech: `"I can swim across the pool," <span class="direct-speech">boasted Michael.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "Direct speech showing Michael's exact boast.",
                details: ["Boasts and claims in direct speech"]
            },
            {
                type: "identify",
                speech: `The principal announced, <span class="direct-speech">"School will be closed tomorrow."</span>`,
                question: "Identify the type of speech:",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "Direct speech showing the exact announcement.",
                details: ["Official announcements in direct speech"]
            },
            {
                type: "identify",
                speech: `"I finished all my vegetables," <span class="direct-speech">the child told his parents proudly.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "Direct speech showing the child's exact statement.",
                details: ["Proud statements in direct speech"]
            },
            {
                type: "identify",
                speech: `The guide warned, <span class="direct-speech">"Don't touch the paintings."</span>`,
                question: "Which type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "Direct speech showing the exact warning.",
                details: ["Warnings in direct speech"]
            },
            {
                type: "identify",
                speech: `"I'll meet you at the library," <span class="direct-speech">promised Anna.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "A",
                explanation: "Direct speech showing Anna's exact promise.",
                details: ["Promises in direct speech"]
            },

            // Identifying Indirect Speech (35 questions)
            {
                type: "identify",
                speech: `<span class="indirect-speech">Maria said that she loved reading books.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech because it reports what Maria said without using her exact words.",
                details: [
                    "Indirect speech reports what someone said without quotation marks",
                    "It often uses 'that' after the reporting verb",
                    "Pronouns and verb tenses may change",
                    "Example: John said that he was hungry."
                ]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">Tom told his mother that he had finished his homework.</span>`,
                question: "Identify the type of speech:",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech reporting what Tom said.",
                details: [
                    "Indirect speech summarizes or reports the meaning",
                    "No quotation marks are used",
                    "The structure becomes a that-clause",
                    "Example: She said that it was raining."
                ]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">The teacher announced that we would have a test the next day.</span>`,
                question: "What type of speech is used here?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech reporting the teacher's announcement.",
                details: [
                    "Time references often change in indirect speech",
                    "'Tomorrow' becomes 'the next day'",
                    "Example: He said he would come tomorrow (direct) → He said he would come the next day (indirect)"
                ]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">Sarah asked her friend if she could help her with the problem.</span>`,
                question: "Which type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech reporting Sarah's question.",
                details: [
                    "Questions in indirect speech use 'if' or 'whether'",
                    "The word order becomes statement form (not question form)",
                    "Example: 'Can you help?' (direct) → She asked if I could help (indirect)"
                ]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">My little brother exclaimed that he saw a rainbow.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech reporting the brother's excitement.",
                details: [
                    "Exclamations in indirect speech lose their exclamation marks",
                    "The emotional content is described rather than shown",
                    "Example: 'What a surprise!' (direct) → She exclaimed that it was a surprise (indirect)"
                ]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">The teacher told the class to be quiet during the test.</span>`,
                question: "Identify the speech type:",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech reporting the teacher's instruction.",
                details: [
                    "Commands in indirect speech use 'to + verb'",
                    "The imperative becomes an infinitive",
                    "Example: 'Sit down!' (direct) → He told me to sit down (indirect)"
                ]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">David complained that he didn't understand the math problem.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech reporting David's complaint.",
                details: [
                    "The reporting verb indicates the tone",
                    "Complained, admitted, denied show attitude",
                    "Example: He admitted that he was wrong."
                ]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">The coach told the players to run faster.</span>`,
                question: "Which type of speech is used?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech reporting the coach's command.",
                details: [
                    "'Told' is often used for commands in indirect speech",
                    "The structure is 'told + object + to + verb'",
                    "Example: She told the children to be quiet."
                ]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">Emily said that her favorite color was blue.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech reporting Emily's statement.",
                details: [
                    "Pronouns often change in indirect speech",
                    "'My' becomes 'his/her/their'",
                    "Example: 'I like my school' (direct) → She said she liked her school (indirect)"
                ]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">The baby cried that he wanted his mommy.</span>`,
                question: "Identify the speech type:",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "This is indirect speech reporting the baby's words.",
                details: [
                    "Even emotional statements become factual reports",
                    "The exact emotional tone is lost but described",
                    "Example: He screamed that he was frightened."
                ]
            },
            // 25 more indirect speech identification questions...
            {
                type: "identify",
                speech: `<span class="indirect-speech">Michael boasted that he could swim across the pool.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "Indirect speech reporting Michael's boast.",
                details: ["Boasts in indirect speech"]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">The principal announced that school would be closed the next day.</span>`,
                question: "Identify the type of speech:",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "Indirect speech reporting the announcement.",
                details: ["Announcements in indirect speech"]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">The child told his parents proudly that he had finished all his vegetables.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "Indirect speech reporting the child's statement.",
                details: ["Proud statements in indirect speech"]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">The guide warned us not to touch the paintings.</span>`,
                question: "Which type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "Indirect speech reporting the warning.",
                details: ["Warnings in indirect speech"]
            },
            {
                type: "identify",
                speech: `<span class="indirect-speech">Anna promised that she would meet me at the library.</span>`,
                question: "What type of speech is this?",
                options: ["Direct Speech", "Indirect Speech"],
                answer: "B",
                explanation: "Indirect speech reporting Anna's promise.",
                details: ["Promises in indirect speech"]
            },

            // Converting Direct to Indirect Speech (30 questions)
            {
                type: "convert",
                speech: `Direct: Maria said, "I love reading books."`,
                question: "Which is the correct indirect speech?",
                options: [
                    "Maria said that she loved reading books.",
                    "Maria said that I love reading books.",
                    "Maria said that she loves reading books.",
                    "Maria said she love reading books."
                ],
                answer: "A",
                explanation: "The correct conversion changes 'I' to 'she' and 'love' to 'loved' to maintain proper tense.",
                details: [
                    "First person pronouns change to third person",
                    "Present tense often changes to past tense",
                    "Remove quotation marks and add 'that'",
                    "Example: 'I am tired' → He said that he was tired"
                ]
            },
            {
                type: "convert",
                speech: `Direct: "I finished my homework," Tom said.`,
                question: "Choose the correct indirect speech:",
                options: [
                    "Tom said that he had finished his homework.",
                    "Tom said that I finished my homework.",
                    "Tom said that he finished his homework.",
                    "Tom said he finish his homework."
                ],
                answer: "A",
                explanation: "The correct conversion uses 'he' for 'I' and 'had finished' for 'finished'.",
                details: [
                    "Simple past often becomes past perfect in indirect speech",
                    "Possessive pronouns change ('my' becomes 'his')",
                    "Example: 'I lost my book' → She said she had lost her book"
                ]
            },
            {
                type: "convert",
                speech: `Direct: The teacher said, "We will have a test tomorrow."`,
                question: "Which is the proper indirect speech?",
                options: [
                    "The teacher said that they would have a test the next day.",
                    "The teacher said that we will have a test tomorrow.",
                    "The teacher said that they will have a test tomorrow.",
                    "The teacher said we would have test the next day."
                ],
                answer: "A",
                explanation: "Correct conversion changes 'we' to 'they', 'will' to 'would', and 'tomorrow' to 'the next day'.",
                details: [
                    "'Will' becomes 'would' in indirect speech",
                    "Time expressions change: tomorrow → the next day",
                    "Example: 'I'll come tomorrow' → He said he would come the next day"
                ]
            },
            {
                type: "convert",
                speech: `Direct: "Can you help me?" Sarah asked.`,
                question: "What is the correct indirect speech?",
                options: [
                    "Sarah asked if I could help her.",
                    "Sarah asked can I help her.",
                    "Sarah asked if I can help her.",
                    "Sarah asked could I help her."
                ],
                answer: "A",
                explanation: "Questions in indirect speech use 'if' and change to statement word order with 'could'.",
                details: [
                    "Questions become statements with 'if' or 'whether'",
                    "'Can' becomes 'could' in past reporting",
                    "Example: 'Are you coming?' → He asked if I was coming"
                ]
            },
            {
                type: "convert",
                speech: `Direct: "I see a rainbow!" my brother exclaimed.`,
                question: "Choose the correct indirect speech:",
                options: [
                    "My brother exclaimed that he saw a rainbow.",
                    "My brother exclaimed that I see a rainbow.",
                    "My brother exclaimed he sees a rainbow.",
                    "My brother exclaimed that he see a rainbow."
                ],
                answer: "A",
                explanation: "Exclamations become simple statements in indirect speech with proper pronoun and tense changes.",
                details: [
                    "Exclamation marks are removed",
                    "The structure becomes a simple statement",
                    "Example: 'What a surprise!' → She exclaimed that it was a surprise"
                ]
            },
            {
                type: "convert",
                speech: `Direct: "Please be quiet," the teacher said.`,
                question: "Which is the proper indirect speech?",
                options: [
                    "The teacher told us to be quiet.",
                    "The teacher said to be quiet please.",
                    "The teacher said please be quiet.",
                    "The teacher told that we be quiet."
                ],
                answer: "A",
                explanation: "Commands and requests use 'told + object + to + verb' structure in indirect speech.",
                details: [
                    "'Please' is usually omitted in indirect speech",
                    "Use 'told' or 'asked' + 'to + verb'",
                    "Example: 'Stop talking!' → She told them to stop talking"
                ]
            },
            {
                type: "convert",
                speech: `Direct: "I don't understand this," David complained.`,
                question: "What is the correct indirect speech?",
                options: [
                    "David complained that he didn't understand that.",
                    "David complained that I don't understand this.",
                    "David complained he doesn't understand this.",
                    "David complained that he don't understand that."
                ],
                answer: "A",
                explanation: "Correct conversion changes pronouns, tense, and demonstratives ('this' becomes 'that').",
                details: [
                    "'This' often becomes 'that' in indirect speech",
                    "Present tense becomes past tense",
                    "Example: 'I like this book' → She said she liked that book"
                ]
            },
            {
                type: "convert",
                speech: `Direct: "Run faster!" the coach yelled.`,
                question: "Choose the correct indirect speech:",
                options: [
                    "The coach yelled at the players to run faster.",
                    "The coach yelled run faster.",
                    "The coach yelled that run faster.",
                    "The coach yelled to running faster."
                ],
                answer: "A",
                explanation: "Commands in indirect speech use 'told/ordered + object + to + verb' structure.",
                details: [
                    "Add the person being commanded if not stated",
                    "Use the infinitive form of the verb",
                    "Example: 'Wait here!' → He told me to wait there"
                ]
            },
            {
                type: "convert",
                speech: `Direct: "My favorite color is blue," said Emily.`,
                question: "Which is the proper indirect speech?",
                options: [
                    "Emily said that her favorite color was blue.",
                    "Emily said that my favorite color is blue.",
                    "Emily said that her favorite color is blue.",
                    "Emily said my favorite color was blue."
                ],
                answer: "A",
                explanation: "Correct conversion changes 'my' to 'her' and 'is' to 'was' for tense consistency.",
                details: [
                    "Possessive pronouns change to match the speaker",
                    "Present tense often changes to past tense",
                    "Example: 'This is my house' → He said that was his house"
                ]
            },
            {
                type: "convert",
                speech: `Direct: "I want my mommy," the baby cried.`,
                question: "What is the correct indirect speech?",
                options: [
                    "The baby cried that he wanted his mommy.",
                    "The baby cried that I want my mommy.",
                    "The baby cried he wants his mommy.",
                    "The baby cried that he want his mommy."
                ],
                answer: "A",
                explanation: "Correct conversion changes pronouns and verb tense while maintaining the meaning.",
                details: [
                    "Emotional content is preserved through reporting verbs",
                    "All necessary grammatical changes are made",
                    "Example: 'I'm scared!' → The child cried that he was scared"
                ]
            },
            // 20 more conversion questions...
            {
                type: "convert",
                speech: `Direct: "I can swim," Michael said.`,
                question: "Choose the correct indirect speech:",
                options: [
                    "Michael said that he could swim.",
                    "Michael said that I can swim.",
                    "Michael said that he can swim.",
                    "Michael said he could swimmed."
                ],
                answer: "A",
                explanation: "'Can' becomes 'could' in indirect speech.",
                details: ["Modal verb changes: can → could"]
            },
            {
                type: "convert",
                speech: `Direct: "We are playing outside," the children said.`,
                question: "Which is the proper indirect speech?",
                options: [
                    "The children said that they were playing outside.",
                    "The children said that we are playing outside.",
                    "The children said that they are playing outside.",
                    "The children said we were playing outside."
                ],
                answer: "A",
                explanation: "'We' becomes 'they' and 'are playing' becomes 'were playing'.",
                details: ["Present continuous becomes past continuous"]
            },
            {
                type: "convert",
                speech: `Direct: "I have finished my work," she said.`,
                question: "What is the correct indirect speech?",
                options: [
                    "She said that she had finished her work.",
                    "She said that I have finished my work.",
                    "She said that she has finished her work.",
                    "She said she had finish her work."
                ],
                answer: "A",
                explanation: "Present perfect becomes past perfect in indirect speech.",
                details: ["Have/has finished → had finished"]
            },
            {
                type: "convert",
                speech: `Direct: "It is raining," he observed.`,
                question: "Choose the correct indirect speech:",
                options: [
                    "He observed that it was raining.",
                    "He observed that it is raining.",
                    "He observed that it were raining.",
                    "He observed it was rain."
                ],
                answer: "A",
                explanation: "Present continuous becomes past continuous.",
                details: ["Is raining → was raining"]
            },
            {
                type: "convert",
                speech: `Direct: "I will help you," she promised.`,
                question: "Which is the proper indirect speech?",
                options: [
                    "She promised that she would help me.",
                    "She promised that I will help you.",
                    "She promised that she will help me.",
                    "She promised she would helped me."
                ],
                answer: "A",
                explanation: "'Will' becomes 'would' and pronouns change appropriately.",
                details: ["Will → would, you → me"]
            }
        ];

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // Positive feedback messages
        const positiveMessages = [
            "Excellent!",
            "Fantastic!",
            "Great job!",
            "Amazing!",
            "Well done!",
            "You're a speech expert!",
            "Perfect!",
            "Outstanding!",
            "Brilliant!",
            "You're on fire!"
        ];

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const speechDisplay = document.getElementById('speechDisplay');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const partDetails = document.getElementById('partDetails');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const backToTopicsBtn = document.getElementById('backToTopics');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const scoreMessage = document.getElementById('scoreMessage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const highestScore = document.getElementById('highestScore');

        // Initialize the app
        function initApp() {
            initSlideshow();
            loadStateFromStorage();
            setupEventListeners();
            
            // Show appropriate page based on state
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Load state from localStorage
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixDirectIndirectSpeech');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                // If we have a saved state but no questions, initialize them
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // Save state to localStorage
        function saveStateToStorage() {
            localStorage.setItem('ideolixDirectIndirectSpeech', JSON.stringify(appState));
        }

        // Initialize and shuffle questions
        function initializeQuestions() {
            // Create a copy of questions and shuffle them
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', backToHome);
            backToTopicsBtn.addEventListener('click', backToTopics);
            viewTopicsBtn.addEventListener('click', backToTopics);
            
            // Allow pressing Enter to start practice
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startPractice();
                }
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            
            // Clear any previous input
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            
            // Display student name
            studentNameDisplay.textContent = appState.studentName;
            
            // Load the current question
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            // Calculate results
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            // Update results display
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            
            // Get highest score from localStorage
            const highest = localStorage.getItem('ideolixDirectIndirectSpeech_highestScore') || 0;
            highestScore.textContent = Math.max(highest, appState.score);
            
            // Save new highest score if applicable
            if (appState.score > highest) {
                localStorage.setItem('ideolixDirectIndirectSpeech_highestScore', appState.score);
            }
            
            // Set encouraging message based on score
            if (percentage >= 90) {
                scoreMessage.textContent = "Outstanding! You're a direct and indirect speech expert!";
            } else if (percentage >= 80) {
                scoreMessage.textContent = "Great job! You understand speech conversion very well!";
            } else if (percentage >= 70) {
                scoreMessage.textContent = "Good work! Keep practicing to become a grammar master!";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "Not bad! Review the questions you missed and try again!";
            } else {
                scoreMessage.textContent = "Keep practicing! You'll get better with more practice!";
            }
        }

        // Start practice mode
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert('Please enter your name to continue.');
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            // Initialize and shuffle questions
            initializeQuestions();
            
            // Save state and show practice page
            saveStateToStorage();
            showPracticePage();
        }

        // Load current question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            // Update progress
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            // Set speech display
            speechDisplay.innerHTML = question.speech;
            
            // Set appropriate question text
            if (question.type === "identify") {
                questionText.textContent = question.question || "Identify the type of speech:";
            } else if (question.type === "convert") {
                questionText.textContent = question.question || "Choose the correct conversion:";
            }
            
            // Clear previous options and feedback
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            // Create option elements
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            // Disable all options
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            // Mark correct/incorrect
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                // Correct answer
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                
                // Show positive feedback
                showFeedback(true, question.explanation, question.details);
            } else {
                // Incorrect answer
                optionElement.classList.add('incorrect');
                appState.answered++;
                
                // Show negative feedback
                showFeedback(false, question.explanation, question.details, question.answer);
            }
            
            // Enable next question button
            nextQuestionBtn.disabled = false;
            
            // Save progress
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, details, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackMessage = feedbackContainer.querySelector('.feedback-message');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            // Clear previous details
            partDetails.innerHTML = '';
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '✓';
                feedbackTitle.textContent = 'Correct!';
                feedbackMessage.textContent = positiveMessages[Math.floor(Math.random() * positiveMessages.length)];
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '✗';
                feedbackTitle.textContent = 'Incorrect';
                const correctOption = String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65));
                feedbackMessage.textContent = `Correct answer: ${correctOption}`;
            }
            
            feedbackExplanation.textContent = explanation;
            
            // Add grammar details
            if (details && details.length > 0) {
                const detailsTitle = document.createElement('div');
                detailsTitle.textContent = 'Grammar Rules:';
                detailsTitle.style.fontWeight = 'bold';
                detailsTitle.style.marginBottom = '10px';
                detailsTitle.style.color = 'var(--text-primary)';
                partDetails.appendChild(detailsTitle);
                
                details.forEach(detail => {
                    const detailElement = document.createElement('div');
                    detailElement.className = 'detail-item';
                    detailElement.textContent = detail;
                    partDetails.appendChild(detailElement);
                });
            }
            
            feedbackContainer.style.display = 'block';
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip current question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry the topic with new shuffled questions
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            // Re-shuffle questions
            initializeQuestions();
            
            saveStateToStorage();
            showPracticePage();
        }

        // Go back to home page
        function backToHome() {
            showWelcomePage();
        }

        // Go back to topics page (simulated)
        function backToTopics() {
            alert("In a complete implementation, this would navigate to the topics selection page.");
            // In a real implementation, this would be: window.location.href = "grade4-english-topics.html";
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

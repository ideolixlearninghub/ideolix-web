<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 5 English - Punctuation | Ideolix Learning Hub</title>
    <style>
        :root {
            --primary-blue: #2196F3;
            --secondary-green: #4CAF50;
            --accent-orange: #FF9800;
            --accent-purple: #9C27B0;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--dark-border);
        }

        .logo {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            border-radius: 10px;
            overflow: hidden;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info {
            flex: 1;
        }

        .brand-info h1 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .card {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--dark-border);
        }

        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 30px 20px;
        }

        .welcome-title {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 25px;
            max-width: 500px;
            line-height: 1.5;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(33, 150, 243, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--primary-blue);
        }

        .topic-name {
            font-weight: 600;
            color: var(--primary-blue);
        }

        .input-group {
            width: 100%;
            max-width: 300px;
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            background: var(--dark-surface);
            color: var(--text-primary);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--dark-border);
        }

        .btn-outline:hover {
            border-color: var(--primary-blue);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 15px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .progress-bar {
            height: 6px;
            background: var(--dark-surface);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-blue), var(--accent-orange));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .question-container {
            margin-bottom: 15px;
        }

        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (min-width: 768px) {
            .content-wrapper {
                grid-template-columns: 1fr 1fr;
            }
        }

        .question-side {
            display: flex;
            flex-direction: column;
        }

        .visualization-side {
            display: flex;
            flex-direction: column;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .sentence-display {
            font-size: 1.1rem;
            padding: 15px;
            background: var(--dark-surface);
            border-radius: 10px;
            margin: 15px 0;
            border-left: 3px solid var(--accent-orange);
            font-family: 'Georgia', serif;
        }

        .grammar-tip {
            background: var(--dark-surface);
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            border-left: 3px solid var(--accent-purple);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .option {
            padding: 12px 15px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-blue);
        }

        .option.correct {
            background: rgba(33, 150, 243, 0.1);
            border-color: var(--primary-blue);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: #F44336;
        }

        .option-letter {
            width: 24px;
            height: 24px;
            background: var(--dark-card);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .option.correct .option-letter {
            background: var(--primary-blue);
            color: white;
        }

        .option.incorrect .option-letter {
            background: #F44336;
            color: white;
        }

        .feedback-container {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .feedback-correct {
            background: rgba(33, 150, 243, 0.1);
            border-left: 3px solid var(--primary-blue);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 3px solid #F44336;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .feedback-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--primary-blue);
        }

        .feedback-incorrect .feedback-icon {
            background: #F44336;
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1rem;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .visualization-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--dark-border);
        }

        .concept-display {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .concept-box {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-orange));
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1rem;
            text-align: center;
        }

        .punctuation-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .punctuation-box {
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            font-size: 1.2rem;
        }

        .comma-box {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid var(--primary-blue);
        }

        .quote-box {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--secondary-green);
        }

        .apostrophe-box {
            background: rgba(156, 39, 176, 0.1);
            border: 1px solid var(--accent-purple);
        }

        .rule-card {
            margin: 10px 0;
            padding: 10px;
            background: var(--dark-card);
            border-radius: 8px;
            border-left: 3px solid;
        }

        .comma-rule {
            border-left-color: var(--primary-blue);
        }

        .quote-rule {
            border-left-color: var(--secondary-green);
        }

        .apostrophe-rule {
            border-left-color: var(--accent-purple);
        }

        .rule-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rule-example {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-family: 'Courier New', monospace;
            margin-top: 5px;
        }

        .example-display {
            padding: 10px;
            background: var(--dark-card);
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Georgia', serif;
        }

        .correct-example {
            color: #4CAF50;
            border-left: 3px solid #4CAF50;
        }

        .incorrect-example {
            color: #F44336;
            border-left: 3px solid #F44336;
        }

        .mark-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .mark {
            font-size: 1.5rem;
            padding: 5px 10px;
            background: var(--dark-card);
            border-radius: 4px;
        }

        .usage-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        @media (min-width: 480px) {
            .usage-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .results-page {
            display: none;
            text-align: center;
            padding: 30px 20px;
        }

        .results-title {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 25px;
            max-width: 400px;
            margin: 0 auto 20px;
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .score-percentage {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 12px;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToTopics">Topics</button>
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <div class="welcome-page card fade-in" id="welcomePage">
            <h1 class="welcome-title">Grade 5 English</h1>
            <p class="welcome-subtitle">Master punctuation: commas, quotation marks, and apostrophes. Learn to use them correctly in your writing.</p>
            
            <div class="topic-badge">
                <span class="topic-name">Punctuation</span>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your name:</label>
                <input type="text" id="studentName" placeholder="Your name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">Start Practice</button>
            </div>
        </div>

        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 60</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 1.67%"></div>
                </div>
            </div>

            <div class="question-container">
                <div id="sentenceDisplay"></div>
                <div id="grammarTip"></div>
                <div id="conceptDisplay"></div>
                
                <div class="content-wrapper">
                    <div class="question-side">
                        <h2 class="question-text" id="questionText"></h2>
                        
                        <div class="options-container" id="optionsContainer"></div>
                        
                        <div class="feedback-container" id="feedbackContainer">
                            <div class="feedback-header">
                                <div class="feedback-icon"></div>
                                <div class="feedback-title"></div>
                            </div>
                            <div class="feedback-explanation"></div>
                        </div>
                    </div>
                    
                    <div class="visualization-side">
                        <div class="visualization-container" id="visualizationContainer"></div>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next</button>
                </div>
            </div>
        </div>

        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Practice Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="highestScore">0</div>
                        <div class="stat-label">Best Score</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Try Again</button>
                <button class="btn btn-outline" id="viewTopics">More Topics</button>
            </div>
        </div>
    </div>

    <script>
        // Core punctuation marks
        const punctuationMarks = {
            comma: ",",
            apostrophe: "'",
            quotation: '"'
        };

        // Questions array - 60 focused questions
        const questions = [
            // Commas (1-20)
            {
                type: "comma",
                sentence: "I need eggs milk and bread from the store.",
                question: "Where should commas go in this list?",
                options: [
                    "I need eggs, milk, and bread from the store.",
                    "I need eggs milk, and bread from the store.",
                    "I need eggs, milk and bread from the store.",
                    "I need eggs milk and bread, from the store."
                ],
                answer: "A",
                explanation: "Use commas to separate items in a list (Oxford comma optional)."
            },
            {
                type: "comma",
                sentence: "After we finish dinner we can watch a movie.",
                question: "Where should the comma go?",
                options: [
                    "After we finish dinner, we can watch a movie.",
                    "After we finish dinner we can, watch a movie.",
                    "After we finish, dinner we can watch a movie.",
                    "After, we finish dinner we can watch a movie."
                ],
                answer: "A",
                explanation: "Use comma after introductory phrase."
            },
            {
                type: "comma",
                sentence: "My friend who lives in Chicago is visiting.",
                question: "Which sentence uses commas correctly?",
                options: [
                    "My friend, who lives in Chicago, is visiting.",
                    "My friend who lives in Chicago, is visiting.",
                    "My friend, who lives in Chicago is visiting.",
                    "My friend who lives in Chicago is visiting."
                ],
                answer: "A",
                explanation: "Use commas to set off non-essential information."
            },

            // Quotation Marks (21-40)
            {
                type: "quotation",
                sentence: "I love reading said Sarah.",
                question: "Which sentence has correct quotation marks?",
                options: [
                    '"I love reading," said Sarah.',
                    "I love reading, said Sarah.",
                    '"I love reading, said Sarah."',
                    'I love reading "said Sarah."'
                ],
                answer: "A",
                explanation: "Quotation marks go around spoken words, comma inside quotes."
            },
            {
                type: "quotation",
                sentence: "Can we go to the park asked Tom",
                question: "Correct the quotation marks and punctuation:",
                options: [
                    '"Can we go to the park?" asked Tom.',
                    '"Can we go to the park" asked Tom.',
                    '"Can we go to the park?" asked Tom',
                    'Can we go to the park? "asked Tom."'
                ],
                answer: "A",
                explanation: "Question mark goes inside quotation marks."
            },
            {
                type: "quotation",
                sentence: "The title of the book is Charlotte's Web",
                question: "How should the title be punctuated?",
                options: [
                    'The title of the book is "Charlotte\'s Web."',
                    "The title of the book is 'Charlotte's Web.'",
                    "The title of the book is Charlotte's Web.",
                    'The title of the book is "Charlottes Web."'
                ],
                answer: "A",
                explanation: "Use quotation marks for titles of short works like books."
            },

            // Apostrophes (41-60)
            {
                type: "apostrophe",
                sentence: "The dogs bone is buried in the yard.",
                question: "Where does the apostrophe go?",
                options: [
                    "The dog's bone is buried in the yard.",
                    "The dogs' bone is buried in the yard.",
                    "The dogs bone's is buried in the yard.",
                    "The dog's bone's is buried in the yard."
                ],
                answer: "A",
                explanation: "Apostrophe before s shows singular possession."
            },
            {
                type: "apostrophe",
                sentence: "All the students backpacks were in the locker.",
                question: "Correct the possessive form:",
                options: [
                    "All the students' backpacks were in the locker.",
                    "All the student's backpacks were in the locker.",
                    "All the students backpack's were in the locker.",
                    "All the students' backpack's were in the locker."
                ],
                answer: "A",
                explanation: "Apostrophe after s shows plural possession."
            },
            {
                type: "apostrophe",
                sentence: "I cant believe its already Friday.",
                question: "Fix the contractions:",
                options: [
                    "I can't believe it's already Friday.",
                    "I cant' believe its' already Friday.",
                    "I can't believe its already Friday.",
                    "I cant believe it's already Friday."
                ],
                answer: "A",
                explanation: "'can't' = cannot, 'it's' = it is (contractions need apostrophes)."
            },
            {
                type: "apostrophe",
                sentence: "The childrens toys were everywhere.",
                question: "Correct the irregular plural possessive:",
                options: [
                    "The children's toys were everywhere.",
                    "The childrens' toys were everywhere.",
                    "The childrens toy's were everywhere.",
                    "The children's toy's were everywhere."
                ],
                answer: "A",
                explanation: "Irregular plural 'children' takes apostrophe + s."
            }
        ];

        // Add more questions to reach 60
        for (let i = 61; i <= 100; i++) {
            const types = ["comma", "quotation", "apostrophe"];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let sentence, question, options, answer, explanation;
            
            switch(type) {
                case "comma":
                    const commaCases = [
                        {
                            sentence: "On Monday Tuesday and Wednesday we have tests.",
                            correct: "On Monday, Tuesday, and Wednesday we have tests.",
                            explanation: "Commas separate items in a list."
                        },
                        {
                            sentence: "Because it was raining we stayed inside.",
                            correct: "Because it was raining, we stayed inside.",
                            explanation: "Comma after introductory clause."
                        },
                        {
                            sentence: "Sarah my best friend loves to read.",
                            correct: "Sarah, my best friend, loves to read.",
                            explanation: "Commas set off appositives."
                        }
                    ];
                    const commaCase = commaCases[Math.floor(Math.random() * commaCases.length)];
                    sentence = commaCase.sentence;
                    question = "Correct the comma usage:";
                    options = [
                        commaCase.correct,
                        sentence.replace(",", ""),
                        sentence.replace(" ", ", "),
                        sentence + ","
                    ];
                    answer = "A";
                    explanation = commaCase.explanation;
                    break;
                    
                case "quotation":
                    const quoteCases = [
                        {
                            sentence: "Lets go to the park said Mom",
                            correct: '"Let\'s go to the park," said Mom.',
                            explanation: "Quotation marks around spoken words, comma inside."
                        },
                        {
                            sentence: "Stop shouted the teacher",
                            correct: '"Stop!" shouted the teacher.',
                            explanation: "Exclamation point inside quotation marks."
                        },
                        {
                            sentence: "Have you read the poem The Road Not Taken",
                            correct: 'Have you read the poem "The Road Not Taken"?',
                            explanation: "Quotation marks for poem titles, question mark outside."
                        }
                    ];
                    const quoteCase = quoteCases[Math.floor(Math.random() * quoteCases.length)];
                    sentence = quoteCase.sentence;
                    question = "Add correct quotation marks and punctuation:";
                    options = [
                        quoteCase.correct,
                        sentence.replace('"', ''),
                        '"' + sentence + '"',
                        sentence + '."'
                    ];
                    answer = "A";
                    explanation = quoteCase.explanation;
                    break;
                    
                case "apostrophe":
                    const apostropheCases = [
                        {
                            sentence: "The cats whiskers are very long.",
                            correct: "The cat's whiskers are very long.",
                            explanation: "Apostrophe before s for singular possession."
                        },
                        {
                            sentence: "All the teachers classrooms are on this floor.",
                            correct: "All the teachers' classrooms are on this floor.",
                            explanation: "Apostrophe after s for plural possession."
                        },
                        {
                            sentence: "Youre going to love this book.",
                            correct: "You're going to love this book.",
                            explanation: "'You're' = you are (contraction)."
                        }
                    ];
                    const apostropheCase = apostropheCases[Math.floor(Math.random() * apostropheCases.length)];
                    sentence = apostropheCase.sentence;
                    question = "Correct the apostrophe usage:";
                    options = [
                        apostropheCase.correct,
                        sentence.replace("'", ""),
                        sentence.replace("s", "s'"),
                        sentence + "'s"
                    ];
                    answer = "A";
                    explanation = apostropheCase.explanation;
                    break;
            }
            
            if (sentence) {
                questions.push({
                    type: type,
                    sentence: sentence,
                    question: question,
                    options: options,
                    answer: answer,
                    explanation: explanation
                });
            }
        }

        // Keep only 60 questions
        questions.length = 60;

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const sentenceDisplay = document.getElementById('sentenceDisplay');
        const grammarTip = document.getElementById('grammarTip');
        const conceptDisplay = document.getElementById('conceptDisplay');
        const visualizationContainer = document.getElementById('visualizationContainer');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const backToTopicsBtn = document.getElementById('backToTopics');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const highestScore = document.getElementById('highestScore');

        // Initialize app
        function initApp() {
            loadStateFromStorage();
            setupEventListeners();
            
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Load state
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixPunctuation');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // Save state
        function saveStateToStorage() {
            localStorage.setItem('ideolixPunctuation', JSON.stringify(appState));
        }

        // Initialize questions
        function initializeQuestions() {
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', backToHome);
            backToTopicsBtn.addEventListener('click', backToTopics);
            viewTopicsBtn.addEventListener('click', backToTopics);
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') startPractice();
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            
            const highest = localStorage.getItem('ideolixPunctuation_highestScore') || 0;
            highestScore.textContent = Math.max(highest, appState.score);
            
            if (appState.score > highest) {
                localStorage.setItem('ideolixPunctuation_highestScore', appState.score);
            }
        }

        // Create sentence display
        function createSentenceDisplay() {
            const display = document.createElement('div');
            display.className = 'sentence-display';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            display.textContent = `"${question.sentence}"`;
            
            return display;
        }

        // Create grammar tip
        function createGrammarTip() {
            const tipDiv = document.createElement('div');
            tipDiv.className = 'grammar-tip';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            const tips = {
                comma: [
                    "Commas separate items in lists.",
                    "Use commas after introductory phrases.",
                    "Commas set off non-essential information."
                ],
                quotation: [
                    "Quotation marks go around spoken words.",
                    "Punctuation usually goes inside quotes.",
                    "Use quotes for titles of short works."
                ],
                apostrophe: [
                    "Apostrophe + s shows possession.",
                    "Apostrophe in contractions replaces letters.",
                    "Plural nouns ending in s just add apostrophe."
                ]
            };
            
            const typeTips = tips[question.type] || tips.comma;
            tipDiv.textContent = `Tip: ${typeTips[Math.floor(Math.random() * typeTips.length)]}`;
            
            return tipDiv;
        }

        // Create concept display
        function createConceptDisplay() {
            const display = document.createElement('div');
            display.className = 'concept-display';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            const conceptBox = document.createElement('div');
            conceptBox.className = 'concept-box fade-in';
            
            let conceptText = "Punctuation";
            if (question.type === "comma") conceptText = "Commas";
            if (question.type === "quotation") conceptText = "Quotation Marks";
            if (question.type === "apostrophe") conceptText = "Apostrophes";
            
            conceptBox.textContent = conceptText;
            display.appendChild(conceptBox);
            
            return display;
        }

        // Create visualization
        function createVisualization() {
            const vizDiv = document.createElement('div');
            vizDiv.className = 'visualization-container';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            if (question.type === "comma") {
                vizDiv.innerHTML = `
                    <div class="punctuation-display">
                        <div class="punctuation-box comma-box">,</div>
                        <div class="punctuation-box quote-box">"</div>
                        <div class="punctuation-box apostrophe-box">'</div>
                    </div>
                    <div class="rule-card comma-rule">
                        <div class="rule-title">üìù Comma Rules</div>
                        <div class="rule-example">Lists: apples, oranges, and bananas</div>
                        <div class="rule-example">Introductory: After lunch, we played</div>
                        <div class="rule-example">Appositives: Tom, my brother, called</div>
                    </div>
                    <div class="example-display correct-example">
                        Correct: I need paper, pencils, and erasers.
                    </div>
                    <div class="example-display incorrect-example">
                        Incorrect: I need paper pencils and erasers.
                    </div>
                `;
            } else if (question.type === "quotation") {
                vizDiv.innerHTML = `
                    <div class="mark-container">
                        <div class="mark">"</div>
                        <div style="color: var(--text-secondary);">Opening and closing quotes</div>
                        <div class="mark">"</div>
                    </div>
                    <div class="rule-card quote-rule">
                        <div class="rule-title">üí¨ Quotation Rules</div>
                        <div class="rule-example">Direct speech: "Hello," she said.</div>
                        <div class="rule-example">Titles: Read "Charlotte's Web"</div>
                        <div class="rule-example">Punctuation inside: "Stop!" he yelled.</div>
                    </div>
                    <div class="usage-grid">
                        <div class="example-display correct-example">
                            "I'm tired," said Mom.
                        </div>
                        <div class="example-display incorrect-example">
                            "I'm tired", said Mom.
                        </div>
                    </div>
                `;
            } else {
                vizDiv.innerHTML = `
                    <div class="mark-container">
                        <div class="mark apostrophe-box">'</div>
                        <div style="color: var(--text-secondary);">Apostrophe has two uses</div>
                    </div>
                    <div class="rule-grid">
                        <div class="rule-card apostrophe-rule">
                            <div class="rule-title">üìå Possession</div>
                            <div class="rule-example">dog ‚Üí dog's (singular)</div>
                            <div class="rule-example">dogs ‚Üí dogs' (plural)</div>
                            <div class="rule-example">children ‚Üí children's (irregular)</div>
                        </div>
                        <div class="rule-card">
                            <div class="rule-title">üî§ Contractions</div>
                            <div class="rule-example">do not ‚Üí don't</div>
                            <div class="rule-example">I am ‚Üí I'm</div>
                            <div class="rule-example">it is ‚Üí it's</div>
                        </div>
                    </div>
                    <div class="example-display correct-example">
                        The cat's toy (one cat) | The cats' toy (many cats)
                    </div>
                `;
            }
            
            return vizDiv;
        }

        // Load question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            sentenceDisplay.innerHTML = '';
            grammarTip.innerHTML = '';
            conceptDisplay.innerHTML = '';
            visualizationContainer.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            sentenceDisplay.appendChild(createSentenceDisplay());
            grammarTip.appendChild(createGrammarTip());
            conceptDisplay.appendChild(createConceptDisplay());
            visualizationContainer.appendChild(createVisualization());
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div>${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation, question.answer);
            }
            
            nextQuestionBtn.disabled = false;
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '‚úì';
                feedbackTitle.textContent = 'Correct!';
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '‚úó';
                feedbackTitle.textContent = 'Incorrect';
                if (correctAnswer) {
                    const correctOption = String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65));
                    explanation = `Correct: ${correctOption}. ${explanation}`;
                }
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            initializeQuestions();
            
            saveStateToStorage();
            showPracticePage();
        }

        // Back to home
        function backToHome() {
            showWelcomePage();
        }

        // Back to topics
        function backToTopics() {
            alert("Would navigate to topics page.");
        }

        // Start practice
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name.");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            if (appState.currentQuestions.length === 0) {
                initializeQuestions();
            }
            
            saveStateToStorage();
            showPracticePage();
        }

        // Initialize app
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

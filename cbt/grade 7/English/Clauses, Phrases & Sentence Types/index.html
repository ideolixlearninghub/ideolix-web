<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 7 English - Clauses, Phrases & Sentence Types | Ideolix Learning Hub</title>
    <style>
        /* CSS Variables for Grammar Theme */
        :root {
            --primary-blue: #2196F3;
            --secondary-teal: #009688;
            --accent-yellow: #FFEB3B;
            --accent-green: #4CAF50;
            --accent-orange: #FF9800;
            --accent-red: #F44336;
            --accent-purple: #9C27B0;
            --accent-pink: #E91E63;
            --accent-indigo: #3F51B5;
            --accent-cyan: #00BCD4;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --text-muted: #888;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --sentence-glow: 0 0 20px rgba(33, 150, 243, 0.4);
            --clause-glow: 0 0 20px rgba(0, 150, 136, 0.4);
            --phrase-glow: 0 0 20px rgba(255, 235, 59, 0.4);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Grammar Pattern Background */
        .grammar-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: 
                radial-gradient(circle at 20% 30%, rgba(33, 150, 243, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 150, 136, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 235, 59, 0.1) 0%, transparent 50%),
                repeating-linear-gradient(45deg, transparent 0px, transparent 5px, rgba(33, 150, 243, 0.05) 6px, transparent 7px),
                repeating-linear-gradient(-45deg, transparent 0px, transparent 5px, rgba(0, 150, 136, 0.05) 6px, transparent 7px);
            opacity: 0.3;
        }

        .floating-element {
            position: absolute;
            font-size: 3rem;
            font-weight: bold;
            animation: floatElement 25s linear infinite;
        }

        @keyframes floatElement {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.1; }
            25% { transform: translateY(-150px) translateX(100px) rotate(90deg); opacity: 0.05; }
            50% { transform: translateY(-50px) translateX(-150px) rotate(180deg); opacity: 0.1; }
            75% { transform: translateY(150px) translateX(50px) rotate(270deg); opacity: 0.05; }
            100% { transform: translateY(0) translateX(0) rotate(360deg); opacity: 0.1; }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: -1;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            position: sticky;
            top: 20px;
            z-index: 100;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(10px);
        }

        .logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info {
            flex: 1;
        }

        .brand-info h1 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        /* Card Styles */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--dark-border);
            backdrop-filter: blur(5px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow), var(--sentence-glow);
        }

        /* Welcome Page */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-logo {
            width: 140px;
            height: 140px;
            margin-bottom: 25px;
            border-radius: 20px;
            overflow: hidden;
            background-color: var(--dark-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .welcome-logo img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .welcome-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 700px;
            line-height: 1.6;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(33, 150, 243, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 25px;
            border: 1px solid var(--primary-blue);
        }

        .topic-icon {
            font-size: 1.5rem;
        }

        .topic-name {
            font-weight: 600;
            color: var(--primary-blue);
        }

        .input-group {
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 1.1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }

        .btn-primary:hover {
            background: #1976D2;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.5);
        }

        .btn-secondary {
            background: var(--secondary-teal);
            color: #212121;
            box-shadow: 0 4px 15px rgba(0, 150, 136, 0.4);
        }

        .btn-secondary:hover {
            background: #00796B;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 150, 136, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-blue);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Practice Mode */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-bar {
            height: 12px;
            background: var(--dark-surface);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-blue), var(--secondary-teal));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
        }

        .question-container {
            margin-bottom: 25px;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .grammar-fact {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-yellow);
            font-style: italic;
            color: var(--text-secondary);
        }

        /* Content Layout */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 25px 0;
        }

        @media (max-width: 992px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .question-side {
            display: flex;
            flex-direction: column;
        }

        .visualization-side {
            display: flex;
            flex-direction: column;
        }

        .concept-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .concept-box {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            padding: 20px 30px;
            border-radius: 12px;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            min-width: 180px;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .concept-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .concept-label {
            font-size: 1rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 5px;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }

        .option {
            padding: 18px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--dark-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: rgba(33, 150, 243, 0.05);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(33, 150, 243, 0.1);
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: #F44336;
            color: #F44336;
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--dark-card);
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
            color: white;
            background: var(--secondary-teal);
            color: #212121;
        }

        .option.correct .option-letter {
            background: var(--primary-blue);
            color: white;
        }

        .option.incorrect .option-letter {
            background: #F44336;
            color: white;
        }

        .feedback-container {
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            display: none;
        }

        .feedback-correct {
            background: rgba(33, 150, 243, 0.1);
            border-left: 5px solid var(--primary-blue);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 5px solid #F44336;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--primary-blue);
        }

        .feedback-incorrect .feedback-icon {
            background: #F44336;
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .feedback-correct .feedback-title {
            color: var(--primary-blue);
        }

        .feedback-incorrect .feedback-title {
            color: #F44336;
        }

        .feedback-message {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        /* Visualization Components */
        .visualization-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 25px;
            height: 100%;
            border: 1px solid var(--dark-border);
            overflow: auto;
            backdrop-filter: blur(5px);
        }

        /* Sentence Display */
        .sentence-display {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid var(--accent-yellow);
            text-align: center;
            font-family: 'Georgia', serif;
        }

        .display-title {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            font-size: 1.3rem;
        }

        /* Grammar Concepts */
        .concepts-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .grammar-card {
            background: var(--dark-card);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            min-width: 200px;
            transition: transform 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .grammar-card.clauses {
            border-color: var(--primary-blue);
            background: rgba(33, 150, 243, 0.1);
        }

        .grammar-card.phrases {
            border-color: var(--secondary-teal);
            background: rgba(0, 150, 136, 0.1);
        }

        .grammar-card.sentence-types {
            border-color: var(--accent-yellow);
            background: rgba(255, 235, 59, 0.1);
        }

        .grammar-card:hover {
            transform: scale(1.05);
        }

        .grammar-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .grammar-card.clauses .grammar-name {
            color: var(--primary-blue);
        }

        .grammar-card.phrases .grammar-name {
            color: var(--secondary-teal);
        }

        .grammar-card.sentence-types .grammar-name {
            color: var(--accent-yellow);
        }

        .grammar-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* Sentence Analysis */
        .analysis-visualization {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-green);
        }

        .sentence-analysis {
            background: var(--dark-surface);
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed var(--dark-border);
            font-family: 'Georgia', serif;
            position: relative;
        }

        .sentence-part {
            display: inline-block;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 6px;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .subject {
            background: rgba(33, 150, 243, 0.3);
            color: white;
            border: 2px solid var(--primary-blue);
        }

        .verb {
            background: rgba(76, 175, 80, 0.3);
            color: white;
            border: 2px solid var(--accent-green);
        }

        .object {
            background: rgba(255, 152, 0, 0.3);
            color: white;
            border: 2px solid var(--accent-orange);
        }

        .phrase {
            background: rgba(156, 39, 176, 0.3);
            color: white;
            border: 2px solid var(--accent-purple);
        }

        .clause {
            background: rgba(244, 67, 54, 0.3);
            color: white;
            border: 2px solid var(--accent-red);
        }

        .sentence-part:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .analysis-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .analysis-button {
            padding: 8px 16px;
            background: var(--dark-surface);
            border: 2px solid var(--accent-green);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analysis-button:hover {
            background: rgba(76, 175, 80, 0.1);
            transform: translateY(-2px);
        }

        /* Sentence Types */
        .sentence-types-visualization {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-orange);
        }

        .types-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .type-box {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            min-width: 150px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .type-box.simple {
            border-color: var(--accent-green);
            background: rgba(76, 175, 80, 0.1);
        }

        .type-box.compound {
            border-color: var(--accent-blue);
            background: rgba(33, 150, 243, 0.1);
        }

        .type-box.complex {
            border-color: var(--accent-purple);
            background: rgba(156, 39, 176, 0.1);
        }

        .type-box.compound-complex {
            border-color: var(--accent-red);
            background: rgba(244, 67, 54, 0.1);
        }

        .type-box:hover {
            transform: translateY(-3px);
        }

        .type-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .type-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .type-box.simple .type-name {
            color: var(--accent-green);
        }

        .type-box.compound .type-name {
            color: var(--primary-blue);
        }

        .type-box.complex .type-name {
            color: var(--accent-purple);
        }

        .type-box.compound-complex .type-name {
            color: var(--accent-red);
        }

        .type-description {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Grammar Examples */
        .examples-container {
            background: var(--dark-card);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--accent-purple);
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .examples-grid {
                grid-template-columns: 1fr;
            }
        }

        .example-box {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .example-box:hover {
            transform: translateY(-3px);
        }

        .example-box.independent {
            border-color: var(--accent-green);
            background: rgba(76, 175, 80, 0.1);
        }

        .example-box.dependent {
            border-color: var(--accent-orange);
            background: rgba(255, 152, 0, 0.1);
        }

        .example-box.noun-phrase {
            border-color: var(--primary-blue);
            background: rgba(33, 150, 243, 0.1);
        }

        .example-box.verb-phrase {
            border-color: var(--accent-red);
            background: rgba(244, 67, 54, 0.1);
        }

        .example-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .example-name {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .example-box.independent .example-name {
            color: var(--accent-green);
        }

        .example-box.dependent .example-name {
            color: var(--accent-orange);
        }

        .example-box.noun-phrase .example-name {
            color: var(--primary-blue);
        }

        .example-box.verb-phrase .example-name {
            color: var(--accent-red);
        }

        .example-sentence {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-family: 'Georgia', serif;
            font-style: italic;
            margin-bottom: 10px;
        }

        /* Grammar Table */
        .grammar-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--dark-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .grammar-table th {
            background: var(--dark-surface);
            padding: 12px;
            text-align: left;
            color: var(--accent-yellow);
            border-bottom: 2px solid var(--accent-yellow);
        }

        .grammar-table td {
            padding: 10px;
            border-bottom: 1px solid var(--dark-border);
            color: var(--text-primary);
            font-family: 'Georgia', serif;
        }

        .grammar-table tr:hover {
            background: rgba(255, 235, 59, 0.05);
        }

        /* Interactive Practice */
        .interactive-practice {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid var(--accent-cyan);
        }

        .practice-title {
            color: var(--accent-cyan);
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .practice-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .practice-button {
            padding: 10px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--accent-cyan);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .practice-button:hover {
            background: rgba(0, 188, 212, 0.1);
            transform: translateY(-2px);
        }

        .practice-display {
            background: var(--dark-surface);
            padding: 15px;
            border-radius: 8px;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .results-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .score-percentage {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--dark-border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2rem;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .score-value {
                font-size: 3rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons .btn {
                width: 100%;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .concept-box {
                min-width: 140px;
                font-size: 1.5rem;
                padding: 15px 20px;
            }
            
            .types-display {
                flex-direction: column;
            }
            
            .examples-grid {
                grid-template-columns: 1fr;
            }
            
            .sentence-analysis {
                flex-direction: column;
                padding: 15px;
            }
        }

        /* Grammar Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease;
        }
        
        @keyframes grow {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .grow {
            animation: grow 0.5s ease forwards;
        }
        
        @keyframes sentenceFlow {
            0% { transform: translateX(-50px); background-color: rgba(33, 150, 243, 0.2); }
            50% { transform: translateX(0); background-color: rgba(33, 150, 243, 0.4); }
            100% { transform: translateX(50px); background-color: rgba(33, 150, 243, 0.2); }
        }
        
        .sentence-flow {
            animation: sentenceFlow 3s linear infinite;
        }
        
        @keyframes clauseFlow {
            0% { transform: translateY(-50px); background-color: rgba(0, 150, 136, 0.2); }
            50% { transform: translateY(0); background-color: rgba(0, 150, 136, 0.4); }
            100% { transform: translateY(50px); background-color: rgba(0, 150, 136, 0.2); }
        }
        
        .clause-flow {
            animation: clauseFlow 3s linear infinite;
        }
        
        @keyframes wordBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .word-bounce {
            animation: wordBounce 2s ease-in-out infinite;
        }
        
        @keyframes grammarSpin {
            0% { transform: rotate(0deg) translateY(0); }
            25% { transform: rotate(90deg) translateY(-10px); }
            50% { transform: rotate(180deg) translateY(0); }
            75% { transform: rotate(270deg) translateY(10px); }
            100% { transform: rotate(360deg) translateY(0); }
        }
        
        .grammar-spin {
            animation: grammarSpin 3s linear infinite;
        }
        
        @keyframes phraseHighlight {
            0%, 100% { background-color: rgba(255, 235, 59, 0.1); border-color: var(--accent-yellow); }
            50% { background-color: rgba(255, 235, 59, 0.3); border-color: #FFC107; }
        }
        
        .phrase-highlight {
            animation: phraseHighlight 1.5s ease infinite;
        }
        
        @keyframes sentenceBuild {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .sentence-build {
            animation: sentenceBuild 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Grammar Pattern Background -->
    <div class="grammar-bg" id="grammarBg">
        <!-- Elements will be generated by JavaScript -->
    </div>
    <div class="overlay"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToTopics">Other Topics</button>
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card fade-in" id="welcomePage">
            <div class="welcome-logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <h1 class="welcome-title">Grade 7 English</h1>
            <p class="welcome-subtitle">Master the building blocks of sentences! Learn to identify clauses and phrases, understand different sentence types, analyze sentence structure, and improve your writing. These essential grammar skills will help you communicate clearly and effectively!</p>
            
            <div class="topic-badge">
                <span class="topic-icon">üìùüî§‚ú®</span>
                <span class="topic-name">Clauses, Phrases & Sentence Types</span>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your full name:</label>
                <input type="text" id="studentName" placeholder="Your full name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">
                    <span>Start Grammar Journey</span>
                </button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 120</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0.8%"></div>
                </div>
            </div>

            <div class="question-container">
                <!-- Grammar fact display -->
                <div id="grammarFact"></div>
                
                <!-- Concept display area -->
                <div id="conceptDisplay"></div>
                
                <!-- Content Wrapper: Questions on left, Visualizations on right -->
                <div class="content-wrapper" id="contentWrapper">
                    <!-- Left side: Question and Options -->
                    <div class="question-side">
                        <h2 class="question-text" id="questionText"></h2>
                        
                        <div class="options-container" id="optionsContainer"></div>
                        
                        <div class="feedback-container" id="feedbackContainer">
                            <div class="feedback-header">
                                <div class="feedback-icon"></div>
                                <div class="feedback-title"></div>
                            </div>
                            <div class="feedback-message"></div>
                            <div class="feedback-explanation"></div>
                        </div>
                    </div>
                    
                    <!-- Right side: Visualizations -->
                    <div class="visualization-side">
                        <div class="visualization-container" id="visualizationContainer">
                            <!-- All visualizations will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip Question</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next Question</button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Grammar Mastery Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                <div class="score-message" id="scoreMessage"></div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="highestScore">0</div>
                        <div class="stat-label">Highest Score</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Try Again</button>
                <button class="btn btn-secondary" id="viewTopics">Explore Other Topics</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize background
        function initBackground() {
            const grammarBg = document.getElementById('grammarBg');
            
            // Create floating grammar symbols
            const elements = ['üìù', 'üî§', '‚ú®', '‚úèÔ∏è', 'üìö', 'üìñ', 'üî†', 'üî°', 'üî£', 'üí¨', 'üó£Ô∏è', '‚úçÔ∏è', 'üìÑ', 'üìÉ', 'üìë', 'üìä', 'üìà', 'üìâ', 'üéØ', 'üåü'];
            
            for (let i = 0; i < 25; i++) {
                const element = document.createElement('div');
                element.className = 'floating-element';
                element.textContent = elements[Math.floor(Math.random() * elements.length)];
                element.style.left = `${Math.random() * 100}%`;
                element.style.top = `${Math.random() * 100}%`;
                element.style.animationDelay = `${Math.random() * 20}s`;
                element.style.fontSize = `${2 + Math.random() * 3}rem`;
                
                // Color different types
                if (['üìù', '‚úèÔ∏è', '‚úçÔ∏è'].includes(element.textContent)) {
                    element.style.color = 'rgba(33, 150, 243, 0.1)'; // Blue for writing
                } else if (['üî§', 'üî†', 'üî°'].includes(element.textContent)) {
                    element.style.color = 'rgba(0, 150, 136, 0.1)'; // Teal for letters
                } else if (['üìö', 'üìñ', 'üìÑ'].includes(element.textContent)) {
                    element.style.color = 'rgba(255, 235, 59, 0.1)'; // Yellow for books
                } else {
                    element.style.color = 'rgba(33, 150, 243, 0.1)'; // Default blue
                }
                
                grammarBg.appendChild(element);
            }
        }

        // Questions array - 120+ Grade 7 Grammar questions
        const questions = [
            // Clauses Basics (1-20)
            {
                type: "clauses_basics",
                question: "What is a clause?",
                options: ["A group of words with a subject and verb", "Any group of words", "A single word", "A punctuation mark"],
                answer: "A",
                explanation: "A clause contains a subject (who/what) and a predicate (verb/action)."
            },
            {
                type: "clauses_basics",
                question: "What is the main difference between a clause and a phrase?",
                options: ["Clause has subject + verb, phrase doesn't", "Clause is shorter", "Phrase always has verb", "No difference"],
                answer: "A",
                explanation: "Clauses have both subject and verb, while phrases are missing one or both."
            },
            {
                type: "clauses_basics",
                question: "What is an independent clause?",
                options: ["Can stand alone as a complete sentence", "Needs another clause", "Has no verb", "Is always short"],
                answer: "A",
                explanation: "Independent clauses express complete thoughts and can be sentences on their own."
            },
            {
                type: "clauses_basics",
                question: "What is a dependent clause?",
                options: ["Cannot stand alone as a sentence", "Is always a complete sentence", "Has no subject", "Is always short"],
                answer: "A",
                explanation: "Dependent clauses cannot stand alone; they depend on independent clauses."
            },
            // Identifying Clauses (21-40)
            {
                type: "identifying_clauses",
                question: "Identify the clause: 'Because it was raining'",
                options: ["Dependent clause", "Independent clause", "Phrase", "Sentence"],
                answer: "A",
                explanation: "This is a dependent clause - starts with 'because' and cannot stand alone."
            },
            {
                type: "identifying_clauses",
                question: "Identify: 'The dog barked loudly'",
                options: ["Independent clause", "Dependent clause", "Phrase", "Fragment"],
                answer: "A",
                explanation: "This is an independent clause - has subject (dog) and verb (barked), expresses complete thought."
            },
            {
                type: "identifying_clauses",
                question: "Which contains a dependent clause?",
                options: ["When I finish my homework", "I went to the store", "She reads books", "They play soccer"],
                answer: "A",
                explanation: "'When I finish my homework' starts with 'when' - a dependent clause marker."
            },
            // Phrases (41-60)
            {
                type: "phrases",
                question: "What is a phrase?",
                options: ["Group of words without subject-verb combination", "Complete sentence", "Single word", "Punctuation mark"],
                answer: "A",
                explanation: "A phrase is a group of words acting as a unit but lacking subject-verb combination."
            },
            {
                type: "phrases",
                question: "Identify the prepositional phrase: 'The book on the table is mine.'",
                options: ["on the table", "The book", "is mine", "The book on"],
                answer: "A",
                explanation: "'on the table' begins with preposition 'on' - it's a prepositional phrase."
            },
            {
                type: "phrases",
                question: "What is a noun phrase?",
                options: ["Phrase with noun as head word", "Phrase with verb", "Phrase with adjective", "Short sentence"],
                answer: "A",
                explanation: "Noun phrases function as nouns, e.g., 'the big red ball'."
            },
            {
                type: "phrases",
                question: "Identify verb phrase: 'She has been studying for hours.'",
                options: ["has been studying", "She has", "for hours", "studying for"],
                answer: "A",
                explanation: "'has been studying' is the verb phrase - main verb 'studying' with helping verbs."
            },
            // Sentence Types (61-80)
            {
                type: "sentence_types",
                question: "What is a simple sentence?",
                options: ["One independent clause", "Two independent clauses", "One dependent clause", "Clause + phrase"],
                answer: "A",
                explanation: "Simple sentences have one independent clause (one complete thought)."
            },
            {
                type: "sentence_types",
                question: "What is a compound sentence?",
                options: ["Two independent clauses joined", "One independent clause", "One dependent clause", "Phrase only"],
                answer: "A",
                explanation: "Compound sentences join two independent clauses with conjunction or semicolon."
            },
            {
                type: "sentence_types",
                question: "What is a complex sentence?",
                options: ["One independent + one dependent clause", "Two independent clauses", "Two dependent clauses", "Simple phrase"],
                answer: "A",
                explanation: "Complex sentences have one independent clause and at least one dependent clause."
            },
            {
                type: "sentence_types",
                question: "What is a compound-complex sentence?",
                options: ["Two independent + one dependent clause", "Three independent clauses", "Three dependent clauses", "Simple sentence"],
                answer: "A",
                explanation: "Compound-complex: at least two independent clauses + at least one dependent clause."
            },
            // Sentence Structure (81-100)
            {
                type: "sentence_structure",
                question: "Identify: 'I like apples, but my brother prefers oranges.'",
                options: ["Compound sentence", "Simple sentence", "Complex sentence", "Fragment"],
                answer: "A",
                explanation: "Two independent clauses joined by 'but' - compound sentence."
            },
            {
                type: "sentence_structure",
                question: "Identify: 'Although it was late, we decided to continue.'",
                options: ["Complex sentence", "Simple sentence", "Compound sentence", "Phrase"],
                answer: "A",
                explanation: "One dependent clause ('Although it was late') + one independent clause - complex sentence."
            },
            {
                type: "sentence_structure",
                question: "Identify: 'The cat slept on the warm blanket.'",
                options: ["Simple sentence", "Compound sentence", "Complex sentence", "Dependent clause"],
                answer: "A",
                explanation: "One independent clause - simple sentence."
            },
            // Subject & Predicate (101-120)
            {
                type: "subject_predicate",
                question: "What is the subject of: 'The quick brown fox jumps over the lazy dog.'?",
                options: ["The quick brown fox", "jumps over", "the lazy dog", "over the lazy"],
                answer: "A",
                explanation: "Subject tells who/what does the action - 'The quick brown fox'."
            },
            {
                type: "subject_predicate",
                question: "What is the predicate of: 'Students study diligently for exams.'?",
                options: ["study diligently for exams", "Students study", "diligently for", "Students"],
                answer: "A",
                explanation: "Predicate tells what the subject does - 'study diligently for exams'."
            }
        ];

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // Positive feedback messages
        const positiveMessages = [
            "Excellent grammar analysis!",
            "Perfect sentence structure understanding!",
            "Great clause identification!",
            "You're a grammar expert!",
            "Perfect phrase recognition!",
            "You're a sentence type champion!",
            "Outstanding language skills!",
            "Brilliant grammar knowledge!",
            "You think like a linguist!",
            "Grammar mastery achieved!"
        ];

        // Grammar terms and definitions
        const grammarTerms = [
            {
                term: "Clause",
                definition: "Group of words with subject and verb",
                example: "Independent: 'She sings.' Dependent: 'Because she loves music'"
            },
            {
                term: "Phrase",
                definition: "Group of words without subject-verb combination",
                example: "Noun phrase: 'the big red ball', Prepositional: 'on the table'"
            },
            {
                term: "Independent Clause",
                definition: "Can stand alone as complete sentence",
                example: "I enjoy reading books."
            },
            {
                term: "Dependent Clause",
                definition: "Cannot stand alone; starts with subordinator",
                example: "When I finish my homework..."
            },
            {
                term: "Simple Sentence",
                definition: "One independent clause",
                example: "The sun shines brightly."
            }
        ];

        // Clause examples
        const clauseExamples = [
            {
                type: "Independent Clause",
                examples: [
                    "The students completed their assignments.",
                    "She enjoys playing basketball.",
                    "They traveled to Paris last summer.",
                    "He reads mystery novels."
                ],
                characteristics: "Complete thought, can stand alone, subject + predicate"
            },
            {
                type: "Dependent Clause",
                examples: [
                    "Because it was raining heavily",
                    "When she arrives at the station",
                    "Although he tried his best",
                    "If you need any assistance"
                ],
                characteristics: "Incomplete thought, starts with subordinator, needs independent clause"
            }
        ];

        // Phrase examples
        const phraseExamples = [
            {
                type: "Noun Phrase",
                examples: ["the big red apple", "three clever students", "my favorite book", "an old wooden house"],
                function: "Acts as subject, object, or complement"
            },
            {
                type: "Verb Phrase",
                examples: ["has been studying", "will be traveling", "might have seen", "should have completed"],
                function: "Shows action or state of being"
            },
            {
                type: "Prepositional Phrase",
                examples: ["on the table", "in the morning", "with great enthusiasm", "after the meeting"],
                function: "Shows relationship (time, place, manner)"
            },
            {
                type: "Adjective Phrase",
                examples: ["very interesting", "extremely difficult", "quite beautiful", "rather surprising"],
                function: "Modifies nouns or pronouns"
            }
        ];

        // Sentence type examples
        const sentenceTypeExamples = [
            {
                type: "Simple Sentence",
                structure: "One independent clause",
                examples: ["Birds sing.", "The sun rises in the east.", "She reads books."],
                conjunction: "None needed"
            },
            {
                type: "Compound Sentence",
                structure: "Two independent clauses joined",
                examples: ["I like tea, but my friend prefers coffee.", "She studies hard, so she gets good grades."],
                conjunctions: "and, but, or, so, yet, for, nor"
            },
            {
                type: "Complex Sentence",
                structure: "One independent + one dependent clause",
                examples: ["Although it was raining, we went for a walk.", "I'll call you when I arrive."],
                subordinators: "because, when, although, if, since, while"
            },
            {
                type: "Compound-Complex",
                structure: "Two independent + one dependent clause",
                examples: ["Although I was tired, I went to work, and I completed all my tasks.", "She studied hard because she wanted to pass, so she achieved her goal."],
                features: "Combines compound and complex structures"
            }
        ];

        // Interesting grammar facts
        const grammarFacts = [
            "The word 'grammar' comes from Greek 'grammatikƒì' meaning 'art of letters'!",
            "English has approximately 1 million words, but most people only use about 20,000!",
            "The longest sentence in literature is 13,955 words in 'Ulysses' by James Joyce!",
            "Shakespeare invented over 1,700 words still used in English today!",
            "The most common letter in English is 'E', appearing in about 11% of all words!",
            "Sentences can be grammatically correct but meaningless: 'Colorless green ideas sleep furiously.'",
            "The word 'set' has 464 definitions in the Oxford English Dictionary!",
            "English is the official language of 67 countries worldwide!"
        ];

        // Sentence analysis examples
        const sentenceAnalysisExamples = [
            {
                sentence: "The quick brown fox jumps over the lazy dog.",
                parts: [
                    {text: "The quick brown fox", type: "subject", color: "var(--primary-blue)"},
                    {text: "jumps", type: "verb", color: "var(--accent-green)"},
                    {text: "over the lazy dog", type: "prepositional phrase", color: "var(--accent-purple)"}
                ],
                type: "Simple sentence"
            },
            {
                sentence: "Although it was raining, we decided to go hiking.",
                parts: [
                    {text: "Although it was raining", type: "dependent clause", color: "var(--accent-red)"},
                    {text: "we", type: "subject", color: "var(--primary-blue)"},
                    {text: "decided to go hiking", type: "verb phrase", color: "var(--accent-green)"}
                ],
                type: "Complex sentence"
            },
            {
                sentence: "I wanted to buy the book, but the store was closed.",
                parts: [
                    {text: "I", type: "subject", color: "var(--primary-blue)"},
                    {text: "wanted to buy the book", type: "verb phrase", color: "var(--accent-green)"},
                    {text: "but", type: "conjunction", color: "var(--accent-yellow)"},
                    {text: "the store", type: "subject", color: "var(--primary-blue)"},
                    {text: "was closed", type: "verb phrase", color: "var(--accent-green)"}
                ],
                type: "Compound sentence"
            }
        ];

        // Common subordinators (dependent clause markers)
        const subordinators = [
            "because", "although", "when", "while", "if", "since", "unless", "until", 
            "before", "after", "as", "though", "even though", "so that", "where", "whether"
        ];

        // Common coordinating conjunctions (FANBOYS)
        const coordinatingConjunctions = [
            "for", "and", "nor", "but", "or", "yet", "so"
        ];

        // Real-world writing examples
        const realWorldExamples = [
            {
                context: "Story Opening",
                sentence: "As the clock struck midnight, a mysterious figure appeared at the window, and everyone in the room gasped in surprise.",
                analysis: "Compound-complex sentence with dependent clause ('As...midnight'), two independent clauses"
            },
            {
                context: "News Headline",
                sentence: "Scientists discover new species in remote rainforest.",
                analysis: "Simple sentence - clear, direct information"
            },
            {
                context: "Instruction Manual",
                sentence: "Before you begin assembly, read all instructions carefully, and ensure you have all required tools.",
                analysis: "Complex-compound sentence - dependent clause + two independent clauses"
            },
            {
                context: "Advertisement",
                sentence: "Try our new product today, and experience the difference for yourself!",
                analysis: "Compound sentence - two independent clauses joined by 'and'"
            }
        ];

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const grammarFact = document.getElementById('grammarFact');
        const conceptDisplay = document.getElementById('conceptDisplay');
        const visualizationContainer = document.getElementById('visualizationContainer');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const backToTopicsBtn = document.getElementById('backToTopics');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const scoreMessage = document.getElementById('scoreMessage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const highestScore = document.getElementById('highestScore');

        // Grammar analysis state
        let grammarState = {
            currentSentence: null,
            currentAnalysis: null,
            sentenceType: 'simple'
        };

        // Initialize the app
        function initApp() {
            initBackground();
            loadStateFromStorage();
            setupEventListeners();
            
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Load state from localStorage
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixGrade7Grammar');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // Save state to localStorage
        function saveStateToStorage() {
            localStorage.setItem('ideolixGrade7Grammar', JSON.stringify(appState));
        }

        // Initialize and shuffle questions
        function initializeQuestions() {
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', backToHome);
            backToTopicsBtn.addEventListener('click', backToTopics);
            viewTopicsBtn.addEventListener('click', backToTopics);
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startPractice();
                }
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            
            const highest = localStorage.getItem('ideolixGrade7Grammar_highestScore') || 0;
            highestScore.textContent = Math.max(highest, appState.score);
            
            if (appState.score > highest) {
                localStorage.setItem('ideolixGrade7Grammar_highestScore', appState.score);
            }
            
            if (percentage >= 90) {
                scoreMessage.textContent = "Outstanding! You're a grammar expert!";
            } else if (percentage >= 80) {
                scoreMessage.textContent = "Great job! You have excellent language skills!";
            } else if (percentage >= 70) {
                scoreMessage.textContent = "Good work! Keep practicing grammar concepts!";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "Not bad! Review clauses, phrases, and sentence types!";
            } else {
                scoreMessage.textContent = "Keep exploring! Grammar skills will help you communicate effectively!";
            }
        }

        // Create grammar fact display
        function createGrammarFact() {
            const factDiv = document.createElement('div');
            factDiv.className = 'grammar-fact';
            
            factDiv.innerHTML = `<strong>Amazing Grammar Fact:</strong> ${grammarFacts[Math.floor(Math.random() * grammarFacts.length)]}`;
            
            return factDiv;
        }

        // Create concept display
        function createConceptDisplay() {
            const display = document.createElement('div');
            display.className = 'concept-display';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            const conceptIcons = {
                "clauses_basics": "üî§",
                "identifying_clauses": "üéØ",
                "phrases": "üìù",
                "sentence_types": "‚ú®",
                "sentence_structure": "üèóÔ∏è",
                "subject_predicate": "üìê"
            };
            
            let conceptName = "Clauses Basics";
            let conceptIcon = "üî§";
            
            if (question.type.includes("clauses_basics")) {
                conceptName = "Clauses";
                conceptIcon = conceptIcons.clauses_basics;
            } else if (question.type.includes("identifying_clauses")) {
                conceptName = "Identifying Clauses";
                conceptIcon = conceptIcons.identifying_clauses;
            } else if (question.type.includes("phrases")) {
                conceptName = "Phrases";
                conceptIcon = conceptIcons.phrases;
            } else if (question.type.includes("sentence_types")) {
                conceptName = "Sentence Types";
                conceptIcon = conceptIcons.sentence_types;
            } else if (question.type.includes("sentence_structure")) {
                conceptName = "Sentence Structure";
                conceptIcon = conceptIcons.sentence_structure;
            } else if (question.type.includes("subject_predicate")) {
                conceptName = "Subject & Predicate";
                conceptIcon = conceptIcons.subject_predicate;
            }
            
            const conceptBox = document.createElement('div');
            conceptBox.className = 'concept-box grow';
            conceptBox.innerHTML = `
                <div class="concept-icon">${conceptIcon}</div>
                <div class="concept-text">${conceptName.toUpperCase()}</div>
            `;
            
            const label = document.createElement('div');
            label.className = 'concept-label';
            
            if (question.type.includes("clauses_basics")) {
                label.textContent = "Understanding independent and dependent clauses";
            } else if (question.type.includes("identifying_clauses")) {
                label.textContent = "Recognizing different types of clauses in sentences";
            } else if (question.type.includes("phrases")) {
                label.textContent = "Identifying noun phrases, verb phrases, prepositional phrases";
            } else if (question.type.includes("sentence_types")) {
                label.textContent = "Simple, compound, complex, and compound-complex sentences";
            } else if (question.type.includes("sentence_structure")) {
                label.textContent = "Analyzing how sentences are constructed";
            } else if (question.type.includes("subject_predicate")) {
                label.textContent = "Identifying subjects and predicates in sentences";
            }
            
            display.appendChild(conceptBox);
            display.appendChild(label);
            
            return display;
        }

        // Create grammar concepts visualization
        function createGrammarConcepts() {
            const conceptsDiv = document.createElement('div');
            
            conceptsDiv.innerHTML = `
                <div class="concepts-container">
                    <div class="grammar-card clauses sentence-flow" onclick="showGrammarDetails('Clauses')">
                        <div class="grammar-icon">üî§</div>
                        <div class="grammar-name">Clauses</div>
                        <div class="grammar-description" style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 5px;">
                            Subject + Verb Groups
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">
                            Independent & Dependent
                        </div>
                    </div>
                    <div class="grammar-card phrases clause-flow" onclick="showGrammarDetails('Phrases')">
                        <div class="grammar-icon">üìù</div>
                        <div class="grammar-name">Phrases</div>
                        <div class="grammar-description" style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 5px;">
                            Word Groups Without Full Verb
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">
                            Noun, Verb, Prepositional
                        </div>
                    </div>
                    <div class="grammar-card sentence-types grammar-spin" onclick="showGrammarDetails('Sentence Types')">
                        <div class="grammar-icon">‚ú®</div>
                        <div class="grammar-name">Sentence Types</div>
                        <div class="grammar-description" style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 5px;">
                            How Sentences Are Built
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">
                            Simple, Compound, Complex
                        </div>
                    </div>
                </div>
            `;
            
            return conceptsDiv;
        }

        // Create sentence analysis visualization
        function createSentenceAnalysis() {
            const analysisDiv = document.createElement('div');
            analysisDiv.className = 'analysis-visualization';
            
            const currentAnalysis = sentenceAnalysisExamples[Math.floor(Math.random() * sentenceAnalysisExamples.length)];
            grammarState.currentAnalysis = currentAnalysis;
            
            analysisDiv.innerHTML = `
                <div class="display-title">Sentence Analysis: ${currentAnalysis.type}</div>
                <div style="text-align: center; color: var(--text-secondary); margin-bottom: 15px;">
                    Click on colored parts to learn about sentence components
                </div>
                
                <div class="sentence-analysis" id="sentenceAnalysis">
                    ${currentAnalysis.parts.map((part, index) => `
                        <span class="sentence-part ${part.type.replace(/\s+/g, '-').toLowerCase()} sentence-build" 
                              style="animation-delay: ${index * 0.2}s; background: ${part.color};"
                              onclick="showPartInfo('${part.type}', '${part.text.replace(/'/g, "\\'")}')">
                            ${part.text}
                        </span>
                    `).join(' ')}
                </div>
                
                <div class="analysis-controls">
                    <div class="analysis-button" onclick="analyzeSentenceStructure()">Analyze Structure</div>
                    <div class="analysis-button" onclick="identifyClauses()">Identify Clauses</div>
                    <div class="analysis-button" onclick="identifyPhrases()">Identify Phrases</div>
                    <div class="analysis-button" onclick="newSentenceExample()">New Sentence</div>
                </div>
                
                <div id="analysisResult" style="margin-top: 20px; padding: 15px; background: var(--dark-surface); border-radius: 8px; display: none;"></div>
                
                <table class="grammar-table">
                    <thead>
                        <tr>
                            <th>Sentence Part</th>
                            <th>Type</th>
                            <th>Function</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${currentAnalysis.parts.map(part => `
                            <tr>
                                <td style="font-family: 'Georgia', serif;">${part.text}</td>
                                <td style="color: ${part.color}; font-weight: bold;">${part.type}</td>
                                <td>${getPartFunction(part.type)}</td>
                            </tr>
                        `).join('')}
                        <tr style="background: rgba(33, 150, 243, 0.1);">
                            <td style="font-weight: bold;">Full Sentence</td>
                            <td style="font-weight: bold; color: var(--accent-yellow);">${currentAnalysis.type}</td>
                            <td>${getSentenceTypeDescription(currentAnalysis.type)}</td>
                        </tr>
                    </tbody>
                </table>
            `;
            
            return analysisDiv;
        }

        // Helper function to get part function
        function getPartFunction(partType) {
            const functions = {
                "subject": "Who or what performs the action",
                "verb": "Action or state of being",
                "object": "Receives the action",
                "dependent clause": "Adds information but can't stand alone",
                "verb phrase": "Main verb with helping verbs",
                "prepositional phrase": "Shows relationship (time, place)",
                "conjunction": "Connects words, phrases, or clauses"
            };
            return functions[partType] || "Modifies or adds information";
        }

        // Helper function to get sentence type description
        function getSentenceTypeDescription(type) {
            const descriptions = {
                "Simple sentence": "One independent clause expressing complete thought",
                "Compound sentence": "Two or more independent clauses joined",
                "Complex sentence": "One independent + one or more dependent clauses",
                "Compound-complex sentence": "Two or more independent + one or more dependent clauses"
            };
            return descriptions[type] || "Sentence expressing complete thought";
        }

        // Show part information
        window.showPartInfo = function(partType, partText) {
            const resultDiv = document.getElementById('analysisResult');
            if (!resultDiv) return;
            
            const functions = {
                "subject": "The subject tells who or what performs the action in the sentence.",
                "verb": "The verb shows the action or state of being.",
                "object": "The object receives the action of the verb.",
                "dependent clause": "A dependent clause cannot stand alone as a complete sentence.",
                "verb phrase": "A verb phrase includes the main verb and any helping verbs.",
                "prepositional phrase": "A prepositional phrase begins with a preposition and shows relationship.",
                "conjunction": "A conjunction connects words, phrases, or clauses together."
            };
            
            resultDiv.innerHTML = `
                <div style="color: var(--primary-blue); font-weight: bold; margin-bottom: 10px;">${partType}: "${partText}"</div>
                <div style="color: var(--text-secondary); margin-bottom: 10px;">
                    ${functions[partType] || "This part adds meaning to the sentence."}
                </div>
                <div style="color: var(--accent-yellow); font-size: 0.9rem;">
                    <strong>Tip:</strong> ${getPartTip(partType)}
                </div>
            `;
            resultDiv.style.display = 'block';
        };

        // Helper function to get part tip
        function getPartTip(partType) {
            const tips = {
                "subject": "To find the subject, ask 'who or what' before the verb.",
                "verb": "Verbs can show action (run, jump) or state of being (is, seem).",
                "object": "Objects answer 'whom' or 'what' after the verb.",
                "dependent clause": "Dependent clauses often start with words like because, when, if, although.",
                "verb phrase": "Look for helping verbs like is, are, was, were, have, has, had, will, might, can.",
                "prepositional phrase": "Common prepositions: in, on, at, with, by, for, from, to, of.",
                "conjunction": "FANBOYS: for, and, nor, but, or, yet, so."
            };
            return tips[partType] || "This element helps build sentence meaning.";
        }

        // Analyze sentence structure
        window.analyzeSentenceStructure = function() {
            const resultDiv = document.getElementById('analysisResult');
            if (!resultDiv || !grammarState.currentAnalysis) return;
            
            const analysis = grammarState.currentAnalysis;
            
            resultDiv.innerHTML = `
                <div style="color: var(--primary-blue); font-weight: bold; margin-bottom: 10px;">Sentence Structure Analysis</div>
                <div style="color: var(--text-secondary); margin-bottom: 10px;">
                    <strong>Full Sentence:</strong> "${analysis.sentence}"<br><br>
                    <strong>Sentence Type:</strong> ${analysis.type}<br>
                    <strong>Structure:</strong> ${getStructureDescription(analysis.type)}<br>
                    <strong>Key Features:</strong> ${getKeyFeatures(analysis)}
                </div>
                <div style="color: var(--accent-yellow); font-size: 0.9rem; margin-top: 10px;">
                    This sentence demonstrates effective use of ${analysis.type.toLowerCase()} structure.
                </div>
            `;
            resultDiv.style.display = 'block';
        };

        // Helper function to get structure description
        function getStructureDescription(type) {
            const structures = {
                "Simple sentence": "One independent clause with subject and predicate",
                "Compound sentence": "Two independent clauses joined by conjunction or semicolon",
                "Complex sentence": "One independent clause + one or more dependent clauses",
                "Compound-complex sentence": "Two independent clauses + one or more dependent clauses"
            };
            return structures[type] || "Standard sentence structure";
        }

        // Helper function to get key features
        function getKeyFeatures(analysis) {
            const clauses = analysis.parts.filter(p => p.type.includes("clause")).length;
            const phrases = analysis.parts.filter(p => p.type.includes("phrase")).length;
            
            let features = [];
            if (clauses > 0) features.push(`${clauses} clause${clauses > 1 ? 's' : ''}`);
            if (phrases > 0) features.push(`${phrases} phrase${phrases > 1 ? 's' : ''}`);
            
            return features.join(", ") + ` | Clear subject-verb relationships`;
        }

        // Identify clauses in sentence
        window.identifyClauses = function() {
            const resultDiv = document.getElementById('analysisResult');
            if (!resultDiv || !grammarState.currentAnalysis) return;
            
            const analysis = grammarState.currentAnalysis;
            const clauses = analysis.parts.filter(p => p.type.includes("clause"));
            
            if (clauses.length === 0) {
                resultDiv.innerHTML = `
                    <div style="color: var(--accent-orange); font-weight: bold; margin-bottom: 10px;">Clause Identification</div>
                    <div style="color: var(--text-secondary);">
                        This sentence contains no dependent clauses. It is a ${analysis.type.toLowerCase()}.
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div style="color: var(--primary-blue); font-weight: bold; margin-bottom: 10px;">Clause Identification</div>
                    <div style="color: var(--text-secondary; margin-bottom: 10px;">
                        <strong>Clauses found:</strong><br>
                        ${clauses.map(clause => `
                            ‚Ä¢ "${clause.text}" - ${clause.type}<br>
                        `).join('')}
                    </div>
                    <div style="color: var(--accent-yellow); font-size: 0.9rem;">
                        <strong>Remember:</strong> Independent clauses can stand alone, dependent clauses cannot.
                    </div>
                `;
            }
            resultDiv.style.display = 'block';
        };

        // Identify phrases in sentence
        window.identifyPhrases = function() {
            const resultDiv = document.getElementById('analysisResult');
            if (!resultDiv || !grammarState.currentAnalysis) return;
            
            const analysis = grammarState.currentAnalysis;
            const phrases = analysis.parts.filter(p => p.type.includes("phrase"));
            
            if (phrases.length === 0) {
                resultDiv.innerHTML = `
                    <div style="color: var(--accent-orange); font-weight: bold; margin-bottom: 10px;">Phrase Identification</div>
                    <div style="color: var(--text-secondary);">
                        This sentence contains no phrases identified in the analysis.
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div style="color: var(--secondary-teal); font-weight: bold; margin-bottom: 10px;">Phrase Identification</div>
                    <div style="color: var(--text-secondary); margin-bottom: 10px;">
                        <strong>Phrases found:</strong><br>
                        ${phrases.map(phrase => `
                            ‚Ä¢ "${phrase.text}" - ${phrase.type}<br>
                        `).join('')}
                    </div>
                    <div style="color: var(--accent-yellow); font-size: 0.9rem;">
                        <strong>Remember:</strong> Phrases are groups of words without a subject-verb combination.
                    </div>
                `;
            }
            resultDiv.style.display = 'block';
        };

        // New sentence example
        window.newSentenceExample = function() {
            const analysisDiv = document.getElementById('sentenceAnalysis');
            const resultDiv = document.getElementById('analysisResult');
            
            if (!analysisDiv || !resultDiv) return;
            
            // Get new analysis (different from current)
            let newAnalysis;
            do {
                newAnalysis = sentenceAnalysisExamples[Math.floor(Math.random() * sentenceAnalysisExamples.length)];
            } while (newAnalysis.sentence === grammarState.currentAnalysis?.sentence);
            
            grammarState.currentAnalysis = newAnalysis;
            
            // Update sentence display
            analysisDiv.innerHTML = newAnalysis.parts.map((part, index) => `
                <span class="sentence-part ${part.type.replace(/\s+/g, '-').toLowerCase()} sentence-build" 
                      style="animation-delay: ${index * 0.2}s; background: ${part.color};"
                      onclick="showPartInfo('${part.type}', '${part.text.replace(/'/g, "\\'")}')">
                    ${part.text}
                </span>
            `).join(' ');
            
            // Update table
            const table = analysisDiv.parentElement.querySelector('.grammar-table tbody');
            if (table) {
                table.innerHTML = `
                    ${newAnalysis.parts.map(part => `
                        <tr>
                            <td style="font-family: 'Georgia', serif;">${part.text}</td>
                            <td style="color: ${part.color}; font-weight: bold;">${part.type}</td>
                            <td>${getPartFunction(part.type)}</td>
                        </tr>
                    `).join('')}
                    <tr style="background: rgba(33, 150, 243, 0.1);">
                        <td style="font-weight: bold;">Full Sentence</td>
                        <td style="font-weight: bold; color: var(--accent-yellow);">${newAnalysis.type}</td>
                        <td>${getSentenceTypeDescription(newAnalysis.type)}</td>
                    </tr>
                `;
            }
            
            // Update title
            const title = analysisDiv.parentElement.querySelector('.display-title');
            if (title) {
                title.textContent = `Sentence Analysis: ${newAnalysis.type}`;
            }
            
            // Clear result
            resultDiv.style.display = 'none';
        };

        // Create sentence types visualization
        function createSentenceTypesVisualization() {
            const typesDiv = document.createElement('div');
            typesDiv.className = 'sentence-types-visualization';
            
            typesDiv.innerHTML = `
                <div class="display-title">Sentence Types</div>
                <div style="text-align: center; color: var(--text-secondary); margin-bottom: 15px;">
                    Different ways to combine clauses into sentences
                </div>
                
                <div class="types-display">
                    ${sentenceTypeExamples.map((type, idx) => `
                        <div class="type-box ${type.type.toLowerCase().replace('-', '')} word-bounce" onclick="showSentenceTypeDetails('${type.type}')">
                            <div class="type-icon">${getTypeIcon(type.type)}</div>
                            <div class="type-name">${type.type}</div>
                            <div class="type-description">${type.structure}</div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 8px; border: 1px solid var(--primary-blue);">
                    <div style="color: var(--primary-blue); font-weight: bold; margin-bottom: 10px;">Why Sentence Variety Matters:</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        <strong>Simple:</strong> Clear and direct<br>
                        <strong>Compound:</strong> Shows relationships between ideas<br>
                        <strong>Complex:</strong> Shows cause-effect, time relationships<br>
                        <strong>Compound-Complex:</strong> Sophisticated expression of complex ideas
                    </div>
                </div>
            `;
            
            return typesDiv;
        }

        // Helper function to get type icon
        function getTypeIcon(type) {
            const icons = {
                "Simple Sentence": "1Ô∏è‚É£",
                "Compound Sentence": "2Ô∏è‚É£",
                "Complex Sentence": "üîÑ",
                "Compound-Complex": "üèóÔ∏è"
            };
            return icons[type] || "üìù";
        }

        // Create grammar examples visualization
        function createExamplesVisualization() {
            const examplesDiv = document.createElement('div');
            examplesDiv.className = 'examples-container';
            
            examplesDiv.innerHTML = `
                <div class="display-title">Grammar Examples</div>
                <div style="text-align: center; color: var(--text-secondary); margin-bottom: 15px;">
                    Click on examples to learn more about each concept
                </div>
                
                <div class="examples-grid">
                    <div class="example-box independent" onclick="showExampleDetails('Independent Clause')">
                        <div class="example-icon">‚úÖ</div>
                        <div class="example-name">Independent Clause</div>
                        <div class="example-sentence">"She completed her assignment."</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            Can stand alone as sentence
                        </div>
                    </div>
                    <div class="example-box dependent" onclick="showExampleDetails('Dependent Clause')">
                        <div class="example-icon">‚è≥</div>
                        <div class="example-name">Dependent Clause</div>
                        <div class="example-sentence">"Because she studied hard"</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            Needs independent clause
                        </div>
                    </div>
                    <div class="example-box noun-phrase" onclick="showExampleDetails('Noun Phrase')">
                        <div class="example-icon">üì¶</div>
                        <div class="example-name">Noun Phrase</div>
                        <div class="example-sentence">"the three little pigs"</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            Functions as noun
                        </div>
                    </div>
                    <div class="example-box verb-phrase" onclick="showExampleDetails('Verb Phrase')">
                        <div class="example-icon">‚ö°</div>
                        <div class="example-name">Verb Phrase</div>
                        <div class="example-sentence">"has been running"</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            Shows action with helpers
                        </div>
                    </div>
                </div>
                
                <table class="grammar-table">
                    <thead>
                        <tr>
                            <th>Concept</th>
                            <th>Example</th>
                            <th>Key Identifier</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="font-weight: bold; color: var(--primary-blue);">Independent Clause</td>
                            <td style="font-family: 'Georgia', serif;">The sun shines brightly.</td>
                            <td>Complete thought, can stand alone</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: var(--accent-orange);">Dependent Clause</td>
                            <td style="font-family: 'Georgia', serif;">When the bell rings</td>
                            <td>Starts with subordinator (when, because, if)</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: var(--accent-green);">Noun Phrase</td>
                            <td style="font-family: 'Georgia', serif;">A beautiful red rose</td>
                            <td>Functions as subject or object</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: var(--accent-red);">Verb Phrase</td>
                            <td style="font-family: 'Georgia', serif;">will have finished</td>
                            <td>Main verb + helping verbs</td>
                        </tr>
                    </tbody>
                </table>
            `;
            
            return examplesDiv;
        }

        // Create math visualization
        function createGrammarVisualization() {
            const vizDiv = document.createElement('div');
            vizDiv.className = 'visualization-container';
            
            const currentClauseExample = clauseExamples[Math.floor(Math.random() * clauseExamples.length)];
            const currentPhraseExample = phraseExamples[Math.floor(Math.random() * phraseExamples.length)];
            const realWorldExample = realWorldExamples[Math.floor(Math.random() * realWorldExamples.length)];
            
            vizDiv.innerHTML = `
                <h3 style="text-align: center; margin-bottom: 20px; color: var(--accent-yellow);">Grammar & Sentence Structure Explorer</h3>
                
                ${createGrammarConcepts().outerHTML}
                
                <div class="sentence-display phrase-highlight">
                    <div style="font-size: 1.5rem; margin-bottom: 15px;">
                        Focus: <span style="color: var(--primary-blue); font-weight: bold;">${currentClauseExample.type}</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; color: var(--primary-blue); margin-bottom: 10px;">Examples</div>
                            <div style="font-size: 1.1rem; color: var(--text-secondary); font-family: 'Georgia', serif; font-style: italic;">
                                ${currentClauseExample.examples.map(ex => `‚Ä¢ ${ex}<br>`).join('')}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">${currentClauseExample.characteristics}</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; color: var(--secondary-teal); margin-bottom: 10px;">${currentPhraseExample.type}</div>
                            <div style="font-size: 1.1rem; color: var(--text-secondary); font-family: 'Georgia', serif; font-style: italic;">
                                ${currentPhraseExample.examples.map(ex => `‚Ä¢ ${ex}<br>`).join('')}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">Function: ${currentPhraseExample.function}</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 10px; background: rgba(255, 235, 59, 0.1); border-radius: 6px; border-left: 3px solid var(--accent-yellow);">
                        <div style="font-size: 0.9rem; color: var(--accent-yellow);">
                            <strong>Key Difference:</strong> Clauses have subject + verb, phrases don't have both.
                        </div>
                    </div>
                </div>
                
                ${createSentenceAnalysis().outerHTML}
                ${createSentenceTypesVisualization().outerHTML}
                ${createExamplesVisualization().outerHTML}
                
                <div class="real-world-example" style="background: var(--dark-card); padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid var(--accent-orange); font-style: italic; color: var(--text-secondary);">
                    <div style="color: var(--accent-orange); font-weight: bold; margin-bottom: 10px;">Real-World Writing - ${realWorldExample.context}:</div>
                    "${realWorldExample.sentence}"
                    <div style="margin-top: 10px;">
                        <strong>Analysis:</strong> ${realWorldExample.analysis}
                    </div>
                </div>
                
                <div class="interactive-practice">
                    <div class="practice-title">Interactive Grammar Practice</div>
                    <div class="practice-controls">
                        <div class="practice-button" onclick="practiceClauses()">Identify Clauses</div>
                        <div class="practice-button" onclick="practicePhrases()">Identify Phrases</div>
                        <div class="practice-button" onclick="practiceSentenceTypes()">Sentence Types</div>
                        <div class="practice-button" onclick="practiceSentenceStructure()">Sentence Structure</div>
                    </div>
                    <div class="practice-display" id="practiceDisplay">
                        Click buttons above to practice grammar skills
                    </div>
                </div>
                
                <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid var(--accent-red);">
                    <div style="color: var(--accent-red); font-weight: bold; margin-bottom: 10px;">Quick Practice:</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        1. Identify: "When the phone rang" (clause or phrase?)<br>
                        2. Identify: "under the bridge" (clause or phrase?)<br>
                        3. What type: "I like coffee, but she prefers tea."<br>
                        4. What type: "Although it was cold, we went outside."<br>
                        5. Find subject: "The curious cat explored the garden."
                    </div>
                </div>
                
                <div style="background: var(--dark-card); padding: 15px; border-radius: 8px; margin-top: 20px; border: 2px solid var(--primary-blue);">
                    <div style="color: var(--primary-blue); font-weight: bold; margin-bottom: 10px; text-align: center;">Grammar Tips</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center;">
                        <strong>Clause:</strong> Look for subject + verb<br>
                        <strong>Phrase:</strong> Missing either subject or verb<br>
                        <strong>Simple:</strong> One complete thought<br>
                        <strong>Compound:</strong> Two thoughts joined<br>
                        <strong>Complex:</strong> Main thought + supporting detail
                    </div>
                </div>
            `;
            
            return vizDiv;
        }

        // Global functions for interactive practice
        window.showGrammarDetails = function(concept) {
            if (concept === 'Clauses') {
                alert(`üî§ Clauses\n\nA clause is a group of words containing a subject and a verb.\n\nTypes:\n‚Ä¢ Independent Clause: Can stand alone as sentence\n  Example: "She reads books."\n‚Ä¢ Dependent Clause: Cannot stand alone\n  Example: "Because she loves stories"\n\nKey Identifiers:\n‚úì Has subject (who/what)\n‚úì Has verb (action/state)\n‚úì May express complete or incomplete thought`);
            } else if (concept === 'Phrases') {
                alert(`üìù Phrases\n\nA phrase is a group of words without both subject and verb.\n\nTypes:\n‚Ä¢ Noun Phrase: "the big red ball"\n‚Ä¢ Verb Phrase: "has been running"\n‚Ä¢ Prepositional Phrase: "on the table"\n‚Ä¢ Adjective Phrase: "very interesting"\n\nKey Identifiers:\n‚úó Missing either subject OR verb\n‚úì Functions as single part of speech\n‚úì Adds information but not complete thought`);
            } else {
                alert(`‚ú® Sentence Types\n\nBased on how clauses are combined:\n\n‚Ä¢ Simple: One independent clause\n  Example: "Birds sing."\n\n‚Ä¢ Compound: Two independent clauses joined\n  Example: "I like tea, and she likes coffee."\n\n‚Ä¢ Complex: One independent + one dependent clause\n  Example: "When it rains, I stay inside."\n\n‚Ä¢ Compound-Complex: Two independent + one dependent\n  Example: "I exercise daily because it's healthy, and I feel better."`);
            }
        };

        window.showSentenceTypeDetails = function(type) {
            const typeInfo = sentenceTypeExamples.find(t => t.type === type);
            if (!typeInfo) return;
            
            alert(`${type}\n\nStructure: ${typeInfo.structure}\n\nExamples:\n${typeInfo.examples.map(ex => `‚Ä¢ ${ex}`).join('\n')}\n\n${type === 'Simple Sentence' ? "Use for clear, direct statements. Good for emphasis." : ""}${type === 'Compound Sentence' ? "Use to show equal relationships between ideas. Joined with FANBOYS." : ""}${type === 'Complex Sentence' ? "Use to show cause-effect, time, or conditional relationships." : ""}${type === 'Compound-Complex' ? "Use for sophisticated writing with multiple related ideas." : ""}`);
        };

        window.showExampleDetails = function(exampleType) {
            let details = '';
            
            switch(exampleType) {
                case 'Independent Clause':
                    details = `‚úÖ Independent Clause\n\n‚Ä¢ Complete thought\n‚Ä¢ Can stand alone as sentence\n‚Ä¢ Has subject + verb\n‚Ä¢ Example: "She completed her assignment."\n\nTest: Can it be a sentence by itself? If yes ‚Üí independent clause.`;
                    break;
                case 'Dependent Clause':
                    details = `‚è≥ Dependent Clause\n\n‚Ä¢ Incomplete thought\n‚Ä¢ Cannot stand alone\n‚Ä¢ Starts with subordinator (because, when, if, although)\n‚Ä¢ Example: "Because she studied hard"\n\nNeeds independent clause: "Because she studied hard, she passed the test."`;
                    break;
                case 'Noun Phrase':
                    details = `üì¶ Noun Phrase\n\n‚Ä¢ Functions as noun in sentence\n‚Ä¢ Can be subject or object\n‚Ä¢ Example: "the three little pigs"\n\nIn sentence: "The three little pigs built houses." (subject)\n             "I saw the three little pigs." (object)`;
                    break;
                case 'Verb Phrase':
                    details = `‚ö° Verb Phrase\n\n‚Ä¢ Main verb + helping verbs\n‚Ä¢ Shows action or state\n‚Ä¢ Example: "has been running"\n\nHelping verbs: is, are, was, were, have, has, had, will, might, can, should, etc.`;
                    break;
            }
            
            alert(details);
        };

        // Interactive practice functions
        window.practiceClauses = function() {
            const practiceDisplay = document.getElementById('practiceDisplay');
            if (!practiceDisplay) return;
            
            const clauseExercises = [
                {
                    sentence: "When the sun rises",
                    type: "Dependent clause",
                    explanation: "Starts with 'when' - cannot stand alone"
                },
                {
                    sentence: "She enjoys painting",
                    type: "Independent clause",
                    explanation: "Complete thought - can stand alone as sentence"
                },
                {
                    sentence: "Because it was raining heavily",
                    type: "Dependent clause",
                    explanation: "Starts with 'because' - needs independent clause"
                },
                {
                    sentence: "They completed the project successfully",
                    type: "Independent clause",
                    explanation: "Complete thought with subject (they) and verb (completed)"
                }
            ];
            
            const currentExercise = clauseExercises[Math.floor(Math.random() * clauseExercises.length)];
            
            practiceDisplay.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--primary-blue);">Identify the Clause</div>
                    <div style="font-size: 1.2rem; margin-bottom: 15px; font-family: 'Georgia', serif; color: var(--text-primary);">
                        "${currentExercise.sentence}"
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0;">
                        <div class="option" onclick="checkClauseAnswer(this, 'Independent clause', '${currentExercise.type}')">
                            <div class="option-letter">A</div>
                            <div class="option-text">Independent clause</div>
                        </div>
                        <div class="option" onclick="checkClauseAnswer(this, 'Dependent clause', '${currentExercise.type}')">
                            <div class="option-letter">B</div>
                            <div class="option-text">Dependent clause</div>
                        </div>
                        <div class="option" onclick="checkClauseAnswer(this, 'Phrase', '${currentExercise.type}')">
                            <div class="option-letter">C</div>
                            <div class="option-text">Phrase</div>
                        </div>
                        <div class="option" onclick="checkClauseAnswer(this, 'Sentence', '${currentExercise.type}')">
                            <div class="option-letter">D</div>
                            <div class="option-text">Complete sentence</div>
                        </div>
                    </div>
                    
                    <div id="clauseResult" style="margin-top: 20px; min-height: 30px; font-weight: bold;"></div>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                        <strong>Remember:</strong> Independent = complete thought, Dependent = starts with subordinator (when, because, if, although)
                    </div>
                </div>
            `;
            
            window.currentClauseExplanation = currentExercise.explanation;
        };

        window.checkClauseAnswer = function(element, selectedAnswer, correctAnswer) {
            const resultDiv = document.getElementById('clauseResult');
            if (!resultDiv) return;
            
            const options = element.parentElement.querySelectorAll('.option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            if (selectedAnswer === correctAnswer) {
                element.classList.add('correct');
                resultDiv.textContent = "Correct! Great clause identification!";
                resultDiv.style.color = 'var(--primary-blue)';
            } else {
                element.classList.add('incorrect');
                // Find and highlight correct option
                options.forEach(opt => {
                    if (opt.querySelector('.option-text').textContent === correctAnswer) {
                        opt.classList.add('correct');
                    }
                });
                resultDiv.innerHTML = `Incorrect. This is a ${correctAnswer.toLowerCase()}.<br>${window.currentClauseExplanation}`;
                resultDiv.style.color = 'var(--accent-orange)';
            }
            
            resultDiv.classList.add('pulse');
            setTimeout(() => resultDiv.classList.remove('pulse'), 500);
        };

        window.practicePhrases = function() {
            const practiceDisplay = document.getElementById('practiceDisplay');
            if (!practiceDisplay) return;
            
            const phraseExercises = [
                {
                    phrase: "under the bridge",
                    type: "Prepositional phrase",
                    explanation: "Begins with preposition 'under'"
                },
                {
                    phrase: "the big red balloon",
                    type: "Noun phrase",
                    explanation: "Functions as noun, no verb"
                },
                {
                    phrase: "has been studying",
                    type: "Verb phrase",
                    explanation: "Main verb 'studying' with helping verbs"
                },
                {
                    phrase: "very quickly",
                    type: "Adverb phrase",
                    explanation: "Modifies verb, no subject"
                }
            ];
            
            const currentExercise = phraseExercises[Math.floor(Math.random() * phraseExercises.length)];
            
            practiceDisplay.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--secondary-teal);">Identify the Phrase</div>
                    <div style="font-size: 1.2rem; margin-bottom: 15px; font-family: 'Georgia', serif; color: var(--text-primary);">
                        "${currentExercise.phrase}"
                    </div>
                    
                    <div style="text-align: left; margin: 20px 0;">
                        <div style="color: var(--text-secondary); margin-bottom: 10px;">What type of phrase is this?</div>
                        ${["Noun phrase", "Verb phrase", "Prepositional phrase", "Adjective phrase", "Adverb phrase"].map((option, idx) => `
                            <div style="margin: 10px 0; display: flex; align-items: center;">
                                <input type="radio" id="phrase${idx}" name="phrase" value="${option}" style="margin-right: 10px;">
                                <label for="phrase${idx}" style="color: var(--text-secondary); cursor: pointer;">${option}</label>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div>
                        <button class="btn btn-small btn-secondary" onclick="checkPhraseAnswer()">Check Answer</button>
                        <button class="btn btn-small btn-outline" onclick="showPhraseSolution()">Show Solution</button>
                    </div>
                    
                    <div id="phraseResult" style="margin-top: 20px; min-height: 30px; font-weight: bold;"></div>
                </div>
            `;
            
            window.currentPhraseAnswer = currentExercise.type;
            window.currentPhraseExplanation = currentExercise.explanation;
        };

        window.checkPhraseAnswer = function() {
            const resultDiv = document.getElementById('phraseResult');
            if (!resultDiv) return;
            
            const radios = document.querySelectorAll('input[type="radio"]');
            let selectedValue = '';
            
            radios.forEach(radio => {
                if (radio.checked) {
                    selectedValue = radio.value;
                }
            });
            
            if (!selectedValue) {
                resultDiv.textContent = "Please select an option.";
                resultDiv.style.color = 'var(--accent-red)';
                return;
            }
            
            if (selectedValue === window.currentPhraseAnswer) {
                resultDiv.textContent = "Correct! Excellent phrase identification!";
                resultDiv.style.color = 'var(--primary-blue)';
            } else {
                resultDiv.textContent = `Incorrect. This is a ${window.currentPhraseAnswer.toLowerCase()}.`;
                resultDiv.style.color = 'var(--accent-orange)';
            }
        };

        window.showPhraseSolution = function() {
            const resultDiv = document.getElementById('phraseResult');
            if (resultDiv && window.currentPhraseAnswer) {
                resultDiv.innerHTML = `
                    <div>
                        <div style="color: var(--secondary-teal); margin-bottom: 5px;"><strong>Correct answer:</strong> ${window.currentPhraseAnswer}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">${window.currentPhraseExplanation}</div>
                    </div>
                `;
            }
        };

        window.practiceSentenceTypes = function() {
            const practiceDisplay = document.getElementById('practiceDisplay');
            if (!practiceDisplay) return;
            
            const sentenceExercises = [
                {
                    sentence: "The cat slept on the sofa.",
                    type: "Simple sentence",
                    explanation: "One independent clause"
                },
                {
                    sentence: "I like coffee, but she prefers tea.",
                    type: "Compound sentence",
                    explanation: "Two independent clauses joined by 'but'"
                },
                {
                    sentence: "When it rains, the flowers grow.",
                    type: "Complex sentence",
                    explanation: "One dependent clause + one independent clause"
                },
                {
                    sentence: "Although it was late, we continued working, and we finished the project.",
                    type: "Compound-complex sentence",
                    explanation: "One dependent clause + two independent clauses"
                }
            ];
            
            const currentExercise = sentenceExercises[Math.floor(Math.random() * sentenceExercises.length)];
            
            practiceDisplay.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--accent-yellow);">Identify Sentence Type</div>
                    <div style="font-size: 1.2rem; margin-bottom: 15px; font-family: 'Georgia', serif; font-style: italic; color: var(--text-primary);">
                        "${currentExercise.sentence}"
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <select id="sentenceTypeSelect" style="width: 100%; padding: 15px; background: var(--dark-surface); border: 2px solid var(--dark-border); border-radius: 8px; color: var(--text-primary); font-size: 1rem;">
                            <option value="">Select sentence type...</option>
                            <option value="Simple sentence">Simple sentence</option>
                            <option value="Compound sentence">Compound sentence</option>
                            <option value="Complex sentence">Complex sentence</option>
                            <option value="Compound-complex sentence">Compound-complex sentence</option>
                        </select>
                    </div>
                    
                    <div>
                        <button class="btn btn-small btn-secondary" onclick="checkSentenceTypeAnswer()">Check Answer</button>
                        <button class="btn btn-small btn-outline" onclick="showSentenceTypeSolution()">Show Solution</button>
                    </div>
                    
                    <div id="sentenceTypeResult" style="margin-top: 20px; min-height: 30px; font-weight: bold;"></div>
                </div>
            `;
            
            window.currentSentenceAnswer = currentExercise.type;
            window.currentSentenceExplanation = currentExercise.explanation;
        };

        window.checkSentenceTypeAnswer = function() {
            const select = document.getElementById('sentenceTypeSelect');
            const resultDiv = document.getElementById('sentenceTypeResult');
            
            if (!select || !resultDiv) return;
            
            const selectedValue = select.value;
            
            if (!selectedValue) {
                resultDiv.textContent = "Please select a sentence type.";
                resultDiv.style.color = 'var(--accent-red)';
                return;
            }
            
            if (selectedValue === window.currentSentenceAnswer) {
                resultDiv.textContent = "Correct! Perfect sentence type identification!";
                resultDiv.style.color = 'var(--primary-blue)';
            } else {
                resultDiv.textContent = `Incorrect. This is a ${window.currentSentenceAnswer.toLowerCase()}.`;
                resultDiv.style.color = 'var(--accent-orange)';
            }
        };

        window.showSentenceTypeSolution = function() {
            const resultDiv = document.getElementById('sentenceTypeResult');
            if (resultDiv && window.currentSentenceAnswer) {
                resultDiv.innerHTML = `
                    <div>
                        <div style="color: var(--secondary-teal); margin-bottom: 5px;"><strong>Correct answer:</strong> ${window.currentSentenceAnswer}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">${window.currentSentenceExplanation}</div>
                    </div>
                `;
            }
        };

        window.practiceSentenceStructure = function() {
            const practiceDisplay = document.getElementById('practiceDisplay');
            if (!practiceDisplay) return;
            
            const structureExercises = [
                {
                    sentence: "The quick brown fox jumps over the lazy dog.",
                    subject: "The quick brown fox",
                    predicate: "jumps over the lazy dog"
                },
                {
                    sentence: "Students should complete their assignments on time.",
                    subject: "Students",
                    predicate: "should complete their assignments on time"
                },
                {
                    sentence: "Beautiful flowers bloom in the spring garden.",
                    subject: "Beautiful flowers",
                    predicate: "bloom in the spring garden"
                },
                {
                    sentence: "The excited children played games at the birthday party.",
                    subject: "The excited children",
                    predicate: "played games at the birthday party"
                }
            ];
            
            const currentExercise = structureExercises[Math.floor(Math.random() * structureExercises.length)];
            
            practiceDisplay.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--accent-purple);">Sentence Structure Analysis</div>
                    <div style="font-size: 1.2rem; margin-bottom: 15px; font-family: 'Georgia', serif; color: var(--text-primary);">
                        "${currentExercise.sentence}"
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div style="text-align: center;">
                            <div style="color: var(--primary-blue); margin-bottom: 10px; font-weight: bold;">Subject</div>
                            <input type="text" id="subjectAnswer" placeholder="Enter subject" style="width: 100%; padding: 10px; background: var(--dark-surface); border: 2px solid var(--dark-border); border-radius: 8px; color: var(--text-primary); font-size: 1rem;">
                            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">Who or what does the action</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: var(--accent-green); margin-bottom: 10px; font-weight: bold;">Predicate</div>
                            <input type="text" id="predicateAnswer" placeholder="Enter predicate" style="width: 100%; padding: 10px; background: var(--dark-surface); border: 2px solid var(--dark-border); border-radius: 8px; color: var(--text-primary); font-size: 1rem;">
                            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">What the subject does</div>
                        </div>
                    </div>
                    
                    <div>
                        <button class="btn btn-small btn-secondary" onclick="checkStructureAnswer()">Check Answers</button>
                        <button class="btn btn-small btn-outline" onclick="showStructureSolution()">Show Solution</button>
                    </div>
                    
                    <div id="structureResult" style="margin-top: 20px; min-height: 30px; font-weight: bold;"></div>
                </div>
            `;
            
            window.currentStructureAnswers = {
                subject: currentExercise.subject,
                predicate: currentExercise.predicate
            };
        };

        window.checkStructureAnswer = function() {
            const subjectInput = document.getElementById('subjectAnswer');
            const predicateInput = document.getElementById('predicateAnswer');
            const resultDiv = document.getElementById('structureResult');
            
            if (!subjectInput || !predicateInput || !resultDiv) return;
            
            const userSubject = subjectInput.value.trim();
            const userPredicate = predicateInput.value.trim();
            const correctSubject = window.currentStructureAnswers.subject;
            const correctPredicate = window.currentStructureAnswers.predicate;
            
            const subjectCorrect = userSubject.toLowerCase() === correctSubject.toLowerCase();
            const predicateCorrect = userPredicate.toLowerCase() === correctPredicate.toLowerCase();
            
            if (subjectCorrect && predicateCorrect) {
                resultDiv.textContent = "Perfect! You identified both subject and predicate correctly!";
                resultDiv.style.color = 'var(--primary-blue)';
            } else if (subjectCorrect || predicateCorrect) {
                resultDiv.textContent = `Partially correct. ${subjectCorrect ? 'Subject is right' : 'Subject is wrong'}. ${predicateCorrect ? 'Predicate is right' : 'Predicate is wrong'}.`;
                resultDiv.style.color = 'var(--accent-orange)';
            } else {
                resultDiv.textContent = "Try again. Remember: Subject = who/what does action, Predicate = what they do.";
                resultDiv.style.color = 'var(--accent-red)';
            }
        };

        window.showStructureSolution = function() {
            const resultDiv = document.getElementById('structureResult');
            if (resultDiv && window.currentStructureAnswers) {
                resultDiv.innerHTML = `
                    <div>
                        <div style="color: var(--secondary-teal); margin-bottom: 5px;">
                            <strong>Subject:</strong> ${window.currentStructureAnswers.subject}<br>
                            <strong>Predicate:</strong> ${window.currentStructureAnswers.predicate}
                        </div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                            <strong>Tip:</strong> Find the verb first, then ask "who or what" before it for subject.
                        </div>
                    </div>
                `;
            }
        };

        // Load current question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            grammarFact.innerHTML = '';
            conceptDisplay.innerHTML = '';
            visualizationContainer.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            grammarFact.appendChild(createGrammarFact());
            conceptDisplay.appendChild(createConceptDisplay());
            visualizationContainer.appendChild(createGrammarVisualization());
            
            // Reset grammar state
            grammarState.currentAnalysis = null;
            grammarState.sentenceType = 'simple';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                optionElement.classList.add('pulse');
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation, question.answer);
            }
            
            nextQuestionBtn.disabled = false;
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackMessage = feedbackContainer.querySelector('.feedback-message');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '‚úì';
                feedbackTitle.textContent = 'Correct!';
                feedbackMessage.textContent = positiveMessages[Math.floor(Math.random() * positiveMessages.length)];
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '‚úó';
                feedbackTitle.textContent = 'Incorrect';
                if (correctAnswer) {
                    const correctOption = String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65));
                    const correctText = questions.find(q => 
                        appState.currentQuestions[appState.currentQuestionIndex].question === q.question
                    )?.options[correctAnswer.charCodeAt(0) - 65];
                    
                    feedbackMessage.textContent = `Correct answer: ${correctOption} (${correctText})`;
                }
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
            feedbackContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip current question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry the topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            initializeQuestions();
            
            saveStateToStorage();
            showPracticePage();
        }

        // Go back to home page
        function backToHome() {
            showWelcomePage();
        }

        // Go back to topics page
        function backToTopics() {
            alert("In a complete implementation, this would navigate to the topics selection page.");
        }

        // Start practice session
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name to begin!");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            if (appState.currentQuestions.length === 0) {
                initializeQuestions();
            }
            
            saveStateToStorage();
            showPracticePage();
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

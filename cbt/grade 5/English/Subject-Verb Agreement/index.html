<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 5 English - Subject-Verb Agreement | Ideolix Learning Hub</title>
    <style>
        :root {
            --primary-blue: #2196F3;
            --secondary-green: #4CAF50;
            --accent-orange: #FF9800;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--dark-border);
        }

        .logo {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            border-radius: 10px;
            overflow: hidden;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info {
            flex: 1;
        }

        .brand-info h1 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .card {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--dark-border);
        }

        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 30px 20px;
        }

        .welcome-title {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 25px;
            max-width: 500px;
            line-height: 1.5;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(33, 150, 243, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--primary-blue);
        }

        .topic-name {
            font-weight: 600;
            color: var(--primary-blue);
        }

        .input-group {
            width: 100%;
            max-width: 300px;
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            background: var(--dark-surface);
            color: var(--text-primary);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--dark-border);
        }

        .btn-outline:hover {
            border-color: var(--primary-blue);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 15px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .progress-bar {
            height: 6px;
            background: var(--dark-surface);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-blue), var(--secondary-green));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .question-container {
            margin-bottom: 15px;
        }

        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (min-width: 768px) {
            .content-wrapper {
                grid-template-columns: 1fr 1fr;
            }
        }

        .question-side {
            display: flex;
            flex-direction: column;
        }

        .visualization-side {
            display: flex;
            flex-direction: column;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .grammar-tip {
            background: var(--dark-surface);
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            border-left: 3px solid var(--accent-orange);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .option {
            padding: 12px 15px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-blue);
        }

        .option.correct {
            background: rgba(33, 150, 243, 0.1);
            border-color: var(--primary-blue);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: #F44336;
        }

        .option-letter {
            width: 24px;
            height: 24px;
            background: var(--dark-card);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .option.correct .option-letter {
            background: var(--primary-blue);
            color: white;
        }

        .option.incorrect .option-letter {
            background: #F44336;
            color: white;
        }

        .feedback-container {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .feedback-correct {
            background: rgba(33, 150, 243, 0.1);
            border-left: 3px solid var(--primary-blue);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 3px solid #F44336;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .feedback-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            color: white;
        }

        .feedback-correct .feedback-icon {
            background: var(--primary-blue);
        }

        .feedback-incorrect .feedback-icon {
            background: #F44336;
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1rem;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .visualization-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--dark-border);
        }

        .concept-display {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .concept-box {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-green));
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1rem;
            text-align: center;
        }

        .agreement-rule {
            margin: 10px 0;
            padding: 10px;
            background: var(--dark-card);
            border-radius: 8px;
        }

        .rule-title {
            color: var(--accent-orange);
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .rule-example {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .subject-verb-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .subject-box, .verb-box {
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
        }

        .subject-box {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid var(--primary-blue);
        }

        .verb-box {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--secondary-green);
        }

        .connector {
            color: var(--accent-orange);
            font-weight: bold;
        }

        .rule-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        @media (min-width: 480px) {
            .rule-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .results-page {
            display: none;
            text-align: center;
            padding: 30px 20px;
        }

        .results-title {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 25px;
            max-width: 400px;
            margin: 0 auto 20px;
            border: 1px solid var(--dark-border);
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .score-percentage {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 12px;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline btn-small" id="backToTopics">Topics</button>
                <button class="btn btn-outline btn-small" id="backToHome">Home</button>
            </div>
        </header>

        <div class="welcome-page card fade-in" id="welcomePage">
            <h1 class="welcome-title">Grade 5 English</h1>
            <p class="welcome-subtitle">Master subject-verb agreement. Learn to match subjects with correct verbs in number and person.</p>
            
            <div class="topic-badge">
                <span class="topic-name">Subject–Verb Agreement</span>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your name:</label>
                <input type="text" id="studentName" placeholder="Your name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">Start Practice</button>
            </div>
        </div>

        <div class="practice-page card fade-in" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 60</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 1.67%"></div>
                </div>
            </div>

            <div class="question-container">
                <div id="grammarTip"></div>
                <div id="conceptDisplay"></div>
                
                <div class="content-wrapper">
                    <div class="question-side">
                        <h2 class="question-text" id="questionText"></h2>
                        
                        <div class="options-container" id="optionsContainer"></div>
                        
                        <div class="feedback-container" id="feedbackContainer">
                            <div class="feedback-header">
                                <div class="feedback-icon"></div>
                                <div class="feedback-title"></div>
                            </div>
                            <div class="feedback-explanation"></div>
                        </div>
                    </div>
                    
                    <div class="visualization-side">
                        <div class="visualization-container" id="visualizationContainer"></div>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next</button>
                </div>
            </div>
        </div>

        <div class="results-page card fade-in" id="resultsPage">
            <h2 class="results-title">Practice Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="skippedQuestions">0</div>
                        <div class="stat-label">Skipped</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="highestScore">0</div>
                        <div class="stat-label">Best Score</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Try Again</button>
                <button class="btn btn-outline" id="viewTopics">More Topics</button>
            </div>
        </div>
    </div>

    <script>
        // Core rules for subject-verb agreement
        const agreementRules = [
            "Singular subjects need singular verbs",
            "Plural subjects need plural verbs",
            "Compound subjects with 'and' take plural verbs",
            "Subjects with 'or' or 'nor' match the nearest subject",
            "Indefinite pronouns like 'everyone' take singular verbs",
            "Collective nouns can be singular or plural based on context"
        ];

        // Questions array - 60 focused questions
        const questions = [
            // Basic singular/plural (1-15)
            {
                type: "basic",
                question: "Choose the correct verb: The cat ____ on the mat.",
                options: ["sleep", "sleeps"],
                answer: "B",
                explanation: "'The cat' is singular, so it needs singular verb 'sleeps'."
            },
            {
                type: "basic",
                question: "Complete: Dogs ____ in the park.",
                options: ["run", "runs"],
                answer: "A",
                explanation: "'Dogs' is plural, so it needs plural verb 'run'."
            },
            {
                type: "basic",
                question: "Select: She ____ to school every day.",
                options: ["walk", "walks"],
                answer: "B",
                explanation: "'She' is third person singular, needs 'walks'."
            },
            {
                type: "basic",
                question: "Choose: They ____ basketball on weekends.",
                options: ["play", "plays"],
                answer: "A",
                explanation: "'They' is plural, needs plural verb 'play'."
            },

            // Compound subjects (16-25)
            {
                type: "compound",
                question: "Tom and Jerry ____ cartoons.",
                options: ["watch", "watches"],
                answer: "A",
                explanation: "Subjects joined by 'and' take plural verbs."
            },
            {
                type: "compound",
                question: "Bread and butter ____ my favorite breakfast.",
                options: ["is", "are"],
                answer: "A",
                explanation: "'Bread and butter' is considered one dish, so singular."
            },
            {
                type: "compound",
                question: "Either the cat or the dogs ____ making noise.",
                options: ["is", "are"],
                answer: "B",
                explanation: "With 'or', verb agrees with nearest subject 'dogs' (plural)."
            },

            // Indefinite pronouns (26-35)
            {
                type: "indefinite",
                question: "Everybody ____ invited to the party.",
                options: ["is", "are"],
                answer: "A",
                explanation: "'Everybody' is singular indefinite pronoun."
            },
            {
                type: "indefinite",
                question: "Some of the cake ____ been eaten.",
                options: ["has", "have"],
                answer: "A",
                explanation: "'Some' refers to singular 'cake', so singular verb."
            },
            {
                type: "indefinite",
                question: "Each student ____ a textbook.",
                options: ["have", "has"],
                answer: "B",
                explanation: "'Each' is singular, needs singular verb 'has'."
            },

            // Collective nouns (36-45)
            {
                type: "collective",
                question: "The team ____ playing well today.",
                options: ["is", "are"],
                answer: "A",
                explanation: "Team as a unit takes singular verb."
            },
            {
                type: "collective",
                question: "The committee ____ different opinions.",
                options: ["have", "has"],
                answer: "A",
                explanation: "Committee as individuals takes plural verb."
            },

            // Tricky cases (46-60)
            {
                type: "tricky",
                question: "Mathematics ____ my favorite subject.",
                options: ["is", "are"],
                answer: "A",
                explanation: "Subjects ending in -ics take singular verbs."
            },
            {
                type: "tricky",
                question: "Ten dollars ____ too much for that.",
                options: ["is", "are"],
                answer: "A",
                explanation: "Amounts of money take singular verbs."
            },
            {
                type: "tricky",
                question: "The police ____ investigating the case.",
                options: ["is", "are"],
                answer: "B",
                explanation: "'Police' is always plural."
            },
            {
                type: "tricky",
                question: "Neither of the answers ____ correct.",
                options: ["is", "are"],
                answer: "A",
                explanation: "'Neither' is singular, needs singular verb."
            }
        ];

        // Add more questions to reach 60
        for (let i = 61; i <= 100; i++) {
            const types = ["basic", "compound", "indefinite", "collective", "tricky"];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let question, options, answer, explanation;
            
            switch(type) {
                case "basic":
                    const subjects = ["boy", "girls", "teacher", "students", "book", "pencils"];
                    const verbs = ["read", "reads", "write", "writes", "play", "plays"];
                    const subject = subjects[Math.floor(Math.random() * subjects.length)];
                    const isSingular = !subject.endsWith('s') || subject === "class" || subject === "bus";
                    const verb = isSingular ? verbs.find(v => v.endsWith('s')) : verbs.find(v => !v.endsWith('s'));
                    
                    question = `The ${subject} ____ every day.`;
                    options = isSingular ? [verb, verb.replace('s', '')] : [verb.replace('s', ''), verb];
                    answer = "A";
                    explanation = `'The ${subject}' is ${isSingular ? 'singular' : 'plural'}, needs ${isSingular ? 'singular' : 'plural'} verb.`;
                    break;
                    
                case "compound":
                    question = `My brother and sister ____ to the same school.`;
                    options = ["go", "goes"];
                    answer = "A";
                    explanation = "Subjects joined by 'and' take plural verbs.";
                    break;
                    
                case "indefinite":
                    const pronouns = ["Everyone", "Someone", "Nobody", "Each"];
                    const pronoun = pronouns[Math.floor(Math.random() * pronouns.length)];
                    question = `${pronoun} ____ completed the assignment.`;
                    options = ["has", "have"];
                    answer = "A";
                    explanation = `'${pronoun}' is singular indefinite pronoun.`;
                    break;
            }
            
            if (question) {
                questions.push({
                    type: type,
                    question: question,
                    options: options,
                    answer: answer,
                    explanation: explanation
                });
            }
        }

        // Keep only 60 questions
        questions.length = 60;

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const grammarTip = document.getElementById('grammarTip');
        const conceptDisplay = document.getElementById('conceptDisplay');
        const visualizationContainer = document.getElementById('visualizationContainer');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const backToTopicsBtn = document.getElementById('backToTopics');
        const viewTopicsBtn = document.getElementById('viewTopics');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');
        const skippedQuestions = document.getElementById('skippedQuestions');
        const highestScore = document.getElementById('highestScore');

        // Initialize app
        function initApp() {
            loadStateFromStorage();
            setupEventListeners();
            
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Load state
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixSubjectVerb');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            }
        }

        // Save state
        function saveStateToStorage() {
            localStorage.setItem('ideolixSubjectVerb', JSON.stringify(appState));
        }

        // Initialize questions
        function initializeQuestions() {
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', backToHome);
            backToTopicsBtn.addEventListener('click', backToTopics);
            viewTopicsBtn.addEventListener('click', backToTopics);
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') startPractice();
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
            skippedQuestions.textContent = appState.skipped;
            
            const highest = localStorage.getItem('ideolixSubjectVerb_highestScore') || 0;
            highestScore.textContent = Math.max(highest, appState.score);
            
            if (appState.score > highest) {
                localStorage.setItem('ideolixSubjectVerb_highestScore', appState.score);
            }
        }

        // Create grammar tip
        function createGrammarTip() {
            const tipDiv = document.createElement('div');
            tipDiv.className = 'grammar-tip';
            
            const tips = [
                "Singular subjects need singular verbs ending in -s.",
                "Plural subjects need plural verbs without -s.",
                "Identify the subject before choosing the verb.",
                "Watch for tricky subjects like 'everyone' or 'team'.",
                "Subjects and verbs must agree in number."
            ];
            
            tipDiv.textContent = `Tip: ${tips[Math.floor(Math.random() * tips.length)]}`;
            
            return tipDiv;
        }

        // Create concept display
        function createConceptDisplay() {
            const display = document.createElement('div');
            display.className = 'concept-display';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            const conceptBox = document.createElement('div');
            conceptBox.className = 'concept-box fade-in';
            
            let conceptText = "Subject-Verb Agreement";
            if (question.type === "basic") conceptText = "Basic Agreement";
            if (question.type === "compound") conceptText = "Compound Subjects";
            if (question.type === "indefinite") conceptText = "Indefinite Pronouns";
            if (question.type === "collective") conceptText = "Collective Nouns";
            if (question.type === "tricky") conceptText = "Special Cases";
            
            conceptBox.textContent = conceptText;
            display.appendChild(conceptBox);
            
            return display;
        }

        // Create visualization
        function createVisualization() {
            const vizDiv = document.createElement('div');
            vizDiv.className = 'visualization-container';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            if (question.type === "basic") {
                vizDiv.innerHTML = `
                    <div class="subject-verb-display">
                        <div class="subject-box">Singular Subject</div>
                        <div class="connector">+</div>
                        <div class="verb-box">Singular Verb</div>
                    </div>
                    <div class="subject-verb-display">
                        <div class="subject-box">Plural Subject</div>
                        <div class="connector">+</div>
                        <div class="verb-box">Plural Verb</div>
                    </div>
                    <div class="agreement-rule">
                        <div class="rule-title">Basic Rule:</div>
                        <div class="rule-example">Singular: The cat runs. | Plural: The cats run.</div>
                    </div>
                `;
            } else if (question.type === "compound") {
                vizDiv.innerHTML = `
                    <div class="agreement-rule">
                        <div class="rule-title">Rule 1: Subjects with 'and'</div>
                        <div class="rule-example">Tom and Jerry play. (plural)</div>
                    </div>
                    <div class="agreement-rule">
                        <div class="rule-title">Rule 2: Subjects with 'or/nor'</div>
                        <div class="rule-example">Tom or Jerry is here. (match nearest)</div>
                    </div>
                `;
            } else if (question.type === "indefinite") {
                vizDiv.innerHTML = `
                    <div class="agreement-rule">
                        <div class="rule-title">Always Singular:</div>
                        <div class="rule-example">everyone, someone, nobody, each, either</div>
                    </div>
                    <div class="agreement-rule">
                        <div class="rule-title">Always Plural:</div>
                        <div class="rule-example">both, few, many, several</div>
                    </div>
                    <div class="agreement-rule">
                        <div class="rule-title">Depends on context:</div>
                        <div class="rule-example">some, any, none, all, most</div>
                    </div>
                `;
            } else if (question.type === "collective") {
                vizDiv.innerHTML = `
                    <div class="agreement-rule">
                        <div class="rule-title">As a unit (singular):</div>
                        <div class="rule-example">The team is winning. (acting together)</div>
                    </div>
                    <div class="agreement-rule">
                        <div class="rule-title">As individuals (plural):</div>
                        <div class="rule-example">The team are arguing. (acting separately)</div>
                    </div>
                `;
            } else {
                vizDiv.innerHTML = `
                    <div class="rule-grid">
                        <div class="agreement-rule">
                            <div class="rule-title">-ics subjects:</div>
                            <div class="rule-example">Mathematics is fun.</div>
                        </div>
                        <div class="agreement-rule">
                            <div class="rule-title">Amounts:</div>
                            <div class="rule-example">Ten dollars is enough.</div>
                        </div>
                        <div class="agreement-rule">
                            <div class="rule-title">Titles:</div>
                            <div class="rule-example">Harry Potter is a good book.</div>
                        </div>
                        <div class="agreement-rule">
                            <div class="rule-title">Plural nouns:</div>
                            <div class="rule-example">The police are coming.</div>
                        </div>
                    </div>
                `;
            }
            
            return vizDiv;
        }

        // Load question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            grammarTip.innerHTML = '';
            conceptDisplay.innerHTML = '';
            visualizationContainer.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            grammarTip.appendChild(createGrammarTip());
            conceptDisplay.appendChild(createConceptDisplay());
            visualizationContainer.appendChild(createVisualization());
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div>${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation, question.answer);
            }
            
            nextQuestionBtn.disabled = false;
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '✓';
                feedbackTitle.textContent = 'Correct!';
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '✗';
                feedbackTitle.textContent = 'Incorrect';
                if (correctAnswer) {
                    const correctOption = String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65));
                    explanation = `Correct: ${correctOption}. ${explanation}`;
                }
            }
            
            feedbackExplanation.textContent = explanation;
            feedbackContainer.style.display = 'block';
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            initializeQuestions();
            
            saveStateToStorage();
            showPracticePage();
        }

        // Back to home
        function backToHome() {
            showWelcomePage();
        }

        // Back to topics
        function backToTopics() {
            alert("Would navigate to topics page.");
        }

        // Start practice
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name.");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            if (appState.currentQuestions.length === 0) {
                initializeQuestions();
            }
            
            saveStateToStorage();
            showPracticePage();
        }

        // Initialize app
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

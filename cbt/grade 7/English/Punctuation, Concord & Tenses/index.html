<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 7 English - Punctuation, Concord & Tenses | Ideolix Learning Hub</title>
    <style>
        :root {
            --primary-blue: #2196F3;
            --secondary-teal: #009688;
            --accent-yellow: #FFEB3B;
            --accent-green: #4CAF50;
            --accent-orange: #FF9800;
            --accent-red: #F44336;
            --accent-purple: #9C27B0;
            --dark-bg: #121212;
            --dark-surface: #1E1E1E;
            --dark-card: #252525;
            --dark-border: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --text-muted: #888;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            background: var(--dark-surface);
            padding: 15px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }

        .logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 12px;
            overflow: hidden;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .brand-info h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .brand-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Cards */
        .card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--dark-border);
        }

        .welcome-page {
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(33, 150, 243, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 25px;
            border: 1px solid var(--primary-blue);
        }

        .input-group {
            width: 100%;
            max-width: 500px;
            margin: 0 auto 25px;
        }

        .input-group label {
            display: block;
            text-align: left;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 1.1rem;
            background: var(--dark-surface);
            color: var(--text-primary);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }

        .btn-primary:hover {
            background: #1976D2;
            transform: translateY(-3px);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Practice Page */
        .practice-page {
            display: none;
        }

        .progress-container {
            margin-bottom: 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        .progress-bar {
            height: 12px;
            background: var(--dark-surface);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-blue), var(--secondary-teal));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .example-display {
            background: var(--dark-surface);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid var(--accent-yellow);
            font-family: 'Georgia', serif;
            font-size: 1.2rem;
            text-align: center;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }

        .option {
            padding: 18px 20px;
            background: var(--dark-surface);
            border: 2px solid var(--dark-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: var(--primary-blue);
            transform: translateY(-2px);
        }

        .option.correct {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: #F44336;
            color: #F44336;
        }

        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--dark-card);
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
            color: white;
            background: var(--secondary-teal);
        }

        .feedback-container {
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            display: none;
        }

        .feedback-correct {
            background: rgba(76, 175, 80, 0.1);
            border-left: 5px solid var(--accent-green);
        }

        .feedback-incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-left: 5px solid #F44336;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
            background: var(--accent-green);
        }

        .feedback-incorrect .feedback-icon {
            background: #F44336;
        }

        .feedback-title {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--accent-green);
        }

        .feedback-incorrect .feedback-title {
            color: #F44336;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        /* Visualization */
        .visualization-container {
            background: var(--dark-surface);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
        }

        .concept-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .concept-box {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            padding: 20px 30px;
            border-radius: 12px;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            min-width: 180px;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .concept-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        /* Results Page */
        .results-page {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .results-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .score-card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto 30px;
            box-shadow: var(--shadow);
        }

        .score-value {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            background: var(--dark-surface);
            padding: 20px;
            border-radius: 12px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .welcome-title { font-size: 2rem; }
            .score-value { font-size: 3rem; }
            .stats-container { grid-template-columns: 1fr; }
            .navigation-buttons { flex-direction: column; gap: 10px; }
            .navigation-buttons .btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ideolixlearninghub/ideolix-web/main/ideolix%20LOGO.jpg" alt="Ideolix Logo">
            </div>
            <div class="brand-info">
                <h1>Ideolix Learning Hub</h1>
                <p>Building learners for a digital future.</p>
            </div>
        </header>

        <!-- Welcome Page -->
        <div class="welcome-page card" id="welcomePage">
            <h1 class="welcome-title">Grade 7 English</h1>
            <p class="welcome-subtitle">Master the mechanics of English! Learn proper punctuation, subject-verb agreement (concord), and verb tenses to write clearly and correctly.</p>
            
            <div class="topic-badge">
                <span class="topic-icon">üìùüî§‚úÖ</span>
                <span class="topic-name">Punctuation, Concord & Tenses</span>
            </div>
            
            <div class="input-group">
                <label for="studentName">Enter your full name:</label>
                <input type="text" id="studentName" placeholder="Your full name">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startPractice">Start Practice</button>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-page card" id="practicePage">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="studentNameDisplay"></span>
                    <span id="progressText">Question 1 of 60</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 1.7%"></div>
                </div>
            </div>

            <div class="question-container">
                <div id="conceptDisplay"></div>
                
                <h2 class="question-text" id="questionText"></h2>
                
                <div class="example-display" id="exampleDisplay"></div>
                
                <div class="options-container" id="optionsContainer"></div>
                
                <div class="feedback-container" id="feedbackContainer">
                    <div class="feedback-header">
                        <div class="feedback-icon"></div>
                        <div class="feedback-title"></div>
                    </div>
                    <div class="feedback-explanation"></div>
                </div>
                
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="skipQuestion">Skip</button>
                    <button class="btn btn-primary" id="nextQuestion" disabled>Next</button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-page card" id="resultsPage">
            <h2 class="results-title">Practice Complete!</h2>
            
            <div class="score-card">
                <div class="score-value" id="finalScore">0</div>
                <div class="score-percentage" id="scorePercentage">0%</div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="retryTopic">Try Again</button>
                <button class="btn btn-outline" id="backToHome">Home</button>
            </div>
        </div>
    </div>

    <script>
        // Questions array - Focused on Punctuation, Concord, and Tenses
        const questions = [
            // Punctuation (1-20)
            {
                type: "punctuation",
                concept: "Commas in Lists",
                question: "Which sentence uses commas correctly in a list?",
                example: "",
                options: [
                    "I bought apples, bananas, and oranges.",
                    "I bought apples bananas and oranges.",
                    "I bought apples, bananas and oranges.",
                    "I bought apples, bananas, and, oranges."
                ],
                answer: "A",
                explanation: "Commas separate items in a list, with a comma before 'and' (Oxford comma) being optional but often preferred."
            },
            {
                type: "punctuation",
                concept: "Apostrophes for Possession",
                question: "Which sentence uses the apostrophe correctly?",
                example: "",
                options: [
                    "The cat's toys are under the bed.",
                    "The cats' toys are under the bed.",
                    "The cats toys are under the bed.",
                    "The cat's toy's are under the bed."
                ],
                answer: "A",
                explanation: "Apostrophe + s shows possession for singular nouns: cat's toys = toys belonging to one cat."
            },
            {
                type: "punctuation",
                concept: "Quotation Marks",
                question: "Which sentence uses quotation marks correctly?",
                example: "",
                options: [
                    'Sarah said, "I will be there at 3:00."',
                    'Sarah said "I will be there at 3:00."',
                    "Sarah said, I will be there at 3:00.",
                    'Sarah said, "I will be there at 3:00".'
                ],
                answer: "A",
                explanation: "Quotation marks surround exact words spoken, with comma before the quote and period inside quotes."
            },
            {
                type: "punctuation",
                concept: "End Punctuation",
                question: "What end punctuation is needed: What time does the movie start",
                example: "",
                options: ["?", ".", "!", ","],
                answer: "A",
                explanation: "Questions end with question marks."
            },
            // Concord/Subject-Verb Agreement (21-40)
            {
                type: "concord",
                concept: "Singular Subjects",
                question: "Which is correct?",
                example: "",
                options: [
                    "The dog barks at the mailman.",
                    "The dog bark at the mailman.",
                    "The dogs barks at the mailman.",
                    "The dog's bark at the mailman."
                ],
                answer: "A",
                explanation: "Singular subject (dog) needs singular verb (barks)."
            },
            {
                type: "concord",
                concept: "Plural Subjects",
                question: "Which is correct?",
                example: "",
                options: [
                    "The students study for their exams.",
                    "The students studies for their exams.",
                    "The student study for their exams.",
                    "The student's study for their exams."
                ],
                answer: "A",
                explanation: "Plural subject (students) needs plural verb (study)."
            },
            {
                type: "concord",
                concept: "Compound Subjects with 'and'",
                question: "Which is correct?",
                example: "",
                options: [
                    "Tom and Jerry are friends.",
                    "Tom and Jerry is friends.",
                    "Tom and Jerry am friends.",
                    "Tom and Jerry be friends."
                ],
                answer: "A",
                explanation: "Compound subjects joined by 'and' take plural verbs."
            },
            {
                type: "concord",
                concept: "Indefinite Pronouns",
                question: "Which is correct?",
                example: "",
                options: [
                    "Everyone has completed their work.",
                    "Everyone have completed their work.",
                    "Everyone having completed their work.",
                    "Everyone had completed their work."
                ],
                answer: "A",
                explanation: "Indefinite pronouns like 'everyone' are singular and take singular verbs."
            },
            // Tenses (41-60)
            {
                type: "tenses",
                concept: "Simple Present",
                question: "Which sentence uses simple present tense correctly?",
                example: "",
                options: [
                    "She walks to school every day.",
                    "She walked to school every day.",
                    "She walking to school every day.",
                    "She will walk to school every day."
                ],
                answer: "A",
                explanation: "Simple present describes habitual actions: subject + base verb + s/es for third person singular."
            },
            {
                type: "tenses",
                concept: "Simple Past",
                question: "Which sentence uses simple past tense correctly?",
                example: "",
                options: [
                    "They visited the museum yesterday.",
                    "They visit the museum yesterday.",
                    "They visiting the museum yesterday.",
                    "They will visit the museum yesterday."
                ],
                answer: "A",
                explanation: "Simple past for completed actions: subject + verb + ed (or irregular past form)."
            },
            {
                type: "tenses",
                concept: "Present Continuous",
                question: "Which sentence uses present continuous tense correctly?",
                example: "",
                options: [
                    "I am reading a book right now.",
                    "I reading a book right now.",
                    "I read a book right now.",
                    "I was reading a book right now."
                ],
                answer: "A",
                explanation: "Present continuous for actions happening now: am/is/are + verb + ing."
            },
            {
                type: "tenses",
                concept: "Future Tense",
                question: "Which sentence expresses future action?",
                example: "",
                options: [
                    "We will travel to Paris next summer.",
                    "We travel to Paris next summer.",
                    "We traveled to Paris next summer.",
                    "We traveling to Paris next summer."
                ],
                answer: "A",
                explanation: "Future tense uses 'will' + base verb to talk about future actions."
            },
            // Mixed Practice
            {
                type: "mixed",
                concept: "Punctuation & Concord",
                question: "Which sentence is completely correct?",
                example: "",
                options: [
                    "My brothers, who live in London, are coming to visit.",
                    "My brothers who live in London is coming to visit.",
                    "My brothers, who live in London is coming to visit.",
                    "My brothers who live in London, are coming to visit."
                ],
                answer: "A",
                explanation: "Correct comma use for non-essential clause AND correct subject-verb agreement (brothers are)."
            },
            {
                type: "mixed",
                concept: "Tenses & Concord",
                question: "Which sentence is correct?",
                example: "",
                options: [
                    "Every morning, she brushes her teeth before breakfast.",
                    "Every morning, she brush her teeth before breakfast.",
                    "Every morning, she brushing her teeth before breakfast.",
                    "Every morning, she brushed her teeth before breakfast."
                ],
                answer: "A",
                explanation: "Simple present for habitual action + correct third person singular verb form (brushes)."
            }
        ];

        // App state
        let appState = {
            currentQuestionIndex: 0,
            score: 0,
            skipped: 0,
            answered: 0,
            currentQuestions: [],
            studentName: ""
        };

        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const practicePage = document.getElementById('practicePage');
        const resultsPage = document.getElementById('resultsPage');
        const studentNameInput = document.getElementById('studentName');
        const startPracticeBtn = document.getElementById('startPractice');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const questionText = document.getElementById('questionText');
        const exampleDisplay = document.getElementById('exampleDisplay');
        const conceptDisplay = document.getElementById('conceptDisplay');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const skipQuestionBtn = document.getElementById('skipQuestion');
        const retryTopicBtn = document.getElementById('retryTopic');
        const backToHomeBtn = document.getElementById('backToHome');
        const finalScore = document.getElementById('finalScore');
        const scorePercentage = document.getElementById('scorePercentage');
        const correctAnswers = document.getElementById('correctAnswers');
        const incorrectAnswers = document.getElementById('incorrectAnswers');

        // Initialize the app
        function initApp() {
            loadStateFromStorage();
            setupEventListeners();
            
            if (appState.studentName && appState.currentQuestions.length > 0) {
                showPracticePage();
            } else {
                showWelcomePage();
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            startPracticeBtn.addEventListener('click', startPractice);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            skipQuestionBtn.addEventListener('click', skipQuestion);
            retryTopicBtn.addEventListener('click', retryTopic);
            backToHomeBtn.addEventListener('click', showWelcomePage);
            
            studentNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') startPractice();
            });
        }

        // Show welcome page
        function showWelcomePage() {
            welcomePage.style.display = 'block';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'none';
            studentNameInput.value = appState.studentName || '';
        }

        // Show practice page
        function showPracticePage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'block';
            resultsPage.style.display = 'none';
            studentNameDisplay.textContent = appState.studentName;
            loadQuestion();
        }

        // Show results page
        function showResultsPage() {
            welcomePage.style.display = 'none';
            practicePage.style.display = 'none';
            resultsPage.style.display = 'block';
            
            const totalQuestions = appState.currentQuestions.length;
            const percentage = Math.round((appState.score / totalQuestions) * 100);
            
            finalScore.textContent = appState.score;
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = appState.score;
            incorrectAnswers.textContent = appState.answered - appState.score;
        }

        // Create concept display
        function createConceptDisplay() {
            const display = document.createElement('div');
            display.className = 'concept-display';
            
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            const conceptIcons = {
                "punctuation": "üìù",
                "concord": "ü§ù",
                "tenses": "‚è∞",
                "mixed": "üåÄ"
            };
            
            const conceptNames = {
                "punctuation": "PUNCTUATION",
                "concord": "CONCORD",
                "tenses": "TENSES",
                "mixed": "MIXED"
            };
            
            const conceptBox = document.createElement('div');
            conceptBox.className = 'concept-box';
            conceptBox.innerHTML = `
                <div class="concept-icon">${conceptIcons[question.type] || "üìö"}</div>
                <div>${conceptNames[question.type] || "GRAMMAR"}</div>
            `;
            
            const label = document.createElement('div');
            label.style.cssText = 'color: var(--text-secondary); text-align: center; margin-top: 10px;';
            label.textContent = question.concept;
            
            display.appendChild(conceptBox);
            display.appendChild(label);
            
            return display;
        }

        // Load current question
        function loadQuestion() {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            
            progressText.textContent = `Question ${appState.currentQuestionIndex + 1} of ${appState.currentQuestions.length}`;
            progressFill.style.width = `${((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100}%`;
            
            questionText.textContent = question.question;
            
            // Clear containers
            conceptDisplay.innerHTML = '';
            exampleDisplay.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackContainer.style.display = 'none';
            nextQuestionBtn.disabled = true;
            
            // Add content
            conceptDisplay.appendChild(createConceptDisplay());
            
            if (question.example) {
                exampleDisplay.textContent = question.example;
                exampleDisplay.style.display = 'block';
            } else {
                exampleDisplay.style.display = 'none';
            }
            
            // Add options
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionElement, index));
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        function selectOption(optionElement, selectedIndex) {
            const question = appState.currentQuestions[appState.currentQuestionIndex];
            const correctIndex = question.answer.charCodeAt(0) - 65;
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            allOptions[correctIndex].classList.add('correct');
            
            if (selectedIndex === correctIndex) {
                optionElement.classList.add('correct');
                appState.score++;
                appState.answered++;
                showFeedback(true, question.explanation);
            } else {
                optionElement.classList.add('incorrect');
                appState.answered++;
                showFeedback(false, question.explanation, question.answer);
            }
            
            nextQuestionBtn.disabled = false;
            saveStateToStorage();
        }

        // Show feedback
        function showFeedback(isCorrect, explanation, correctAnswer = null) {
            const feedbackTitle = feedbackContainer.querySelector('.feedback-title');
            const feedbackExplanation = feedbackContainer.querySelector('.feedback-explanation');
            const feedbackIcon = feedbackContainer.querySelector('.feedback-icon');
            
            if (isCorrect) {
                feedbackContainer.className = 'feedback-container feedback-correct';
                feedbackIcon.textContent = '‚úì';
                feedbackTitle.textContent = 'Correct!';
            } else {
                feedbackContainer.className = 'feedback-container feedback-incorrect';
                feedbackIcon.textContent = '‚úó';
                feedbackTitle.textContent = 'Incorrect';
                if (correctAnswer) {
                    const correctOption = String.fromCharCode(65 + (correctAnswer.charCodeAt(0) - 65));
                    const correctText = questions.find(q => 
                        appState.currentQuestions[appState.currentQuestionIndex].question === q.question
                    )?.options[correctAnswer.charCodeAt(0) - 65];
                    
                    feedbackExplanation.textContent = `Correct answer: ${correctOption} (${correctText})\n\n${explanation}`;
                }
            }
            
            if (isCorrect) {
                feedbackExplanation.textContent = explanation;
            }
            
            feedbackContainer.style.display = 'block';
        }

        // Move to next question
        function nextQuestion() {
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Skip current question
        function skipQuestion() {
            appState.skipped++;
            appState.currentQuestionIndex++;
            
            if (appState.currentQuestionIndex < appState.currentQuestions.length) {
                loadQuestion();
            } else {
                showResultsPage();
            }
            
            saveStateToStorage();
        }

        // Retry the topic
        function retryTopic() {
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            initializeQuestions();
            saveStateToStorage();
            showPracticePage();
        }

        // Start practice session
        function startPractice() {
            const name = studentNameInput.value.trim();
            if (!name) {
                alert("Please enter your name to begin!");
                studentNameInput.focus();
                return;
            }
            
            appState.studentName = name;
            appState.currentQuestionIndex = 0;
            appState.score = 0;
            appState.skipped = 0;
            appState.answered = 0;
            
            initializeQuestions();
            saveStateToStorage();
            showPracticePage();
        }

        // Initialize and shuffle questions
        function initializeQuestions() {
            appState.currentQuestions = [...questions];
            shuffleArray(appState.currentQuestions);
        }

        // Fisher-Yates shuffle
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Load/save state
        function loadStateFromStorage() {
            const savedState = localStorage.getItem('ideolixGrammarPractice');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                appState.studentName = parsed.studentName || "";
                appState.currentQuestionIndex = parsed.currentQuestionIndex || 0;
                appState.score = parsed.score || 0;
                appState.skipped = parsed.skipped || 0;
                appState.answered = parsed.answered || 0;
                appState.currentQuestions = parsed.currentQuestions || [];
                
                if (appState.currentQuestions.length === 0) {
                    initializeQuestions();
                }
            } else {
                initializeQuestions();
            }
        }

        function saveStateToStorage() {
            localStorage.setItem('ideolixGrammarPractice', JSON.stringify(appState));
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
